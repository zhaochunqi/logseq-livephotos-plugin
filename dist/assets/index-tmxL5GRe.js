(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))v(d);new MutationObserver(d=>{for(const T of d)if(T.type==="childList")for(const S of T.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&v(S)}).observe(document,{childList:!0,subtree:!0});function b(d){const T={};return d.integrity&&(T.integrity=d.integrity),d.referrerPolicy&&(T.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?T.credentials="include":d.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function v(d){if(d.ep)return;d.ep=!0;const T=b(d);fetch(d.href,T)}})();var kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Xt={exports:{}};Xt.exports;var Sr;function So(){return Sr||(Sr=1,(function(q,l){(function(b,v){q.exports=v()})(self,(()=>(()=>{var b={227:(S,c,y)=>{var O=y(155);c.formatArgs=function(N){if(N[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+N[0]+(this.useColors?"%c ":" ")+"+"+S.exports.humanize(this.diff),!this.useColors)return;const J="color: "+this.color;N.splice(1,0,J,"color: inherit");let w=0,p=0;N[0].replace(/%[a-zA-Z%]/g,(k=>{k!=="%%"&&(w++,k==="%c"&&(p=w))})),N.splice(p,0,J)},c.save=function(N){try{N?c.storage.setItem("debug",N):c.storage.removeItem("debug")}catch{}},c.load=function(){let N;try{N=c.storage.getItem("debug")}catch{}return!N&&O!==void 0&&"env"in O&&(N=O.env.DEBUG),N},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=(function(){try{return localStorage}catch{}})(),c.destroy=(()=>{let N=!1;return()=>{N||(N=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),S.exports=y(447)(c);const{formatters:A}=S.exports;A.j=function(N){try{return JSON.stringify(N)}catch(J){return"[UnexpectedJSONParseError]: "+J.message}}},447:(S,c,y)=>{S.exports=function(O){function A(w){let p,k,h,E=null;function C(...R){if(!C.enabled)return;const B=C,F=Number(new Date),U=F-(p||F);B.diff=U,B.prev=p,B.curr=F,p=F,R[0]=A.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let i=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,((f,_)=>{if(f==="%%")return"%";i++;const x=A.formatters[_];if(typeof x=="function"){const K=R[i];f=x.call(B,K),R.splice(i,1),i--}return f})),A.formatArgs.call(B,R),(B.log||A.log).apply(B,R)}return C.namespace=w,C.useColors=A.useColors(),C.color=A.selectColor(w),C.extend=N,C.destroy=A.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(k!==A.namespaces&&(k=A.namespaces,h=A.enabled(w)),h),set:R=>{E=R}}),typeof A.init=="function"&&A.init(C),C}function N(w,p){const k=A(this.namespace+(p===void 0?":":p)+w);return k.log=this.log,k}function J(w){return w.toString().substring(2,w.toString().length-2).replace(/\.\*\?$/,"*")}return A.debug=A,A.default=A,A.coerce=function(w){return w instanceof Error?w.stack||w.message:w},A.disable=function(){const w=[...A.names.map(J),...A.skips.map(J).map((p=>"-"+p))].join(",");return A.enable(""),w},A.enable=function(w){let p;A.save(w),A.namespaces=w,A.names=[],A.skips=[];const k=(typeof w=="string"?w:"").split(/[\s,]+/),h=k.length;for(p=0;p<h;p++)k[p]&&((w=k[p].replace(/\*/g,".*?"))[0]==="-"?A.skips.push(new RegExp("^"+w.slice(1)+"$")):A.names.push(new RegExp("^"+w+"$")))},A.enabled=function(w){if(w[w.length-1]==="*")return!0;let p,k;for(p=0,k=A.skips.length;p<k;p++)if(A.skips[p].test(w))return!1;for(p=0,k=A.names.length;p<k;p++)if(A.names[p].test(w))return!0;return!1},A.humanize=y(824),A.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(O).forEach((w=>{A[w]=O[w]})),A.names=[],A.skips=[],A.formatters={},A.selectColor=function(w){let p=0;for(let k=0;k<w.length;k++)p=(p<<5)-p+w.charCodeAt(k),p|=0;return A.colors[Math.abs(p)%A.colors.length]},A.enable(A.load()),A}},996:S=>{var c=function(h){return(function(E){return!!E&&typeof E=="object"})(h)&&!(function(E){var C=Object.prototype.toString.call(E);return C==="[object RegExp]"||C==="[object Date]"||(function(R){return R.$$typeof===y})(E)})(h)},y=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function O(h,E){return E.clone!==!1&&E.isMergeableObject(h)?p((C=h,Array.isArray(C)?[]:{}),h,E):h;var C}function A(h,E,C){return h.concat(E).map((function(R){return O(R,C)}))}function N(h){return Object.keys(h).concat((function(E){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(E).filter((function(C){return Object.propertyIsEnumerable.call(E,C)})):[]})(h))}function J(h,E){try{return E in h}catch{return!1}}function w(h,E,C){var R={};return C.isMergeableObject(h)&&N(h).forEach((function(B){R[B]=O(h[B],C)})),N(E).forEach((function(B){(function(F,U){return J(F,U)&&!(Object.hasOwnProperty.call(F,U)&&Object.propertyIsEnumerable.call(F,U))})(h,B)||(J(h,B)&&C.isMergeableObject(E[B])?R[B]=(function(F,U){if(!U.customMerge)return p;var i=U.customMerge(F);return typeof i=="function"?i:p})(B,C)(h[B],E[B],C):R[B]=O(E[B],C))})),R}function p(h,E,C){(C=C||{}).arrayMerge=C.arrayMerge||A,C.isMergeableObject=C.isMergeableObject||c,C.cloneUnlessOtherwiseSpecified=O;var R=Array.isArray(E);return R===Array.isArray(h)?R?C.arrayMerge(h,E,C):w(h,E,C):O(E,C)}p.all=function(h,E){if(!Array.isArray(h))throw new Error("first argument should be an array");return h.reduce((function(C,R){return p(C,R,E)}),{})};var k=p;S.exports=k},856:function(S){S.exports=(function(){function c(j){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($){return typeof $}:function($){return $&&typeof Symbol=="function"&&$.constructor===Symbol&&$!==Symbol.prototype?"symbol":typeof $},c(j)}function y(j,$){return y=Object.setPrototypeOf||function(V,X){return V.__proto__=X,V},y(j,$)}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}}function A(j,$,V){return A=O()?Reflect.construct:function(X,pe,Re){var Ge=[null];Ge.push.apply(Ge,pe);var nt=new(Function.bind.apply(X,Ge));return Re&&y(nt,Re.prototype),nt},A.apply(null,arguments)}function N(j){return J(j)||w(j)||p(j)||h()}function J(j){if(Array.isArray(j))return k(j)}function w(j){if(typeof Symbol<"u"&&j[Symbol.iterator]!=null||j["@@iterator"]!=null)return Array.from(j)}function p(j,$){if(j){if(typeof j=="string")return k(j,$);var V=Object.prototype.toString.call(j).slice(8,-1);return V==="Object"&&j.constructor&&(V=j.constructor.name),V==="Map"||V==="Set"?Array.from(j):V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V)?k(j,$):void 0}}function k(j,$){($==null||$>j.length)&&($=j.length);for(var V=0,X=new Array($);V<$;V++)X[V]=j[V];return X}function h(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=Object.hasOwnProperty,C=Object.setPrototypeOf,R=Object.isFrozen,B=Object.getPrototypeOf,F=Object.getOwnPropertyDescriptor,U=Object.freeze,i=Object.seal,f=Object.create,_=typeof Reflect<"u"&&Reflect,x=_.apply,K=_.construct;x||(x=function(j,$,V){return j.apply($,V)}),U||(U=function(j){return j}),i||(i=function(j){return j}),K||(K=function(j,$){return A(j,N($))});var ne=te(Array.prototype.forEach),ae=te(Array.prototype.pop),he=te(Array.prototype.push),_e=te(String.prototype.toLowerCase),Ce=te(String.prototype.match),be=te(String.prototype.replace),kt=te(String.prototype.indexOf),g=te(String.prototype.trim),P=te(RegExp.prototype.test),G=Se(TypeError);function te(j){return function($){for(var V=arguments.length,X=new Array(V>1?V-1:0),pe=1;pe<V;pe++)X[pe-1]=arguments[pe];return x(j,$,X)}}function Se(j){return function(){for(var $=arguments.length,V=new Array($),X=0;X<$;X++)V[X]=arguments[X];return K(j,V)}}function D(j,$){C&&C(j,null);for(var V=$.length;V--;){var X=$[V];if(typeof X=="string"){var pe=_e(X);pe!==X&&(R($)||($[V]=pe),X=pe)}j[X]=!0}return j}function Y(j){var $,V=f(null);for($ in j)x(E,j,[$])&&(V[$]=j[$]);return V}function se(j,$){for(;j!==null;){var V=F(j,$);if(V){if(V.get)return te(V.get);if(typeof V.value=="function")return te(V.value)}j=B(j)}function X(pe){return console.warn("fallback value for",pe),null}return X}var Ae=U(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xe=U(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),je=U(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),tt=U(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),fe=U(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ce=U(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ke=U(["#text"]),Oe=U(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Fe=U(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ke=U(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Te=U(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Pe=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ht=i(/<%[\w\W]*|[\w\W]*%>/gm),En=i(/^data-[\-\w.\u00B7-\uFFFF]/),Ne=i(/^aria-[\-\w]+$/),He=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),en=i(/^(?:\w+script|data):/i),An=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),On=i(/^html$/i),pt=function(){return typeof window>"u"?null:window},Pn=function(j,$){if(c(j)!=="object"||typeof j.createPolicy!="function")return null;var V=null,X="data-tt-policy-suffix";$.currentScript&&$.currentScript.hasAttribute(X)&&(V=$.currentScript.getAttribute(X));var pe="dompurify"+(V?"#"+V:"");try{return j.createPolicy(pe,{createHTML:function(Re){return Re}})}catch{return console.warn("TrustedTypes policy "+pe+" could not be created."),null}};function tn(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pt(),$=function(o){return tn(o)};if($.version="2.3.8",$.removed=[],!j||!j.document||j.document.nodeType!==9)return $.isSupported=!1,$;var V=j.document,X=j.document,pe=j.DocumentFragment,Re=j.HTMLTemplateElement,Ge=j.Node,nt=j.Element,Dt=j.NodeFilter,nn=j.NamedNodeMap,Qe=nn===void 0?j.NamedNodeMap||j.MozNamedAttrMap:nn,Ln=j.HTMLFormElement,jn=j.DOMParser,Tn=j.trustedTypes,Et=nt.prototype,In=se(Et,"cloneNode"),Mn=se(Et,"nextSibling"),Fn=se(Et,"childNodes"),zt=se(Et,"parentNode");if(typeof Re=="function"){var Ue=X.createElement("template");Ue.content&&Ue.content.ownerDocument&&(X=Ue.content.ownerDocument)}var $e=Pn(Tn,V),rn=$e?$e.createHTML(""):"",At=X,Bt=At.implementation,rt=At.createNodeIterator,on=At.createDocumentFragment,sn=At.getElementsByTagName,Nn=V.importNode,an={};try{an=Y(X).documentMode?X.documentMode:{}}catch{}var Ie={};$.isSupported=typeof zt=="function"&&Bt&&Bt.createHTMLDocument!==void 0&&an!==9;var gt,We,Ot=Pe,Pt=ht,qt=En,Rn=Ne,ln=en,Lt=An,re=He,ge=null,cn=D({},[].concat(N(Ae),N(xe),N(je),N(fe),N(ke))),me=null,ot=D({},[].concat(N(Oe),N(Fe),N(Ke),N(Te))),ue=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),it=null,jt=null,Ht=!0,Gt=!0,un=!1,st=!1,Ye=!1,Wt=!1,Vt=!1,at=!1,Tt=!1,lt=!1,fn=!0,Jt=!0,ct=!1,De={},ut=null,dn=D({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),hn=null,pn=D({},["audio","video","img","source","image","track"]),Zt=null,Xe=D({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ft="http://www.w3.org/1998/Math/MathML",Kt="http://www.w3.org/2000/svg",Ve="http://www.w3.org/1999/xhtml",It=Ve,gn=!1,mt=["application/xhtml+xml","text/html"],vt="text/html",dt=null,Un=X.createElement("form"),mn=function(o){return o instanceof RegExp||o instanceof Function},Qt=function(o){dt&&dt===o||(o&&c(o)==="object"||(o={}),o=Y(o),ge="ALLOWED_TAGS"in o?D({},o.ALLOWED_TAGS):cn,me="ALLOWED_ATTR"in o?D({},o.ALLOWED_ATTR):ot,Zt="ADD_URI_SAFE_ATTR"in o?D(Y(Xe),o.ADD_URI_SAFE_ATTR):Xe,hn="ADD_DATA_URI_TAGS"in o?D(Y(pn),o.ADD_DATA_URI_TAGS):pn,ut="FORBID_CONTENTS"in o?D({},o.FORBID_CONTENTS):dn,it="FORBID_TAGS"in o?D({},o.FORBID_TAGS):{},jt="FORBID_ATTR"in o?D({},o.FORBID_ATTR):{},De="USE_PROFILES"in o&&o.USE_PROFILES,Ht=o.ALLOW_ARIA_ATTR!==!1,Gt=o.ALLOW_DATA_ATTR!==!1,un=o.ALLOW_UNKNOWN_PROTOCOLS||!1,st=o.SAFE_FOR_TEMPLATES||!1,Ye=o.WHOLE_DOCUMENT||!1,at=o.RETURN_DOM||!1,Tt=o.RETURN_DOM_FRAGMENT||!1,lt=o.RETURN_TRUSTED_TYPE||!1,Vt=o.FORCE_BODY||!1,fn=o.SANITIZE_DOM!==!1,Jt=o.KEEP_CONTENT!==!1,ct=o.IN_PLACE||!1,re=o.ALLOWED_URI_REGEXP||re,It=o.NAMESPACE||Ve,o.CUSTOM_ELEMENT_HANDLING&&mn(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ue.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&mn(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ue.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ue.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),gt=gt=mt.indexOf(o.PARSER_MEDIA_TYPE)===-1?vt:o.PARSER_MEDIA_TYPE,We=gt==="application/xhtml+xml"?function(M){return M}:_e,st&&(Gt=!1),Tt&&(at=!0),De&&(ge=D({},N(ke)),me=[],De.html===!0&&(D(ge,Ae),D(me,Oe)),De.svg===!0&&(D(ge,xe),D(me,Fe),D(me,Te)),De.svgFilters===!0&&(D(ge,je),D(me,Fe),D(me,Te)),De.mathMl===!0&&(D(ge,fe),D(me,Ke),D(me,Te))),o.ADD_TAGS&&(ge===cn&&(ge=Y(ge)),D(ge,o.ADD_TAGS)),o.ADD_ATTR&&(me===ot&&(me=Y(me)),D(me,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&D(Zt,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ut===dn&&(ut=Y(ut)),D(ut,o.FORBID_CONTENTS)),Jt&&(ge["#text"]=!0),Ye&&D(ge,["html","head","body"]),ge.table&&(D(ge,["tbody"]),delete it.tbody),U&&U(o),dt=o)},vn=D({},["mi","mo","mn","ms","mtext"]),yn=D({},["foreignobject","desc","title","annotation-xml"]),$n=D({},["title","style","font","a","script"]),ze=D({},xe);D(ze,je),D(ze,tt);var Mt=D({},fe);D(Mt,ce);var Dn=function(o){var M=zt(o);M&&M.tagName||(M={namespaceURI:Ve,tagName:"template"});var L=_e(o.tagName),oe=_e(M.tagName);return o.namespaceURI===Kt?M.namespaceURI===Ve?L==="svg":M.namespaceURI===ft?L==="svg"&&(oe==="annotation-xml"||vn[oe]):!!ze[L]:o.namespaceURI===ft?M.namespaceURI===Ve?L==="math":M.namespaceURI===Kt?L==="math"&&yn[oe]:!!Mt[L]:o.namespaceURI===Ve&&!(M.namespaceURI===Kt&&!yn[oe])&&!(M.namespaceURI===ft&&!vn[oe])&&!Mt[L]&&($n[L]||!ze[L])},Be=function(o){he($.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=rn}catch{o.remove()}}},yt=function(o,M){try{he($.removed,{attribute:M.getAttributeNode(o),from:M})}catch{he($.removed,{attribute:null,from:M})}if(M.removeAttribute(o),o==="is"&&!me[o])if(at||Tt)try{Be(M)}catch{}else try{M.setAttribute(o,"")}catch{}},bn=function(o){var M,L;if(Vt)o="<remove></remove>"+o;else{var oe=Ce(o,/^[\r\n\t ]+/);L=oe&&oe[0]}gt==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var de=$e?$e.createHTML(o):o;if(It===Ve)try{M=new jn().parseFromString(de,gt)}catch{}if(!M||!M.documentElement){M=Bt.createDocument(It,"template",null);try{M.documentElement.innerHTML=gn?"":de}catch{}}var we=M.body||M.documentElement;return o&&L&&we.insertBefore(X.createTextNode(L),we.childNodes[0]||null),It===Ve?sn.call(M,Ye?"html":"body")[0]:Ye?M.documentElement:we},wn=function(o){return rt.call(o.ownerDocument||o,o,Dt.SHOW_ELEMENT|Dt.SHOW_COMMENT|Dt.SHOW_TEXT,null,!1)},zn=function(o){return o instanceof Ln&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Qe)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},bt=function(o){return c(Ge)==="object"?o instanceof Ge:o&&c(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},Ee=function(o,M,L){Ie[o]&&ne(Ie[o],(function(oe){oe.call($,M,L,dt)}))},wt=function(o){var M;if(Ee("beforeSanitizeElements",o,null),zn(o)||P(/[\u0080-\uFFFF]/,o.nodeName))return Be(o),!0;var L=We(o.nodeName);if(Ee("uponSanitizeElement",o,{tagName:L,allowedTags:ge}),o.hasChildNodes()&&!bt(o.firstElementChild)&&(!bt(o.content)||!bt(o.content.firstElementChild))&&P(/<[/\w]/g,o.innerHTML)&&P(/<[/\w]/g,o.textContent)||L==="select"&&P(/<template/i,o.innerHTML))return Be(o),!0;if(!ge[L]||it[L]){if(!it[L]&&et(L)&&(ue.tagNameCheck instanceof RegExp&&P(ue.tagNameCheck,L)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(L)))return!1;if(Jt&&!ut[L]){var oe=zt(o)||o.parentNode,de=Fn(o)||o.childNodes;if(de&&oe)for(var we=de.length-1;we>=0;--we)oe.insertBefore(In(de[we],!0),Mn(o))}return Be(o),!0}return o instanceof nt&&!Dn(o)?(Be(o),!0):L!=="noscript"&&L!=="noembed"||!P(/<\/no(script|embed)/i,o.innerHTML)?(st&&o.nodeType===3&&(M=o.textContent,M=be(M,Ot," "),M=be(M,Pt," "),o.textContent!==M&&(he($.removed,{element:o.cloneNode()}),o.textContent=M)),Ee("afterSanitizeElements",o,null),!1):(Be(o),!0)},_n=function(o,M,L){if(fn&&(M==="id"||M==="name")&&(L in X||L in Un))return!1;if(!(Gt&&!jt[M]&&P(qt,M))){if(!(Ht&&P(Rn,M))){if(!me[M]||jt[M]){if(!(et(o)&&(ue.tagNameCheck instanceof RegExp&&P(ue.tagNameCheck,o)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(o))&&(ue.attributeNameCheck instanceof RegExp&&P(ue.attributeNameCheck,M)||ue.attributeNameCheck instanceof Function&&ue.attributeNameCheck(M))||M==="is"&&ue.allowCustomizedBuiltInElements&&(ue.tagNameCheck instanceof RegExp&&P(ue.tagNameCheck,L)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(L))))return!1}else if(!Zt[M]){if(!P(re,be(L,Lt,""))){if((M!=="src"&&M!=="xlink:href"&&M!=="href"||o==="script"||kt(L,"data:")!==0||!hn[o])&&!(un&&!P(ln,be(L,Lt,"")))){if(L)return!1}}}}}return!0},et=function(o){return o.indexOf("-")>0},_t=function(o){var M,L,oe,de;Ee("beforeSanitizeAttributes",o,null);var we=o.attributes;if(we){var ve={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:me};for(de=we.length;de--;){var xt=M=we[de],Je=xt.name,Le=xt.namespaceURI;if(L=Je==="value"?M.value:g(M.value),oe=We(Je),ve.attrName=oe,ve.attrValue=L,ve.keepAttr=!0,ve.forceKeepAttr=void 0,Ee("uponSanitizeAttribute",o,ve),L=ve.attrValue,!ve.forceKeepAttr&&(yt(Je,o),ve.keepAttr))if(P(/\/>/i,L))yt(Je,o);else{st&&(L=be(L,Ot," "),L=be(L,Pt," "));var Yt=We(o.nodeName);if(_n(Yt,oe,L))try{Le?o.setAttributeNS(Le,Je,L):o.setAttribute(Je,L),ae($.removed)}catch{}}}Ee("afterSanitizeAttributes",o,null)}},Bn=function o(M){var L,oe=wn(M);for(Ee("beforeSanitizeShadowDOM",M,null);L=oe.nextNode();)Ee("uponSanitizeShadowNode",L,null),wt(L)||(L.content instanceof pe&&o(L.content),_t(L));Ee("afterSanitizeShadowDOM",M,null)};return $.sanitize=function(o,M){var L,oe,de,we,ve;if((gn=!o)&&(o="<!-->"),typeof o!="string"&&!bt(o)){if(typeof o.toString!="function")throw G("toString is not a function");if(typeof(o=o.toString())!="string")throw G("dirty is not a string, aborting")}if(!$.isSupported){if(c(j.toStaticHTML)==="object"||typeof j.toStaticHTML=="function"){if(typeof o=="string")return j.toStaticHTML(o);if(bt(o))return j.toStaticHTML(o.outerHTML)}return o}if(Wt||Qt(M),$.removed=[],typeof o=="string"&&(ct=!1),ct){if(o.nodeName){var xt=We(o.nodeName);if(!ge[xt]||it[xt])throw G("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Ge)(oe=(L=bn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&oe.nodeName==="BODY"||oe.nodeName==="HTML"?L=oe:L.appendChild(oe);else{if(!at&&!st&&!Ye&&o.indexOf("<")===-1)return $e&&lt?$e.createHTML(o):o;if(!(L=bn(o)))return at?null:lt?rn:""}L&&Vt&&Be(L.firstChild);for(var Je=wn(ct?o:L);de=Je.nextNode();)de.nodeType===3&&de===we||wt(de)||(de.content instanceof pe&&Bn(de.content),_t(de),we=de);if(we=null,ct)return o;if(at){if(Tt)for(ve=on.call(L.ownerDocument);L.firstChild;)ve.appendChild(L.firstChild);else ve=L;return me.shadowroot&&(ve=Nn.call(V,ve,!0)),ve}var Le=Ye?L.outerHTML:L.innerHTML;return Ye&&ge["!doctype"]&&L.ownerDocument&&L.ownerDocument.doctype&&L.ownerDocument.doctype.name&&P(On,L.ownerDocument.doctype.name)&&(Le="<!DOCTYPE "+L.ownerDocument.doctype.name+`>
`+Le),st&&(Le=be(Le,Ot," "),Le=be(Le,Pt," ")),$e&&lt?$e.createHTML(Le):Le},$.setConfig=function(o){Qt(o),Wt=!0},$.clearConfig=function(){dt=null,Wt=!1},$.isValidAttribute=function(o,M,L){dt||Qt({});var oe=We(o),de=We(M);return _n(oe,de,L)},$.addHook=function(o,M){typeof M=="function"&&(Ie[o]=Ie[o]||[],he(Ie[o],M))},$.removeHook=function(o){if(Ie[o])return ae(Ie[o])},$.removeHooks=function(o){Ie[o]&&(Ie[o]=[])},$.removeAllHooks=function(){Ie={}},$}return tn()})()},729:S=>{var c=Object.prototype.hasOwnProperty,y="~";function O(){}function A(p,k,h){this.fn=p,this.context=k,this.once=h||!1}function N(p,k,h,E,C){if(typeof h!="function")throw new TypeError("The listener must be a function");var R=new A(h,E||p,C),B=y?y+k:k;return p._events[B]?p._events[B].fn?p._events[B]=[p._events[B],R]:p._events[B].push(R):(p._events[B]=R,p._eventsCount++),p}function J(p,k){--p._eventsCount==0?p._events=new O:delete p._events[k]}function w(){this._events=new O,this._eventsCount=0}Object.create&&(O.prototype=Object.create(null),new O().__proto__||(y=!1)),w.prototype.eventNames=function(){var p,k,h=[];if(this._eventsCount===0)return h;for(k in p=this._events)c.call(p,k)&&h.push(y?k.slice(1):k);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(p)):h},w.prototype.listeners=function(p){var k=y?y+p:p,h=this._events[k];if(!h)return[];if(h.fn)return[h.fn];for(var E=0,C=h.length,R=new Array(C);E<C;E++)R[E]=h[E].fn;return R},w.prototype.listenerCount=function(p){var k=y?y+p:p,h=this._events[k];return h?h.fn?1:h.length:0},w.prototype.emit=function(p,k,h,E,C,R){var B=y?y+p:p;if(!this._events[B])return!1;var F,U,i=this._events[B],f=arguments.length;if(i.fn){switch(i.once&&this.removeListener(p,i.fn,void 0,!0),f){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,k),!0;case 3:return i.fn.call(i.context,k,h),!0;case 4:return i.fn.call(i.context,k,h,E),!0;case 5:return i.fn.call(i.context,k,h,E,C),!0;case 6:return i.fn.call(i.context,k,h,E,C,R),!0}for(U=1,F=new Array(f-1);U<f;U++)F[U-1]=arguments[U];i.fn.apply(i.context,F)}else{var _,x=i.length;for(U=0;U<x;U++)switch(i[U].once&&this.removeListener(p,i[U].fn,void 0,!0),f){case 1:i[U].fn.call(i[U].context);break;case 2:i[U].fn.call(i[U].context,k);break;case 3:i[U].fn.call(i[U].context,k,h);break;case 4:i[U].fn.call(i[U].context,k,h,E);break;default:if(!F)for(_=1,F=new Array(f-1);_<f;_++)F[_-1]=arguments[_];i[U].fn.apply(i[U].context,F)}}return!0},w.prototype.on=function(p,k,h){return N(this,p,k,h,!1)},w.prototype.once=function(p,k,h){return N(this,p,k,h,!0)},w.prototype.removeListener=function(p,k,h,E){var C=y?y+p:p;if(!this._events[C])return this;if(!k)return J(this,C),this;var R=this._events[C];if(R.fn)R.fn!==k||E&&!R.once||h&&R.context!==h||J(this,C);else{for(var B=0,F=[],U=R.length;B<U;B++)(R[B].fn!==k||E&&!R[B].once||h&&R[B].context!==h)&&F.push(R[B]);F.length?this._events[C]=F.length===1?F[0]:F:J(this,C)}return this},w.prototype.removeAllListeners=function(p){var k;return p?(k=y?y+p:p,this._events[k]&&J(this,k)):(this._events=new O,this._eventsCount=0),this},w.prototype.off=w.prototype.removeListener,w.prototype.addListener=w.prototype.on,w.prefixed=y,w.EventEmitter=w,S.exports=w},717:S=>{typeof Object.create=="function"?S.exports=function(c,y){c.super_=y,c.prototype=Object.create(y.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:S.exports=function(c,y){c.super_=y;var O=function(){};O.prototype=y.prototype,c.prototype=new O,c.prototype.constructor=c}},824:S=>{var c=1e3,y=60*c,O=60*y,A=24*O,N=7*A,J=365.25*A;function w(p,k,h,E){var C=k>=1.5*h;return Math.round(p/h)+" "+E+(C?"s":"")}S.exports=function(p,k){k=k||{};var h=typeof p;if(h==="string"&&p.length>0)return(function(E){if(!((E=String(E)).length>100)){var C=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(E);if(C){var R=parseFloat(C[1]);switch((C[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return R*J;case"weeks":case"week":case"w":return R*N;case"days":case"day":case"d":return R*A;case"hours":case"hour":case"hrs":case"hr":case"h":return R*O;case"minutes":case"minute":case"mins":case"min":case"m":return R*y;case"seconds":case"second":case"secs":case"sec":case"s":return R*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return R;default:return}}}})(p);if(h==="number"&&isFinite(p))return k.long?(function(E){var C=Math.abs(E);return C>=A?w(E,C,A,"day"):C>=O?w(E,C,O,"hour"):C>=y?w(E,C,y,"minute"):C>=c?w(E,C,c,"second"):E+" ms"})(p):(function(E){var C=Math.abs(E);return C>=A?Math.round(E/A)+"d":C>=O?Math.round(E/O)+"h":C>=y?Math.round(E/y)+"m":C>=c?Math.round(E/c)+"s":E+"ms"})(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},520:(S,c,y)=>{var O=y(155),A=O.platform==="win32",N=y(539);function J(i,f){for(var _=[],x=0;x<i.length;x++){var K=i[x];K&&K!=="."&&(K===".."?_.length&&_[_.length-1]!==".."?_.pop():f&&_.push(".."):_.push(K))}return _}function w(i){for(var f=i.length-1,_=0;_<=f&&!i[_];_++);for(var x=f;x>=0&&!i[x];x--);return _===0&&x===f?i:_>x?[]:i.slice(_,x+1)}var p=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,k=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,h={};function E(i){var f=p.exec(i),_=(f[1]||"")+(f[2]||""),x=f[3]||"",K=k.exec(x);return[_,K[1],K[2],K[3]]}function C(i){var f=p.exec(i),_=f[1]||"",x=!!_&&_[1]!==":";return{device:_,isUnc:x,isAbsolute:x||!!f[2],tail:f[3]}}function R(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}h.resolve=function(){for(var i="",f="",_=!1,x=arguments.length-1;x>=-1;x--){var K;if(x>=0?K=arguments[x]:i?(K=O.env["="+i])&&K.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(K=i+"\\"):K=O.cwd(),!N.isString(K))throw new TypeError("Arguments to path.resolve must be strings");if(K){var ne=C(K),ae=ne.device,he=ne.isUnc,_e=ne.isAbsolute,Ce=ne.tail;if((!ae||!i||ae.toLowerCase()===i.toLowerCase())&&(i||(i=ae),_||(f=Ce+"\\"+f,_=_e),i&&_))break}}return he&&(i=R(i)),i+(_?"\\":"")+(f=J(f.split(/[\\\/]+/),!_).join("\\"))||"."},h.normalize=function(i){var f=C(i),_=f.device,x=f.isUnc,K=f.isAbsolute,ne=f.tail,ae=/[\\\/]$/.test(ne);return(ne=J(ne.split(/[\\\/]+/),!K).join("\\"))||K||(ne="."),ne&&ae&&(ne+="\\"),x&&(_=R(_)),_+(K?"\\":"")+ne},h.isAbsolute=function(i){return C(i).isAbsolute},h.join=function(){for(var i=[],f=0;f<arguments.length;f++){var _=arguments[f];if(!N.isString(_))throw new TypeError("Arguments to path.join must be strings");_&&i.push(_)}var x=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(x=x.replace(/^[\\\/]{2,}/,"\\")),h.normalize(x)},h.relative=function(i,f){i=h.resolve(i),f=h.resolve(f);for(var _=i.toLowerCase(),x=f.toLowerCase(),K=w(f.split("\\")),ne=w(_.split("\\")),ae=w(x.split("\\")),he=Math.min(ne.length,ae.length),_e=he,Ce=0;Ce<he;Ce++)if(ne[Ce]!==ae[Ce]){_e=Ce;break}if(_e==0)return f;var be=[];for(Ce=_e;Ce<ne.length;Ce++)be.push("..");return(be=be.concat(K.slice(_e))).join("\\")},h._makeLong=function(i){if(!N.isString(i))return i;if(!i)return"";var f=h.resolve(i);return/^[a-zA-Z]\:\\/.test(f)?"\\\\?\\"+f:/^\\\\[^?.]/.test(f)?"\\\\?\\UNC\\"+f.substring(2):i},h.dirname=function(i){var f=E(i),_=f[0],x=f[1];return _||x?(x&&(x=x.substr(0,x.length-1)),_+x):"."},h.basename=function(i,f){var _=E(i)[2];return f&&_.substr(-1*f.length)===f&&(_=_.substr(0,_.length-f.length)),_},h.extname=function(i){return E(i)[3]},h.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var f=i.root||"";if(!N.isString(f))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var _=i.dir,x=i.base||"";return _?_[_.length-1]===h.sep?_+x:_+h.sep+x:x},h.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var f=E(i);if(!f||f.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:f[0],dir:f[0]+f[1].slice(0,-1),base:f[2],ext:f[3],name:f[2].slice(0,f[2].length-f[3].length)}},h.sep="\\",h.delimiter=";";var B=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,F={};function U(i){return B.exec(i).slice(1)}F.resolve=function(){for(var i="",f=!1,_=arguments.length-1;_>=-1&&!f;_--){var x=_>=0?arguments[_]:O.cwd();if(!N.isString(x))throw new TypeError("Arguments to path.resolve must be strings");x&&(i=x+"/"+i,f=x[0]==="/")}return(f?"/":"")+(i=J(i.split("/"),!f).join("/"))||"."},F.normalize=function(i){var f=F.isAbsolute(i),_=i&&i[i.length-1]==="/";return(i=J(i.split("/"),!f).join("/"))||f||(i="."),i&&_&&(i+="/"),(f?"/":"")+i},F.isAbsolute=function(i){return i.charAt(0)==="/"},F.join=function(){for(var i="",f=0;f<arguments.length;f++){var _=arguments[f];if(!N.isString(_))throw new TypeError("Arguments to path.join must be strings");_&&(i+=i?"/"+_:_)}return F.normalize(i)},F.relative=function(i,f){i=F.resolve(i).substr(1),f=F.resolve(f).substr(1);for(var _=w(i.split("/")),x=w(f.split("/")),K=Math.min(_.length,x.length),ne=K,ae=0;ae<K;ae++)if(_[ae]!==x[ae]){ne=ae;break}var he=[];for(ae=ne;ae<_.length;ae++)he.push("..");return(he=he.concat(x.slice(ne))).join("/")},F._makeLong=function(i){return i},F.dirname=function(i){var f=U(i),_=f[0],x=f[1];return _||x?(x&&(x=x.substr(0,x.length-1)),_+x):"."},F.basename=function(i,f){var _=U(i)[2];return f&&_.substr(-1*f.length)===f&&(_=_.substr(0,_.length-f.length)),_},F.extname=function(i){return U(i)[3]},F.format=function(i){if(!N.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var f=i.root||"";if(!N.isString(f))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+F.sep:"")+(i.base||"")},F.parse=function(i){if(!N.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var f=U(i);if(!f||f.length!==4)throw new TypeError("Invalid path '"+i+"'");return f[1]=f[1]||"",f[2]=f[2]||"",f[3]=f[3]||"",{root:f[0],dir:f[0]+f[1].slice(0,-1),base:f[2],ext:f[3],name:f[2].slice(0,f[2].length-f[3].length)}},F.sep="/",F.delimiter=":",S.exports=A?h:F,S.exports.posix=F,S.exports.win32=h},155:S=>{var c,y,O=S.exports={};function A(){throw new Error("setTimeout has not been defined")}function N(){throw new Error("clearTimeout has not been defined")}function J(F){if(c===setTimeout)return setTimeout(F,0);if((c===A||!c)&&setTimeout)return c=setTimeout,setTimeout(F,0);try{return c(F,0)}catch{try{return c.call(null,F,0)}catch{return c.call(this,F,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:A}catch{c=A}try{y=typeof clearTimeout=="function"?clearTimeout:N}catch{y=N}})();var w,p=[],k=!1,h=-1;function E(){k&&w&&(k=!1,w.length?p=w.concat(p):h=-1,p.length&&C())}function C(){if(!k){var F=J(E);k=!0;for(var U=p.length;U;){for(w=p,p=[];++h<U;)w&&w[h].run();h=-1,U=p.length}w=null,k=!1,(function(i){if(y===clearTimeout)return clearTimeout(i);if((y===N||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(i);try{y(i)}catch{try{return y.call(null,i)}catch{return y.call(this,i)}}})(F)}}function R(F,U){this.fun=F,this.array=U}function B(){}O.nextTick=function(F){var U=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)U[i-1]=arguments[i];p.push(new R(F,U)),p.length!==1||k||J(C)},R.prototype.run=function(){this.fun.apply(null,this.array)},O.title="browser",O.browser=!0,O.env={},O.argv=[],O.version="",O.versions={},O.on=B,O.addListener=B,O.once=B,O.off=B,O.removeListener=B,O.removeAllListeners=B,O.emit=B,O.prependListener=B,O.prependOnceListener=B,O.listeners=function(F){return[]},O.binding=function(F){throw new Error("process.binding is not supported")},O.cwd=function(){return"/"},O.chdir=function(F){throw new Error("process.chdir is not supported")},O.umask=function(){return 0}},384:S=>{S.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},539:(S,c,y)=>{var O=y(155),A=/%[sdj%]/g;c.format=function(g){if(!i(g)){for(var P=[],G=0;G<arguments.length;G++)P.push(w(arguments[G]));return P.join(" ")}G=1;for(var te=arguments,Se=te.length,D=String(g).replace(A,(function(se){if(se==="%%")return"%";if(G>=Se)return se;switch(se){case"%s":return String(te[G++]);case"%d":return Number(te[G++]);case"%j":try{return JSON.stringify(te[G++])}catch{return"[Circular]"}default:return se}})),Y=te[G];G<Se;Y=te[++G])F(Y)||!x(Y)?D+=" "+Y:D+=" "+w(Y);return D},c.deprecate=function(g,P){if(f(y.g.process))return function(){return c.deprecate(g,P).apply(this,arguments)};if(O.noDeprecation===!0)return g;var G=!1;return function(){if(!G){if(O.throwDeprecation)throw new Error(P);O.traceDeprecation?console.trace(P):console.error(P),G=!0}return g.apply(this,arguments)}};var N,J={};function w(g,P){var G={seen:[],stylize:k};return arguments.length>=3&&(G.depth=arguments[2]),arguments.length>=4&&(G.colors=arguments[3]),B(P)?G.showHidden=P:P&&c._extend(G,P),f(G.showHidden)&&(G.showHidden=!1),f(G.depth)&&(G.depth=2),f(G.colors)&&(G.colors=!1),f(G.customInspect)&&(G.customInspect=!0),G.colors&&(G.stylize=p),h(G,g,G.depth)}function p(g,P){var G=w.styles[P];return G?"\x1B["+w.colors[G][0]+"m"+g+"\x1B["+w.colors[G][1]+"m":g}function k(g,P){return g}function h(g,P,G){if(g.customInspect&&P&&ae(P.inspect)&&P.inspect!==c.inspect&&(!P.constructor||P.constructor.prototype!==P)){var te=P.inspect(G,g);return i(te)||(te=h(g,te,G)),te}var Se=(function(fe,ce){if(f(ce))return fe.stylize("undefined","undefined");if(i(ce)){var ke="'"+JSON.stringify(ce).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return fe.stylize(ke,"string")}if(U(ce))return fe.stylize(""+ce,"number");if(B(ce))return fe.stylize(""+ce,"boolean");if(F(ce))return fe.stylize("null","null")})(g,P);if(Se)return Se;var D=Object.keys(P),Y=(function(fe){var ce={};return fe.forEach((function(ke,Oe){ce[ke]=!0})),ce})(D);if(g.showHidden&&(D=Object.getOwnPropertyNames(P)),ne(P)&&(D.indexOf("message")>=0||D.indexOf("description")>=0))return E(P);if(D.length===0){if(ae(P)){var se=P.name?": "+P.name:"";return g.stylize("[Function"+se+"]","special")}if(_(P))return g.stylize(RegExp.prototype.toString.call(P),"regexp");if(K(P))return g.stylize(Date.prototype.toString.call(P),"date");if(ne(P))return E(P)}var Ae,xe="",je=!1,tt=["{","}"];return R(P)&&(je=!0,tt=["[","]"]),ae(P)&&(xe=" [Function"+(P.name?": "+P.name:"")+"]"),_(P)&&(xe=" "+RegExp.prototype.toString.call(P)),K(P)&&(xe=" "+Date.prototype.toUTCString.call(P)),ne(P)&&(xe=" "+E(P)),D.length!==0||je&&P.length!=0?G<0?_(P)?g.stylize(RegExp.prototype.toString.call(P),"regexp"):g.stylize("[Object]","special"):(g.seen.push(P),Ae=je?(function(fe,ce,ke,Oe,Fe){for(var Ke=[],Te=0,Pe=ce.length;Te<Pe;++Te)kt(ce,String(Te))?Ke.push(C(fe,ce,ke,Oe,String(Te),!0)):Ke.push("");return Fe.forEach((function(ht){ht.match(/^\d+$/)||Ke.push(C(fe,ce,ke,Oe,ht,!0))})),Ke})(g,P,G,Y,D):D.map((function(fe){return C(g,P,G,Y,fe,je)})),g.seen.pop(),(function(fe,ce,ke){return fe.reduce((function(Oe,Fe){return Fe.indexOf(`
`)>=0,Oe+Fe.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?ke[0]+(ce===""?"":ce+`
 `)+" "+fe.join(`,
  `)+" "+ke[1]:ke[0]+ce+" "+fe.join(", ")+" "+ke[1]})(Ae,xe,tt)):tt[0]+xe+tt[1]}function E(g){return"["+Error.prototype.toString.call(g)+"]"}function C(g,P,G,te,Se,D){var Y,se,Ae;if((Ae=Object.getOwnPropertyDescriptor(P,Se)||{value:P[Se]}).get?se=Ae.set?g.stylize("[Getter/Setter]","special"):g.stylize("[Getter]","special"):Ae.set&&(se=g.stylize("[Setter]","special")),kt(te,Se)||(Y="["+Se+"]"),se||(g.seen.indexOf(Ae.value)<0?(se=F(G)?h(g,Ae.value,null):h(g,Ae.value,G-1)).indexOf(`
`)>-1&&(se=D?se.split(`
`).map((function(xe){return"  "+xe})).join(`
`).substr(2):`
`+se.split(`
`).map((function(xe){return"   "+xe})).join(`
`)):se=g.stylize("[Circular]","special")),f(Y)){if(D&&Se.match(/^\d+$/))return se;(Y=JSON.stringify(""+Se)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Y=Y.substr(1,Y.length-2),Y=g.stylize(Y,"name")):(Y=Y.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Y=g.stylize(Y,"string"))}return Y+": "+se}function R(g){return Array.isArray(g)}function B(g){return typeof g=="boolean"}function F(g){return g===null}function U(g){return typeof g=="number"}function i(g){return typeof g=="string"}function f(g){return g===void 0}function _(g){return x(g)&&he(g)==="[object RegExp]"}function x(g){return typeof g=="object"&&g!==null}function K(g){return x(g)&&he(g)==="[object Date]"}function ne(g){return x(g)&&(he(g)==="[object Error]"||g instanceof Error)}function ae(g){return typeof g=="function"}function he(g){return Object.prototype.toString.call(g)}function _e(g){return g<10?"0"+g.toString(10):g.toString(10)}c.debuglog=function(g){if(f(N)&&(N=O.env.NODE_DEBUG||""),g=g.toUpperCase(),!J[g])if(new RegExp("\\b"+g+"\\b","i").test(N)){var P=O.pid;J[g]=function(){var G=c.format.apply(c,arguments);console.error("%s %d: %s",g,P,G)}}else J[g]=function(){};return J[g]},c.inspect=w,w.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},w.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=R,c.isBoolean=B,c.isNull=F,c.isNullOrUndefined=function(g){return g==null},c.isNumber=U,c.isString=i,c.isSymbol=function(g){return typeof g=="symbol"},c.isUndefined=f,c.isRegExp=_,c.isObject=x,c.isDate=K,c.isError=ne,c.isFunction=ae,c.isPrimitive=function(g){return g===null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||typeof g=="symbol"||g===void 0},c.isBuffer=y(384);var Ce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function be(){var g=new Date,P=[_e(g.getHours()),_e(g.getMinutes()),_e(g.getSeconds())].join(":");return[g.getDate(),Ce[g.getMonth()],P].join(" ")}function kt(g,P){return Object.prototype.hasOwnProperty.call(g,P)}c.log=function(){console.log("%s - %s",be(),c.format.apply(c,arguments))},c.inherits=y(717),c._extend=function(g,P){if(!P||!x(P))return g;for(var G=Object.keys(P),te=G.length;te--;)g[G[te]]=P[G[te]];return g}}},v={};function d(S){var c=v[S];if(c!==void 0)return c.exports;var y=v[S]={exports:{}};return b[S].call(y.exports,y,y.exports,d),y.exports}d.n=S=>{var c=S&&S.__esModule?()=>S.default:()=>S;return d.d(c,{a:c}),c},d.d=(S,c)=>{for(var y in c)d.o(c,y)&&!d.o(S,y)&&Object.defineProperty(S,y,{enumerable:!0,get:c[y]})},d.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),d.o=(S,c)=>Object.prototype.hasOwnProperty.call(S,c),d.r=S=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})};var T={};return(()=>{d.r(T),d.d(T,{LSPluginUser:()=>Kn,setupPluginUserInstance:()=>Cr});var S=d(520),c=(d(856),d(996)),y=d.n(c),O=function(){return O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},O.apply(this,arguments)};function A(t){return t.toLowerCase()}var N=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],J=/[^A-Z0-9]+/gi;function w(t,e,n){return e instanceof RegExp?t.replace(e,n):e.reduce((function(r,s){return r.replace(s,n)}),t)}function p(t,e){return e===void 0&&(e={}),(function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?N:s,u=r.stripRegexp,m=u===void 0?J:u,I=r.transform,H=I===void 0?A:I,W=r.delimiter,z=W===void 0?" ":W,Z=w(w(n,a,"$1\0$2"),m,"\0"),ee=0,Q=Z.length;Z.charAt(ee)==="\0";)ee++;for(;Z.charAt(Q-1)==="\0";)Q--;return Z.slice(ee,Q).split("\0").map(H).join(z)})(t,O({delimiter:"."},e))}var k=d(729),h=d.n(k);function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const C=navigator.platform.toLowerCase()==="win32"?S.win32:S.posix,R=function(t,e){return e===void 0&&(e={}),p(t,O({delimiter:"_"},e))};class B extends h(){constructor(e,n){super(),E(this,"_tag",void 0),E(this,"_opts",void 0),E(this,"_logs",[]),this._tag=e,this._opts=n}write(e,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce(((m,I)=>(I&&I instanceof Error?m+=`${I.message} ${I.stack}`:m+=I.toString(),m)),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var u;this._logs.push([e,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((u=console)===null||u===void 0||u[e==="ERROR"?"error":"debug"](`${e}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...e){this.write("INFO",e)}error(...e){this.write("ERROR",e)}warn(...e){this.write("WARN",e)}setTag(e){this._tag=e}toJSON(){return this._logs}}function F(t,...e){try{const n=new URL(t);if(!n.origin)throw new Error(null);const r=C.join(t.substr(n.origin.length),...e);return n.origin+r}catch{return C.join(t,...e)}}function U(t,e){let n,r,s=!1;const a=m=>I=>{t&&clearTimeout(t),m(I),s=!0},u=new Promise(((m,I)=>{n=a(m),r=a(I),t&&(t=setTimeout((()=>r(new Error(`[deferred timeout] ${e}`))),t))}));return{created:Date.now(),setTag:m=>e=m,resolve:n,reject:r,promise:u,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var f=d(227),_=d.n(f);function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const K="application/x-postmate-v1+json";let ne=0;const ae={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},he=(t,e)=>(typeof e!="string"||t.origin===e)&&!!t.data&&(typeof t.data!="object"||"postmate"in t.data)&&t.data.type===K&&!!ae[t.data.postmate];class _e{constructor(e){x(this,"parent",void 0),x(this,"frame",void 0),x(this,"child",void 0),x(this,"events",{}),x(this,"childOrigin",void 0),x(this,"listener",void 0),this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.listener=n=>{if(!he(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach((a=>{a.call(this,r)}))},this.parent.addEventListener("message",this.listener,!1)}get(e,...n){return new Promise(((r,s)=>{const a=++ne,u=m=>{m.data.uid===a&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",u,!1),m.data.error?s(m.data.error):r(m.data.value))};this.parent.addEventListener("message",u,!1),this.child.postMessage({postmate:"request",type:K,property:e,args:n,uid:a},this.childOrigin)}))}call(e,n){this.child.postMessage({postmate:"call",type:K,property:e,data:n},this.childOrigin)}on(e,n){this.events[e]||(this.events[e]=[]),this.events[e].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class Ce{constructor(e){x(this,"model",void 0),x(this,"parent",void 0),x(this,"parentOrigin",void 0),x(this,"child",void 0),this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",(n=>{if(!he(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:u}=n.data;n.data.postmate!=="call"?((m,I,H)=>{const W=typeof m[I]=="function"?m[I].apply(null,H):m[I];return Promise.resolve(W)})(this.model,r,u).then((m=>{n.source.postMessage({property:r,postmate:"reply",type:K,uid:s,value:m},n.origin)})).catch((m=>{n.source.postMessage({property:r,postmate:"reply",type:K,uid:s,error:m},n.origin)})):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)}))}emit(e,n){this.parent.postMessage({postmate:"emit",type:K,value:{name:e,data:n}},this.parentOrigin)}}class be{constructor(e){x(this,"container",void 0),x(this,"parent",void 0),x(this,"frame",void 0),x(this,"child",void 0),x(this,"childOrigin",void 0),x(this,"url",void 0),x(this,"model",void 0),this.container=e.container,this.url=e.url,this.parent=window,this.frame=document.createElement("iframe"),e.id&&(this.frame.id=e.id),e.name&&(this.frame.name=e.name),this.frame.classList.add.apply(this.frame.classList,e.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=e.model||{}}sendHandshake(e){const n=(a=>{const u=document.createElement("a");u.href=a;const m=u.protocol.length>4?u.protocol:window.location.protocol,I=u.host.length?u.port==="80"||u.port==="443"?u.hostname:u.host:window.location.host;return u.origin||`${m}//${I}`})(e=e||this.url);let r,s=0;return new Promise(((a,u)=>{const m=H=>!!he(H,n)&&(H.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=H.origin,a(new _e(this))):u("Failed handshake"));this.parent.addEventListener("message",m,!1);const I=()=>{s++,this.child.postMessage({postmate:"handshake",type:K,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",(()=>{I(),r=setInterval(I,500)})),this.frame.src=e}))}destroy(){this.frame.parentNode.removeChild(this.frame)}}x(be,"debug",!1),x(be,"Model",void 0);class kt{constructor(e){x(this,"child",void 0),x(this,"model",void 0),x(this,"parent",void 0),x(this,"parentOrigin",void 0),this.child=window,this.model=e,this.parent=this.child.parent}sendHandshakeReply(){return new Promise(((e,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:K},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach((u=>{this.model[u]=a[u]})),e(new Ce(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)}))}}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const{importHTML:P,createSandboxContainer:G}=window.QSandbox||{};function te(t,e){return t.startsWith("http")?fetch(t,e):(t=t.replace("file://",""),new Promise((async(n,r)=>{try{const s=await window.apis.doAction(["readFile",t]);n({text:()=>s})}catch(s){console.error(s),r(s)}})))}class Se extends h(){constructor(e){super(),g(this,"_pluginLocal",void 0),g(this,"_frame",void 0),g(this,"_root",void 0),g(this,"_loaded",!1),g(this,"_unmountFns",[]),this._pluginLocal=e,e._dispose((()=>{this._unmount()}))}async load(){const{name:e,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await P(n,{fetch:te});this._mount(r,document.body);const a=G(e,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Kn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const u=await s(a,!0);this._unmountFns.push(u.unmount),this._loaded=!0}_mount(e,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${e}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const e of this._unmountFns)e&&e.call(null)}destroy(){var e,n;(e=this.frame)===null||e===void 0||(n=e.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var e;return(e=this._root)===null||e===void 0?void 0:e.firstChild}get frame(){return this._frame}}function D(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Y=_()("LSPlugin:caller"),se="#await#response#",Ae="#lspmsg#",xe="#lspmsg#error#",je=t=>`#lspmsg#${t}`;class tt extends h(){constructor(e){super(),D(this,"_pluginLocal",void 0),D(this,"_connected",!1),D(this,"_parent",void 0),D(this,"_child",void 0),D(this,"_shadow",void 0),D(this,"_status",void 0),D(this,"_userModel",{}),D(this,"_call",void 0),D(this,"_callUserModel",void 0),D(this,"_debugTag",""),this._pluginLocal=e,e&&(this._debugTag=e.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:e}=this._pluginLocal;e?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(e={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,u=U(6e4),m=this._extendUserModel({"#lspmsg#ready#":async W=>{m[je(W?.pid)]=({type:z,payload:Z})=>{Y(`[host (_call) -> *user] ${this._debugTag}`,z,Z),n.emit(z,Z)},await u.resolve()},"#lspmsg#beforeunload#":async W=>{const z=U(1e4);n.emit("beforeunload",Object.assign({actor:z},W)),await z.promise},"#lspmsg#settings#":async({type:W,payload:z})=>{n.emit("settings:changed",z)},[Ae]:async({ns:W,type:z,payload:Z})=>{Y(`[host (async) -> *user] ${this._debugTag} ns=${W} type=${z}`,Z),W&&W.startsWith("hook")?n.emit(`${W}:${z}`,Z):n.emit(z,Z)},"#lspmsg#reply#":({_sync:W,result:z})=>{if(Y(`[sync host -> *user] #${W}`,z),a.has(W)){const Z=a.get(W);Z&&(z!=null&&z.hasOwnProperty(xe)?Z.reject(z[xe]):Z.resolve(z),a.delete(W))}},...e});var I;if(r)return await u.promise,JSON.parse(JSON.stringify((I=this._pluginLocal)===null||I===void 0?void 0:I.toJSON()));const H=new kt(m).sendHandshakeReply();return this._status="pending",await H.then((W=>{this._child=W,this._connected=!0,this._call=async(z,Z={},ee)=>{if(ee){const Q=++s;a.set(Q,ee),Z._sync=Q,ee.setTag(`async call #${Q}`),Y(`async call #${Q}`)}return W.emit(je(m.baseInfo.id),{type:z,payload:Z}),ee?.promise},this._callUserModel=async(z,Z)=>{try{m[z](Z)}catch{Y(`[model method] #${z} not existed`)}},setInterval((()=>{if(a.size>100)for(const[z,Z]of a)Z.settled&&a.delete(z)}),18e5)})).finally((()=>{this._status=void 0})),await u.promise,m.baseInfo}async call(e,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,e,n)}async callAsync(e,n={}){var r;const s=U(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,e,n,s)}async callUserModel(e,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[e,...n])}async callUserModelAsync(e,...n){var r;return e=`${se}${e}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[e,...n])}async _setupIframeSandbox(){const e=this._pluginLocal,n=e.id,r=`${n}_lsp_main`,s=new URL(e.options.entry);s.searchParams.set("__v__",e.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const u=document.createElement("div");u.classList.add("lsp-iframe-sandbox-container"),u.id=r,u.dataset.pid=n;try{var m;const z=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if(z){u.dataset.inited_layout="true";let{width:Z,height:ee,left:Q,top:ie,vw:le,vh:ye}=z;Q=Math.max(Q,0),Q=typeof le=="number"?`${Math.min(100*Q/le,99)}%`:`${Q}px`,ie=Math.max(ie,45),ie=typeof ye=="number"?`${Math.min(100*ie/ye,99)}%`:`${ie}px`,Object.assign(u.style,{width:Z+"px",height:ee+"px",left:Q,top:ie})}}catch(z){console.error("[Restore Layout Error]",z)}document.body.appendChild(u);const I=new be({id:n+"_iframe",container:u,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(e.toJSON()))}});let H,W=I.sendHandshake();return this._status="pending",new Promise(((z,Z)=>{H=setTimeout((()=>{Z(new Error("handshake Timeout")),I.destroy()}),4e3),W.then((ee=>{this._parent=ee,this._connected=!0,this.emit("connected"),ee.on(je(e.id),(({type:Q,payload:ie})=>{var le,ye;Y("[user -> *host] ",Q,ie),(le=this._pluginLocal)===null||le===void 0||le.emit(Q,ie||{}),(ye=this._pluginLocal)===null||ye===void 0||ye.caller.emit(Q,ie||{})})),this._call=async(...Q)=>{await ee.call(je(e.id),{type:Q[0],payload:Object.assign(Q[1]||{},{$$pid:e.id})})},this._callUserModel=async(Q,...ie)=>{if(Q.startsWith(se))return await ee.get(Q.replace(se,""),...ie);ee.call(Q,ie?.[0])},z(null)})).catch((ee=>{Z(ee)})).finally((()=>{clearTimeout(H)}))})).catch((z=>{throw Y("[iframe sandbox] error",z),z})).finally((()=>{this._status=void 0}))}async _setupShadowSandbox(){const e=this._pluginLocal,n=this._shadow=new Se(e);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var u;return a&&(s.actor=a),(u=this._pluginLocal)===null||u===void 0||u.emit(r,Object.assign(s,{$$pid:e.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(se)&&(a=a.replace(se,""));const u=r[1]||{},m=this._userModel[a];typeof m=="function"&&await m.call(null,u)}}catch(r){throw Y("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(e){return Object.assign(this._userModel,e)}_getSandboxIframeContainer(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxShadowContainer(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxIframeRoot(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame}_getSandboxShadowRoot(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame}set debugTag(e){this._debugTag=e}async destroy(){var e;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(e=n)===null||e===void 0||e.parentNode.removeChild(n)}}function fe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ce{constructor(e,n){fe(this,"ctx",void 0),fe(this,"opts",void 0),this.ctx=e,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(e,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,e,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(e){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(e){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var e;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}clear(){var e;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}hasItem(e){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class ke{constructor(e){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=e}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(e,...n){var r,s;const a=this.ensureHostScope();return e=(r=R(e))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+e])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...e){(e=e.map((n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n)))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...e)}registerFencedCodeRenderer(e,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,e,n)}registerExtensionsEnhancer(e,n){const r=this.ensureHostScope();return e==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,e,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Fe=t=>`task_callback_${t}`;class Ke{constructor(e,n,r={}){Oe(this,"_client",void 0),Oe(this,"_requestId",void 0),Oe(this,"_requestOptions",void 0),Oe(this,"_promise",void 0),Oe(this,"_aborted",!1),this._client=e,this._requestId=n,this._requestOptions=r,this._promise=new Promise(((m,I)=>{if(!this._requestId)return I(null);this._client.once(Fe(this._requestId),(H=>{H&&H instanceof Error?I(H):m(H)}))}));const{success:s,fail:a,final:u}=this._requestOptions;this._promise.then((m=>{s?.(m)})).catch((m=>{a?.(m)})).finally((()=>{u?.()}))}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Te extends k.EventEmitter{constructor(e){super(),Oe(this,"_ctx",void 0),this._ctx=e,this.ctx.caller.on("#lsp#request#callback",(n=>{const r=n?.requestId;r&&this.emit(Fe(r),n?.payload)}))}static createRequestTask(e,n,r){return new Ke(e,n,r)}async _request(e){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...u}=e,m=this.ctx.Experiments.invokeExperMethod("request",n,u),I=Te.createRequestTask(this.ctx.Request,m,e);return u.abortable?I:I.promise}get ctx(){return this._ctx}}const Pe=Array.isArray,ht=typeof kn=="object"&&kn&&kn.Object===Object&&kn;var En=typeof self=="object"&&self&&self.Object===Object&&self;const Ne=ht||En||Function("return this")(),He=Ne.Symbol;var en=Object.prototype,An=en.hasOwnProperty,On=en.toString,pt=He?He.toStringTag:void 0;const Pn=function(t){var e=An.call(t,pt),n=t[pt];try{t[pt]=void 0;var r=!0}catch{}var s=On.call(t);return r&&(e?t[pt]=n:delete t[pt]),s};var tn=Object.prototype.toString;const j=function(t){return tn.call(t)};var $=He?He.toStringTag:void 0;const V=function(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":$&&$ in Object(t)?Pn(t):j(t)},X=function(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")},pe=function(t){if(!X(t))return!1;var e=V(t);return e=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]"},Re=Ne["__core-js_shared__"];var Ge,nt=(Ge=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+Ge:"";const Dt=function(t){return!!nt&&nt in t};var nn=Function.prototype.toString;const Qe=function(t){if(t!=null){try{return nn.call(t)}catch{}try{return t+""}catch{}}return""};var Ln=/^\[object .+?Constructor\]$/,jn=Function.prototype,Tn=Object.prototype,Et=jn.toString,In=Tn.hasOwnProperty,Mn=RegExp("^"+Et.call(In).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Fn=function(t){return!(!X(t)||Dt(t))&&(pe(t)?Mn:Ln).test(Qe(t))},zt=function(t,e){return t?.[e]},Ue=function(t,e){var n=zt(t,e);return Fn(n)?n:void 0},$e=(function(){try{var t=Ue(Object,"defineProperty");return t({},"",{}),t}catch{}})(),rn=function(t,e,n){e=="__proto__"&&$e?$e(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},At=(function(t){return function(e,n,r){for(var s=-1,a=Object(e),u=r(e),m=u.length;m--;){var I=u[++s];if(n(a[I],I,a)===!1)break}return e}})(),Bt=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},rt=function(t){return t!=null&&typeof t=="object"},on=function(t){return rt(t)&&V(t)=="[object Arguments]"};var sn=Object.prototype,Nn=sn.hasOwnProperty,an=sn.propertyIsEnumerable;const Ie=on((function(){return arguments})())?on:function(t){return rt(t)&&Nn.call(t,"callee")&&!an.call(t,"callee")},gt=function(){return!1};var We=l&&!l.nodeType&&l,Ot=We&&!0&&q&&!q.nodeType&&q,Pt=Ot&&Ot.exports===We?Ne.Buffer:void 0;const qt=(Pt?Pt.isBuffer:void 0)||gt;var Rn=/^(?:0|[1-9]\d*)$/;const ln=function(t,e){var n=typeof t;return!!(e=e??9007199254740991)&&(n=="number"||n!="symbol"&&Rn.test(t))&&t>-1&&t%1==0&&t<e},Lt=function(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=9007199254740991};var re={};re["[object Float32Array]"]=re["[object Float64Array]"]=re["[object Int8Array]"]=re["[object Int16Array]"]=re["[object Int32Array]"]=re["[object Uint8Array]"]=re["[object Uint8ClampedArray]"]=re["[object Uint16Array]"]=re["[object Uint32Array]"]=!0,re["[object Arguments]"]=re["[object Array]"]=re["[object ArrayBuffer]"]=re["[object Boolean]"]=re["[object DataView]"]=re["[object Date]"]=re["[object Error]"]=re["[object Function]"]=re["[object Map]"]=re["[object Number]"]=re["[object Object]"]=re["[object RegExp]"]=re["[object Set]"]=re["[object String]"]=re["[object WeakMap]"]=!1;const ge=function(t){return rt(t)&&Lt(t.length)&&!!re[V(t)]},cn=function(t){return function(e){return t(e)}};var me=l&&!l.nodeType&&l,ot=me&&!0&&q&&!q.nodeType&&q,ue=ot&&ot.exports===me&&ht.process,it=(function(){try{var t=ot&&ot.require&&ot.require("util").types;return t||ue&&ue.binding&&ue.binding("util")}catch{}})(),jt=it&&it.isTypedArray;const Ht=jt?cn(jt):ge;var Gt=Object.prototype.hasOwnProperty;const un=function(t,e){var n=Pe(t),r=!n&&Ie(t),s=!n&&!r&&qt(t),a=!n&&!r&&!s&&Ht(t),u=n||r||s||a,m=u?Bt(t.length,String):[],I=m.length;for(var H in t)!Gt.call(t,H)||u&&(H=="length"||s&&(H=="offset"||H=="parent")||a&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||ln(H,I))||m.push(H);return m};var st=Object.prototype;const Ye=function(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||st)},Wt=(function(t,e){return function(n){return t(e(n))}})(Object.keys,Object);var Vt=Object.prototype.hasOwnProperty;const at=function(t){if(!Ye(t))return Wt(t);var e=[];for(var n in Object(t))Vt.call(t,n)&&n!="constructor"&&e.push(n);return e},Tt=function(t){return t!=null&&Lt(t.length)&&!pe(t)},lt=function(t){return Tt(t)?un(t):at(t)},fn=function(t,e){return t&&At(t,e,lt)},Jt=function(){this.__data__=[],this.size=0},ct=function(t,e){return t===e||t!=t&&e!=e},De=function(t,e){for(var n=t.length;n--;)if(ct(t[n][0],e))return n;return-1};var ut=Array.prototype.splice;const dn=function(t){var e=this.__data__,n=De(e,t);return!(n<0)&&(n==e.length-1?e.pop():ut.call(e,n,1),--this.size,!0)},hn=function(t){var e=this.__data__,n=De(e,t);return n<0?void 0:e[n][1]},pn=function(t){return De(this.__data__,t)>-1},Zt=function(t,e){var n=this.__data__,r=De(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function Xe(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Xe.prototype.clear=Jt,Xe.prototype.delete=dn,Xe.prototype.get=hn,Xe.prototype.has=pn,Xe.prototype.set=Zt;const ft=Xe,Kt=function(){this.__data__=new ft,this.size=0},Ve=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},It=function(t){return this.__data__.get(t)},gn=function(t){return this.__data__.has(t)},mt=Ue(Ne,"Map"),vt=Ue(Object,"create"),dt=function(){this.__data__=vt?vt(null):{},this.size=0},Un=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e};var mn=Object.prototype.hasOwnProperty;const Qt=function(t){var e=this.__data__;if(vt){var n=e[t];return n==="__lodash_hash_undefined__"?void 0:n}return mn.call(e,t)?e[t]:void 0};var vn=Object.prototype.hasOwnProperty;const yn=function(t){var e=this.__data__;return vt?e[t]!==void 0:vn.call(e,t)},$n=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=vt&&e===void 0?"__lodash_hash_undefined__":e,this};function ze(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ze.prototype.clear=dt,ze.prototype.delete=Un,ze.prototype.get=Qt,ze.prototype.has=yn,ze.prototype.set=$n;const Mt=ze,Dn=function(){this.size=0,this.__data__={hash:new Mt,map:new(mt||ft),string:new Mt}},Be=function(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null},yt=function(t,e){var n=t.__data__;return Be(e)?n[typeof e=="string"?"string":"hash"]:n.map},bn=function(t){var e=yt(this,t).delete(t);return this.size-=e?1:0,e},wn=function(t){return yt(this,t).get(t)},zn=function(t){return yt(this,t).has(t)},bt=function(t,e){var n=yt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Ee(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ee.prototype.clear=Dn,Ee.prototype.delete=bn,Ee.prototype.get=wn,Ee.prototype.has=zn,Ee.prototype.set=bt;const wt=Ee,_n=function(t,e){var n=this.__data__;if(n instanceof ft){var r=n.__data__;if(!mt||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new wt(r)}return n.set(t,e),this.size=n.size,this};function et(t){var e=this.__data__=new ft(t);this.size=e.size}et.prototype.clear=Kt,et.prototype.delete=Ve,et.prototype.get=It,et.prototype.has=gn,et.prototype.set=_n;const _t=et,Bn=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},o=function(t){return this.__data__.has(t)};function M(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new wt;++e<n;)this.add(t[e])}M.prototype.add=M.prototype.push=Bn,M.prototype.has=o;const L=M,oe=function(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},de=function(t,e){return t.has(e)},we=function(t,e,n,r,s,a){var u=1&n,m=t.length,I=e.length;if(m!=I&&!(u&&I>m))return!1;var H=a.get(t),W=a.get(e);if(H&&W)return H==e&&W==t;var z=-1,Z=!0,ee=2&n?new L:void 0;for(a.set(t,e),a.set(e,t);++z<m;){var Q=t[z],ie=e[z];if(r)var le=u?r(ie,Q,z,e,t,a):r(Q,ie,z,t,e,a);if(le!==void 0){if(le)continue;Z=!1;break}if(ee){if(!oe(e,(function(ye,Me){if(!de(ee,Me)&&(Q===ye||s(Q,ye,n,r,a)))return ee.push(Me)}))){Z=!1;break}}else if(Q!==ie&&!s(Q,ie,n,r,a)){Z=!1;break}}return a.delete(t),a.delete(e),Z},ve=Ne.Uint8Array,xt=function(t){var e=-1,n=Array(t.size);return t.forEach((function(r,s){n[++e]=[s,r]})),n},Je=function(t){var e=-1,n=Array(t.size);return t.forEach((function(r){n[++e]=r})),n};var Le=He?He.prototype:void 0,Yt=Le?Le.valueOf:void 0;const Xn=function(t,e,n,r,s,a,u){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new ve(t),new ve(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ct(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var m=xt;case"[object Set]":var I=1&r;if(m||(m=Je),t.size!=e.size&&!I)return!1;var H=u.get(t);if(H)return H==e;r|=2,u.set(t,e);var W=we(m(t),m(e),r,s,a,u);return u.delete(t),W;case"[object Symbol]":if(Yt)return Yt.call(t)==Yt.call(e)}return!1},jr=function(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t},Tr=function(t,e,n){var r=e(t);return Pe(t)?r:jr(r,n(t))},Ir=function(t,e){for(var n=-1,r=t==null?0:t.length,s=0,a=[];++n<r;){var u=t[n];e(u,n,t)&&(a[s++]=u)}return a},Mr=function(){return[]};var Fr=Object.prototype.propertyIsEnumerable,er=Object.getOwnPropertySymbols;const Nr=er?function(t){return t==null?[]:(t=Object(t),Ir(er(t),(function(e){return Fr.call(t,e)})))}:Mr,tr=function(t){return Tr(t,lt,Nr)};var Rr=Object.prototype.hasOwnProperty;const Ur=function(t,e,n,r,s,a){var u=1&n,m=tr(t),I=m.length;if(I!=tr(e).length&&!u)return!1;for(var H=I;H--;){var W=m[H];if(!(u?W in e:Rr.call(e,W)))return!1}var z=a.get(t),Z=a.get(e);if(z&&Z)return z==e&&Z==t;var ee=!0;a.set(t,e),a.set(e,t);for(var Q=u;++H<I;){var ie=t[W=m[H]],le=e[W];if(r)var ye=u?r(le,ie,W,e,t,a):r(ie,le,W,t,e,a);if(!(ye===void 0?ie===le||s(ie,le,n,r,a):ye)){ee=!1;break}Q||(Q=W=="constructor")}if(ee&&!Q){var Me=t.constructor,St=e.constructor;Me==St||!("constructor"in t)||!("constructor"in e)||typeof Me=="function"&&Me instanceof Me&&typeof St=="function"&&St instanceof St||(ee=!1)}return a.delete(t),a.delete(e),ee},qn=Ue(Ne,"DataView"),Hn=Ue(Ne,"Promise"),Gn=Ue(Ne,"Set"),Wn=Ue(Ne,"WeakMap");var nr="[object Map]",rr="[object Promise]",or="[object Set]",ir="[object WeakMap]",sr="[object DataView]",$r=Qe(qn),Dr=Qe(mt),zr=Qe(Hn),Br=Qe(Gn),qr=Qe(Wn),Ct=V;(qn&&Ct(new qn(new ArrayBuffer(1)))!=sr||mt&&Ct(new mt)!=nr||Hn&&Ct(Hn.resolve())!=rr||Gn&&Ct(new Gn)!=or||Wn&&Ct(new Wn)!=ir)&&(Ct=function(t){var e=V(t),n=e=="[object Object]"?t.constructor:void 0,r=n?Qe(n):"";if(r)switch(r){case $r:return sr;case Dr:return nr;case zr:return rr;case Br:return or;case qr:return ir}return e});const ar=Ct;var lr="[object Arguments]",cr="[object Array]",xn="[object Object]",ur=Object.prototype.hasOwnProperty;const Hr=function(t,e,n,r,s,a){var u=Pe(t),m=Pe(e),I=u?cr:ar(t),H=m?cr:ar(e),W=(I=I==lr?xn:I)==xn,z=(H=H==lr?xn:H)==xn,Z=I==H;if(Z&&qt(t)){if(!qt(e))return!1;u=!0,W=!1}if(Z&&!W)return a||(a=new _t),u||Ht(t)?we(t,e,n,r,s,a):Xn(t,e,I,n,r,s,a);if(!(1&n)){var ee=W&&ur.call(t,"__wrapped__"),Q=z&&ur.call(e,"__wrapped__");if(ee||Q){var ie=ee?t.value():t,le=Q?e.value():e;return a||(a=new _t),s(ie,le,n,r,a)}}return!!Z&&(a||(a=new _t),Ur(t,e,n,r,s,a))},fr=function t(e,n,r,s,a){return e===n||(e==null||n==null||!rt(e)&&!rt(n)?e!=e&&n!=n:Hr(e,n,r,s,t,a))},Gr=function(t,e,n,r){var s=n.length,a=s;if(t==null)return!a;for(t=Object(t);s--;){var u=n[s];if(u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++s<a;){var m=(u=n[s])[0],I=t[m],H=u[1];if(u[2]){if(I===void 0&&!(m in t))return!1}else{var W=new _t,z;if(!(z===void 0?fr(H,I,3,r,W):z))return!1}}return!0},dr=function(t){return t==t&&!X(t)},Wr=function(t){for(var e=lt(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,dr(s)]}return e},hr=function(t,e){return function(n){return n!=null&&n[t]===e&&(e!==void 0||t in Object(n))}},Vr=function(t){var e=Wr(t);return e.length==1&&e[0][2]?hr(e[0][0],e[0][1]):function(n){return n===t||Gr(n,t,e)}},Vn=function(t){return typeof t=="symbol"||rt(t)&&V(t)=="[object Symbol]"};var Jr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zr=/^\w*$/;const Jn=function(t,e){if(Pe(t))return!1;var n=typeof t;return!(n!="number"&&n!="symbol"&&n!="boolean"&&t!=null&&!Vn(t))||Zr.test(t)||!Jr.test(t)||e!=null&&t in Object(e)};function Zn(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var u=t.apply(this,r);return n.cache=a.set(s,u)||a,u};return n.cache=new(Zn.Cache||wt),n}Zn.Cache=wt;const Kr=Zn;var Qr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yr=/\\(\\)?/g;const Xr=(function(t){var e=Kr(t,(function(r){return n.size===500&&n.clear(),r})),n=e.cache;return e})((function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Qr,(function(n,r,s,a){e.push(s?a.replace(Yr,"$1"):r||n)})),e})),eo=function(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s};var pr=He?He.prototype:void 0,gr=pr?pr.toString:void 0;const to=function t(e){if(typeof e=="string")return e;if(Pe(e))return eo(e,t)+"";if(Vn(e))return gr?gr.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n},no=function(t){return t==null?"":to(t)},mr=function(t,e){return Pe(t)?t:Jn(t,e)?[t]:Xr(no(t))},Cn=function(t){if(typeof t=="string"||Vn(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e},vr=function(t,e){for(var n=0,r=(e=mr(e,t)).length;t!=null&&n<r;)t=t[Cn(e[n++])];return n&&n==r?t:void 0},ro=function(t,e,n){var r=t==null?void 0:vr(t,e);return r===void 0?n:r},oo=function(t,e){return t!=null&&e in Object(t)},io=function(t,e,n){for(var r=-1,s=(e=mr(e,t)).length,a=!1;++r<s;){var u=Cn(e[r]);if(!(a=t!=null&&n(t,u)))break;t=t[u]}return a||++r!=s?a:!!(s=t==null?0:t.length)&&Lt(s)&&ln(u,s)&&(Pe(t)||Ie(t))},so=function(t,e){return t!=null&&io(t,e,oo)},ao=function(t,e){return Jn(t)&&dr(e)?hr(Cn(t),e):function(n){var r=ro(n,t);return r===void 0&&r===e?so(n,t):fr(e,r,3)}},lo=function(t){return t},co=function(t){return function(e){return e?.[t]}},uo=function(t){return function(e){return vr(e,t)}},fo=function(t){return Jn(t)?co(Cn(t)):uo(t)},ho=function(t){return typeof t=="function"?t:t==null?lo:typeof t=="object"?Pe(t)?ao(t[0],t[1]):Vr(t):fo(t)},po=function(t,e){var n={};return e=ho(e),fn(t,(function(r,s,a){rn(n,e(r,s,a),r)})),n};function yr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class go{constructor(e,n){yr(this,"ctx",void 0),yr(this,"serviceHooks",void 0),this.ctx=e,this.serviceHooks=n,e._execCallableAPI("register-search-service",e.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Pe(r?.blocks)&&(r.blocks=r.blocks.map((s=>s&&po(s,((a,u)=>`block/${u}`))))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach((([r,s])=>{const a=(u=>`service:search:${u}:${n.name}`)(r);e.caller.on(a,(async u=>{if(pe(n?.[s.f])){let m=null;try{m=await n[s.f].apply(n,(s.args||[]).map((I=>{if(u){if(I===!0)return u;if(u.hasOwnProperty(I)){const H=u[I];return delete u[I],H}}}))),s.transformOutput&&(m=s.transformOutput(m))}catch(I){console.error("[SearchService] ",I),m=I}finally{s.reply&&e.caller.call(`${a}:reply`,m)}}}))}))}}function qe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const mo=Symbol.for("proxy-continue"),vo=_()("LSPlugin:user"),br=new B("",{console:!0});function Ft(t,e,n){var r;const{key:s,label:a,desc:u,palette:m,keybinding:I,extras:H}=e;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const W=(function(Z){if(typeof Z=="string")return Z.trim().replace(/\s/g,"_").toLowerCase()})(s);if(!W)return this.logger.error(`${a}: command key is required.`),!1;const z=`SimpleCommandHook${W}${++xr}`;this.Editor["on"+z](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:W,label:a,type:t,desc:u,keybinding:I,extras:H},["editor/hook",z]],m]})}function wr(t){return!(typeof(e=t)!="string"||e.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(e))||(br.error(`#${t} is not a valid UUID string.`),!1);var e}let Sn=null,_r=new Map;const yo={async getInfo(t){return Sn||(Sn=await this._execCallableAPIAsync("get-app-info")),typeof t=="string"?Sn[t]:Sn},registerCommand:Ft,registerSearchService(t){if(_r.has(t.name))throw new Error(`SearchService: #${t.name} has registered!`);_r.set(t.name,new go(this,t))},registerCommandPalette(t,e){const{key:n,label:r,keybinding:s}=t;return Ft.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},e)},registerCommandShortcut(t,e,n={}){typeof t=="string"&&(t={mode:"global",binding:t});const{binding:r}=t,s="$shortcut$",a=n.key||s+R(r?.toString());return Ft.call(this,s,{...n,key:a,palette:!1,keybinding:t},e)},registerUIItem(t,e){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,t,e]})},registerPageMenuItem(t,e){if(typeof e!="function")return!1;const n=t+"_"+this.baseInfo.id,r=t;Ft.call(this,"page-menu-item",{key:n,label:r},e)},onBlockRendererSlotted(t,e){if(!wr(t))return;const n=this.baseInfo.id,r=`hook:editor:${R(`slot:${t}`)}`;return this.caller.on(r,e),this.App._installPluginHook(n,r),()=>{this.caller.off(r,e),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(t,...e){var n;if(!(t=(n=t)===null||n===void 0?void 0:n.trim()))return;let[r,s]=t.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=t.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${t} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,e)},setFullScreen(t){const e=(...n)=>this._callWin("setFullScreen",...n);t==="toggle"?this._callWin("isFullScreen").then((n=>{n?e():e(!0)})):t?e(!0):e()}};let xr=0;const bo={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(t,e){var n;vo("Register slash command #",this.baseInfo.id,t,e),typeof e=="function"&&(e=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",e]]),e=e.map((r=>{const[s,...a]=r;if(s==="editor/hook"){let u=a[0],m=()=>{var H;(H=this.caller)===null||H===void 0||H.callUserModel(u)};typeof u=="function"&&(m=u);const I=`SlashCommandHook${s}${++xr}`;r[1]=I,this.Editor["on"+I](m)}return r})),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[t,e]]})},registerBlockContextMenuItem(t,e){if(typeof e!="function")return!1;const n=t+"_"+this.baseInfo.id;Ft.call(this,"block-context-menu-item",{key:n,label:t},e)},registerHighlightContextMenuItem(t,e,n){if(typeof e!="function")return!1;const r=t+"_"+this.baseInfo.id;Ft.call(this,"highlight-context-menu-item",{key:r,label:t,extras:n},e)},scrollToBlockInPage(t,e,n){const r="block-content-"+e;n!=null&&n.replaceState?this.App.replaceState("page",{name:t},{anchor:r}):this.App.pushState("page",{name:t},{anchor:r})}},wo={onBlockChanged(t,e){if(!wr(t))return;const n=this.baseInfo.id,r=`hook:db:${R(`block:${t}`)}`,s=({block:a,txData:u,txMeta:m})=>{a.uuid===t&&e(a,u,m)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(t,...e){return e.pop(),e!=null&&e.some((n=>typeof n=="function"))?this.Experiments.ensureHostScope().logseq.api.datascript_query(t,...e):this._execCallableAPIAsync("datascript_query",t,...e)}},_o={},xo={},Co={makeSandboxStorage(){return new ce(this,{assets:!0})}};class Kn extends h(){constructor(e,n){super(),qe(this,"_baseInfo",void 0),qe(this,"_caller",void 0),qe(this,"_version","0.0.17"),qe(this,"_debugTag",""),qe(this,"_settingsSchema",void 0),qe(this,"_connected",!1),qe(this,"_ui",new Map),qe(this,"_mFileStorage",void 0),qe(this,"_mRequest",void 0),qe(this,"_mExperiments",void 0),qe(this,"_beforeunloadCallback",void 0),this._baseInfo=e,this._caller=n,n.on("sys:ui:visible",(r=>{r!=null&&r.toggle&&this.toggleMainUI()})),n.on("settings:changed",(r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)})),n.on("beforeunload",(async r=>{const{actor:s,...a}=r,u=this._beforeunloadCallback;try{u&&await u(a),s?.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),s?.reject(m)}}))}async ready(e,n){var r,s;if(!this._connected)try{var a;typeof e=="function"&&(n=e,e={});let u=await this._caller.connectToParent(e);this._connected=!0,r=this._baseInfo,s=u,u=y()(r,s,{arrayMerge:(m,I)=>I}),this._baseInfo=u,(a=u)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${u.id} [${u.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(u.settings=(function(m,I){const H=(I||[]).reduce(((W,z)=>("default"in z&&(W[z.key]=z.default),W)),{});return Object.assign(H,m)})(u.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,u)}catch(u){console.error(`${this._debugTag} [Ready Error]`,u)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(e){typeof e=="function"&&(this._beforeunloadCallback=e)}provideModel(e){return this.caller._extendUserModel(e),this}provideTheme(e){return this.caller.call("provider:theme",e),this}provideStyle(e){return this.caller.call("provider:style",e),this}provideUI(e){return this.caller.call("provider:ui",e),this}useSettingsSchema(e){return this.connected&&this.caller.call("settings:schema",{schema:e,isSync:!0}),this._settingsSchema=e,this}updateSettings(e){this.caller.call("settings:update",e)}onSettingsChanged(e){const n="settings:changed";return this.on(n,e),()=>this.off(n,e)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(e){this.caller.call("main-ui:attrs",e)}setMainUIInlineStyle(e){this.caller.call("main-ui:style",e)}hideMainUI(e){const n={key:0,visible:!1,cursor:e?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(e){const n={key:0,visible:!0,autoFocus:e?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const e=this._ui.get(0);return!!(e&&e.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(e=this)&&(((n=e.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=e.baseInfo)!==null&&r!==void 0&&r.iir));var e,n,r}get logger(){return br}get settings(){var e;return(e=this.baseInfo)===null||e===void 0?void 0:e.settings}get caller(){return this._caller}resolveResourceFullUrl(e){if(this.ensureConnected(),e)return e=e.replace(/^[.\\/]+/,""),F(this._baseInfo.lsr,e)}_makeUserProxy(e,n){const r=this,s=this.caller;return new Proxy(e,{get(a,u,m){const I=a[u];return function(...H){if(I){const z=I.apply(r,H.concat(n));if(z!==mo)return z}if(n){const z=u.toString().match(/^(once|off|on)/i);if(z!=null){const Z=z[0].toLowerCase(),ee=z.input,Q=Z==="off",ie=r.baseInfo.id;let le=ee.slice(Z.length),ye=H[0],Me=H[1];typeof ye=="string"&&typeof Me=="function"&&(ye=ye.replace(/^logseq./,":"),le=`${le}${ye}`,ye=Me,Me=H[2]),le=`hook:${n}:${R(le)}`,s[Z](le,ye);const St=()=>{s.off(le,ye),s.listenerCount(le)||r.App._uninstallPluginHook(ie,le)};return Q?void St():(r.App._installPluginHook(ie,le,Me),St)}}let W=u;return["git","ui","assets"].includes(n)&&(W=n+"_"+W),s.callAsync("api:call",{tag:n,method:W,args:H})}}})}_execCallableAPIAsync(e,...n){return this._caller.callAsync("api:call",{method:e,args:n})}_execCallableAPI(e,...n){this._caller.call("api:call",{method:e,args:n})}_callWin(...e){return this._execCallableAPIAsync("_callMainWin",...e)}get App(){return this._makeUserProxy(yo,"app")}get Editor(){return this._makeUserProxy(bo,"editor")}get DB(){return this._makeUserProxy(wo,"db")}get Git(){return this._makeUserProxy(_o,"git")}get UI(){return this._makeUserProxy(xo,"ui")}get Assets(){return this._makeUserProxy(Co,"assets")}get FileStorage(){let e=this._mFileStorage;return e||(e=this._mFileStorage=new ce(this)),e}get Request(){let e=this._mRequest;return e||(e=this._mRequest=new Te(this)),e}get Experiments(){let e=this._mExperiments;return e||(e=this._mExperiments=new ke(this)),e}}function Cr(t,e){return new Kn(t,e)}if(window.__LSP__HOST__==null){const t=new tt(null);window.logseq=Cr({},t)}})(),T})()))})(Xt,Xt.exports)),Xt.exports}So();const ko={id:"logseq-livephotos-plugin"},Yn=parent.document,Eo=":live-photo",Ze={regexPattern:"^(.*?)-([A-Za-z0-9]{5,6})\\.(jpg|jpeg|png|gif|mov|mp4)$",enableAutoConvert:!1,enableSound:!1},Ut=(q,l)=>{const b=Yn.createElement(q);return l&&Object.assign(b.style,l),b},Er=(q,l)=>{Object.assign(q.style,l)},Ao=(q,l,b)=>{let v=!1,d;const T=q.querySelector("[data-live-badge]"),S=O=>{!T||!b||b(T,O)},c=async()=>{v=!0;try{d=l.play(),await d,v?(l.style.opacity="1",S(!0)):(l.pause(),l.currentTime=0,l.style.opacity="0",S(!1))}catch(O){console.warn("Video play interrupted or failed",O),v||(l.style.opacity="0",S(!1))}},y=()=>{v=!1,l.style.opacity="0",S(!1),setTimeout(()=>{v||(l.pause(),l.currentTime=0)},250)};q.addEventListener("mouseenter",c),q.addEventListener("mouseleave",y),q.addEventListener("touchstart",c,{passive:!0}),q.addEventListener("touchend",y),q.addEventListener("touchcancel",y)},$t={container:{position:"relative",width:"100%",cursor:"pointer",overflow:"hidden",borderRadius:"8px"},image:{width:"100%",height:"auto",display:"block",objectFit:"cover"},video:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.2s ease-in-out",pointerEvents:"none"},badge:{position:"absolute",top:"8px",left:"8px",display:"flex",alignItems:"center",gap:"4px",padding:"4px 6px",borderRadius:"4px",backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(6px)",zIndex:"2",pointerEvents:"none",transition:"transform 0.2s ease"},badgeText:{fontSize:"10px",fontWeight:"bold",color:"black",lineHeight:"1",letterSpacing:"0.5px"},muteButton:{position:"absolute",bottom:"8px",right:"8px",display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",padding:"6px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(6px)",cursor:"pointer",zIndex:"2",transition:"transform 0.1s ease"}},Oo=(q=!1)=>`
    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" stroke="black" stroke-width="2.5" fill="none"/>
      <circle cx="12" cy="12" r="5" fill="black"/>
      <circle cx="12" cy="12" r="2" fill="white" style="opacity: 0.8"/>
    </svg>
  `,Po=()=>{const q=Ut("div",$t.badge);q.setAttribute("data-live-badge","true"),q.innerHTML=Oo();const l=Ut("span",$t.badgeText);return l.textContent="LIVE",q.appendChild(l),q},Lo=(q,l)=>{const b=q.querySelector("svg");if(b){const v=b.querySelector("circle:first-child"),d=b.querySelector("circle:last-child");v&&(l?(v.setAttribute("stroke-dasharray","8 4"),v.setAttribute("stroke-width","2.5"),v.style.stroke="#333333",v.style.transformOrigin="center",v.style.animation="rotate 3s linear infinite"):(v.setAttribute("stroke-dasharray","none"),v.setAttribute("stroke-width","2"),v.style.stroke="",v.style.animation="")),d&&(l?(d.style.fill="#333333",d.innerHTML='<animate attributeName="r" values="2;3;2" dur="1s" repeatCount="indefinite"/>',d.innerHTML+='<animate attributeName="opacity" values="0.8;1;0.8" dur="1s" repeatCount="indefinite"/>'):(d.style.fill="white",d.style.opacity="0.5",d.innerHTML=""))}l?(q.style.transform="scale(1.1)",q.style.animation="badgePulse 0.3s ease-out"):(q.style.transform="scale(1)",q.style.animation="")},Ar=q=>q?`
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
        <line x1="23" y1="9" x2="17" y2="15"/>
        <line x1="17" y1="9" x2="23" y2="15"/>
      </svg>
    `:`
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
      <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
    </svg>
  `,jo=q=>{const l=Ut("div",$t.muteButton);return l.innerHTML=Ar(q),l},Or=(q,l,b=!1)=>{const v=Ut("div",$t.container),d=Ut("img",$t.image);d.src=q;const T=Ut("video",$t.video);T.src=l,T.muted=!b,T.playsInline=!0,T.loop=!0;const S=Po(),y=jo(!b);return y.addEventListener("click",O=>{O.stopPropagation(),O.preventDefault(),T.muted=!T.muted,y.innerHTML=Ar(T.muted)}),v.appendChild(d),v.appendChild(T),v.appendChild(S),v.appendChild(y),Ao(v,T,Lo),v};class To{settings;listeners=[];constructor(){this.settings={...Ze}}async load(){try{if(console.log("[LivePhotos] Loading settings..."),console.log("[LivePhotos] Logseq settings:",logseq.settings),logseq.settings){const l=logseq.settings;this.settings={...Ze,regexPattern:l.regexPattern||Ze.regexPattern,enableAutoConvert:l.enableAutoConvert!==void 0?l.enableAutoConvert:Ze.enableAutoConvert,enableSound:l.enableSound!==void 0?l.enableSound:Ze.enableSound},console.log("[LivePhotos] Loaded settings:",this.settings)}else console.log("[LivePhotos] No logseq settings found, using defaults")}catch(l){console.warn("[LivePhotos] Failed to load settings, using defaults:",l)}return this.settings}async save(l){this.settings={...this.settings,...l};try{logseq.updateSettings(l),this.listeners.forEach(b=>b(this.settings))}catch(b){throw console.error("Failed to save settings:",b),b}}getSettings(){return{...this.settings}}updateSettings(l){this.settings={...this.settings,...l},this.listeners.forEach(b=>b(this.settings))}async showSettingsUI(){logseq.showSettingsUI()}async resetToDefaults(){this.settings={...Ze},await this.save(Ze),logseq.UI.showMsg("Settings reset to defaults","success")}async promptRegexUpdate(){const l=await logseq.UI.showMsg("Enter regex pattern for file matching:","info");if(l)try{new RegExp(l),await this.save({regexPattern:l}),logseq.UI.showMsg("Regex pattern saved successfully!","success")}catch{logseq.UI.showMsg("Invalid regex pattern!","error")}}addSettingsListener(l){this.listeners.push(l)}removeSettingsListener(l){const b=this.listeners.indexOf(l);b>-1&&this.listeners.splice(b,1)}}class kr{settings;constructor(l){this.settings=l}async getCurrentPageBlocks(){const l=await logseq.Editor.getCurrentPage();if(console.log("[LivePhotos] Current page:",l),!l||!l.name)return console.log("[LivePhotos] No current page or page name"),[];const b=await logseq.Editor.getPageBlocksTree(l.name);console.log("[LivePhotos] Raw blocks tree:",b);const v=this.flattenBlockTree(b||[]);return console.log("[LivePhotos] Flattened blocks:",v),v}flattenBlockTree(l,b=0,v){const d=[];for(const T of l){const S={uuid:T.uuid,content:T.content||"",level:b,parent:v,children:void 0};if(d.push(S),T.children&&T.children.length>0){const c=this.flattenBlockTree(T.children,b+1,S);d.push(...c),S.children=c}}return d}extractMediaUrl(l){const v=/!\[.*?\]\((.*?)\)/g.exec(l);if(console.log("[LivePhotos] Extracting media from content:",l),console.log("[LivePhotos] Regex match:",v),!v)return{url:"",type:null};const d=v[1];return console.log("[LivePhotos] Extracted URL:",d),d.match(/\.(jpg|jpeg|png|gif|webp)$/i)?(console.log("[LivePhotos] Detected image type"),{url:d,type:"image"}):d.match(/\.(mov|mp4|avi|webm)$/i)?(console.log("[LivePhotos] Detected video type"),{url:d,type:"video"}):(console.log("[LivePhotos] No media type matched"),{url:"",type:null})}findMediaPairs(l){console.log("[LivePhotos] Finding media pairs from blocks:",l.length);const b=[],v=this.groupBlocksByLevel(l);console.log("[LivePhotos] Grouped blocks by level:",v);for(const[d,T]of Object.entries(v)){console.log("[LivePhotos] Processing level:",d,"with",T.length,"blocks");const S=this.findConsecutiveMediaBlocks(T);console.log("[LivePhotos] Found consecutive media groups:",S.length);for(const c of S){console.log("[LivePhotos] Processing group:",c);const y=this.findValidPairs(c);console.log("[LivePhotos] Found pairs in group:",y.length),b.push(...y)}}return console.log("[LivePhotos] Total pairs found:",b.length),b}groupBlocksByLevel(l){const b={};for(const v of l){const d=`${v.level}-${v.parent?.uuid||"root"}`;b[d]||(b[d]=[]),b[d].push(v)}return b}findConsecutiveMediaBlocks(l){const b=[];let v=[];for(const d of l)this.extractMediaUrl(d.content).type?v.push(d):(v.length>=2&&b.push([...v]),v=[]);return v.length>=2&&b.push(v),b}findValidPairs(l){console.log("[LivePhotos] Finding all valid pairs from",l.length,"blocks");const b=[];for(let v=0;v<l.length-1;v++){const d=l[v],T=l[v+1],S=this.extractMediaUrl(d.content),c=this.extractMediaUrl(T.content);if(console.log(`[LivePhotos] Checking pair ${v}:`,S.type,c.type),S.type&&c.type&&S.type!==c.type){const y=S.type==="image"?d:T,O=S.type==="video"?d:T,A=S.type==="image"?S.url:c.url,N=S.type==="video"?S.url:c.url;if(console.log("[LivePhotos] Potential pair found, checking match..."),this.isSimpleMatch(A,N))console.log("[LivePhotos] Simple match found!"),b.push({imageBlock:y,videoBlock:O,imageUrl:A,videoUrl:N,matchScore:1});else{const J=this.calculateMatchScore(A,N);this.isValidMatch(A,N,J)&&b.push({imageBlock:y,videoBlock:O,imageUrl:A,videoUrl:N,matchScore:J})}}}return console.log("[LivePhotos] Found",b.length,"valid pairs"),b}isSimpleMatch(l,b){const v=this.extractFileName(l),d=this.extractFileName(b);console.log("[LivePhotos] Testing simple match:",v,d);const T=v.replace(/\.[^.]*$/,""),S=d.replace(/\.[^.]*$/,"");if(console.log("[LivePhotos] Base names:",T,S),T.length>=6&&S.length>=6){const c=T.slice(0,-6),y=S.slice(0,-6);if(console.log("[LivePhotos] Prefixes:",c,y),c===y){const O=T.slice(-6),A=S.slice(-6);if(console.log("[LivePhotos] Suffixes:",O,A),O!==A)return console.log("[LivePhotos] Simple pattern match confirmed!"),!0}}return!1}calculateMatchScore(l,b){try{console.log("[LivePhotos] Calculating match score for:",l,b),console.log("[LivePhotos] Using regex pattern:",this.settings.regexPattern);const v=this.extractFileName(l),d=this.extractFileName(b);console.log("[LivePhotos] Extracted filenames:",v,d);const T=new RegExp(this.settings.regexPattern),S=v.match(T),c=d.match(T);if(console.log("[LivePhotos] Image regex match:",S),console.log("[LivePhotos] Video regex match:",c),!S||!c){console.log("[LivePhotos] No regex match, trying simple pattern matching");const w=/^(.*?)-([A-Za-z0-9]{5,6})\.(jpg|jpeg|png|gif|mov|mp4)$/,p=v.match(w),k=d.match(w);if(console.log("[LivePhotos] Image simple match:",p),console.log("[LivePhotos] Video simple match:",k),!p||!k)return console.log("[LivePhotos] No pattern match at all, score 0"),0;const h=p[1],E=k[1],C=p[2],R=k[2];console.log("[LivePhotos] Simple match - Image base:",h,"random:",C),console.log("[LivePhotos] Simple match - Video base:",E,"random:",R);let B=0;if(h===E)B=1,console.log("[LivePhotos] Perfect base name match, score 1.0");else{const F=this.calculateStringSimilarity(h,E);B=F*.8,console.log("[LivePhotos] Base name similarity:",F,"*",.8,"=",B)}return console.log("[LivePhotos] Final score (simple):",B),B}const y=S[1],O=S[2],A=c[1],N=c[2];console.log("[LivePhotos] Image base:",y,"random:",O),console.log("[LivePhotos] Video base:",A,"random:",N);let J=0;if(y===A)J+=.8,console.log("[LivePhotos] Base names match exactly, +0.8");else{const w=this.calculateStringSimilarity(y,A);J+=w*.6,console.log("[LivePhotos] Base name similarity:",w,"*",.6,"=",w*.6)}return O!==N&&(J+=.2,console.log("[LivePhotos] Random strings different, +0.2")),console.log("[LivePhotos] Final score:",J),J}catch(v){return console.warn("[LivePhotos] Invalid regex pattern:",v),0}}extractFileName(l){return l.split("/").pop()||l}calculateStringSimilarity(l,b){const v=l.length>b.length?l:b,d=l.length>b.length?b:l;if(v.length===0)return 1;const T=this.levenshteinDistance(v,d);return(v.length-T)/v.length}levenshteinDistance(l,b){const v=[];for(let d=0;d<=b.length;d++)v[d]=[d];for(let d=0;d<=l.length;d++)v[0][d]=d;for(let d=1;d<=b.length;d++)for(let T=1;T<=l.length;T++)b.charAt(d-1)===l.charAt(T-1)?v[d][T]=v[d-1][T-1]:v[d][T]=Math.min(v[d-1][T-1]+1,v[d][T-1]+1,v[d-1][T]+1);return v[b.length][l.length]}isValidMatch(l,b,v){return v>=.6}generateRendererTemplate(l){return`{{renderer :live-photo, ${l.imageUrl}, ${l.videoUrl}}}`}}class Io{blockAnalyzer;settingsManager;constructor(l){this.settingsManager=l,this.blockAnalyzer=new kr(l.getSettings())}async convertCurrentPage(){try{const l=await this.blockAnalyzer.getCurrentPageBlocks(),b=this.blockAnalyzer.findMediaPairs(l);let v=0,d=0;for(const T of b)try{await this.convertPair(T),v++}catch(S){console.error("Failed to convert pair:",S),d++}return{success:v,failed:d,total:b.length}}catch(l){return console.error("Failed to convert current page:",l),{success:0,failed:0,total:0}}}async convertPair(l){const b=this.blockAnalyzer.generateRendererTemplate(l);await logseq.Editor.updateBlock(l.imageBlock.uuid,b),await logseq.Editor.removeBlock(l.videoBlock.uuid)}async previewConversions(){try{console.log("[LivePhotos] Starting preview conversions...");const l=await this.blockAnalyzer.getCurrentPageBlocks();console.log("[LivePhotos] Got blocks for preview:",l.length);const b=this.blockAnalyzer.findMediaPairs(l);return console.log("[LivePhotos] Preview found pairs:",b.length),b}catch(l){return console.error("[LivePhotos] Failed to preview conversions:",l),[]}}async showPreviewDialog(){console.log("[LivePhotos] Starting preview dialog...");const l=await this.previewConversions();if(console.log("[LivePhotos] Preview dialog found pairs:",l.length),l.length===0){logseq.UI.showMsg("No convertible media pairs found on current page.","info");return}const b=l.map((d,T)=>`Pair ${T+1} (${(d.matchScore*100).toFixed(1)}%):
  Image: ${this.getFileName(d.imageUrl)}
  Video: ${this.getFileName(d.videoUrl)}
`).join(`
`);if(console.log("[LivePhotos] Preview text:",b),await this.confirmConversion(l.length,b)){const d=await this.convertCurrentPage();logseq.UI.showMsg(`Conversion complete: ${d.success} successful, ${d.failed} failed`,d.failed>0?"warning":"success")}}async confirmConversion(l,b){return logseq.UI.showMsg(`Found ${l} Media Pair${l>1?"s":""} to Convert:

${b}
Converting...`,"info"),!0}generatePreviewContent(l){return l.map((b,v)=>`
      <div style="
        border: 1px solid #ddd; 
        border-radius: 4px; 
        padding: 12px; 
        margin-bottom: 12px; 
        background: #f9f9f9;
      ">
        <h4 style="margin: 0 0 8px 0; color: #333;">Pair ${v+1} (Score: ${(b.matchScore*100).toFixed(1)}%)</h4>
        <div style="font-size: 12px; color: #666;">
          <div><strong>Image:</strong> ${this.getFileName(b.imageUrl)}</div>
          <div><strong>Video:</strong> ${this.getFileName(b.videoUrl)}</div>
        </div>
        <div style="margin-top: 8px; padding: 8px; background: white; border-radius: 3px; font-family: monospace; font-size: 11px;">
          {{renderer :live-photo, ${b.imageUrl}, ${b.videoUrl}}}
        </div>
      </div>
    `).join("")}getFileName(l){return l.split("/").pop()||l}async convertSelectedBlocks(l){const d=(await Promise.all(l.map(y=>logseq.Editor.getBlock(y)))).filter(y=>y!==null).map(y=>({uuid:y.uuid,content:y.content||"",level:0,parent:void 0})),T=this.blockAnalyzer.findMediaPairs(d);let S=0,c=0;for(const y of T)try{await this.convertPair(y),S++}catch(O){console.error("Failed to convert selected pair:",O),c++}return{success:S,failed:c}}updateSettings(){this.blockAnalyzer=new kr(this.settingsManager.getSettings())}}const Mo=ko.id,Fo=`
  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  @keyframes badgePulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1.1); }
  }
  
  /* Add subtle drop shadow for better visibility */
  [data-live-badge] {
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
  }
  
  [data-live-badge] svg {
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.2));
  }
`,Pr=document.createElement("style");Pr.textContent=Fo;document.head.appendChild(Pr);const Lr={slot:{width:"100%",height:"auto",display:"block"}},No=(q,l,b)=>q===Eo&&!!l&&!!b;let Rt,Nt;const Qn=new Map,Ro=({slot:q,payload:l})=>{const[b,v,d]=l.arguments;if(!No(b,v,d))return;const T=Yn.getElementById(q);if(!T)return;T.innerHTML="",Er(T,Lr.slot);const S=Rt.getSettings(),c=Or(v,d,S.enableSound);T.appendChild(c),Qn.set(q,{photoSrc:v,videoSrc:d,container:c})};async function Uo(){console.info(`#${Mo}: MAIN`),logseq.useSettingsSchema([{key:"regexPattern",type:"string",default:Ze.regexPattern,title:"Regex Pattern",description:"Regex pattern for matching image/video files. Use group 1 for base name, group 2 for random string."},{key:"enableAutoConvert",type:"boolean",default:Ze.enableAutoConvert,title:"Auto Convert",description:"Enable automatic conversion when pasting media files"},{key:"enableSound",type:"boolean",default:Ze.enableSound,title:"Enable Sound",description:"Enable sound by default for live photos. When unchecked, videos are muted by default."}]),Rt=new To,await Rt.load(),Nt=new Io(Rt),Rt.addSettingsListener(q=>{Qn.forEach(({photoSrc:l,videoSrc:b,container:v},d)=>{const T=Yn.getElementById(d);if(T&&T.contains(v)){const S=Or(l,b,q.enableSound);T.innerHTML="",Er(T,Lr.slot),T.appendChild(S),Qn.set(d,{photoSrc:l,videoSrc:b,container:S})}})}),logseq.App.onMacroRendererSlotted(Ro),logseq.onSettingsChanged(q=>{Rt.updateSettings(q)}),logseq.provideModel({async handleConvertPage(){await Nt.showPreviewDialog()},async handleQuickConvert(){const q=await Nt.convertCurrentPage();q.total>0?logseq.UI.showMsg(`Quick conversion: ${q.success} successful, ${q.failed} failed`,q.failed>0?"warning":"success"):logseq.UI.showMsg("No convertible media pairs found.","info")},async handleSettings(){logseq.showSettingsUI()}}),logseq.Editor.registerSlashCommand("[Live Photos] insert macro",async()=>{const q=await logseq.Editor.getCurrentBlock();q&&await logseq.Editor.updateBlock(q.uuid,"{{renderer :live-photo, photo_url, video_url}}")}),logseq.Editor.registerSlashCommand("[Live Photos] convert page",async()=>{await Nt.showPreviewDialog()}),logseq.Editor.registerSlashCommand("[Live Photos] settings",async()=>{logseq.showSettingsUI()}),logseq.App.registerCommandPalette({key:"live-photos-settings",label:"Live Photos: Settings"},async()=>{logseq.showSettingsUI()}),logseq.App.registerCommandPalette({key:"live-photos-convert-page",label:"Live Photos: Convert Current Page"},async()=>{await Nt.showPreviewDialog()}),logseq.App.registerCommandPalette({key:"live-photos-quick-convert",label:"Live Photos: Quick Convert Current Page"},async()=>{const q=await Nt.convertCurrentPage();q.total>0?logseq.UI.showMsg(`Quick conversion: ${q.success} successful, ${q.failed} failed`,q.failed>0?"warning":"success"):logseq.UI.showMsg("No convertible media pairs found.","info")}),logseq.App.registerUIItem("toolbar",{key:"live-photos-convert",template:`
      <span class="live-photos-convert">
        <a title="Convert Live Photos" class="button" data-on-click="handleConvertPage">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
            <circle cx="12" cy="13" r="4"></circle>
            <text x="12" y="11" font-size="3" font-weight="bold" text-anchor="middle" fill="currentColor">LIVE</text>
            <circle cx="20" cy="8" r="1.5" fill="currentColor">
              <animate attributeName="opacity" values="1;0.3;1" dur="1.5s" repeatCount="indefinite"/>
            </circle>
          </svg>
        </a>
      </span>
    `})}logseq.ready(Uo).catch(console.error);
