(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))j(p);new MutationObserver(p=>{for(const $ of p)if($.type==="childList")for(const x of $.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&j(x)}).observe(document,{childList:!0,subtree:!0});function C(p){const $={};return p.integrity&&($.integrity=p.integrity),p.referrerPolicy&&($.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?$.credentials="include":p.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function j(p){if(p.ep)return;p.ep=!0;const $=C(p);fetch(p.href,$)}})();var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},kn={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */kn.exports;(function(V,u){(function(C,j){V.exports=j()})(self,()=>(()=>{var C={227:(x,c,w)=>{var L=w(155);c.formatArgs=function(F){if(F[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+F[0]+(this.useColors?"%c ":" ")+"+"+x.exports.humanize(this.diff),!this.useColors)return;const Z="color: "+this.color;F.splice(1,0,Z,"color: inherit");let v=0,f=0;F[0].replace(/%[a-zA-Z%]/g,k=>{k!=="%%"&&(v++,k==="%c"&&(f=v))}),F.splice(f,0,Z)},c.save=function(F){try{F?c.storage.setItem("debug",F):c.storage.removeItem("debug")}catch{}},c.load=function(){let F;try{F=c.storage.getItem("debug")}catch{}return!F&&L!==void 0&&"env"in L&&(F=L.env.DEBUG),F},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let F=!1;return()=>{F||(F=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),x.exports=w(447)(c);const{formatters:O}=x.exports;O.j=function(F){try{return JSON.stringify(F)}catch(Z){return"[UnexpectedJSONParseError]: "+Z.message}}},447:(x,c,w)=>{x.exports=function(L){function O(v){let f,k,d,S=null;function _(...N){if(!_.enabled)return;const B=_,M=Number(new Date),R=M-(f||M);B.diff=R,B.prev=f,B.curr=M,f=M,N[0]=O.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let i=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(l,y)=>{if(l==="%%")return"%";i++;const b=O.formatters[y];if(typeof b=="function"){const Q=N[i];l=b.call(B,Q),N.splice(i,1),i--}return l}),O.formatArgs.call(B,N),(B.log||O.log).apply(B,N)}return _.namespace=v,_.useColors=O.useColors(),_.color=O.selectColor(v),_.extend=F,_.destroy=O.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(k!==O.namespaces&&(k=O.namespaces,d=O.enabled(v)),d),set:N=>{S=N}}),typeof O.init=="function"&&O.init(_),_}function F(v,f){const k=O(this.namespace+(f===void 0?":":f)+v);return k.log=this.log,k}function Z(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}return O.debug=O,O.default=O,O.coerce=function(v){return v instanceof Error?v.stack||v.message:v},O.disable=function(){const v=[...O.names.map(Z),...O.skips.map(Z).map(f=>"-"+f)].join(",");return O.enable(""),v},O.enable=function(v){let f;O.save(v),O.namespaces=v,O.names=[],O.skips=[];const k=(typeof v=="string"?v:"").split(/[\s,]+/),d=k.length;for(f=0;f<d;f++)k[f]&&((v=k[f].replace(/\*/g,".*?"))[0]==="-"?O.skips.push(new RegExp("^"+v.slice(1)+"$")):O.names.push(new RegExp("^"+v+"$")))},O.enabled=function(v){if(v[v.length-1]==="*")return!0;let f,k;for(f=0,k=O.skips.length;f<k;f++)if(O.skips[f].test(v))return!1;for(f=0,k=O.names.length;f<k;f++)if(O.names[f].test(v))return!0;return!1},O.humanize=w(824),O.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(L).forEach(v=>{O[v]=L[v]}),O.names=[],O.skips=[],O.formatters={},O.selectColor=function(v){let f=0;for(let k=0;k<v.length;k++)f=(f<<5)-f+v.charCodeAt(k),f|=0;return O.colors[Math.abs(f)%O.colors.length]},O.enable(O.load()),O}},996:x=>{var c=function(d){return function(S){return!!S&&typeof S=="object"}(d)&&!function(S){var _=Object.prototype.toString.call(S);return _==="[object RegExp]"||_==="[object Date]"||function(N){return N.$$typeof===w}(S)}(d)},w=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function L(d,S){return S.clone!==!1&&S.isMergeableObject(d)?f((_=d,Array.isArray(_)?[]:{}),d,S):d;var _}function O(d,S,_){return d.concat(S).map(function(N){return L(N,_)})}function F(d){return Object.keys(d).concat(function(S){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(S).filter(function(_){return Object.propertyIsEnumerable.call(S,_)}):[]}(d))}function Z(d,S){try{return S in d}catch{return!1}}function v(d,S,_){var N={};return _.isMergeableObject(d)&&F(d).forEach(function(B){N[B]=L(d[B],_)}),F(S).forEach(function(B){(function(M,R){return Z(M,R)&&!(Object.hasOwnProperty.call(M,R)&&Object.propertyIsEnumerable.call(M,R))})(d,B)||(Z(d,B)&&_.isMergeableObject(S[B])?N[B]=function(M,R){if(!R.customMerge)return f;var i=R.customMerge(M);return typeof i=="function"?i:f}(B,_)(d[B],S[B],_):N[B]=L(S[B],_))}),N}function f(d,S,_){(_=_||{}).arrayMerge=_.arrayMerge||O,_.isMergeableObject=_.isMergeableObject||c,_.cloneUnlessOtherwiseSpecified=L;var N=Array.isArray(S);return N===Array.isArray(d)?N?_.arrayMerge(d,S,_):v(d,S,_):L(S,_)}f.all=function(d,S){if(!Array.isArray(d))throw new Error("first argument should be an array");return d.reduce(function(_,N){return f(_,N,S)},{})};var k=f;x.exports=k},856:function(x){x.exports=function(){function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},c(P)}function w(P,U){return w=Object.setPrototypeOf||function(W,X){return W.__proto__=X,W},w(P,U)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(P,U,W){return O=L()?Reflect.construct:function(X,ft,Rt){var Gt=[null];Gt.push.apply(Gt,ft);var ee=new(Function.bind.apply(X,Gt));return Rt&&w(ee,Rt.prototype),ee},O.apply(null,arguments)}function F(P){return Z(P)||v(P)||f(P)||d()}function Z(P){if(Array.isArray(P))return k(P)}function v(P){if(typeof Symbol<"u"&&P[Symbol.iterator]!=null||P["@@iterator"]!=null)return Array.from(P)}function f(P,U){if(P){if(typeof P=="string")return k(P,U);var W=Object.prototype.toString.call(P).slice(8,-1);return W==="Object"&&P.constructor&&(W=P.constructor.name),W==="Map"||W==="Set"?Array.from(P):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?k(P,U):void 0}}function k(P,U){(U==null||U>P.length)&&(U=P.length);for(var W=0,X=new Array(U);W<U;W++)X[W]=P[W];return X}function d(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var S=Object.hasOwnProperty,_=Object.setPrototypeOf,N=Object.isFrozen,B=Object.getPrototypeOf,M=Object.getOwnPropertyDescriptor,R=Object.freeze,i=Object.seal,l=Object.create,y=typeof Reflect<"u"&&Reflect,b=y.apply,Q=y.construct;b||(b=function(P,U,W){return P.apply(U,W)}),R||(R=function(P){return P}),i||(i=function(P){return P}),Q||(Q=function(P,U){return O(P,F(U))});var nt=et(Array.prototype.forEach),at=et(Array.prototype.pop),pt=et(Array.prototype.push),wt=et(String.prototype.toLowerCase),Ct=et(String.prototype.match),bt=et(String.prototype.replace),Se=et(String.prototype.indexOf),g=et(String.prototype.trim),A=et(RegExp.prototype.test),H=kt(TypeError);function et(P){return function(U){for(var W=arguments.length,X=new Array(W>1?W-1:0),ft=1;ft<W;ft++)X[ft-1]=arguments[ft];return b(P,U,X)}}function kt(P){return function(){for(var U=arguments.length,W=new Array(U),X=0;X<U;X++)W[X]=arguments[X];return Q(P,W)}}function D(P,U){_&&_(P,null);for(var W=U.length;W--;){var X=U[W];if(typeof X=="string"){var ft=wt(X);ft!==X&&(N(U)||(U[W]=ft),X=ft)}P[X]=!0}return P}function Y(P){var U,W=l(null);for(U in P)b(S,P,[U])&&(W[U]=P[U]);return W}function st(P,U){for(;P!==null;){var W=M(P,U);if(W){if(W.get)return et(W.get);if(typeof W.value=="function")return et(W.value)}P=B(P)}function X(ft){return console.warn("fallback value for",ft),null}return X}var At=R(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xt=R(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),jt=R(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),te=R(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ht=R(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),lt=R(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),St=R(["#text"]),Et=R(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Ft=R(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Zt=R(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Tt=R(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Pt=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),pe=i(/<%[\w\W]*|[\w\W]*%>/gm),Sn=i(/^data-[\-\w.\u00B7-\uFFFF]/),Nt=i(/^aria-[\-\w]+$/),Ht=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ye=i(/^(?:\w+script|data):/i),On=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),An=i(/^html$/i),fe=function(){return typeof window>"u"?null:window},En=function(P,U){if(c(P)!=="object"||typeof P.createPolicy!="function")return null;var W=null,X="data-tt-policy-suffix";U.currentScript&&U.currentScript.hasAttribute(X)&&(W=U.currentScript.getAttribute(X));var ft="dompurify"+(W?"#"+W:"");try{return P.createPolicy(ft,{createHTML:function(Rt){return Rt}})}catch{return console.warn("TrustedTypes policy "+ft+" could not be created."),null}};function Xe(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fe(),U=function(o){return Xe(o)};if(U.version="2.3.8",U.removed=[],!P||!P.document||P.document.nodeType!==9)return U.isSupported=!1,U;var W=P.document,X=P.document,ft=P.DocumentFragment,Rt=P.HTMLTemplateElement,Gt=P.Node,ee=P.Element,$e=P.NodeFilter,tn=P.NamedNodeMap,Qt=tn===void 0?P.NamedNodeMap||P.MozNamedAttrMap:tn,Pn=P.HTMLFormElement,Ln=P.DOMParser,jn=P.trustedTypes,Oe=ee.prototype,Tn=st(Oe,"cloneNode"),In=st(Oe,"nextSibling"),Mn=st(Oe,"childNodes"),De=st(Oe,"parentNode");if(typeof Rt=="function"){var Ut=X.createElement("template");Ut.content&&Ut.content.ownerDocument&&(X=Ut.content.ownerDocument)}var $t=En(jn,W),en=$t?$t.createHTML(""):"",Ae=X,ze=Ae.implementation,ne=Ae.createNodeIterator,nn=Ae.createDocumentFragment,rn=Ae.getElementsByTagName,Fn=W.importNode,on={};try{on=Y(X).documentMode?X.documentMode:{}}catch{}var It={};U.isSupported=typeof De=="function"&&ze&&ze.createHTMLDocument!==void 0&&on!==9;var ge,Wt,Ee=Pt,Pe=pe,Be=Sn,Nn=Nt,sn=Ye,Le=On,rt=Ht,gt=null,an=D({},[].concat(F(At),F(xt),F(jt),F(ht),F(St))),mt=null,re=D({},[].concat(F(Et),F(Ft),F(Zt),F(Tt))),ut=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),oe=null,je=null,qe=!0,He=!0,cn=!1,ie=!1,Kt=!1,Ge=!1,We=!1,se=!1,Te=!1,ae=!1,ln=!0,Ve=!0,ce=!1,Dt={},le=null,un=D({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),hn=null,dn=D({},["audio","video","img","source","image","track"]),Je=null,Yt=D({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ue="http://www.w3.org/1998/Math/MathML",Ze="http://www.w3.org/2000/svg",Vt="http://www.w3.org/1999/xhtml",Ie=Vt,pn=!1,me=["application/xhtml+xml","text/html"],ve="text/html",he=null,Rn=X.createElement("form"),fn=function(o){return o instanceof RegExp||o instanceof Function},Qe=function(o){he&&he===o||(o&&c(o)==="object"||(o={}),o=Y(o),gt="ALLOWED_TAGS"in o?D({},o.ALLOWED_TAGS):an,mt="ALLOWED_ATTR"in o?D({},o.ALLOWED_ATTR):re,Je="ADD_URI_SAFE_ATTR"in o?D(Y(Yt),o.ADD_URI_SAFE_ATTR):Yt,hn="ADD_DATA_URI_TAGS"in o?D(Y(dn),o.ADD_DATA_URI_TAGS):dn,le="FORBID_CONTENTS"in o?D({},o.FORBID_CONTENTS):un,oe="FORBID_TAGS"in o?D({},o.FORBID_TAGS):{},je="FORBID_ATTR"in o?D({},o.FORBID_ATTR):{},Dt="USE_PROFILES"in o&&o.USE_PROFILES,qe=o.ALLOW_ARIA_ATTR!==!1,He=o.ALLOW_DATA_ATTR!==!1,cn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,ie=o.SAFE_FOR_TEMPLATES||!1,Kt=o.WHOLE_DOCUMENT||!1,se=o.RETURN_DOM||!1,Te=o.RETURN_DOM_FRAGMENT||!1,ae=o.RETURN_TRUSTED_TYPE||!1,We=o.FORCE_BODY||!1,ln=o.SANITIZE_DOM!==!1,Ve=o.KEEP_CONTENT!==!1,ce=o.IN_PLACE||!1,rt=o.ALLOWED_URI_REGEXP||rt,Ie=o.NAMESPACE||Vt,o.CUSTOM_ELEMENT_HANDLING&&fn(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ut.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&fn(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ut.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ut.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ge=ge=me.indexOf(o.PARSER_MEDIA_TYPE)===-1?ve:o.PARSER_MEDIA_TYPE,Wt=ge==="application/xhtml+xml"?function(I){return I}:wt,ie&&(He=!1),Te&&(se=!0),Dt&&(gt=D({},F(St)),mt=[],Dt.html===!0&&(D(gt,At),D(mt,Et)),Dt.svg===!0&&(D(gt,xt),D(mt,Ft),D(mt,Tt)),Dt.svgFilters===!0&&(D(gt,jt),D(mt,Ft),D(mt,Tt)),Dt.mathMl===!0&&(D(gt,ht),D(mt,Zt),D(mt,Tt))),o.ADD_TAGS&&(gt===an&&(gt=Y(gt)),D(gt,o.ADD_TAGS)),o.ADD_ATTR&&(mt===re&&(mt=Y(mt)),D(mt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&D(Je,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(le===un&&(le=Y(le)),D(le,o.FORBID_CONTENTS)),Ve&&(gt["#text"]=!0),Kt&&D(gt,["html","head","body"]),gt.table&&(D(gt,["tbody"]),delete oe.tbody),R&&R(o),he=o)},gn=D({},["mi","mo","mn","ms","mtext"]),mn=D({},["foreignobject","desc","title","annotation-xml"]),Un=D({},["title","style","font","a","script"]),zt=D({},xt);D(zt,jt),D(zt,te);var Me=D({},ht);D(Me,lt);var $n=function(o){var I=De(o);I&&I.tagName||(I={namespaceURI:Vt,tagName:"template"});var E=wt(o.tagName),ot=wt(I.tagName);return o.namespaceURI===Ze?I.namespaceURI===Vt?E==="svg":I.namespaceURI===ue?E==="svg"&&(ot==="annotation-xml"||gn[ot]):!!zt[E]:o.namespaceURI===ue?I.namespaceURI===Vt?E==="math":I.namespaceURI===Ze?E==="math"&&mn[ot]:!!Me[E]:o.namespaceURI===Vt&&!(I.namespaceURI===Ze&&!mn[ot])&&!(I.namespaceURI===ue&&!gn[ot])&&!Me[E]&&(Un[E]||!zt[E])},Bt=function(o){pt(U.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=en}catch{o.remove()}}},ye=function(o,I){try{pt(U.removed,{attribute:I.getAttributeNode(o),from:I})}catch{pt(U.removed,{attribute:null,from:I})}if(I.removeAttribute(o),o==="is"&&!mt[o])if(se||Te)try{Bt(I)}catch{}else try{I.setAttribute(o,"")}catch{}},vn=function(o){var I,E;if(We)o="<remove></remove>"+o;else{var ot=Ct(o,/^[\r\n\t ]+/);E=ot&&ot[0]}ge==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var dt=$t?$t.createHTML(o):o;if(Ie===Vt)try{I=new Ln().parseFromString(dt,ge)}catch{}if(!I||!I.documentElement){I=ze.createDocument(Ie,"template",null);try{I.documentElement.innerHTML=pn?"":dt}catch{}}var _t=I.body||I.documentElement;return o&&E&&_t.insertBefore(X.createTextNode(E),_t.childNodes[0]||null),Ie===Vt?rn.call(I,Kt?"html":"body")[0]:Kt?I.documentElement:_t},yn=function(o){return ne.call(o.ownerDocument||o,o,$e.SHOW_ELEMENT|$e.SHOW_COMMENT|$e.SHOW_TEXT,null,!1)},Dn=function(o){return o instanceof Pn&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Qt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},be=function(o){return c(Gt)==="object"?o instanceof Gt:o&&c(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},Ot=function(o,I,E){It[o]&&nt(It[o],function(ot){ot.call(U,I,E,he)})},_e=function(o){var I;if(Ot("beforeSanitizeElements",o,null),Dn(o)||A(/[\u0080-\uFFFF]/,o.nodeName))return Bt(o),!0;var E=Wt(o.nodeName);if(Ot("uponSanitizeElement",o,{tagName:E,allowedTags:gt}),o.hasChildNodes()&&!be(o.firstElementChild)&&(!be(o.content)||!be(o.content.firstElementChild))&&A(/<[/\w]/g,o.innerHTML)&&A(/<[/\w]/g,o.textContent)||E==="select"&&A(/<template/i,o.innerHTML))return Bt(o),!0;if(!gt[E]||oe[E]){if(!oe[E]&&Xt(E)&&(ut.tagNameCheck instanceof RegExp&&A(ut.tagNameCheck,E)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(E)))return!1;if(Ve&&!le[E]){var ot=De(o)||o.parentNode,dt=Mn(o)||o.childNodes;if(dt&&ot)for(var _t=dt.length-1;_t>=0;--_t)ot.insertBefore(Tn(dt[_t],!0),In(o))}return Bt(o),!0}return o instanceof ee&&!$n(o)?(Bt(o),!0):E!=="noscript"&&E!=="noembed"||!A(/<\/no(script|embed)/i,o.innerHTML)?(ie&&o.nodeType===3&&(I=o.textContent,I=bt(I,Ee," "),I=bt(I,Pe," "),o.textContent!==I&&(pt(U.removed,{element:o.cloneNode()}),o.textContent=I)),Ot("afterSanitizeElements",o,null),!1):(Bt(o),!0)},bn=function(o,I,E){if(ln&&(I==="id"||I==="name")&&(E in X||E in Rn))return!1;if(!(He&&!je[I]&&A(Be,I))){if(!(qe&&A(Nn,I))){if(!mt[I]||je[I]){if(!(Xt(o)&&(ut.tagNameCheck instanceof RegExp&&A(ut.tagNameCheck,o)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(o))&&(ut.attributeNameCheck instanceof RegExp&&A(ut.attributeNameCheck,I)||ut.attributeNameCheck instanceof Function&&ut.attributeNameCheck(I))||I==="is"&&ut.allowCustomizedBuiltInElements&&(ut.tagNameCheck instanceof RegExp&&A(ut.tagNameCheck,E)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(E))))return!1}else if(!Je[I]){if(!A(rt,bt(E,Le,""))){if((I!=="src"&&I!=="xlink:href"&&I!=="href"||o==="script"||Se(E,"data:")!==0||!hn[o])&&!(cn&&!A(sn,bt(E,Le,"")))){if(E)return!1}}}}}return!0},Xt=function(o){return o.indexOf("-")>0},we=function(o){var I,E,ot,dt;Ot("beforeSanitizeAttributes",o,null);var _t=o.attributes;if(_t){var vt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:mt};for(dt=_t.length;dt--;){var xe=I=_t[dt],Jt=xe.name,Lt=xe.namespaceURI;if(E=Jt==="value"?I.value:g(I.value),ot=Wt(Jt),vt.attrName=ot,vt.attrValue=E,vt.keepAttr=!0,vt.forceKeepAttr=void 0,Ot("uponSanitizeAttribute",o,vt),E=vt.attrValue,!vt.forceKeepAttr&&(ye(Jt,o),vt.keepAttr))if(A(/\/>/i,E))ye(Jt,o);else{ie&&(E=bt(E,Ee," "),E=bt(E,Pe," "));var Ke=Wt(o.nodeName);if(bn(Ke,ot,E))try{Lt?o.setAttributeNS(Lt,Jt,E):o.setAttribute(Jt,E),at(U.removed)}catch{}}}Ot("afterSanitizeAttributes",o,null)}},zn=function o(I){var E,ot=yn(I);for(Ot("beforeSanitizeShadowDOM",I,null);E=ot.nextNode();)Ot("uponSanitizeShadowNode",E,null),_e(E)||(E.content instanceof ft&&o(E.content),we(E));Ot("afterSanitizeShadowDOM",I,null)};return U.sanitize=function(o,I){var E,ot,dt,_t,vt;if((pn=!o)&&(o="<!-->"),typeof o!="string"&&!be(o)){if(typeof o.toString!="function")throw H("toString is not a function");if(typeof(o=o.toString())!="string")throw H("dirty is not a string, aborting")}if(!U.isSupported){if(c(P.toStaticHTML)==="object"||typeof P.toStaticHTML=="function"){if(typeof o=="string")return P.toStaticHTML(o);if(be(o))return P.toStaticHTML(o.outerHTML)}return o}if(Ge||Qe(I),U.removed=[],typeof o=="string"&&(ce=!1),ce){if(o.nodeName){var xe=Wt(o.nodeName);if(!gt[xe]||oe[xe])throw H("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Gt)(ot=(E=vn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&ot.nodeName==="BODY"||ot.nodeName==="HTML"?E=ot:E.appendChild(ot);else{if(!se&&!ie&&!Kt&&o.indexOf("<")===-1)return $t&&ae?$t.createHTML(o):o;if(!(E=vn(o)))return se?null:ae?en:""}E&&We&&Bt(E.firstChild);for(var Jt=yn(ce?o:E);dt=Jt.nextNode();)dt.nodeType===3&&dt===_t||_e(dt)||(dt.content instanceof ft&&zn(dt.content),we(dt),_t=dt);if(_t=null,ce)return o;if(se){if(Te)for(vt=nn.call(E.ownerDocument);E.firstChild;)vt.appendChild(E.firstChild);else vt=E;return mt.shadowroot&&(vt=Fn.call(W,vt,!0)),vt}var Lt=Kt?E.outerHTML:E.innerHTML;return Kt&&gt["!doctype"]&&E.ownerDocument&&E.ownerDocument.doctype&&E.ownerDocument.doctype.name&&A(An,E.ownerDocument.doctype.name)&&(Lt="<!DOCTYPE "+E.ownerDocument.doctype.name+`>
`+Lt),ie&&(Lt=bt(Lt,Ee," "),Lt=bt(Lt,Pe," ")),$t&&ae?$t.createHTML(Lt):Lt},U.setConfig=function(o){Qe(o),Ge=!0},U.clearConfig=function(){he=null,Ge=!1},U.isValidAttribute=function(o,I,E){he||Qe({});var ot=Wt(o),dt=Wt(I);return bn(ot,dt,E)},U.addHook=function(o,I){typeof I=="function"&&(It[o]=It[o]||[],pt(It[o],I))},U.removeHook=function(o){if(It[o])return at(It[o])},U.removeHooks=function(o){It[o]&&(It[o]=[])},U.removeAllHooks=function(){It={}},U}return Xe()}()},729:x=>{var c=Object.prototype.hasOwnProperty,w="~";function L(){}function O(f,k,d){this.fn=f,this.context=k,this.once=d||!1}function F(f,k,d,S,_){if(typeof d!="function")throw new TypeError("The listener must be a function");var N=new O(d,S||f,_),B=w?w+k:k;return f._events[B]?f._events[B].fn?f._events[B]=[f._events[B],N]:f._events[B].push(N):(f._events[B]=N,f._eventsCount++),f}function Z(f,k){--f._eventsCount==0?f._events=new L:delete f._events[k]}function v(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(w=!1)),v.prototype.eventNames=function(){var f,k,d=[];if(this._eventsCount===0)return d;for(k in f=this._events)c.call(f,k)&&d.push(w?k.slice(1):k);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},v.prototype.listeners=function(f){var k=w?w+f:f,d=this._events[k];if(!d)return[];if(d.fn)return[d.fn];for(var S=0,_=d.length,N=new Array(_);S<_;S++)N[S]=d[S].fn;return N},v.prototype.listenerCount=function(f){var k=w?w+f:f,d=this._events[k];return d?d.fn?1:d.length:0},v.prototype.emit=function(f,k,d,S,_,N){var B=w?w+f:f;if(!this._events[B])return!1;var M,R,i=this._events[B],l=arguments.length;if(i.fn){switch(i.once&&this.removeListener(f,i.fn,void 0,!0),l){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,k),!0;case 3:return i.fn.call(i.context,k,d),!0;case 4:return i.fn.call(i.context,k,d,S),!0;case 5:return i.fn.call(i.context,k,d,S,_),!0;case 6:return i.fn.call(i.context,k,d,S,_,N),!0}for(R=1,M=new Array(l-1);R<l;R++)M[R-1]=arguments[R];i.fn.apply(i.context,M)}else{var y,b=i.length;for(R=0;R<b;R++)switch(i[R].once&&this.removeListener(f,i[R].fn,void 0,!0),l){case 1:i[R].fn.call(i[R].context);break;case 2:i[R].fn.call(i[R].context,k);break;case 3:i[R].fn.call(i[R].context,k,d);break;case 4:i[R].fn.call(i[R].context,k,d,S);break;default:if(!M)for(y=1,M=new Array(l-1);y<l;y++)M[y-1]=arguments[y];i[R].fn.apply(i[R].context,M)}}return!0},v.prototype.on=function(f,k,d){return F(this,f,k,d,!1)},v.prototype.once=function(f,k,d){return F(this,f,k,d,!0)},v.prototype.removeListener=function(f,k,d,S){var _=w?w+f:f;if(!this._events[_])return this;if(!k)return Z(this,_),this;var N=this._events[_];if(N.fn)N.fn!==k||S&&!N.once||d&&N.context!==d||Z(this,_);else{for(var B=0,M=[],R=N.length;B<R;B++)(N[B].fn!==k||S&&!N[B].once||d&&N[B].context!==d)&&M.push(N[B]);M.length?this._events[_]=M.length===1?M[0]:M:Z(this,_)}return this},v.prototype.removeAllListeners=function(f){var k;return f?(k=w?w+f:f,this._events[k]&&Z(this,k)):(this._events=new L,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=w,v.EventEmitter=v,x.exports=v},717:x=>{typeof Object.create=="function"?x.exports=function(c,w){c.super_=w,c.prototype=Object.create(w.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:x.exports=function(c,w){c.super_=w;var L=function(){};L.prototype=w.prototype,c.prototype=new L,c.prototype.constructor=c}},824:x=>{var c=1e3,w=60*c,L=60*w,O=24*L,F=7*O,Z=365.25*O;function v(f,k,d,S){var _=k>=1.5*d;return Math.round(f/d)+" "+S+(_?"s":"")}x.exports=function(f,k){k=k||{};var d=typeof f;if(d==="string"&&f.length>0)return function(S){if(!((S=String(S)).length>100)){var _=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(S);if(_){var N=parseFloat(_[1]);switch((_[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return N*Z;case"weeks":case"week":case"w":return N*F;case"days":case"day":case"d":return N*O;case"hours":case"hour":case"hrs":case"hr":case"h":return N*L;case"minutes":case"minute":case"mins":case"min":case"m":return N*w;case"seconds":case"second":case"secs":case"sec":case"s":return N*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return N;default:return}}}}(f);if(d==="number"&&isFinite(f))return k.long?function(S){var _=Math.abs(S);return _>=O?v(S,_,O,"day"):_>=L?v(S,_,L,"hour"):_>=w?v(S,_,w,"minute"):_>=c?v(S,_,c,"second"):S+" ms"}(f):function(S){var _=Math.abs(S);return _>=O?Math.round(S/O)+"d":_>=L?Math.round(S/L)+"h":_>=w?Math.round(S/w)+"m":_>=c?Math.round(S/c)+"s":S+"ms"}(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},520:(x,c,w)=>{var L=w(155),O=L.platform==="win32",F=w(539);function Z(i,l){for(var y=[],b=0;b<i.length;b++){var Q=i[b];Q&&Q!=="."&&(Q===".."?y.length&&y[y.length-1]!==".."?y.pop():l&&y.push(".."):y.push(Q))}return y}function v(i){for(var l=i.length-1,y=0;y<=l&&!i[y];y++);for(var b=l;b>=0&&!i[b];b--);return y===0&&b===l?i:y>b?[]:i.slice(y,b+1)}var f=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,k=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,d={};function S(i){var l=f.exec(i),y=(l[1]||"")+(l[2]||""),b=l[3]||"",Q=k.exec(b);return[y,Q[1],Q[2],Q[3]]}function _(i){var l=f.exec(i),y=l[1]||"",b=!!y&&y[1]!==":";return{device:y,isUnc:b,isAbsolute:b||!!l[2],tail:l[3]}}function N(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}d.resolve=function(){for(var i="",l="",y=!1,b=arguments.length-1;b>=-1;b--){var Q;if(b>=0?Q=arguments[b]:i?(Q=L.env["="+i])&&Q.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(Q=i+"\\"):Q=L.cwd(),!F.isString(Q))throw new TypeError("Arguments to path.resolve must be strings");if(Q){var nt=_(Q),at=nt.device,pt=nt.isUnc,wt=nt.isAbsolute,Ct=nt.tail;if((!at||!i||at.toLowerCase()===i.toLowerCase())&&(i||(i=at),y||(l=Ct+"\\"+l,y=wt),i&&y))break}}return pt&&(i=N(i)),i+(y?"\\":"")+(l=Z(l.split(/[\\\/]+/),!y).join("\\"))||"."},d.normalize=function(i){var l=_(i),y=l.device,b=l.isUnc,Q=l.isAbsolute,nt=l.tail,at=/[\\\/]$/.test(nt);return(nt=Z(nt.split(/[\\\/]+/),!Q).join("\\"))||Q||(nt="."),nt&&at&&(nt+="\\"),b&&(y=N(y)),y+(Q?"\\":"")+nt},d.isAbsolute=function(i){return _(i).isAbsolute},d.join=function(){for(var i=[],l=0;l<arguments.length;l++){var y=arguments[l];if(!F.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&i.push(y)}var b=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(b=b.replace(/^[\\\/]{2,}/,"\\")),d.normalize(b)},d.relative=function(i,l){i=d.resolve(i),l=d.resolve(l);for(var y=i.toLowerCase(),b=l.toLowerCase(),Q=v(l.split("\\")),nt=v(y.split("\\")),at=v(b.split("\\")),pt=Math.min(nt.length,at.length),wt=pt,Ct=0;Ct<pt;Ct++)if(nt[Ct]!==at[Ct]){wt=Ct;break}if(wt==0)return l;var bt=[];for(Ct=wt;Ct<nt.length;Ct++)bt.push("..");return(bt=bt.concat(Q.slice(wt))).join("\\")},d._makeLong=function(i){if(!F.isString(i))return i;if(!i)return"";var l=d.resolve(i);return/^[a-zA-Z]\:\\/.test(l)?"\\\\?\\"+l:/^\\\\[^?.]/.test(l)?"\\\\?\\UNC\\"+l.substring(2):i},d.dirname=function(i){var l=S(i),y=l[0],b=l[1];return y||b?(b&&(b=b.substr(0,b.length-1)),y+b):"."},d.basename=function(i,l){var y=S(i)[2];return l&&y.substr(-1*l.length)===l&&(y=y.substr(0,y.length-l.length)),y},d.extname=function(i){return S(i)[3]},d.format=function(i){if(!F.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!F.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var y=i.dir,b=i.base||"";return y?y[y.length-1]===d.sep?y+b:y+d.sep+b:b},d.parse=function(i){if(!F.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=S(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},d.sep="\\",d.delimiter=";";var B=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,M={};function R(i){return B.exec(i).slice(1)}M.resolve=function(){for(var i="",l=!1,y=arguments.length-1;y>=-1&&!l;y--){var b=y>=0?arguments[y]:L.cwd();if(!F.isString(b))throw new TypeError("Arguments to path.resolve must be strings");b&&(i=b+"/"+i,l=b[0]==="/")}return(l?"/":"")+(i=Z(i.split("/"),!l).join("/"))||"."},M.normalize=function(i){var l=M.isAbsolute(i),y=i&&i[i.length-1]==="/";return(i=Z(i.split("/"),!l).join("/"))||l||(i="."),i&&y&&(i+="/"),(l?"/":"")+i},M.isAbsolute=function(i){return i.charAt(0)==="/"},M.join=function(){for(var i="",l=0;l<arguments.length;l++){var y=arguments[l];if(!F.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&(i+=i?"/"+y:y)}return M.normalize(i)},M.relative=function(i,l){i=M.resolve(i).substr(1),l=M.resolve(l).substr(1);for(var y=v(i.split("/")),b=v(l.split("/")),Q=Math.min(y.length,b.length),nt=Q,at=0;at<Q;at++)if(y[at]!==b[at]){nt=at;break}var pt=[];for(at=nt;at<y.length;at++)pt.push("..");return(pt=pt.concat(b.slice(nt))).join("/")},M._makeLong=function(i){return i},M.dirname=function(i){var l=R(i),y=l[0],b=l[1];return y||b?(b&&(b=b.substr(0,b.length-1)),y+b):"."},M.basename=function(i,l){var y=R(i)[2];return l&&y.substr(-1*l.length)===l&&(y=y.substr(0,y.length-l.length)),y},M.extname=function(i){return R(i)[3]},M.format=function(i){if(!F.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var l=i.root||"";if(!F.isString(l))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+M.sep:"")+(i.base||"")},M.parse=function(i){if(!F.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var l=R(i);if(!l||l.length!==4)throw new TypeError("Invalid path '"+i+"'");return l[1]=l[1]||"",l[2]=l[2]||"",l[3]=l[3]||"",{root:l[0],dir:l[0]+l[1].slice(0,-1),base:l[2],ext:l[3],name:l[2].slice(0,l[2].length-l[3].length)}},M.sep="/",M.delimiter=":",x.exports=O?d:M,x.exports.posix=M,x.exports.win32=d},155:x=>{var c,w,L=x.exports={};function O(){throw new Error("setTimeout has not been defined")}function F(){throw new Error("clearTimeout has not been defined")}function Z(M){if(c===setTimeout)return setTimeout(M,0);if((c===O||!c)&&setTimeout)return c=setTimeout,setTimeout(M,0);try{return c(M,0)}catch{try{return c.call(null,M,0)}catch{return c.call(this,M,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:O}catch{c=O}try{w=typeof clearTimeout=="function"?clearTimeout:F}catch{w=F}})();var v,f=[],k=!1,d=-1;function S(){k&&v&&(k=!1,v.length?f=v.concat(f):d=-1,f.length&&_())}function _(){if(!k){var M=Z(S);k=!0;for(var R=f.length;R;){for(v=f,f=[];++d<R;)v&&v[d].run();d=-1,R=f.length}v=null,k=!1,function(i){if(w===clearTimeout)return clearTimeout(i);if((w===F||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(i);try{w(i)}catch{try{return w.call(null,i)}catch{return w.call(this,i)}}}(M)}}function N(M,R){this.fun=M,this.array=R}function B(){}L.nextTick=function(M){var R=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)R[i-1]=arguments[i];f.push(new N(M,R)),f.length!==1||k||Z(_)},N.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=B,L.addListener=B,L.once=B,L.off=B,L.removeListener=B,L.removeAllListeners=B,L.emit=B,L.prependListener=B,L.prependOnceListener=B,L.listeners=function(M){return[]},L.binding=function(M){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(M){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},384:x=>{x.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},539:(x,c,w)=>{var L=w(155),O=/%[sdj%]/g;c.format=function(g){if(!i(g)){for(var A=[],H=0;H<arguments.length;H++)A.push(v(arguments[H]));return A.join(" ")}H=1;for(var et=arguments,kt=et.length,D=String(g).replace(O,function(st){if(st==="%%")return"%";if(H>=kt)return st;switch(st){case"%s":return String(et[H++]);case"%d":return Number(et[H++]);case"%j":try{return JSON.stringify(et[H++])}catch{return"[Circular]"}default:return st}}),Y=et[H];H<kt;Y=et[++H])M(Y)||!b(Y)?D+=" "+Y:D+=" "+v(Y);return D},c.deprecate=function(g,A){if(l(w.g.process))return function(){return c.deprecate(g,A).apply(this,arguments)};if(L.noDeprecation===!0)return g;var H=!1;return function(){if(!H){if(L.throwDeprecation)throw new Error(A);L.traceDeprecation?console.trace(A):console.error(A),H=!0}return g.apply(this,arguments)}};var F,Z={};function v(g,A){var H={seen:[],stylize:k};return arguments.length>=3&&(H.depth=arguments[2]),arguments.length>=4&&(H.colors=arguments[3]),B(A)?H.showHidden=A:A&&c._extend(H,A),l(H.showHidden)&&(H.showHidden=!1),l(H.depth)&&(H.depth=2),l(H.colors)&&(H.colors=!1),l(H.customInspect)&&(H.customInspect=!0),H.colors&&(H.stylize=f),d(H,g,H.depth)}function f(g,A){var H=v.styles[A];return H?"\x1B["+v.colors[H][0]+"m"+g+"\x1B["+v.colors[H][1]+"m":g}function k(g,A){return g}function d(g,A,H){if(g.customInspect&&A&&at(A.inspect)&&A.inspect!==c.inspect&&(!A.constructor||A.constructor.prototype!==A)){var et=A.inspect(H,g);return i(et)||(et=d(g,et,H)),et}var kt=function(ht,lt){if(l(lt))return ht.stylize("undefined","undefined");if(i(lt)){var St="'"+JSON.stringify(lt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ht.stylize(St,"string")}if(R(lt))return ht.stylize(""+lt,"number");if(B(lt))return ht.stylize(""+lt,"boolean");if(M(lt))return ht.stylize("null","null")}(g,A);if(kt)return kt;var D=Object.keys(A),Y=function(ht){var lt={};return ht.forEach(function(St,Et){lt[St]=!0}),lt}(D);if(g.showHidden&&(D=Object.getOwnPropertyNames(A)),nt(A)&&(D.indexOf("message")>=0||D.indexOf("description")>=0))return S(A);if(D.length===0){if(at(A)){var st=A.name?": "+A.name:"";return g.stylize("[Function"+st+"]","special")}if(y(A))return g.stylize(RegExp.prototype.toString.call(A),"regexp");if(Q(A))return g.stylize(Date.prototype.toString.call(A),"date");if(nt(A))return S(A)}var At,xt="",jt=!1,te=["{","}"];return N(A)&&(jt=!0,te=["[","]"]),at(A)&&(xt=" [Function"+(A.name?": "+A.name:"")+"]"),y(A)&&(xt=" "+RegExp.prototype.toString.call(A)),Q(A)&&(xt=" "+Date.prototype.toUTCString.call(A)),nt(A)&&(xt=" "+S(A)),D.length!==0||jt&&A.length!=0?H<0?y(A)?g.stylize(RegExp.prototype.toString.call(A),"regexp"):g.stylize("[Object]","special"):(g.seen.push(A),At=jt?function(ht,lt,St,Et,Ft){for(var Zt=[],Tt=0,Pt=lt.length;Tt<Pt;++Tt)Se(lt,String(Tt))?Zt.push(_(ht,lt,St,Et,String(Tt),!0)):Zt.push("");return Ft.forEach(function(pe){pe.match(/^\d+$/)||Zt.push(_(ht,lt,St,Et,pe,!0))}),Zt}(g,A,H,Y,D):D.map(function(ht){return _(g,A,H,Y,ht,jt)}),g.seen.pop(),function(ht,lt,St){return ht.reduce(function(Et,Ft){return Ft.indexOf(`
`)>=0,Et+Ft.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?St[0]+(lt===""?"":lt+`
 `)+" "+ht.join(`,
  `)+" "+St[1]:St[0]+lt+" "+ht.join(", ")+" "+St[1]}(At,xt,te)):te[0]+xt+te[1]}function S(g){return"["+Error.prototype.toString.call(g)+"]"}function _(g,A,H,et,kt,D){var Y,st,At;if((At=Object.getOwnPropertyDescriptor(A,kt)||{value:A[kt]}).get?st=At.set?g.stylize("[Getter/Setter]","special"):g.stylize("[Getter]","special"):At.set&&(st=g.stylize("[Setter]","special")),Se(et,kt)||(Y="["+kt+"]"),st||(g.seen.indexOf(At.value)<0?(st=M(H)?d(g,At.value,null):d(g,At.value,H-1)).indexOf(`
`)>-1&&(st=D?st.split(`
`).map(function(xt){return"  "+xt}).join(`
`).substr(2):`
`+st.split(`
`).map(function(xt){return"   "+xt}).join(`
`)):st=g.stylize("[Circular]","special")),l(Y)){if(D&&kt.match(/^\d+$/))return st;(Y=JSON.stringify(""+kt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Y=Y.substr(1,Y.length-2),Y=g.stylize(Y,"name")):(Y=Y.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Y=g.stylize(Y,"string"))}return Y+": "+st}function N(g){return Array.isArray(g)}function B(g){return typeof g=="boolean"}function M(g){return g===null}function R(g){return typeof g=="number"}function i(g){return typeof g=="string"}function l(g){return g===void 0}function y(g){return b(g)&&pt(g)==="[object RegExp]"}function b(g){return typeof g=="object"&&g!==null}function Q(g){return b(g)&&pt(g)==="[object Date]"}function nt(g){return b(g)&&(pt(g)==="[object Error]"||g instanceof Error)}function at(g){return typeof g=="function"}function pt(g){return Object.prototype.toString.call(g)}function wt(g){return g<10?"0"+g.toString(10):g.toString(10)}c.debuglog=function(g){if(l(F)&&(F=L.env.NODE_DEBUG||""),g=g.toUpperCase(),!Z[g])if(new RegExp("\\b"+g+"\\b","i").test(F)){var A=L.pid;Z[g]=function(){var H=c.format.apply(c,arguments);console.error("%s %d: %s",g,A,H)}}else Z[g]=function(){};return Z[g]},c.inspect=v,v.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},v.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=N,c.isBoolean=B,c.isNull=M,c.isNullOrUndefined=function(g){return g==null},c.isNumber=R,c.isString=i,c.isSymbol=function(g){return typeof g=="symbol"},c.isUndefined=l,c.isRegExp=y,c.isObject=b,c.isDate=Q,c.isError=nt,c.isFunction=at,c.isPrimitive=function(g){return g===null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||typeof g=="symbol"||g===void 0},c.isBuffer=w(384);var Ct=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function bt(){var g=new Date,A=[wt(g.getHours()),wt(g.getMinutes()),wt(g.getSeconds())].join(":");return[g.getDate(),Ct[g.getMonth()],A].join(" ")}function Se(g,A){return Object.prototype.hasOwnProperty.call(g,A)}c.log=function(){console.log("%s - %s",bt(),c.format.apply(c,arguments))},c.inherits=w(717),c._extend=function(g,A){if(!A||!b(A))return g;for(var H=Object.keys(A),et=H.length;et--;)g[H[et]]=A[H[et]];return g}}},j={};function p(x){var c=j[x];if(c!==void 0)return c.exports;var w=j[x]={exports:{}};return C[x].call(w.exports,w,w.exports,p),w.exports}p.n=x=>{var c=x&&x.__esModule?()=>x.default:()=>x;return p.d(c,{a:c}),c},p.d=(x,c)=>{for(var w in c)p.o(c,w)&&!p.o(x,w)&&Object.defineProperty(x,w,{enumerable:!0,get:c[w]})},p.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),p.o=(x,c)=>Object.prototype.hasOwnProperty.call(x,c),p.r=x=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(x,"__esModule",{value:!0})};var $={};return(()=>{p.r($),p.d($,{LSPluginUser:()=>Zn,setupPluginUserInstance:()=>wr});var x=p(520),c=(p(856),p(996)),w=p.n(c),L=function(){return L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},L.apply(this,arguments)};function O(e){return e.toLowerCase()}var F=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],Z=/[^A-Z0-9]+/gi;function v(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function f(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?F:s,h=r.stripRegexp,m=h===void 0?Z:h,T=r.transform,q=T===void 0?O:T,G=r.delimiter,z=G===void 0?" ":G,J=v(v(n,a,"$1\0$2"),m,"\0"),tt=0,K=J.length;J.charAt(tt)==="\0";)tt++;for(;J.charAt(K-1)==="\0";)K--;return J.slice(tt,K).split("\0").map(q).join(z)}(e,L({delimiter:"."},t))}var k=p(729),d=p.n(k);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=navigator.platform.toLowerCase()==="win32"?x.win32:x.posix,N=function(e,t){return t===void 0&&(t={}),f(e,L({delimiter:"_"},t))};class B extends d(){constructor(t,n){super(),S(this,"_tag",void 0),S(this,"_opts",void 0),S(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce((m,T)=>(T&&T instanceof Error?m+=`${T.message} ${T.stack}`:m+=T.toString(),m),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var h;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((h=console)===null||h===void 0||h[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function M(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=_.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return _.join(e,...t)}}function R(e,t){let n,r,s=!1;const a=m=>T=>{e&&clearTimeout(e),m(T),s=!0},h=new Promise((m,T)=>{n=a(m),r=a(T),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:m=>t=m,resolve:n,reject:r,promise:h,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var l=p(227),y=p.n(l);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Q="application/x-postmate-v1+json";let nt=0;const at={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},pt=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===Q&&!!at[e.data.postmate];class wt{constructor(t){b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"events",{}),b(this,"childOrigin",void 0),b(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!pt(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{const a=++nt,h=m=>{m.data.uid===a&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",h,!1),m.data.error?s(m.data.error):r(m.data.value))};this.parent.addEventListener("message",h,!1),this.child.postMessage({postmate:"request",type:Q,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:Q,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class Ct{constructor(t){b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),b(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!pt(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:h}=n.data;n.data.postmate!=="call"?((m,T,q)=>{const G=typeof m[T]=="function"?m[T].apply(null,q):m[T];return Promise.resolve(G)})(this.model,r,h).then(m=>{n.source.postMessage({property:r,postmate:"reply",type:Q,uid:s,value:m},n.origin)}).catch(m=>{n.source.postMessage({property:r,postmate:"reply",type:Q,uid:s,error:m},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:Q,value:{name:t,data:n}},this.parentOrigin)}}class bt{constructor(t){b(this,"container",void 0),b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"childOrigin",void 0),b(this,"url",void 0),b(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(a=>{const h=document.createElement("a");h.href=a;const m=h.protocol.length>4?h.protocol:window.location.protocol,T=h.host.length?h.port==="80"||h.port==="443"?h.hostname:h.host:window.location.host;return h.origin||`${m}//${T}`})(t=t||this.url);let r,s=0;return new Promise((a,h)=>{const m=q=>!!pt(q,n)&&(q.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=q.origin,a(new wt(this))):h("Failed handshake"));this.parent.addEventListener("message",m,!1);const T=()=>{s++,this.child.postMessage({postmate:"handshake",type:Q,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{T(),r=setInterval(T,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}b(bt,"debug",!1),b(bt,"Model",void 0);class Se{constructor(t){b(this,"child",void 0),b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:Q},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(h=>{this.model[h]=a[h]}),t(new Ct(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:A,createSandboxContainer:H}=window.QSandbox||{};function et(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class kt extends d(){constructor(t){super(),g(this,"_pluginLocal",void 0),g(this,"_frame",void 0),g(this,"_root",void 0),g(this,"_loaded",!1),g(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await A(n,{fetch:et});this._mount(r,document.body);const a=H(t,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Zn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const h=await s(a,!0);this._unmountFns.push(h.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Y=y()("LSPlugin:caller"),st="#await#response#",At="#lspmsg#",xt="#lspmsg#error#",jt=e=>`#lspmsg#${e}`;class te extends d(){constructor(t){super(),D(this,"_pluginLocal",void 0),D(this,"_connected",!1),D(this,"_parent",void 0),D(this,"_child",void 0),D(this,"_shadow",void 0),D(this,"_status",void 0),D(this,"_userModel",{}),D(this,"_call",void 0),D(this,"_callUserModel",void 0),D(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,h=R(6e4),m=this._extendUserModel({"#lspmsg#ready#":async G=>{m[jt(G?.pid)]=({type:z,payload:J})=>{Y(`[host (_call) -> *user] ${this._debugTag}`,z,J),n.emit(z,J)},await h.resolve()},"#lspmsg#beforeunload#":async G=>{const z=R(1e4);n.emit("beforeunload",Object.assign({actor:z},G)),await z.promise},"#lspmsg#settings#":async({type:G,payload:z})=>{n.emit("settings:changed",z)},[At]:async({ns:G,type:z,payload:J})=>{Y(`[host (async) -> *user] ${this._debugTag} ns=${G} type=${z}`,J),G&&G.startsWith("hook")?n.emit(`${G}:${z}`,J):n.emit(z,J)},"#lspmsg#reply#":({_sync:G,result:z})=>{if(Y(`[sync host -> *user] #${G}`,z),a.has(G)){const J=a.get(G);J&&(z!=null&&z.hasOwnProperty(xt)?J.reject(z[xt]):J.resolve(z),a.delete(G))}},...t});var T;if(r)return await h.promise,JSON.parse(JSON.stringify((T=this._pluginLocal)===null||T===void 0?void 0:T.toJSON()));const q=new Se(m).sendHandshakeReply();return this._status="pending",await q.then(G=>{this._child=G,this._connected=!0,this._call=async(z,J={},tt)=>{if(tt){const K=++s;a.set(K,tt),J._sync=K,tt.setTag(`async call #${K}`),Y(`async call #${K}`)}return G.emit(jt(m.baseInfo.id),{type:z,payload:J}),tt?.promise},this._callUserModel=async(z,J)=>{try{m[z](J)}catch{Y(`[model method] #${z} not existed`)}},setInterval(()=>{if(a.size>100)for(const[z,J]of a)J.settled&&a.delete(z)},18e5)}).finally(()=>{this._status=void 0}),await h.promise,m.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const s=R(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${st}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const h=document.createElement("div");h.classList.add("lsp-iframe-sandbox-container"),h.id=r,h.dataset.pid=n;try{var m;const z=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if(z){h.dataset.inited_layout="true";let{width:J,height:tt,left:K,top:it,vw:ct,vh:yt}=z;K=Math.max(K,0),K=typeof ct=="number"?`${Math.min(100*K/ct,99)}%`:`${K}px`,it=Math.max(it,45),it=typeof yt=="number"?`${Math.min(100*it/yt,99)}%`:`${it}px`,Object.assign(h.style,{width:J+"px",height:tt+"px",left:K,top:it})}}catch(z){console.error("[Restore Layout Error]",z)}document.body.appendChild(h);const T=new bt({id:n+"_iframe",container:h,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let q,G=T.sendHandshake();return this._status="pending",new Promise((z,J)=>{q=setTimeout(()=>{J(new Error("handshake Timeout")),T.destroy()},4e3),G.then(tt=>{this._parent=tt,this._connected=!0,this.emit("connected"),tt.on(jt(t.id),({type:K,payload:it})=>{var ct,yt;Y("[user -> *host] ",K,it),(ct=this._pluginLocal)===null||ct===void 0||ct.emit(K,it||{}),(yt=this._pluginLocal)===null||yt===void 0||yt.caller.emit(K,it||{})}),this._call=async(...K)=>{await tt.call(jt(t.id),{type:K[0],payload:Object.assign(K[1]||{},{$$pid:t.id})})},this._callUserModel=async(K,...it)=>{if(K.startsWith(st))return await tt.get(K.replace(st,""),...it);tt.call(K,it?.[0])},z(null)}).catch(tt=>{J(tt)}).finally(()=>{clearTimeout(q)})}).catch(z=>{throw Y("[iframe sandbox] error",z),z}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new kt(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var h;return a&&(s.actor=a),(h=this._pluginLocal)===null||h===void 0||h.emit(r,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(st)&&(a=a.replace(st,""));const h=r[1]||{},m=this._userModel[a];typeof m=="function"&&await m.call(null,h)}}catch(r){throw Y("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class lt{constructor(t,n){ht(this,"ctx",void 0),ht(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class St{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;const a=this.ensureHostScope();return t=(r=N(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ft=e=>`task_callback_${e}`;class Zt{constructor(t,n,r={}){Et(this,"_client",void 0),Et(this,"_requestId",void 0),Et(this,"_requestOptions",void 0),Et(this,"_promise",void 0),Et(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((m,T)=>{if(!this._requestId)return T(null);this._client.once(Ft(this._requestId),q=>{q&&q instanceof Error?T(q):m(q)})});const{success:s,fail:a,final:h}=this._requestOptions;this._promise.then(m=>{s?.(m)}).catch(m=>{a?.(m)}).finally(()=>{h?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Tt extends k.EventEmitter{constructor(t){super(),Et(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(Ft(r),n?.payload)})}static createRequestTask(t,n,r){return new Zt(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...h}=t,m=this.ctx.Experiments.invokeExperMethod("request",n,h),T=Tt.createRequestTask(this.ctx.Request,m,t);return h.abortable?T:T.promise}get ctx(){return this._ctx}}const Pt=Array.isArray,pe=typeof Cn=="object"&&Cn&&Cn.Object===Object&&Cn;var Sn=typeof self=="object"&&self&&self.Object===Object&&self;const Nt=pe||Sn||Function("return this")(),Ht=Nt.Symbol;var Ye=Object.prototype,On=Ye.hasOwnProperty,An=Ye.toString,fe=Ht?Ht.toStringTag:void 0;const En=function(e){var t=On.call(e,fe),n=e[fe];try{e[fe]=void 0;var r=!0}catch{}var s=An.call(e);return r&&(t?e[fe]=n:delete e[fe]),s};var Xe=Object.prototype.toString;const P=function(e){return Xe.call(e)};var U=Ht?Ht.toStringTag:void 0;const W=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":U&&U in Object(e)?En(e):P(e)},X=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ft=function(e){if(!X(e))return!1;var t=W(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Rt=Nt["__core-js_shared__"];var Gt,ee=(Gt=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+Gt:"";const $e=function(e){return!!ee&&ee in e};var tn=Function.prototype.toString;const Qt=function(e){if(e!=null){try{return tn.call(e)}catch{}try{return e+""}catch{}}return""};var Pn=/^\[object .+?Constructor\]$/,Ln=Function.prototype,jn=Object.prototype,Oe=Ln.toString,Tn=jn.hasOwnProperty,In=RegExp("^"+Oe.call(Tn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Mn=function(e){return!(!X(e)||$e(e))&&(ft(e)?In:Pn).test(Qt(e))},De=function(e,t){return e?.[t]},Ut=function(e,t){var n=De(e,t);return Mn(n)?n:void 0},$t=function(){try{var e=Ut(Object,"defineProperty");return e({},"",{}),e}catch{}}(),en=function(e,t,n){t=="__proto__"&&$t?$t(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ae=function(e){return function(t,n,r){for(var s=-1,a=Object(t),h=r(t),m=h.length;m--;){var T=h[e?m:++s];if(n(a[T],T,a)===!1)break}return t}}(),ze=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ne=function(e){return e!=null&&typeof e=="object"},nn=function(e){return ne(e)&&W(e)=="[object Arguments]"};var rn=Object.prototype,Fn=rn.hasOwnProperty,on=rn.propertyIsEnumerable;const It=nn(function(){return arguments}())?nn:function(e){return ne(e)&&Fn.call(e,"callee")&&!on.call(e,"callee")},ge=function(){return!1};var Wt=u&&!u.nodeType&&u,Ee=Wt&&!0&&V&&!V.nodeType&&V,Pe=Ee&&Ee.exports===Wt?Nt.Buffer:void 0;const Be=(Pe?Pe.isBuffer:void 0)||ge;var Nn=/^(?:0|[1-9]\d*)$/;const sn=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Nn.test(e))&&e>-1&&e%1==0&&e<t},Le=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var rt={};rt["[object Float32Array]"]=rt["[object Float64Array]"]=rt["[object Int8Array]"]=rt["[object Int16Array]"]=rt["[object Int32Array]"]=rt["[object Uint8Array]"]=rt["[object Uint8ClampedArray]"]=rt["[object Uint16Array]"]=rt["[object Uint32Array]"]=!0,rt["[object Arguments]"]=rt["[object Array]"]=rt["[object ArrayBuffer]"]=rt["[object Boolean]"]=rt["[object DataView]"]=rt["[object Date]"]=rt["[object Error]"]=rt["[object Function]"]=rt["[object Map]"]=rt["[object Number]"]=rt["[object Object]"]=rt["[object RegExp]"]=rt["[object Set]"]=rt["[object String]"]=rt["[object WeakMap]"]=!1;const gt=function(e){return ne(e)&&Le(e.length)&&!!rt[W(e)]},an=function(e){return function(t){return e(t)}};var mt=u&&!u.nodeType&&u,re=mt&&!0&&V&&!V.nodeType&&V,ut=re&&re.exports===mt&&pe.process,oe=function(){try{var e=re&&re.require&&re.require("util").types;return e||ut&&ut.binding&&ut.binding("util")}catch{}}(),je=oe&&oe.isTypedArray;const qe=je?an(je):gt;var He=Object.prototype.hasOwnProperty;const cn=function(e,t){var n=Pt(e),r=!n&&It(e),s=!n&&!r&&Be(e),a=!n&&!r&&!s&&qe(e),h=n||r||s||a,m=h?ze(e.length,String):[],T=m.length;for(var q in e)!t&&!He.call(e,q)||h&&(q=="length"||s&&(q=="offset"||q=="parent")||a&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||sn(q,T))||m.push(q);return m};var ie=Object.prototype;const Kt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||ie)},Ge=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var We=Object.prototype.hasOwnProperty;const se=function(e){if(!Kt(e))return Ge(e);var t=[];for(var n in Object(e))We.call(e,n)&&n!="constructor"&&t.push(n);return t},Te=function(e){return e!=null&&Le(e.length)&&!ft(e)},ae=function(e){return Te(e)?cn(e):se(e)},ln=function(e,t){return e&&Ae(e,t,ae)},Ve=function(){this.__data__=[],this.size=0},ce=function(e,t){return e===t||e!=e&&t!=t},Dt=function(e,t){for(var n=e.length;n--;)if(ce(e[n][0],t))return n;return-1};var le=Array.prototype.splice;const un=function(e){var t=this.__data__,n=Dt(t,e);return!(n<0)&&(n==t.length-1?t.pop():le.call(t,n,1),--this.size,!0)},hn=function(e){var t=this.__data__,n=Dt(t,e);return n<0?void 0:t[n][1]},dn=function(e){return Dt(this.__data__,e)>-1},Je=function(e,t){var n=this.__data__,r=Dt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Yt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Yt.prototype.clear=Ve,Yt.prototype.delete=un,Yt.prototype.get=hn,Yt.prototype.has=dn,Yt.prototype.set=Je;const ue=Yt,Ze=function(){this.__data__=new ue,this.size=0},Vt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ie=function(e){return this.__data__.get(e)},pn=function(e){return this.__data__.has(e)},me=Ut(Nt,"Map"),ve=Ut(Object,"create"),he=function(){this.__data__=ve?ve(null):{},this.size=0},Rn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var fn=Object.prototype.hasOwnProperty;const Qe=function(e){var t=this.__data__;if(ve){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return fn.call(t,e)?t[e]:void 0};var gn=Object.prototype.hasOwnProperty;const mn=function(e){var t=this.__data__;return ve?t[e]!==void 0:gn.call(t,e)},Un=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ve&&t===void 0?"__lodash_hash_undefined__":t,this};function zt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}zt.prototype.clear=he,zt.prototype.delete=Rn,zt.prototype.get=Qe,zt.prototype.has=mn,zt.prototype.set=Un;const Me=zt,$n=function(){this.size=0,this.__data__={hash:new Me,map:new(me||ue),string:new Me}},Bt=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ye=function(e,t){var n=e.__data__;return Bt(t)?n[typeof t=="string"?"string":"hash"]:n.map},vn=function(e){var t=ye(this,e).delete(e);return this.size-=t?1:0,t},yn=function(e){return ye(this,e).get(e)},Dn=function(e){return ye(this,e).has(e)},be=function(e,t){var n=ye(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Ot(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ot.prototype.clear=$n,Ot.prototype.delete=vn,Ot.prototype.get=yn,Ot.prototype.has=Dn,Ot.prototype.set=be;const _e=Ot,bn=function(e,t){var n=this.__data__;if(n instanceof ue){var r=n.__data__;if(!me||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new _e(r)}return n.set(e,t),this.size=n.size,this};function Xt(e){var t=this.__data__=new ue(e);this.size=t.size}Xt.prototype.clear=Ze,Xt.prototype.delete=Vt,Xt.prototype.get=Ie,Xt.prototype.has=pn,Xt.prototype.set=bn;const we=Xt,zn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function I(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new _e;++t<n;)this.add(e[t])}I.prototype.add=I.prototype.push=zn,I.prototype.has=o;const E=I,ot=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},dt=function(e,t){return e.has(t)},_t=function(e,t,n,r,s,a){var h=1&n,m=e.length,T=t.length;if(m!=T&&!(h&&T>m))return!1;var q=a.get(e),G=a.get(t);if(q&&G)return q==t&&G==e;var z=-1,J=!0,tt=2&n?new E:void 0;for(a.set(e,t),a.set(t,e);++z<m;){var K=e[z],it=t[z];if(r)var ct=h?r(it,K,z,t,e,a):r(K,it,z,e,t,a);if(ct!==void 0){if(ct)continue;J=!1;break}if(tt){if(!ot(t,function(yt,Mt){if(!dt(tt,Mt)&&(K===yt||s(K,yt,n,r,a)))return tt.push(Mt)})){J=!1;break}}else if(K!==it&&!s(K,it,n,r,a)){J=!1;break}}return a.delete(e),a.delete(t),J},vt=Nt.Uint8Array,xe=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Jt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var Lt=Ht?Ht.prototype:void 0,Ke=Lt?Lt.valueOf:void 0;const Kn=function(e,t,n,r,s,a,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new vt(e),new vt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var m=xe;case"[object Set]":var T=1&r;if(m||(m=Jt),e.size!=t.size&&!T)return!1;var q=h.get(e);if(q)return q==t;r|=2,h.set(e,t);var G=_t(m(e),m(t),r,s,a,h);return h.delete(e),G;case"[object Symbol]":if(Ke)return Ke.call(e)==Ke.call(t)}return!1},Sr=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},Or=function(e,t,n){var r=t(e);return Pt(e)?r:Sr(r,n(e))},Ar=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var h=e[n];t(h,n,e)&&(a[s++]=h)}return a},Er=function(){return[]};var Pr=Object.prototype.propertyIsEnumerable,Yn=Object.getOwnPropertySymbols;const Lr=Yn?function(e){return e==null?[]:(e=Object(e),Ar(Yn(e),function(t){return Pr.call(e,t)}))}:Er,Xn=function(e){return Or(e,ae,Lr)};var jr=Object.prototype.hasOwnProperty;const Tr=function(e,t,n,r,s,a){var h=1&n,m=Xn(e),T=m.length;if(T!=Xn(t).length&&!h)return!1;for(var q=T;q--;){var G=m[q];if(!(h?G in t:jr.call(t,G)))return!1}var z=a.get(e),J=a.get(t);if(z&&J)return z==t&&J==e;var tt=!0;a.set(e,t),a.set(t,e);for(var K=h;++q<T;){var it=e[G=m[q]],ct=t[G];if(r)var yt=h?r(ct,it,G,t,e,a):r(it,ct,G,e,t,a);if(!(yt===void 0?it===ct||s(it,ct,n,r,a):yt)){tt=!1;break}K||(K=G=="constructor")}if(tt&&!K){var Mt=e.constructor,ke=t.constructor;Mt==ke||!("constructor"in e)||!("constructor"in t)||typeof Mt=="function"&&Mt instanceof Mt&&typeof ke=="function"&&ke instanceof ke||(tt=!1)}return a.delete(e),a.delete(t),tt},Bn=Ut(Nt,"DataView"),qn=Ut(Nt,"Promise"),Hn=Ut(Nt,"Set"),Gn=Ut(Nt,"WeakMap");var tr="[object Map]",er="[object Promise]",nr="[object Set]",rr="[object WeakMap]",or="[object DataView]",Ir=Qt(Bn),Mr=Qt(me),Fr=Qt(qn),Nr=Qt(Hn),Rr=Qt(Gn),Ce=W;(Bn&&Ce(new Bn(new ArrayBuffer(1)))!=or||me&&Ce(new me)!=tr||qn&&Ce(qn.resolve())!=er||Hn&&Ce(new Hn)!=nr||Gn&&Ce(new Gn)!=rr)&&(Ce=function(e){var t=W(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Qt(n):"";if(r)switch(r){case Ir:return or;case Mr:return tr;case Fr:return er;case Nr:return nr;case Rr:return rr}return t});const ir=Ce;var sr="[object Arguments]",ar="[object Array]",_n="[object Object]",cr=Object.prototype.hasOwnProperty;const Ur=function(e,t,n,r,s,a){var h=Pt(e),m=Pt(t),T=h?ar:ir(e),q=m?ar:ir(t),G=(T=T==sr?_n:T)==_n,z=(q=q==sr?_n:q)==_n,J=T==q;if(J&&Be(e)){if(!Be(t))return!1;h=!0,G=!1}if(J&&!G)return a||(a=new we),h||qe(e)?_t(e,t,n,r,s,a):Kn(e,t,T,n,r,s,a);if(!(1&n)){var tt=G&&cr.call(e,"__wrapped__"),K=z&&cr.call(t,"__wrapped__");if(tt||K){var it=tt?e.value():e,ct=K?t.value():t;return a||(a=new we),s(it,ct,n,r,a)}}return!!J&&(a||(a=new we),Tr(e,t,n,r,s,a))},lr=function e(t,n,r,s,a){return t===n||(t==null||n==null||!ne(t)&&!ne(n)?t!=t&&n!=n:Ur(t,n,r,s,e,a))},$r=function(e,t,n,r){var s=n.length,a=s,h=!r;if(e==null)return!a;for(e=Object(e);s--;){var m=n[s];if(h&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++s<a;){var T=(m=n[s])[0],q=e[T],G=m[1];if(h&&m[2]){if(q===void 0&&!(T in e))return!1}else{var z=new we;if(r)var J=r(q,G,T,e,t,z);if(!(J===void 0?lr(G,q,3,r,z):J))return!1}}return!0},ur=function(e){return e==e&&!X(e)},Dr=function(e){for(var t=ae(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,ur(s)]}return t},hr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},zr=function(e){var t=Dr(e);return t.length==1&&t[0][2]?hr(t[0][0],t[0][1]):function(n){return n===e||$r(n,e,t)}},Wn=function(e){return typeof e=="symbol"||ne(e)&&W(e)=="[object Symbol]"};var Br=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qr=/^\w*$/;const Vn=function(e,t){if(Pt(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Wn(e))||qr.test(e)||!Br.test(e)||t!=null&&e in Object(t)};function Jn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var h=e.apply(this,r);return n.cache=a.set(s,h)||a,h};return n.cache=new(Jn.Cache||_e),n}Jn.Cache=_e;const Hr=Jn;var Gr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wr=/\\(\\)?/g;const Vr=function(e){var t=Hr(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Gr,function(n,r,s,a){t.push(s?a.replace(Wr,"$1"):r||n)}),t}),Jr=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var dr=Ht?Ht.prototype:void 0,pr=dr?dr.toString:void 0;const Zr=function e(t){if(typeof t=="string")return t;if(Pt(t))return Jr(t,e)+"";if(Wn(t))return pr?pr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Qr=function(e){return e==null?"":Zr(e)},fr=function(e,t){return Pt(e)?e:Vn(e,t)?[e]:Vr(Qr(e))},wn=function(e){if(typeof e=="string"||Wn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},gr=function(e,t){for(var n=0,r=(t=fr(t,e)).length;e!=null&&n<r;)e=e[wn(t[n++])];return n&&n==r?e:void 0},Kr=function(e,t,n){var r=e==null?void 0:gr(e,t);return r===void 0?n:r},Yr=function(e,t){return e!=null&&t in Object(e)},Xr=function(e,t,n){for(var r=-1,s=(t=fr(t,e)).length,a=!1;++r<s;){var h=wn(t[r]);if(!(a=e!=null&&n(e,h)))break;e=e[h]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&Le(s)&&sn(h,s)&&(Pt(e)||It(e))},to=function(e,t){return e!=null&&Xr(e,t,Yr)},eo=function(e,t){return Vn(e)&&ur(t)?hr(wn(e),t):function(n){var r=Kr(n,e);return r===void 0&&r===t?to(n,e):lr(t,r,3)}},no=function(e){return e},ro=function(e){return function(t){return t?.[e]}},oo=function(e){return function(t){return gr(t,e)}},io=function(e){return Vn(e)?ro(wn(e)):oo(e)},so=function(e){return typeof e=="function"?e:e==null?no:typeof e=="object"?Pt(e)?eo(e[0],e[1]):zr(e):io(e)},ao=function(e,t){var n={};return t=so(t),ln(e,function(r,s,a){en(n,t(r,s,a),r)}),n};function mr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class co{constructor(t,n){mr(this,"ctx",void 0),mr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Pt(r?.blocks)&&(r.blocks=r.blocks.map(s=>s&&ao(s,(a,h)=>`block/${h}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{const a=(h=>`service:search:${h}:${n.name}`)(r);t.caller.on(a,async h=>{if(ft(n?.[s.f])){let m=null;try{m=await n[s.f].apply(n,(s.args||[]).map(T=>{if(h){if(T===!0)return h;if(h.hasOwnProperty(T)){const q=h[T];return delete h[T],q}}})),s.transformOutput&&(m=s.transformOutput(m))}catch(T){console.error("[SearchService] ",T),m=T}finally{s.reply&&t.caller.call(`${a}:reply`,m)}}})})}}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const lo=Symbol.for("proxy-continue"),uo=y()("LSPlugin:user"),vr=new B("",{console:!0});function Fe(e,t,n){var r;const{key:s,label:a,desc:h,palette:m,keybinding:T,extras:q}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const G=function(J){if(typeof J=="string")return J.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!G)return this.logger.error(`${a}: command key is required.`),!1;const z=`SimpleCommandHook${G}${++_r}`;this.Editor["on"+z](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:G,label:a,type:e,desc:h,keybinding:T,extras:q},["editor/hook",z]],m]})}function yr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(vr.error(`#${e} is not a valid UUID string.`),!1);var t}let xn=null,br=new Map;const ho={async getInfo(e){return xn||(xn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?xn[e]:xn},registerCommand:Fe,registerSearchService(e){if(br.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);br.set(e.name,new co(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:s}=e;return Fe.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,s="$shortcut$",a=n.key||s+N(r?.toString());return Fe.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;Fe.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!yr(e))return;const n=this.baseInfo.id,r=`hook:editor:${N(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let _r=0;const po={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;uo("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[s,...a]=r;if(s==="editor/hook"){let h=a[0],m=()=>{var q;(q=this.caller)===null||q===void 0||q.callUserModel(h)};typeof h=="function"&&(m=h);const T=`SlashCommandHook${s}${++_r}`;r[1]=T,this.Editor["on"+T](m)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Fe.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Fe.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},fo={onBlockChanged(e,t){if(!yr(e))return;const n=this.baseInfo.id,r=`hook:db:${N(`block:${e}`)}`,s=({block:a,txData:h,txMeta:m})=>{a.uuid===e&&t(a,h,m)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},go={},mo={},vo={makeSandboxStorage(){return new lt(this,{assets:!0})}};class Zn extends d(){constructor(t,n){super(),qt(this,"_baseInfo",void 0),qt(this,"_caller",void 0),qt(this,"_version","0.0.17"),qt(this,"_debugTag",""),qt(this,"_settingsSchema",void 0),qt(this,"_connected",!1),qt(this,"_ui",new Map),qt(this,"_mFileStorage",void 0),qt(this,"_mRequest",void 0),qt(this,"_mExperiments",void 0),qt(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{const{actor:s,...a}=r,h=this._beforeunloadCallback;try{h&&await h(a),s?.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),s?.reject(m)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let h=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=h,h=w()(r,s,{arrayMerge:(m,T)=>T}),this._baseInfo=h,(a=h)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${h.id} [${h.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(h.settings=function(m,T){const q=(T||[]).reduce((G,z)=>("default"in z&&(G[z.key]=z.default),G),{});return Object.assign(q,m)}(h.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,h)}catch(h){console.error(`${this._debugTag} [Ready Error]`,h)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return vr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),M(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,s=this.caller;return new Proxy(t,{get(a,h,m){const T=a[h];return function(...q){if(T){const z=T.apply(r,q.concat(n));if(z!==lo)return z}if(n){const z=h.toString().match(/^(once|off|on)/i);if(z!=null){const J=z[0].toLowerCase(),tt=z.input,K=J==="off",it=r.baseInfo.id;let ct=tt.slice(J.length),yt=q[0],Mt=q[1];typeof yt=="string"&&typeof Mt=="function"&&(yt=yt.replace(/^logseq./,":"),ct=`${ct}${yt}`,yt=Mt,Mt=q[2]),ct=`hook:${n}:${N(ct)}`,s[J](ct,yt);const ke=()=>{s.off(ct,yt),s.listenerCount(ct)||r.App._uninstallPluginHook(it,ct)};return K?void ke():(r.App._installPluginHook(it,ct,Mt),ke)}}let G=h;return["git","ui","assets"].includes(n)&&(G=n+"_"+G),s.callAsync("api:call",{tag:n,method:G,args:q})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(ho,"app")}get Editor(){return this._makeUserProxy(po,"editor")}get DB(){return this._makeUserProxy(fo,"db")}get Git(){return this._makeUserProxy(go,"git")}get UI(){return this._makeUserProxy(mo,"ui")}get Assets(){return this._makeUserProxy(vo,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new lt(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Tt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new St(this)),t}}function wr(e,t){return new Zn(e,t)}if(window.__LSP__HOST__==null){const e=new te(null);window.logseq=wr({},e)}})(),$})())})(kn,kn.exports);kn.exports;const yo={id:"logseq-livephotos-plugin",icon:"./logo.svg"},Cr=parent.document,bo=":live-photo",de={regexPattern:"^(.*?)-([A-Za-z0-9]{5,6})\\.(jpg|jpeg|png|gif|mov|mp4)$",enableAutoConvert:!1},Re=(V,u)=>{const C=Cr.createElement(V);return u&&Object.assign(C.style,u),C},_o=(V,u)=>{Object.assign(V.style,u)},wo=(V,u)=>{let C=!1,j;const p=async()=>{C=!0;try{j=u.play(),await j,C?u.style.opacity="1":(u.pause(),u.currentTime=0,u.style.opacity="0")}catch(x){console.warn("Video play interrupted or failed",x),C||(u.style.opacity="0")}},$=()=>{C=!1,u.style.opacity="0",setTimeout(()=>{C||(u.pause(),u.currentTime=0)},250)};V.addEventListener("mouseenter",p),V.addEventListener("mouseleave",$),V.addEventListener("touchstart",p,{passive:!0}),V.addEventListener("touchend",$),V.addEventListener("touchcancel",$)},Ue={container:{position:"relative",width:"100%",cursor:"pointer",overflow:"hidden",borderRadius:"8px"},image:{width:"100%",height:"auto",display:"block",objectFit:"cover"},video:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.2s ease-in-out",pointerEvents:"none"},badge:{position:"absolute",top:"8px",left:"8px",display:"flex",alignItems:"center",gap:"4px",padding:"4px 6px",borderRadius:"4px",backgroundColor:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(4px)",zIndex:"10",pointerEvents:"none"},badgeText:{fontSize:"10px",fontWeight:"bold",color:"black",lineHeight:"1",letterSpacing:"0.5px"},muteButton:{position:"absolute",bottom:"8px",right:"8px",display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",padding:"6px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(4px)",cursor:"pointer",zIndex:"10",transition:"transform 0.1s ease"}},xo=()=>`
    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" stroke="black" stroke-width="2"/>
      <circle cx="12" cy="12" r="5" fill="black"/>
      <circle cx="12" cy="12" r="2" fill="white" style="opacity: 0.5"/>
    </svg>
  `,Co=()=>{const V=Re("div",Ue.badge);V.innerHTML=xo();const u=Re("span",Ue.badgeText);return u.textContent="LIVE",V.appendChild(u),V},kr=V=>V?`
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
        <line x1="23" y1="9" x2="17" y2="15"/>
        <line x1="17" y1="9" x2="23" y2="15"/>
      </svg>
    `:`
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
      <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
    </svg>
  `,ko=()=>{const V=Re("div",Ue.muteButton);return V.innerHTML=kr(!0),V},So=(V,u)=>{const C=Re("div",Ue.container),j=Re("img",Ue.image);j.src=V;const p=Re("video",Ue.video);p.src=u,p.muted=!0,p.playsInline=!0,p.loop=!0;const $=Co(),x=ko();return x.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),p.muted=!p.muted,x.innerHTML=kr(p.muted)}),C.appendChild(j),C.appendChild(p),C.appendChild($),C.appendChild(x),wo(C,p),C};class Oo{settings;constructor(){this.settings={...de}}async load(){try{if(console.log("[LivePhotos] Loading settings..."),console.log("[LivePhotos] Logseq settings:",logseq.settings),logseq.settings){const u=logseq.settings;this.settings={...de,regexPattern:u.regexPattern||de.regexPattern,enableAutoConvert:u.enableAutoConvert!==void 0?u.enableAutoConvert:de.enableAutoConvert},console.log("[LivePhotos] Loaded settings:",this.settings)}else console.log("[LivePhotos] No logseq settings found, using defaults")}catch(u){console.warn("[LivePhotos] Failed to load settings, using defaults:",u)}return this.settings}async save(u){this.settings={...this.settings,...u};try{logseq.updateSettings(u)}catch(C){throw console.error("Failed to save settings:",C),C}}getSettings(){return{...this.settings}}updateSettings(u){this.settings={...this.settings,...u}}async showSettingsUI(){logseq.showSettingsUI()}async resetToDefaults(){this.settings={...de},await this.save(de),logseq.UI.showMsg("Settings reset to defaults","success")}async promptRegexUpdate(){const u=await logseq.UI.showMsg("Enter regex pattern for file matching:","info");if(u)try{new RegExp(u),await this.save({regexPattern:u}),logseq.UI.showMsg("Regex pattern saved successfully!","success")}catch{logseq.UI.showMsg("Invalid regex pattern!","error")}}}class xr{settings;constructor(u){this.settings=u}async getCurrentPageBlocks(){const u=await logseq.Editor.getCurrentPage();if(console.log("[LivePhotos] Current page:",u),!u||!u.name)return console.log("[LivePhotos] No current page or page name"),[];const C=await logseq.Editor.getPageBlocksTree(u.name);console.log("[LivePhotos] Raw blocks tree:",C);const j=this.flattenBlockTree(C||[]);return console.log("[LivePhotos] Flattened blocks:",j),j}flattenBlockTree(u,C=0,j){const p=[];for(const $ of u){const x={uuid:$.uuid,content:$.content||"",level:C,parent:j,children:void 0};if(p.push(x),$.children&&$.children.length>0){const c=this.flattenBlockTree($.children,C+1,x);p.push(...c),x.children=c}}return p}extractMediaUrl(u){const j=/!\[.*?\]\((.*?)\)/g.exec(u);if(console.log("[LivePhotos] Extracting media from content:",u),console.log("[LivePhotos] Regex match:",j),!j)return{url:"",type:null};const p=j[1];return console.log("[LivePhotos] Extracted URL:",p),p.match(/\.(jpg|jpeg|png|gif|webp)$/i)?(console.log("[LivePhotos] Detected image type"),{url:p,type:"image"}):p.match(/\.(mov|mp4|avi|webm)$/i)?(console.log("[LivePhotos] Detected video type"),{url:p,type:"video"}):(console.log("[LivePhotos] No media type matched"),{url:"",type:null})}findMediaPairs(u){console.log("[LivePhotos] Finding media pairs from blocks:",u.length);const C=[],j=this.groupBlocksByLevel(u);console.log("[LivePhotos] Grouped blocks by level:",j);for(const[p,$]of Object.entries(j)){console.log("[LivePhotos] Processing level:",p,"with",$.length,"blocks");const x=this.findConsecutiveMediaBlocks($);console.log("[LivePhotos] Found consecutive media groups:",x.length);for(const c of x){console.log("[LivePhotos] Processing group:",c);const w=this.findValidPairs(c);console.log("[LivePhotos] Found pairs in group:",w.length),C.push(...w)}}return console.log("[LivePhotos] Total pairs found:",C.length),C}groupBlocksByLevel(u){const C={};for(const j of u){const p=`${j.level}-${j.parent?.uuid||"root"}`;C[p]||(C[p]=[]),C[p].push(j)}return C}findConsecutiveMediaBlocks(u){const C=[];let j=[];for(const p of u)this.extractMediaUrl(p.content).type?j.push(p):(j.length>=2&&C.push([...j]),j=[]);return j.length>=2&&C.push(j),C}findValidPairs(u){console.log("[LivePhotos] Finding all valid pairs from",u.length,"blocks");const C=[];for(let j=0;j<u.length-1;j++){const p=u[j],$=u[j+1],x=this.extractMediaUrl(p.content),c=this.extractMediaUrl($.content);if(console.log(`[LivePhotos] Checking pair ${j}:`,x.type,c.type),x.type&&c.type&&x.type!==c.type){const w=x.type==="image"?p:$,L=x.type==="video"?p:$,O=x.type==="image"?x.url:c.url,F=x.type==="video"?x.url:c.url;if(console.log("[LivePhotos] Potential pair found, checking match..."),this.isSimpleMatch(O,F)){console.log("[LivePhotos] Simple match found!");const Z=1;C.push({imageBlock:w,videoBlock:L,imageUrl:O,videoUrl:F,matchScore:Z})}else{const Z=this.calculateMatchScore(O,F);this.isValidMatch(O,F,Z)&&C.push({imageBlock:w,videoBlock:L,imageUrl:O,videoUrl:F,matchScore:Z})}}}return console.log("[LivePhotos] Found",C.length,"valid pairs"),C}isSimpleMatch(u,C){const j=this.extractFileName(u),p=this.extractFileName(C);console.log("[LivePhotos] Testing simple match:",j,p);const $=j.replace(/\.[^.]*$/,""),x=p.replace(/\.[^.]*$/,"");if(console.log("[LivePhotos] Base names:",$,x),$.length>=6&&x.length>=6){const c=$.slice(0,-6),w=x.slice(0,-6);if(console.log("[LivePhotos] Prefixes:",c,w),c===w){const L=$.slice(-6),O=x.slice(-6);if(console.log("[LivePhotos] Suffixes:",L,O),L!==O)return console.log("[LivePhotos] Simple pattern match confirmed!"),!0}}return!1}calculateMatchScore(u,C){try{console.log("[LivePhotos] Calculating match score for:",u,C),console.log("[LivePhotos] Using regex pattern:",this.settings.regexPattern);const j=this.extractFileName(u),p=this.extractFileName(C);console.log("[LivePhotos] Extracted filenames:",j,p);const $=new RegExp(this.settings.regexPattern),x=j.match($),c=p.match($);if(console.log("[LivePhotos] Image regex match:",x),console.log("[LivePhotos] Video regex match:",c),!x||!c){console.log("[LivePhotos] No regex match, trying simple pattern matching");const v=/^(.*?)-([A-Za-z0-9]{5,6})\.(jpg|jpeg|png|gif|mov|mp4)$/,f=j.match(v),k=p.match(v);if(console.log("[LivePhotos] Image simple match:",f),console.log("[LivePhotos] Video simple match:",k),!f||!k)return console.log("[LivePhotos] No pattern match at all, score 0"),0;const d=f[1],S=k[1],_=f[2],N=k[2];console.log("[LivePhotos] Simple match - Image base:",d,"random:",_),console.log("[LivePhotos] Simple match - Video base:",S,"random:",N);let B=0;if(d===S)B=1,console.log("[LivePhotos] Perfect base name match, score 1.0");else{const M=this.calculateStringSimilarity(d,S);B=M*.8,console.log("[LivePhotos] Base name similarity:",M,"*",.8,"=",B)}return console.log("[LivePhotos] Final score (simple):",B),B}const w=x[1],L=x[2],O=c[1],F=c[2];console.log("[LivePhotos] Image base:",w,"random:",L),console.log("[LivePhotos] Video base:",O,"random:",F);let Z=0;if(w===O)Z+=.8,console.log("[LivePhotos] Base names match exactly, +0.8");else{const v=this.calculateStringSimilarity(w,O);Z+=v*.6,console.log("[LivePhotos] Base name similarity:",v,"*",.6,"=",v*.6)}return L!==F&&(Z+=.2,console.log("[LivePhotos] Random strings different, +0.2")),console.log("[LivePhotos] Final score:",Z),Z}catch(j){return console.warn("[LivePhotos] Invalid regex pattern:",j),0}}extractFileName(u){return u.split("/").pop()||u}calculateStringSimilarity(u,C){const j=u.length>C.length?u:C,p=u.length>C.length?C:u;if(j.length===0)return 1;const $=this.levenshteinDistance(j,p);return(j.length-$)/j.length}levenshteinDistance(u,C){const j=[];for(let p=0;p<=C.length;p++)j[p]=[p];for(let p=0;p<=u.length;p++)j[0][p]=p;for(let p=1;p<=C.length;p++)for(let $=1;$<=u.length;$++)C.charAt(p-1)===u.charAt($-1)?j[p][$]=j[p-1][$-1]:j[p][$]=Math.min(j[p-1][$-1]+1,j[p][$-1]+1,j[p-1][$]+1);return j[C.length][u.length]}isValidMatch(u,C,j){return j>=.6}generateRendererTemplate(u){return`{{renderer :live-photo, ${u.imageUrl}, ${u.videoUrl}}}`}}class Ao{blockAnalyzer;settingsManager;constructor(u){this.settingsManager=u,this.blockAnalyzer=new xr(u.getSettings())}async convertCurrentPage(){try{const u=await this.blockAnalyzer.getCurrentPageBlocks(),C=this.blockAnalyzer.findMediaPairs(u);let j=0,p=0;for(const $ of C)try{await this.convertPair($),j++}catch(x){console.error("Failed to convert pair:",x),p++}return{success:j,failed:p,total:C.length}}catch(u){return console.error("Failed to convert current page:",u),{success:0,failed:0,total:0}}}async convertPair(u){const C=this.blockAnalyzer.generateRendererTemplate(u);await logseq.Editor.updateBlock(u.imageBlock.uuid,C),await logseq.Editor.removeBlock(u.videoBlock.uuid)}async previewConversions(){try{console.log("[LivePhotos] Starting preview conversions...");const u=await this.blockAnalyzer.getCurrentPageBlocks();console.log("[LivePhotos] Got blocks for preview:",u.length);const C=this.blockAnalyzer.findMediaPairs(u);return console.log("[LivePhotos] Preview found pairs:",C.length),C}catch(u){return console.error("[LivePhotos] Failed to preview conversions:",u),[]}}async showPreviewDialog(){console.log("[LivePhotos] Starting preview dialog...");const u=await this.previewConversions();if(console.log("[LivePhotos] Preview dialog found pairs:",u.length),u.length===0){logseq.UI.showMsg("No convertible media pairs found on current page.","info");return}const C=u.map((p,$)=>`Pair ${$+1} (${(p.matchScore*100).toFixed(1)}%):
  Image: ${this.getFileName(p.imageUrl)}
  Video: ${this.getFileName(p.videoUrl)}
`).join(`
`);if(console.log("[LivePhotos] Preview text:",C),await this.confirmConversion(u.length,C)){const p=await this.convertCurrentPage();logseq.UI.showMsg(`Conversion complete: ${p.success} successful, ${p.failed} failed`,p.failed>0?"warning":"success")}}async confirmConversion(u,C){return logseq.UI.showMsg(`Found ${u} Media Pair${u>1?"s":""} to Convert:

${C}
Converting...`,"info"),!0}generatePreviewContent(u){return u.map((C,j)=>`
      <div style="
        border: 1px solid #ddd; 
        border-radius: 4px; 
        padding: 12px; 
        margin-bottom: 12px; 
        background: #f9f9f9;
      ">
        <h4 style="margin: 0 0 8px 0; color: #333;">Pair ${j+1} (Score: ${(C.matchScore*100).toFixed(1)}%)</h4>
        <div style="font-size: 12px; color: #666;">
          <div><strong>Image:</strong> ${this.getFileName(C.imageUrl)}</div>
          <div><strong>Video:</strong> ${this.getFileName(C.videoUrl)}</div>
        </div>
        <div style="margin-top: 8px; padding: 8px; background: white; border-radius: 3px; font-family: monospace; font-size: 11px;">
          {{renderer :live-photo, ${C.imageUrl}, ${C.videoUrl}}}
        </div>
      </div>
    `).join("")}getFileName(u){return u.split("/").pop()||u}async convertSelectedBlocks(u){const p=(await Promise.all(u.map(w=>logseq.Editor.getBlock(w)))).filter(w=>w!==null).map(w=>({uuid:w.uuid,content:w.content||"",level:0,parent:void 0})),$=this.blockAnalyzer.findMediaPairs(p);let x=0,c=0;for(const w of $)try{await this.convertPair(w),x++}catch(L){console.error("Failed to convert selected pair:",L),c++}return{success:x,failed:c}}updateSettings(){this.blockAnalyzer=new xr(this.settingsManager.getSettings())}}const Eo=yo.id,Po={slot:{width:"100%",height:"auto",display:"block"}},Lo=(V,u,C)=>V===bo&&!!u&&!!C;let Qn,Ne;const jo=({slot:V,payload:u})=>{const[C,j,p]=u.arguments;if(!Lo(C,j,p))return;const $=Cr.getElementById(V);if(!$)return;$.innerHTML="",_o($,Po.slot);const x=So(j,p);$.appendChild(x)};async function To(){console.info(`#${Eo}: MAIN`),logseq.useSettingsSchema([{key:"regexPattern",type:"string",default:de.regexPattern,title:"Regex Pattern",description:"Regex pattern for matching image/video files. Use group 1 for base name, group 2 for random string."},{key:"enableAutoConvert",type:"boolean",default:de.enableAutoConvert,title:"Auto Convert",description:"Enable automatic conversion when pasting media files"}]),Qn=new Oo,await Qn.load(),Ne=new Ao(Qn),logseq.App.onMacroRendererSlotted(jo),logseq.provideModel({async handleConvertPage(){await Ne.showPreviewDialog()},async handleQuickConvert(){const V=await Ne.convertCurrentPage();V.total>0?logseq.UI.showMsg(`Quick conversion: ${V.success} successful, ${V.failed} failed`,V.failed>0?"warning":"success"):logseq.UI.showMsg("No convertible media pairs found.","info")},async handleSettings(){logseq.showSettingsUI()}}),logseq.Editor.registerSlashCommand("[Live Photos] insert macro",async()=>{const V=await logseq.Editor.getCurrentBlock();if(V){const u="{{renderer :live-photo, photo_url, video_url}}";await logseq.Editor.updateBlock(V.uuid,u)}}),logseq.Editor.registerSlashCommand("[Live Photos] convert page",async()=>{await Ne.showPreviewDialog()}),logseq.Editor.registerSlashCommand("[Live Photos] settings",async()=>{logseq.showSettingsUI()}),logseq.App.registerCommandPalette({key:"live-photos-settings",label:"Live Photos: Settings"},async()=>{logseq.showSettingsUI()}),logseq.App.registerCommandPalette({key:"live-photos-convert-page",label:"Live Photos: Convert Current Page"},async()=>{await Ne.showPreviewDialog()}),logseq.App.registerCommandPalette({key:"live-photos-quick-convert",label:"Live Photos: Quick Convert Current Page"},async()=>{const V=await Ne.convertCurrentPage();V.total>0?logseq.UI.showMsg(`Quick conversion: ${V.success} successful, ${V.failed} failed`,V.failed>0?"warning":"success"):logseq.UI.showMsg("No convertible media pairs found.","info")}),logseq.App.registerUIItem("toolbar",{key:"live-photos-convert",template:`
      <span class="live-photos-convert">
        <a title="Convert Live Photos" class="button" data-on-click="handleConvertPage">
          <i class="ti ti-photo"></i>
        </a>
      </span>
    `}),logseq.App.registerUIItem("toolbar",{key:"live-photos-quick-convert",template:`
      <span class="live-photos-quick-convert">
        <a title="Quick Convert" class="button" data-on-click="handleQuickConvert">
          <i class="ti ti-bolt"></i>
        </a>
      </span>
    `}),logseq.App.registerUIItem("toolbar",{key:"live-photos-settings",template:`
      <span class="live-photos-settings">
        <a title="Live Photos Settings" class="button" data-on-click="handleSettings">
          <i class="ti ti-settings"></i>
        </a>
      </span>
    `})}logseq.ready(To).catch(console.error);
