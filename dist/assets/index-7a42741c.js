(function(){const Tt=document.createElement("link").relList;if(Tt&&Tt.supports&&Tt.supports("modulepreload"))return;for(const G of document.querySelectorAll('link[rel="modulepreload"]'))Ht(G);new MutationObserver(G=>{for(const ct of G)if(ct.type==="childList")for(const N of ct.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&Ht(N)}).observe(document,{childList:!0,subtree:!0});function Ce(G){const ct={};return G.integrity&&(ct.integrity=G.integrity),G.referrerPolicy&&(ct.referrerPolicy=G.referrerPolicy),G.crossOrigin==="use-credentials"?ct.credentials="include":G.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function Ht(G){if(G.ep)return;G.ep=!0;const ct=Ce(G);fetch(G.href,ct)}})();var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */_n.exports;(function(zt,Tt){(function(Ce,Ht){zt.exports=Ht()})(self,()=>(()=>{var Ce={227:(N,p,v)=>{var j=v(155);p.formatArgs=function(M){if(M[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+M[0]+(this.useColors?"%c ":" ")+"+"+N.exports.humanize(this.diff),!this.useColors)return;const V="color: "+this.color;M.splice(1,0,V,"color: inherit");let b=0,d=0;M[0].replace(/%[a-zA-Z%]/g,w=>{w!=="%%"&&(b++,w==="%c"&&(d=b))}),M.splice(d,0,V)},p.save=function(M){try{M?p.storage.setItem("debug",M):p.storage.removeItem("debug")}catch{}},p.load=function(){let M;try{M=p.storage.getItem("debug")}catch{}return!M&&j!==void 0&&"env"in j&&(M=j.env.DEBUG),M},p.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},p.storage=function(){try{return localStorage}catch{}}(),p.destroy=(()=>{let M=!1;return()=>{M||(M=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),p.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],p.log=console.debug||console.log||(()=>{}),N.exports=v(447)(p);const{formatters:O}=N.exports;O.j=function(M){try{return JSON.stringify(M)}catch(V){return"[UnexpectedJSONParseError]: "+V.message}}},447:(N,p,v)=>{N.exports=function(j){function O(b){let d,w,u,x=null;function y(...T){if(!y.enabled)return;const D=y,k=Number(new Date),I=k-(d||k);D.diff=I,D.prev=d,D.curr=k,d=k,T[0]=O.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let i=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(c,m)=>{if(c==="%%")return"%";i++;const g=O.formatters[m];if(typeof g=="function"){const q=T[i];c=g.call(D,q),T.splice(i,1),i--}return c}),O.formatArgs.call(D,T),(D.log||O.log).apply(D,T)}return y.namespace=b,y.useColors=O.useColors(),y.color=O.selectColor(b),y.extend=M,y.destroy=O.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>x!==null?x:(w!==O.namespaces&&(w=O.namespaces,u=O.enabled(b)),u),set:T=>{x=T}}),typeof O.init=="function"&&O.init(y),y}function M(b,d){const w=O(this.namespace+(d===void 0?":":d)+b);return w.log=this.log,w}function V(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}return O.debug=O,O.default=O,O.coerce=function(b){return b instanceof Error?b.stack||b.message:b},O.disable=function(){const b=[...O.names.map(V),...O.skips.map(V).map(d=>"-"+d)].join(",");return O.enable(""),b},O.enable=function(b){let d;O.save(b),O.namespaces=b,O.names=[],O.skips=[];const w=(typeof b=="string"?b:"").split(/[\s,]+/),u=w.length;for(d=0;d<u;d++)w[d]&&((b=w[d].replace(/\*/g,".*?"))[0]==="-"?O.skips.push(new RegExp("^"+b.slice(1)+"$")):O.names.push(new RegExp("^"+b+"$")))},O.enabled=function(b){if(b[b.length-1]==="*")return!0;let d,w;for(d=0,w=O.skips.length;d<w;d++)if(O.skips[d].test(b))return!1;for(d=0,w=O.names.length;d<w;d++)if(O.names[d].test(b))return!0;return!1},O.humanize=v(824),O.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(j).forEach(b=>{O[b]=j[b]}),O.names=[],O.skips=[],O.formatters={},O.selectColor=function(b){let d=0;for(let w=0;w<b.length;w++)d=(d<<5)-d+b.charCodeAt(w),d|=0;return O.colors[Math.abs(d)%O.colors.length]},O.enable(O.load()),O}},996:N=>{var p=function(u){return function(x){return!!x&&typeof x=="object"}(u)&&!function(x){var y=Object.prototype.toString.call(x);return y==="[object RegExp]"||y==="[object Date]"||function(T){return T.$$typeof===v}(x)}(u)},v=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function j(u,x){return x.clone!==!1&&x.isMergeableObject(u)?d((y=u,Array.isArray(y)?[]:{}),u,x):u;var y}function O(u,x,y){return u.concat(x).map(function(T){return j(T,y)})}function M(u){return Object.keys(u).concat(function(x){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(x).filter(function(y){return Object.propertyIsEnumerable.call(x,y)}):[]}(u))}function V(u,x){try{return x in u}catch{return!1}}function b(u,x,y){var T={};return y.isMergeableObject(u)&&M(u).forEach(function(D){T[D]=j(u[D],y)}),M(x).forEach(function(D){(function(k,I){return V(k,I)&&!(Object.hasOwnProperty.call(k,I)&&Object.propertyIsEnumerable.call(k,I))})(u,D)||(V(u,D)&&y.isMergeableObject(x[D])?T[D]=function(k,I){if(!I.customMerge)return d;var i=I.customMerge(k);return typeof i=="function"?i:d}(D,y)(u[D],x[D],y):T[D]=j(x[D],y))}),T}function d(u,x,y){(y=y||{}).arrayMerge=y.arrayMerge||O,y.isMergeableObject=y.isMergeableObject||p,y.cloneUnlessOtherwiseSpecified=j;var T=Array.isArray(x);return T===Array.isArray(u)?T?y.arrayMerge(u,x,y):b(u,x,y):j(x,y)}d.all=function(u,x){if(!Array.isArray(u))throw new Error("first argument should be an array");return u.reduce(function(y,T){return d(y,T,x)},{})};var w=d;N.exports=w},856:function(N){N.exports=function(){function p(S){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},p(S)}function v(S,L){return v=Object.setPrototypeOf||function(z,J){return z.__proto__=J,z},v(S,L)}function j(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(S,L,z){return O=j()?Reflect.construct:function(J,ut,Ft){var Bt=[null];Bt.push.apply(Bt,ut);var te=new(Function.bind.apply(J,Bt));return Ft&&v(te,Ft.prototype),te},O.apply(null,arguments)}function M(S){return V(S)||b(S)||d(S)||u()}function V(S){if(Array.isArray(S))return w(S)}function b(S){if(typeof Symbol<"u"&&S[Symbol.iterator]!=null||S["@@iterator"]!=null)return Array.from(S)}function d(S,L){if(S){if(typeof S=="string")return w(S,L);var z=Object.prototype.toString.call(S).slice(8,-1);return z==="Object"&&S.constructor&&(z=S.constructor.name),z==="Map"||z==="Set"?Array.from(S):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?w(S,L):void 0}}function w(S,L){(L==null||L>S.length)&&(L=S.length);for(var z=0,J=new Array(L);z<L;z++)J[z]=S[z];return J}function u(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=Object.hasOwnProperty,y=Object.setPrototypeOf,T=Object.isFrozen,D=Object.getPrototypeOf,k=Object.getOwnPropertyDescriptor,I=Object.freeze,i=Object.seal,c=Object.create,m=typeof Reflect<"u"&&Reflect,g=m.apply,q=m.construct;g||(g=function(S,L,z){return S.apply(L,z)}),I||(I=function(S){return S}),i||(i=function(S){return S}),q||(q=function(S,L){return O(S,M(L))});var Y=K(Array.prototype.forEach),nt=K(Array.prototype.pop),lt=K(Array.prototype.push),yt=K(String.prototype.toLowerCase),bt=K(String.prototype.match),mt=K(String.prototype.replace),Se=K(String.prototype.indexOf),f=K(String.prototype.trim),_=K(RegExp.prototype.test),U=_t(TypeError);function K(S){return function(L){for(var z=arguments.length,J=new Array(z>1?z-1:0),ut=1;ut<z;ut++)J[ut-1]=arguments[ut];return g(S,L,J)}}function _t(S){return function(){for(var L=arguments.length,z=new Array(L),J=0;J<L;J++)z[J]=arguments[J];return q(S,z)}}function F(S,L){y&&y(S,null);for(var z=L.length;z--;){var J=L[z];if(typeof J=="string"){var ut=yt(J);ut!==J&&(T(L)||(L[z]=ut),J=ut)}S[J]=!0}return S}function W(S){var L,z=c(null);for(L in S)g(x,S,[L])&&(z[L]=S[L]);return z}function et(S,L){for(;S!==null;){var z=k(S,L);if(z){if(z.get)return K(z.get);if(typeof z.value=="function")return K(z.value)}S=D(S)}function J(ut){return console.warn("fallback value for",ut),null}return J}var Ct=I(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),vt=I(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Et=I(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Xt=I(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),st=I(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ot=I(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),wt=I(["#text"]),St=I(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Lt=I(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vt=I(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),jt=I(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ot=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),fe=i(/<%[\w\W]*|[\w\W]*%>/gm),wn=i(/^data-[\-\w.\u00B7-\uFFFF]/),Mt=i(/^aria-[\-\w]+$/),qt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ve=i(/^(?:\w+script|data):/i),xn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Cn=i(/^html$/i),pe=function(){return typeof window>"u"?null:window},Sn=function(S,L){if(p(S)!=="object"||typeof S.createPolicy!="function")return null;var z=null,J="data-tt-policy-suffix";L.currentScript&&L.currentScript.hasAttribute(J)&&(z=L.currentScript.getAttribute(J));var ut="dompurify"+(z?"#"+z:"");try{return S.createPolicy(ut,{createHTML:function(Ft){return Ft}})}catch{return console.warn("TrustedTypes policy "+ut+" could not be created."),null}};function Ze(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe(),L=function(o){return Ze(o)};if(L.version="2.3.8",L.removed=[],!S||!S.document||S.document.nodeType!==9)return L.isSupported=!1,L;var z=S.document,J=S.document,ut=S.DocumentFragment,Ft=S.HTMLTemplateElement,Bt=S.Node,te=S.Element,Ne=S.NodeFilter,Ke=S.NamedNodeMap,Zt=Ke===void 0?S.NamedNodeMap||S.MozNamedAttrMap:Ke,On=S.HTMLFormElement,An=S.DOMParser,En=S.trustedTypes,Oe=te.prototype,jn=et(Oe,"cloneNode"),kn=et(Oe,"nextSibling"),Tn=et(Oe,"childNodes"),Pe=et(Oe,"parentNode");if(typeof Ft=="function"){var Nt=J.createElement("template");Nt.content&&Nt.content.ownerDocument&&(J=Nt.content.ownerDocument)}var Pt=Sn(En,z),Ye=Pt?Pt.createHTML(""):"",Ae=J,Re=Ae.implementation,ee=Ae.createNodeIterator,Qe=Ae.createDocumentFragment,Xe=Ae.getElementsByTagName,In=z.importNode,tn={};try{tn=W(J).documentMode?J.documentMode:{}}catch{}var kt={};L.isSupported=typeof Pe=="function"&&Re&&Re.createHTMLDocument!==void 0&&tn!==9;var de,Wt,Ee=Ot,je=fe,De=wn,Ln=Mt,en=Ve,ke=xn,Q=qt,ft=null,nn=F({},[].concat(M(Ct),M(vt),M(Et),M(st),M(wt))),pt=null,ne=F({},[].concat(M(St),M(Lt),M(Vt),M(jt))),it=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),re=null,Te=null,Ue=!0,$e=!0,rn=!1,oe=!1,Kt=!1,ze=!1,He=!1,ie=!1,Ie=!1,se=!1,on=!0,qe=!0,ae=!1,Rt={},ce=null,sn=F({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),an=null,cn=F({},["audio","video","img","source","image","track"]),Be=null,Yt=F({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),le="http://www.w3.org/1998/Math/MathML",We="http://www.w3.org/2000/svg",Gt="http://www.w3.org/1999/xhtml",Le=Gt,ln=!1,he=["application/xhtml+xml","text/html"],me="text/html",ue=null,Mn=J.createElement("form"),un=function(o){return o instanceof RegExp||o instanceof Function},Ge=function(o){ue&&ue===o||(o&&p(o)==="object"||(o={}),o=W(o),ft="ALLOWED_TAGS"in o?F({},o.ALLOWED_TAGS):nn,pt="ALLOWED_ATTR"in o?F({},o.ALLOWED_ATTR):ne,Be="ADD_URI_SAFE_ATTR"in o?F(W(Yt),o.ADD_URI_SAFE_ATTR):Yt,an="ADD_DATA_URI_TAGS"in o?F(W(cn),o.ADD_DATA_URI_TAGS):cn,ce="FORBID_CONTENTS"in o?F({},o.FORBID_CONTENTS):sn,re="FORBID_TAGS"in o?F({},o.FORBID_TAGS):{},Te="FORBID_ATTR"in o?F({},o.FORBID_ATTR):{},Rt="USE_PROFILES"in o&&o.USE_PROFILES,Ue=o.ALLOW_ARIA_ATTR!==!1,$e=o.ALLOW_DATA_ATTR!==!1,rn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,oe=o.SAFE_FOR_TEMPLATES||!1,Kt=o.WHOLE_DOCUMENT||!1,ie=o.RETURN_DOM||!1,Ie=o.RETURN_DOM_FRAGMENT||!1,se=o.RETURN_TRUSTED_TYPE||!1,He=o.FORCE_BODY||!1,on=o.SANITIZE_DOM!==!1,qe=o.KEEP_CONTENT!==!1,ae=o.IN_PLACE||!1,Q=o.ALLOWED_URI_REGEXP||Q,Le=o.NAMESPACE||Gt,o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(it.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(it.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(it.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),de=de=he.indexOf(o.PARSER_MEDIA_TYPE)===-1?me:o.PARSER_MEDIA_TYPE,Wt=de==="application/xhtml+xml"?function(E){return E}:yt,oe&&($e=!1),Ie&&(ie=!0),Rt&&(ft=F({},M(wt)),pt=[],Rt.html===!0&&(F(ft,Ct),F(pt,St)),Rt.svg===!0&&(F(ft,vt),F(pt,Lt),F(pt,jt)),Rt.svgFilters===!0&&(F(ft,Et),F(pt,Lt),F(pt,jt)),Rt.mathMl===!0&&(F(ft,st),F(pt,Vt),F(pt,jt))),o.ADD_TAGS&&(ft===nn&&(ft=W(ft)),F(ft,o.ADD_TAGS)),o.ADD_ATTR&&(pt===ne&&(pt=W(pt)),F(pt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&F(Be,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ce===sn&&(ce=W(ce)),F(ce,o.FORBID_CONTENTS)),qe&&(ft["#text"]=!0),Kt&&F(ft,["html","head","body"]),ft.table&&(F(ft,["tbody"]),delete re.tbody),I&&I(o),ue=o)},fn=F({},["mi","mo","mn","ms","mtext"]),pn=F({},["foreignobject","desc","title","annotation-xml"]),Fn=F({},["title","style","font","a","script"]),Dt=F({},vt);F(Dt,Et),F(Dt,Xt);var Me=F({},st);F(Me,ot);var Nn=function(o){var E=Pe(o);E&&E.tagName||(E={namespaceURI:Gt,tagName:"template"});var C=yt(o.tagName),X=yt(E.tagName);return o.namespaceURI===We?E.namespaceURI===Gt?C==="svg":E.namespaceURI===le?C==="svg"&&(X==="annotation-xml"||fn[X]):!!Dt[C]:o.namespaceURI===le?E.namespaceURI===Gt?C==="math":E.namespaceURI===We?C==="math"&&pn[X]:!!Me[C]:o.namespaceURI===Gt&&!(E.namespaceURI===We&&!pn[X])&&!(E.namespaceURI===le&&!fn[X])&&!Me[C]&&(Fn[C]||!Dt[C])},Ut=function(o){lt(L.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Ye}catch{o.remove()}}},ge=function(o,E){try{lt(L.removed,{attribute:E.getAttributeNode(o),from:E})}catch{lt(L.removed,{attribute:null,from:E})}if(E.removeAttribute(o),o==="is"&&!pt[o])if(ie||Ie)try{Ut(E)}catch{}else try{E.setAttribute(o,"")}catch{}},dn=function(o){var E,C;if(He)o="<remove></remove>"+o;else{var X=bt(o,/^[\r\n\t ]+/);C=X&&X[0]}de==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var at=Pt?Pt.createHTML(o):o;if(Le===Gt)try{E=new An().parseFromString(at,de)}catch{}if(!E||!E.documentElement){E=Re.createDocument(Le,"template",null);try{E.documentElement.innerHTML=ln?"":at}catch{}}var gt=E.body||E.documentElement;return o&&C&&gt.insertBefore(J.createTextNode(C),gt.childNodes[0]||null),Le===Gt?Xe.call(E,Kt?"html":"body")[0]:Kt?E.documentElement:gt},hn=function(o){return ee.call(o.ownerDocument||o,o,Ne.SHOW_ELEMENT|Ne.SHOW_COMMENT|Ne.SHOW_TEXT,null,!1)},Pn=function(o){return o instanceof On&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Zt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},ye=function(o){return p(Bt)==="object"?o instanceof Bt:o&&p(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},xt=function(o,E,C){kt[o]&&Y(kt[o],function(X){X.call(L,E,C,ue)})},ve=function(o){var E;if(xt("beforeSanitizeElements",o,null),Pn(o)||_(/[\u0080-\uFFFF]/,o.nodeName))return Ut(o),!0;var C=Wt(o.nodeName);if(xt("uponSanitizeElement",o,{tagName:C,allowedTags:ft}),o.hasChildNodes()&&!ye(o.firstElementChild)&&(!ye(o.content)||!ye(o.content.firstElementChild))&&_(/<[/\w]/g,o.innerHTML)&&_(/<[/\w]/g,o.textContent)||C==="select"&&_(/<template/i,o.innerHTML))return Ut(o),!0;if(!ft[C]||re[C]){if(!re[C]&&Qt(C)&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,C)||it.tagNameCheck instanceof Function&&it.tagNameCheck(C)))return!1;if(qe&&!ce[C]){var X=Pe(o)||o.parentNode,at=Tn(o)||o.childNodes;if(at&&X)for(var gt=at.length-1;gt>=0;--gt)X.insertBefore(jn(at[gt],!0),kn(o))}return Ut(o),!0}return o instanceof te&&!Nn(o)?(Ut(o),!0):C!=="noscript"&&C!=="noembed"||!_(/<\/no(script|embed)/i,o.innerHTML)?(oe&&o.nodeType===3&&(E=o.textContent,E=mt(E,Ee," "),E=mt(E,je," "),o.textContent!==E&&(lt(L.removed,{element:o.cloneNode()}),o.textContent=E)),xt("afterSanitizeElements",o,null),!1):(Ut(o),!0)},mn=function(o,E,C){if(on&&(E==="id"||E==="name")&&(C in J||C in Mn))return!1;if(!($e&&!Te[E]&&_(De,E))){if(!(Ue&&_(Ln,E))){if(!pt[E]||Te[E]){if(!(Qt(o)&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,o)||it.tagNameCheck instanceof Function&&it.tagNameCheck(o))&&(it.attributeNameCheck instanceof RegExp&&_(it.attributeNameCheck,E)||it.attributeNameCheck instanceof Function&&it.attributeNameCheck(E))||E==="is"&&it.allowCustomizedBuiltInElements&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,C)||it.tagNameCheck instanceof Function&&it.tagNameCheck(C))))return!1}else if(!Be[E]){if(!_(Q,mt(C,ke,""))){if((E!=="src"&&E!=="xlink:href"&&E!=="href"||o==="script"||Se(C,"data:")!==0||!an[o])&&!(rn&&!_(en,mt(C,ke,"")))){if(C)return!1}}}}}return!0},Qt=function(o){return o.indexOf("-")>0},be=function(o){var E,C,X,at;xt("beforeSanitizeAttributes",o,null);var gt=o.attributes;if(gt){var dt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:pt};for(at=gt.length;at--;){var _e=E=gt[at],Jt=_e.name,At=_e.namespaceURI;if(C=Jt==="value"?E.value:f(E.value),X=Wt(Jt),dt.attrName=X,dt.attrValue=C,dt.keepAttr=!0,dt.forceKeepAttr=void 0,xt("uponSanitizeAttribute",o,dt),C=dt.attrValue,!dt.forceKeepAttr&&(ge(Jt,o),dt.keepAttr))if(_(/\/>/i,C))ge(Jt,o);else{oe&&(C=mt(C,Ee," "),C=mt(C,je," "));var Je=Wt(o.nodeName);if(mn(Je,X,C))try{At?o.setAttributeNS(At,Jt,C):o.setAttribute(Jt,C),nt(L.removed)}catch{}}}xt("afterSanitizeAttributes",o,null)}},Rn=function o(E){var C,X=hn(E);for(xt("beforeSanitizeShadowDOM",E,null);C=X.nextNode();)xt("uponSanitizeShadowNode",C,null),ve(C)||(C.content instanceof ut&&o(C.content),be(C));xt("afterSanitizeShadowDOM",E,null)};return L.sanitize=function(o,E){var C,X,at,gt,dt;if((ln=!o)&&(o="<!-->"),typeof o!="string"&&!ye(o)){if(typeof o.toString!="function")throw U("toString is not a function");if(typeof(o=o.toString())!="string")throw U("dirty is not a string, aborting")}if(!L.isSupported){if(p(S.toStaticHTML)==="object"||typeof S.toStaticHTML=="function"){if(typeof o=="string")return S.toStaticHTML(o);if(ye(o))return S.toStaticHTML(o.outerHTML)}return o}if(ze||Ge(E),L.removed=[],typeof o=="string"&&(ae=!1),ae){if(o.nodeName){var _e=Wt(o.nodeName);if(!ft[_e]||re[_e])throw U("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Bt)(X=(C=dn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&X.nodeName==="BODY"||X.nodeName==="HTML"?C=X:C.appendChild(X);else{if(!ie&&!oe&&!Kt&&o.indexOf("<")===-1)return Pt&&se?Pt.createHTML(o):o;if(!(C=dn(o)))return ie?null:se?Ye:""}C&&He&&Ut(C.firstChild);for(var Jt=hn(ae?o:C);at=Jt.nextNode();)at.nodeType===3&&at===gt||ve(at)||(at.content instanceof ut&&Rn(at.content),be(at),gt=at);if(gt=null,ae)return o;if(ie){if(Ie)for(dt=Qe.call(C.ownerDocument);C.firstChild;)dt.appendChild(C.firstChild);else dt=C;return pt.shadowroot&&(dt=In.call(z,dt,!0)),dt}var At=Kt?C.outerHTML:C.innerHTML;return Kt&&ft["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&_(Cn,C.ownerDocument.doctype.name)&&(At="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+At),oe&&(At=mt(At,Ee," "),At=mt(At,je," ")),Pt&&se?Pt.createHTML(At):At},L.setConfig=function(o){Ge(o),ze=!0},L.clearConfig=function(){ue=null,ze=!1},L.isValidAttribute=function(o,E,C){ue||Ge({});var X=Wt(o),at=Wt(E);return mn(X,at,C)},L.addHook=function(o,E){typeof E=="function"&&(kt[o]=kt[o]||[],lt(kt[o],E))},L.removeHook=function(o){if(kt[o])return nt(kt[o])},L.removeHooks=function(o){kt[o]&&(kt[o]=[])},L.removeAllHooks=function(){kt={}},L}return Ze()}()},729:N=>{var p=Object.prototype.hasOwnProperty,v="~";function j(){}function O(d,w,u){this.fn=d,this.context=w,this.once=u||!1}function M(d,w,u,x,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var T=new O(u,x||d,y),D=v?v+w:w;return d._events[D]?d._events[D].fn?d._events[D]=[d._events[D],T]:d._events[D].push(T):(d._events[D]=T,d._eventsCount++),d}function V(d,w){--d._eventsCount==0?d._events=new j:delete d._events[w]}function b(){this._events=new j,this._eventsCount=0}Object.create&&(j.prototype=Object.create(null),new j().__proto__||(v=!1)),b.prototype.eventNames=function(){var d,w,u=[];if(this._eventsCount===0)return u;for(w in d=this._events)p.call(d,w)&&u.push(v?w.slice(1):w);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},b.prototype.listeners=function(d){var w=v?v+d:d,u=this._events[w];if(!u)return[];if(u.fn)return[u.fn];for(var x=0,y=u.length,T=new Array(y);x<y;x++)T[x]=u[x].fn;return T},b.prototype.listenerCount=function(d){var w=v?v+d:d,u=this._events[w];return u?u.fn?1:u.length:0},b.prototype.emit=function(d,w,u,x,y,T){var D=v?v+d:d;if(!this._events[D])return!1;var k,I,i=this._events[D],c=arguments.length;if(i.fn){switch(i.once&&this.removeListener(d,i.fn,void 0,!0),c){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,w),!0;case 3:return i.fn.call(i.context,w,u),!0;case 4:return i.fn.call(i.context,w,u,x),!0;case 5:return i.fn.call(i.context,w,u,x,y),!0;case 6:return i.fn.call(i.context,w,u,x,y,T),!0}for(I=1,k=new Array(c-1);I<c;I++)k[I-1]=arguments[I];i.fn.apply(i.context,k)}else{var m,g=i.length;for(I=0;I<g;I++)switch(i[I].once&&this.removeListener(d,i[I].fn,void 0,!0),c){case 1:i[I].fn.call(i[I].context);break;case 2:i[I].fn.call(i[I].context,w);break;case 3:i[I].fn.call(i[I].context,w,u);break;case 4:i[I].fn.call(i[I].context,w,u,x);break;default:if(!k)for(m=1,k=new Array(c-1);m<c;m++)k[m-1]=arguments[m];i[I].fn.apply(i[I].context,k)}}return!0},b.prototype.on=function(d,w,u){return M(this,d,w,u,!1)},b.prototype.once=function(d,w,u){return M(this,d,w,u,!0)},b.prototype.removeListener=function(d,w,u,x){var y=v?v+d:d;if(!this._events[y])return this;if(!w)return V(this,y),this;var T=this._events[y];if(T.fn)T.fn!==w||x&&!T.once||u&&T.context!==u||V(this,y);else{for(var D=0,k=[],I=T.length;D<I;D++)(T[D].fn!==w||x&&!T[D].once||u&&T[D].context!==u)&&k.push(T[D]);k.length?this._events[y]=k.length===1?k[0]:k:V(this,y)}return this},b.prototype.removeAllListeners=function(d){var w;return d?(w=v?v+d:d,this._events[w]&&V(this,w)):(this._events=new j,this._eventsCount=0),this},b.prototype.off=b.prototype.removeListener,b.prototype.addListener=b.prototype.on,b.prefixed=v,b.EventEmitter=b,N.exports=b},717:N=>{typeof Object.create=="function"?N.exports=function(p,v){p.super_=v,p.prototype=Object.create(v.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}})}:N.exports=function(p,v){p.super_=v;var j=function(){};j.prototype=v.prototype,p.prototype=new j,p.prototype.constructor=p}},824:N=>{var p=1e3,v=60*p,j=60*v,O=24*j,M=7*O,V=365.25*O;function b(d,w,u,x){var y=w>=1.5*u;return Math.round(d/u)+" "+x+(y?"s":"")}N.exports=function(d,w){w=w||{};var u=typeof d;if(u==="string"&&d.length>0)return function(x){if(!((x=String(x)).length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(x);if(y){var T=parseFloat(y[1]);switch((y[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return T*V;case"weeks":case"week":case"w":return T*M;case"days":case"day":case"d":return T*O;case"hours":case"hour":case"hrs":case"hr":case"h":return T*j;case"minutes":case"minute":case"mins":case"min":case"m":return T*v;case"seconds":case"second":case"secs":case"sec":case"s":return T*p;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return T;default:return}}}}(d);if(u==="number"&&isFinite(d))return w.long?function(x){var y=Math.abs(x);return y>=O?b(x,y,O,"day"):y>=j?b(x,y,j,"hour"):y>=v?b(x,y,v,"minute"):y>=p?b(x,y,p,"second"):x+" ms"}(d):function(x){var y=Math.abs(x);return y>=O?Math.round(x/O)+"d":y>=j?Math.round(x/j)+"h":y>=v?Math.round(x/v)+"m":y>=p?Math.round(x/p)+"s":x+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},520:(N,p,v)=>{var j=v(155),O=j.platform==="win32",M=v(539);function V(i,c){for(var m=[],g=0;g<i.length;g++){var q=i[g];q&&q!=="."&&(q===".."?m.length&&m[m.length-1]!==".."?m.pop():c&&m.push(".."):m.push(q))}return m}function b(i){for(var c=i.length-1,m=0;m<=c&&!i[m];m++);for(var g=c;g>=0&&!i[g];g--);return m===0&&g===c?i:m>g?[]:i.slice(m,g+1)}var d=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,w=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,u={};function x(i){var c=d.exec(i),m=(c[1]||"")+(c[2]||""),g=c[3]||"",q=w.exec(g);return[m,q[1],q[2],q[3]]}function y(i){var c=d.exec(i),m=c[1]||"",g=!!m&&m[1]!==":";return{device:m,isUnc:g,isAbsolute:g||!!c[2],tail:c[3]}}function T(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}u.resolve=function(){for(var i="",c="",m=!1,g=arguments.length-1;g>=-1;g--){var q;if(g>=0?q=arguments[g]:i?(q=j.env["="+i])&&q.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(q=i+"\\"):q=j.cwd(),!M.isString(q))throw new TypeError("Arguments to path.resolve must be strings");if(q){var Y=y(q),nt=Y.device,lt=Y.isUnc,yt=Y.isAbsolute,bt=Y.tail;if((!nt||!i||nt.toLowerCase()===i.toLowerCase())&&(i||(i=nt),m||(c=bt+"\\"+c,m=yt),i&&m))break}}return lt&&(i=T(i)),i+(m?"\\":"")+(c=V(c.split(/[\\\/]+/),!m).join("\\"))||"."},u.normalize=function(i){var c=y(i),m=c.device,g=c.isUnc,q=c.isAbsolute,Y=c.tail,nt=/[\\\/]$/.test(Y);return(Y=V(Y.split(/[\\\/]+/),!q).join("\\"))||q||(Y="."),Y&&nt&&(Y+="\\"),g&&(m=T(m)),m+(q?"\\":"")+Y},u.isAbsolute=function(i){return y(i).isAbsolute},u.join=function(){for(var i=[],c=0;c<arguments.length;c++){var m=arguments[c];if(!M.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&i.push(m)}var g=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(g=g.replace(/^[\\\/]{2,}/,"\\")),u.normalize(g)},u.relative=function(i,c){i=u.resolve(i),c=u.resolve(c);for(var m=i.toLowerCase(),g=c.toLowerCase(),q=b(c.split("\\")),Y=b(m.split("\\")),nt=b(g.split("\\")),lt=Math.min(Y.length,nt.length),yt=lt,bt=0;bt<lt;bt++)if(Y[bt]!==nt[bt]){yt=bt;break}if(yt==0)return c;var mt=[];for(bt=yt;bt<Y.length;bt++)mt.push("..");return(mt=mt.concat(q.slice(yt))).join("\\")},u._makeLong=function(i){if(!M.isString(i))return i;if(!i)return"";var c=u.resolve(i);return/^[a-zA-Z]\:\\/.test(c)?"\\\\?\\"+c:/^\\\\[^?.]/.test(c)?"\\\\?\\UNC\\"+c.substring(2):i},u.dirname=function(i){var c=x(i),m=c[0],g=c[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},u.basename=function(i,c){var m=x(i)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},u.extname=function(i){return x(i)[3]},u.format=function(i){if(!M.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var c=i.root||"";if(!M.isString(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var m=i.dir,g=i.base||"";return m?m[m.length-1]===u.sep?m+g:m+u.sep+g:g},u.parse=function(i){if(!M.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var c=x(i);if(!c||c.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:c[0],dir:c[0]+c[1].slice(0,-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},u.sep="\\",u.delimiter=";";var D=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,k={};function I(i){return D.exec(i).slice(1)}k.resolve=function(){for(var i="",c=!1,m=arguments.length-1;m>=-1&&!c;m--){var g=m>=0?arguments[m]:j.cwd();if(!M.isString(g))throw new TypeError("Arguments to path.resolve must be strings");g&&(i=g+"/"+i,c=g[0]==="/")}return(c?"/":"")+(i=V(i.split("/"),!c).join("/"))||"."},k.normalize=function(i){var c=k.isAbsolute(i),m=i&&i[i.length-1]==="/";return(i=V(i.split("/"),!c).join("/"))||c||(i="."),i&&m&&(i+="/"),(c?"/":"")+i},k.isAbsolute=function(i){return i.charAt(0)==="/"},k.join=function(){for(var i="",c=0;c<arguments.length;c++){var m=arguments[c];if(!M.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&(i+=i?"/"+m:m)}return k.normalize(i)},k.relative=function(i,c){i=k.resolve(i).substr(1),c=k.resolve(c).substr(1);for(var m=b(i.split("/")),g=b(c.split("/")),q=Math.min(m.length,g.length),Y=q,nt=0;nt<q;nt++)if(m[nt]!==g[nt]){Y=nt;break}var lt=[];for(nt=Y;nt<m.length;nt++)lt.push("..");return(lt=lt.concat(g.slice(Y))).join("/")},k._makeLong=function(i){return i},k.dirname=function(i){var c=I(i),m=c[0],g=c[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},k.basename=function(i,c){var m=I(i)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},k.extname=function(i){return I(i)[3]},k.format=function(i){if(!M.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var c=i.root||"";if(!M.isString(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+k.sep:"")+(i.base||"")},k.parse=function(i){if(!M.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var c=I(i);if(!c||c.length!==4)throw new TypeError("Invalid path '"+i+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},k.sep="/",k.delimiter=":",N.exports=O?u:k,N.exports.posix=k,N.exports.win32=u},155:N=>{var p,v,j=N.exports={};function O(){throw new Error("setTimeout has not been defined")}function M(){throw new Error("clearTimeout has not been defined")}function V(k){if(p===setTimeout)return setTimeout(k,0);if((p===O||!p)&&setTimeout)return p=setTimeout,setTimeout(k,0);try{return p(k,0)}catch{try{return p.call(null,k,0)}catch{return p.call(this,k,0)}}}(function(){try{p=typeof setTimeout=="function"?setTimeout:O}catch{p=O}try{v=typeof clearTimeout=="function"?clearTimeout:M}catch{v=M}})();var b,d=[],w=!1,u=-1;function x(){w&&b&&(w=!1,b.length?d=b.concat(d):u=-1,d.length&&y())}function y(){if(!w){var k=V(x);w=!0;for(var I=d.length;I;){for(b=d,d=[];++u<I;)b&&b[u].run();u=-1,I=d.length}b=null,w=!1,function(i){if(v===clearTimeout)return clearTimeout(i);if((v===M||!v)&&clearTimeout)return v=clearTimeout,clearTimeout(i);try{v(i)}catch{try{return v.call(null,i)}catch{return v.call(this,i)}}}(k)}}function T(k,I){this.fun=k,this.array=I}function D(){}j.nextTick=function(k){var I=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)I[i-1]=arguments[i];d.push(new T(k,I)),d.length!==1||w||V(y)},T.prototype.run=function(){this.fun.apply(null,this.array)},j.title="browser",j.browser=!0,j.env={},j.argv=[],j.version="",j.versions={},j.on=D,j.addListener=D,j.once=D,j.off=D,j.removeListener=D,j.removeAllListeners=D,j.emit=D,j.prependListener=D,j.prependOnceListener=D,j.listeners=function(k){return[]},j.binding=function(k){throw new Error("process.binding is not supported")},j.cwd=function(){return"/"},j.chdir=function(k){throw new Error("process.chdir is not supported")},j.umask=function(){return 0}},384:N=>{N.exports=function(p){return p&&typeof p=="object"&&typeof p.copy=="function"&&typeof p.fill=="function"&&typeof p.readUInt8=="function"}},539:(N,p,v)=>{var j=v(155),O=/%[sdj%]/g;p.format=function(f){if(!i(f)){for(var _=[],U=0;U<arguments.length;U++)_.push(b(arguments[U]));return _.join(" ")}U=1;for(var K=arguments,_t=K.length,F=String(f).replace(O,function(et){if(et==="%%")return"%";if(U>=_t)return et;switch(et){case"%s":return String(K[U++]);case"%d":return Number(K[U++]);case"%j":try{return JSON.stringify(K[U++])}catch{return"[Circular]"}default:return et}}),W=K[U];U<_t;W=K[++U])k(W)||!g(W)?F+=" "+W:F+=" "+b(W);return F},p.deprecate=function(f,_){if(c(v.g.process))return function(){return p.deprecate(f,_).apply(this,arguments)};if(j.noDeprecation===!0)return f;var U=!1;return function(){if(!U){if(j.throwDeprecation)throw new Error(_);j.traceDeprecation?console.trace(_):console.error(_),U=!0}return f.apply(this,arguments)}};var M,V={};function b(f,_){var U={seen:[],stylize:w};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),D(_)?U.showHidden=_:_&&p._extend(U,_),c(U.showHidden)&&(U.showHidden=!1),c(U.depth)&&(U.depth=2),c(U.colors)&&(U.colors=!1),c(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=d),u(U,f,U.depth)}function d(f,_){var U=b.styles[_];return U?"\x1B["+b.colors[U][0]+"m"+f+"\x1B["+b.colors[U][1]+"m":f}function w(f,_){return f}function u(f,_,U){if(f.customInspect&&_&&nt(_.inspect)&&_.inspect!==p.inspect&&(!_.constructor||_.constructor.prototype!==_)){var K=_.inspect(U,f);return i(K)||(K=u(f,K,U)),K}var _t=function(st,ot){if(c(ot))return st.stylize("undefined","undefined");if(i(ot)){var wt="'"+JSON.stringify(ot).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return st.stylize(wt,"string")}if(I(ot))return st.stylize(""+ot,"number");if(D(ot))return st.stylize(""+ot,"boolean");if(k(ot))return st.stylize("null","null")}(f,_);if(_t)return _t;var F=Object.keys(_),W=function(st){var ot={};return st.forEach(function(wt,St){ot[wt]=!0}),ot}(F);if(f.showHidden&&(F=Object.getOwnPropertyNames(_)),Y(_)&&(F.indexOf("message")>=0||F.indexOf("description")>=0))return x(_);if(F.length===0){if(nt(_)){var et=_.name?": "+_.name:"";return f.stylize("[Function"+et+"]","special")}if(m(_))return f.stylize(RegExp.prototype.toString.call(_),"regexp");if(q(_))return f.stylize(Date.prototype.toString.call(_),"date");if(Y(_))return x(_)}var Ct,vt="",Et=!1,Xt=["{","}"];return T(_)&&(Et=!0,Xt=["[","]"]),nt(_)&&(vt=" [Function"+(_.name?": "+_.name:"")+"]"),m(_)&&(vt=" "+RegExp.prototype.toString.call(_)),q(_)&&(vt=" "+Date.prototype.toUTCString.call(_)),Y(_)&&(vt=" "+x(_)),F.length!==0||Et&&_.length!=0?U<0?m(_)?f.stylize(RegExp.prototype.toString.call(_),"regexp"):f.stylize("[Object]","special"):(f.seen.push(_),Ct=Et?function(st,ot,wt,St,Lt){for(var Vt=[],jt=0,Ot=ot.length;jt<Ot;++jt)Se(ot,String(jt))?Vt.push(y(st,ot,wt,St,String(jt),!0)):Vt.push("");return Lt.forEach(function(fe){fe.match(/^\d+$/)||Vt.push(y(st,ot,wt,St,fe,!0))}),Vt}(f,_,U,W,F):F.map(function(st){return y(f,_,U,W,st,Et)}),f.seen.pop(),function(st,ot,wt){return st.reduce(function(St,Lt){return Lt.indexOf(`
`)>=0,St+Lt.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?wt[0]+(ot===""?"":ot+`
 `)+" "+st.join(`,
  `)+" "+wt[1]:wt[0]+ot+" "+st.join(", ")+" "+wt[1]}(Ct,vt,Xt)):Xt[0]+vt+Xt[1]}function x(f){return"["+Error.prototype.toString.call(f)+"]"}function y(f,_,U,K,_t,F){var W,et,Ct;if((Ct=Object.getOwnPropertyDescriptor(_,_t)||{value:_[_t]}).get?et=Ct.set?f.stylize("[Getter/Setter]","special"):f.stylize("[Getter]","special"):Ct.set&&(et=f.stylize("[Setter]","special")),Se(K,_t)||(W="["+_t+"]"),et||(f.seen.indexOf(Ct.value)<0?(et=k(U)?u(f,Ct.value,null):u(f,Ct.value,U-1)).indexOf(`
`)>-1&&(et=F?et.split(`
`).map(function(vt){return"  "+vt}).join(`
`).substr(2):`
`+et.split(`
`).map(function(vt){return"   "+vt}).join(`
`)):et=f.stylize("[Circular]","special")),c(W)){if(F&&_t.match(/^\d+$/))return et;(W=JSON.stringify(""+_t)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(W=W.substr(1,W.length-2),W=f.stylize(W,"name")):(W=W.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),W=f.stylize(W,"string"))}return W+": "+et}function T(f){return Array.isArray(f)}function D(f){return typeof f=="boolean"}function k(f){return f===null}function I(f){return typeof f=="number"}function i(f){return typeof f=="string"}function c(f){return f===void 0}function m(f){return g(f)&&lt(f)==="[object RegExp]"}function g(f){return typeof f=="object"&&f!==null}function q(f){return g(f)&&lt(f)==="[object Date]"}function Y(f){return g(f)&&(lt(f)==="[object Error]"||f instanceof Error)}function nt(f){return typeof f=="function"}function lt(f){return Object.prototype.toString.call(f)}function yt(f){return f<10?"0"+f.toString(10):f.toString(10)}p.debuglog=function(f){if(c(M)&&(M=j.env.NODE_DEBUG||""),f=f.toUpperCase(),!V[f])if(new RegExp("\\b"+f+"\\b","i").test(M)){var _=j.pid;V[f]=function(){var U=p.format.apply(p,arguments);console.error("%s %d: %s",f,_,U)}}else V[f]=function(){};return V[f]},p.inspect=b,b.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},b.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},p.isArray=T,p.isBoolean=D,p.isNull=k,p.isNullOrUndefined=function(f){return f==null},p.isNumber=I,p.isString=i,p.isSymbol=function(f){return typeof f=="symbol"},p.isUndefined=c,p.isRegExp=m,p.isObject=g,p.isDate=q,p.isError=Y,p.isFunction=nt,p.isPrimitive=function(f){return f===null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||typeof f=="symbol"||f===void 0},p.isBuffer=v(384);var bt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function mt(){var f=new Date,_=[yt(f.getHours()),yt(f.getMinutes()),yt(f.getSeconds())].join(":");return[f.getDate(),bt[f.getMonth()],_].join(" ")}function Se(f,_){return Object.prototype.hasOwnProperty.call(f,_)}p.log=function(){console.log("%s - %s",mt(),p.format.apply(p,arguments))},p.inherits=v(717),p._extend=function(f,_){if(!_||!g(_))return f;for(var U=Object.keys(_),K=U.length;K--;)f[U[K]]=_[U[K]];return f}}},Ht={};function G(N){var p=Ht[N];if(p!==void 0)return p.exports;var v=Ht[N]={exports:{}};return Ce[N].call(v.exports,v,v.exports,G),v.exports}G.n=N=>{var p=N&&N.__esModule?()=>N.default:()=>N;return G.d(p,{a:p}),p},G.d=(N,p)=>{for(var v in p)G.o(p,v)&&!G.o(N,v)&&Object.defineProperty(N,v,{enumerable:!0,get:p[v]})},G.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),G.o=(N,p)=>Object.prototype.hasOwnProperty.call(N,p),G.r=N=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(N,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(N,"__esModule",{value:!0})};var ct={};return(()=>{G.r(ct),G.d(ct,{LSPluginUser:()=>Wn,setupPluginUserInstance:()=>gr});var N=G(520),p=(G(856),G(996)),v=G.n(p),j=function(){return j=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},j.apply(this,arguments)};function O(e){return e.toLowerCase()}var M=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],V=/[^A-Z0-9]+/gi;function b(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function d(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?M:s,l=r.stripRegexp,h=l===void 0?V:l,A=r.transform,R=A===void 0?O:A,$=r.delimiter,P=$===void 0?" ":$,H=b(b(n,a,"$1\0$2"),h,"\0"),Z=0,B=H.length;H.charAt(Z)==="\0";)Z++;for(;H.charAt(B-1)==="\0";)B--;return H.slice(Z,B).split("\0").map(R).join(P)}(e,j({delimiter:"."},t))}var w=G(729),u=G.n(w);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const y=navigator.platform.toLowerCase()==="win32"?N.win32:N.posix,T=function(e,t){return t===void 0&&(t={}),d(e,j({delimiter:"_"},t))};class D extends u(){constructor(t,n){super(),x(this,"_tag",void 0),x(this,"_opts",void 0),x(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce((h,A)=>(A&&A instanceof Error?h+=`${A.message} ${A.stack}`:h+=A.toString(),h),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var l;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((l=console)===null||l===void 0||l[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function k(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=y.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return y.join(e,...t)}}function I(e,t){let n,r,s=!1;const a=h=>A=>{e&&clearTimeout(e),h(A),s=!0},l=new Promise((h,A)=>{n=a(h),r=a(A),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:h=>t=h,resolve:n,reject:r,promise:l,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var c=G(227),m=G.n(c);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const q="application/x-postmate-v1+json";let Y=0;const nt={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},lt=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===q&&!!nt[e.data.postmate];class yt{constructor(t){g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"events",{}),g(this,"childOrigin",void 0),g(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!lt(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{const a=++Y,l=h=>{h.data.uid===a&&h.data.postmate==="reply"&&(this.parent.removeEventListener("message",l,!1),h.data.error?s(h.data.error):r(h.data.value))};this.parent.addEventListener("message",l,!1),this.child.postMessage({postmate:"request",type:q,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:q,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class bt{constructor(t){g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),g(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!lt(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:l}=n.data;n.data.postmate!=="call"?((h,A,R)=>{const $=typeof h[A]=="function"?h[A].apply(null,R):h[A];return Promise.resolve($)})(this.model,r,l).then(h=>{n.source.postMessage({property:r,postmate:"reply",type:q,uid:s,value:h},n.origin)}).catch(h=>{n.source.postMessage({property:r,postmate:"reply",type:q,uid:s,error:h},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:q,value:{name:t,data:n}},this.parentOrigin)}}class mt{constructor(t){g(this,"container",void 0),g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"childOrigin",void 0),g(this,"url",void 0),g(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(a=>{const l=document.createElement("a");l.href=a;const h=l.protocol.length>4?l.protocol:window.location.protocol,A=l.host.length?l.port==="80"||l.port==="443"?l.hostname:l.host:window.location.host;return l.origin||`${h}//${A}`})(t=t||this.url);let r,s=0;return new Promise((a,l)=>{const h=R=>!!lt(R,n)&&(R.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",h,!1),this.childOrigin=R.origin,a(new yt(this))):l("Failed handshake"));this.parent.addEventListener("message",h,!1);const A=()=>{s++,this.child.postMessage({postmate:"handshake",type:q,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{A(),r=setInterval(A,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}g(mt,"debug",!1),g(mt,"Model",void 0);class Se{constructor(t){g(this,"child",void 0),g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:q},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(l=>{this.model[l]=a[l]}),t(new bt(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:_,createSandboxContainer:U}=window.QSandbox||{};function K(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class _t extends u(){constructor(t){super(),f(this,"_pluginLocal",void 0),f(this,"_frame",void 0),f(this,"_root",void 0),f(this,"_loaded",!1),f(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await _(n,{fetch:K});this._mount(r,document.body);const a=U(t,{elementGetter:()=>{var h;return(h=this._root)===null||h===void 0?void 0:h.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Wn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const l=await s(a,!0);this._unmountFns.push(l.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const W=m()("LSPlugin:caller"),et="#await#response#",Ct="#lspmsg#",vt="#lspmsg#error#",Et=e=>`#lspmsg#${e}`;class Xt extends u(){constructor(t){super(),F(this,"_pluginLocal",void 0),F(this,"_connected",!1),F(this,"_parent",void 0),F(this,"_child",void 0),F(this,"_shadow",void 0),F(this,"_status",void 0),F(this,"_userModel",{}),F(this,"_call",void 0),F(this,"_callUserModel",void 0),F(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,l=I(6e4),h=this._extendUserModel({"#lspmsg#ready#":async $=>{h[Et($?.pid)]=({type:P,payload:H})=>{W(`[host (_call) -> *user] ${this._debugTag}`,P,H),n.emit(P,H)},await l.resolve()},"#lspmsg#beforeunload#":async $=>{const P=I(1e4);n.emit("beforeunload",Object.assign({actor:P},$)),await P.promise},"#lspmsg#settings#":async({type:$,payload:P})=>{n.emit("settings:changed",P)},[Ct]:async({ns:$,type:P,payload:H})=>{W(`[host (async) -> *user] ${this._debugTag} ns=${$} type=${P}`,H),$&&$.startsWith("hook")?n.emit(`${$}:${P}`,H):n.emit(P,H)},"#lspmsg#reply#":({_sync:$,result:P})=>{if(W(`[sync host -> *user] #${$}`,P),a.has($)){const H=a.get($);H&&(P!=null&&P.hasOwnProperty(vt)?H.reject(P[vt]):H.resolve(P),a.delete($))}},...t});var A;if(r)return await l.promise,JSON.parse(JSON.stringify((A=this._pluginLocal)===null||A===void 0?void 0:A.toJSON()));const R=new Se(h).sendHandshakeReply();return this._status="pending",await R.then($=>{this._child=$,this._connected=!0,this._call=async(P,H={},Z)=>{if(Z){const B=++s;a.set(B,Z),H._sync=B,Z.setTag(`async call #${B}`),W(`async call #${B}`)}return $.emit(Et(h.baseInfo.id),{type:P,payload:H}),Z?.promise},this._callUserModel=async(P,H)=>{try{h[P](H)}catch{W(`[model method] #${P} not existed`)}},setInterval(()=>{if(a.size>100)for(const[P,H]of a)H.settled&&a.delete(P)},18e5)}).finally(()=>{this._status=void 0}),await l.promise,h.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const s=I(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${et}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const l=document.createElement("div");l.classList.add("lsp-iframe-sandbox-container"),l.id=r,l.dataset.pid=n;try{var h;const P=(h=await this._pluginLocal._loadLayoutsData())===null||h===void 0?void 0:h.$$0;if(P){l.dataset.inited_layout="true";let{width:H,height:Z,left:B,top:tt,vw:rt,vh:ht}=P;B=Math.max(B,0),B=typeof rt=="number"?`${Math.min(100*B/rt,99)}%`:`${B}px`,tt=Math.max(tt,45),tt=typeof ht=="number"?`${Math.min(100*tt/ht,99)}%`:`${tt}px`,Object.assign(l.style,{width:H+"px",height:Z+"px",left:B,top:tt})}}catch(P){console.error("[Restore Layout Error]",P)}document.body.appendChild(l);const A=new mt({id:n+"_iframe",container:l,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let R,$=A.sendHandshake();return this._status="pending",new Promise((P,H)=>{R=setTimeout(()=>{H(new Error("handshake Timeout")),A.destroy()},4e3),$.then(Z=>{this._parent=Z,this._connected=!0,this.emit("connected"),Z.on(Et(t.id),({type:B,payload:tt})=>{var rt,ht;W("[user -> *host] ",B,tt),(rt=this._pluginLocal)===null||rt===void 0||rt.emit(B,tt||{}),(ht=this._pluginLocal)===null||ht===void 0||ht.caller.emit(B,tt||{})}),this._call=async(...B)=>{await Z.call(Et(t.id),{type:B[0],payload:Object.assign(B[1]||{},{$$pid:t.id})})},this._callUserModel=async(B,...tt)=>{if(B.startsWith(et))return await Z.get(B.replace(et,""),...tt);Z.call(B,tt?.[0])},P(null)}).catch(Z=>{H(Z)}).finally(()=>{clearTimeout(R)})}).catch(P=>{throw W("[iframe sandbox] error",P),P}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new _t(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var l;return a&&(s.actor=a),(l=this._pluginLocal)===null||l===void 0||l.emit(r,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(et)&&(a=a.replace(et,""));const l=r[1]||{},h=this._userModel[a];typeof h=="function"&&await h.call(null,l)}}catch(r){throw W("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ot{constructor(t,n){st(this,"ctx",void 0),st(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class wt{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;const a=this.ensureHostScope();return t=(r=T(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Lt=e=>`task_callback_${e}`;class Vt{constructor(t,n,r={}){St(this,"_client",void 0),St(this,"_requestId",void 0),St(this,"_requestOptions",void 0),St(this,"_promise",void 0),St(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((h,A)=>{if(!this._requestId)return A(null);this._client.once(Lt(this._requestId),R=>{R&&R instanceof Error?A(R):h(R)})});const{success:s,fail:a,final:l}=this._requestOptions;this._promise.then(h=>{s?.(h)}).catch(h=>{a?.(h)}).finally(()=>{l?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class jt extends w.EventEmitter{constructor(t){super(),St(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(Lt(r),n?.payload)})}static createRequestTask(t,n,r){return new Vt(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...l}=t,h=this.ctx.Experiments.invokeExperMethod("request",n,l),A=jt.createRequestTask(this.ctx.Request,h,t);return l.abortable?A:A.promise}get ctx(){return this._ctx}}const Ot=Array.isArray,fe=typeof bn=="object"&&bn&&bn.Object===Object&&bn;var wn=typeof self=="object"&&self&&self.Object===Object&&self;const Mt=fe||wn||Function("return this")(),qt=Mt.Symbol;var Ve=Object.prototype,xn=Ve.hasOwnProperty,Cn=Ve.toString,pe=qt?qt.toStringTag:void 0;const Sn=function(e){var t=xn.call(e,pe),n=e[pe];try{e[pe]=void 0;var r=!0}catch{}var s=Cn.call(e);return r&&(t?e[pe]=n:delete e[pe]),s};var Ze=Object.prototype.toString;const S=function(e){return Ze.call(e)};var L=qt?qt.toStringTag:void 0;const z=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":L&&L in Object(e)?Sn(e):S(e)},J=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ut=function(e){if(!J(e))return!1;var t=z(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Ft=Mt["__core-js_shared__"];var Bt,te=(Bt=/[^.]+$/.exec(Ft&&Ft.keys&&Ft.keys.IE_PROTO||""))?"Symbol(src)_1."+Bt:"";const Ne=function(e){return!!te&&te in e};var Ke=Function.prototype.toString;const Zt=function(e){if(e!=null){try{return Ke.call(e)}catch{}try{return e+""}catch{}}return""};var On=/^\[object .+?Constructor\]$/,An=Function.prototype,En=Object.prototype,Oe=An.toString,jn=En.hasOwnProperty,kn=RegExp("^"+Oe.call(jn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Tn=function(e){return!(!J(e)||Ne(e))&&(ut(e)?kn:On).test(Zt(e))},Pe=function(e,t){return e?.[t]},Nt=function(e,t){var n=Pe(e,t);return Tn(n)?n:void 0},Pt=function(){try{var e=Nt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ye=function(e,t,n){t=="__proto__"&&Pt?Pt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ae=function(e){return function(t,n,r){for(var s=-1,a=Object(t),l=r(t),h=l.length;h--;){var A=l[e?h:++s];if(n(a[A],A,a)===!1)break}return t}}(),Re=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ee=function(e){return e!=null&&typeof e=="object"},Qe=function(e){return ee(e)&&z(e)=="[object Arguments]"};var Xe=Object.prototype,In=Xe.hasOwnProperty,tn=Xe.propertyIsEnumerable;const kt=Qe(function(){return arguments}())?Qe:function(e){return ee(e)&&In.call(e,"callee")&&!tn.call(e,"callee")},de=function(){return!1};var Wt=Tt&&!Tt.nodeType&&Tt,Ee=Wt&&!0&&zt&&!zt.nodeType&&zt,je=Ee&&Ee.exports===Wt?Mt.Buffer:void 0;const De=(je?je.isBuffer:void 0)||de;var Ln=/^(?:0|[1-9]\d*)$/;const en=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Ln.test(e))&&e>-1&&e%1==0&&e<t},ke=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var Q={};Q["[object Float32Array]"]=Q["[object Float64Array]"]=Q["[object Int8Array]"]=Q["[object Int16Array]"]=Q["[object Int32Array]"]=Q["[object Uint8Array]"]=Q["[object Uint8ClampedArray]"]=Q["[object Uint16Array]"]=Q["[object Uint32Array]"]=!0,Q["[object Arguments]"]=Q["[object Array]"]=Q["[object ArrayBuffer]"]=Q["[object Boolean]"]=Q["[object DataView]"]=Q["[object Date]"]=Q["[object Error]"]=Q["[object Function]"]=Q["[object Map]"]=Q["[object Number]"]=Q["[object Object]"]=Q["[object RegExp]"]=Q["[object Set]"]=Q["[object String]"]=Q["[object WeakMap]"]=!1;const ft=function(e){return ee(e)&&ke(e.length)&&!!Q[z(e)]},nn=function(e){return function(t){return e(t)}};var pt=Tt&&!Tt.nodeType&&Tt,ne=pt&&!0&&zt&&!zt.nodeType&&zt,it=ne&&ne.exports===pt&&fe.process,re=function(){try{var e=ne&&ne.require&&ne.require("util").types;return e||it&&it.binding&&it.binding("util")}catch{}}(),Te=re&&re.isTypedArray;const Ue=Te?nn(Te):ft;var $e=Object.prototype.hasOwnProperty;const rn=function(e,t){var n=Ot(e),r=!n&&kt(e),s=!n&&!r&&De(e),a=!n&&!r&&!s&&Ue(e),l=n||r||s||a,h=l?Re(e.length,String):[],A=h.length;for(var R in e)!t&&!$e.call(e,R)||l&&(R=="length"||s&&(R=="offset"||R=="parent")||a&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||en(R,A))||h.push(R);return h};var oe=Object.prototype;const Kt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||oe)},ze=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var He=Object.prototype.hasOwnProperty;const ie=function(e){if(!Kt(e))return ze(e);var t=[];for(var n in Object(e))He.call(e,n)&&n!="constructor"&&t.push(n);return t},Ie=function(e){return e!=null&&ke(e.length)&&!ut(e)},se=function(e){return Ie(e)?rn(e):ie(e)},on=function(e,t){return e&&Ae(e,t,se)},qe=function(){this.__data__=[],this.size=0},ae=function(e,t){return e===t||e!=e&&t!=t},Rt=function(e,t){for(var n=e.length;n--;)if(ae(e[n][0],t))return n;return-1};var ce=Array.prototype.splice;const sn=function(e){var t=this.__data__,n=Rt(t,e);return!(n<0)&&(n==t.length-1?t.pop():ce.call(t,n,1),--this.size,!0)},an=function(e){var t=this.__data__,n=Rt(t,e);return n<0?void 0:t[n][1]},cn=function(e){return Rt(this.__data__,e)>-1},Be=function(e,t){var n=this.__data__,r=Rt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Yt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Yt.prototype.clear=qe,Yt.prototype.delete=sn,Yt.prototype.get=an,Yt.prototype.has=cn,Yt.prototype.set=Be;const le=Yt,We=function(){this.__data__=new le,this.size=0},Gt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Le=function(e){return this.__data__.get(e)},ln=function(e){return this.__data__.has(e)},he=Nt(Mt,"Map"),me=Nt(Object,"create"),ue=function(){this.__data__=me?me(null):{},this.size=0},Mn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var un=Object.prototype.hasOwnProperty;const Ge=function(e){var t=this.__data__;if(me){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return un.call(t,e)?t[e]:void 0};var fn=Object.prototype.hasOwnProperty;const pn=function(e){var t=this.__data__;return me?t[e]!==void 0:fn.call(t,e)},Fn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=me&&t===void 0?"__lodash_hash_undefined__":t,this};function Dt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Dt.prototype.clear=ue,Dt.prototype.delete=Mn,Dt.prototype.get=Ge,Dt.prototype.has=pn,Dt.prototype.set=Fn;const Me=Dt,Nn=function(){this.size=0,this.__data__={hash:new Me,map:new(he||le),string:new Me}},Ut=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ge=function(e,t){var n=e.__data__;return Ut(t)?n[typeof t=="string"?"string":"hash"]:n.map},dn=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},hn=function(e){return ge(this,e).get(e)},Pn=function(e){return ge(this,e).has(e)},ye=function(e,t){var n=ge(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}xt.prototype.clear=Nn,xt.prototype.delete=dn,xt.prototype.get=hn,xt.prototype.has=Pn,xt.prototype.set=ye;const ve=xt,mn=function(e,t){var n=this.__data__;if(n instanceof le){var r=n.__data__;if(!he||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ve(r)}return n.set(e,t),this.size=n.size,this};function Qt(e){var t=this.__data__=new le(e);this.size=t.size}Qt.prototype.clear=We,Qt.prototype.delete=Gt,Qt.prototype.get=Le,Qt.prototype.has=ln,Qt.prototype.set=mn;const be=Qt,Rn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function E(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ve;++t<n;)this.add(e[t])}E.prototype.add=E.prototype.push=Rn,E.prototype.has=o;const C=E,X=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},at=function(e,t){return e.has(t)},gt=function(e,t,n,r,s,a){var l=1&n,h=e.length,A=t.length;if(h!=A&&!(l&&A>h))return!1;var R=a.get(e),$=a.get(t);if(R&&$)return R==t&&$==e;var P=-1,H=!0,Z=2&n?new C:void 0;for(a.set(e,t),a.set(t,e);++P<h;){var B=e[P],tt=t[P];if(r)var rt=l?r(tt,B,P,t,e,a):r(B,tt,P,e,t,a);if(rt!==void 0){if(rt)continue;H=!1;break}if(Z){if(!X(t,function(ht,It){if(!at(Z,It)&&(B===ht||s(B,ht,n,r,a)))return Z.push(It)})){H=!1;break}}else if(B!==tt&&!s(B,tt,n,r,a)){H=!1;break}}return a.delete(e),a.delete(t),H},dt=Mt.Uint8Array,_e=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Jt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var At=qt?qt.prototype:void 0,Je=At?At.valueOf:void 0;const Gn=function(e,t,n,r,s,a,l){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new dt(e),new dt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ae(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var h=_e;case"[object Set]":var A=1&r;if(h||(h=Jt),e.size!=t.size&&!A)return!1;var R=l.get(e);if(R)return R==t;r|=2,l.set(e,t);var $=gt(h(e),h(t),r,s,a,l);return l.delete(e),$;case"[object Symbol]":if(Je)return Je.call(e)==Je.call(t)}return!1},yr=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},vr=function(e,t,n){var r=t(e);return Ot(e)?r:yr(r,n(e))},br=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var l=e[n];t(l,n,e)&&(a[s++]=l)}return a},_r=function(){return[]};var wr=Object.prototype.propertyIsEnumerable,Jn=Object.getOwnPropertySymbols;const xr=Jn?function(e){return e==null?[]:(e=Object(e),br(Jn(e),function(t){return wr.call(e,t)}))}:_r,Vn=function(e){return vr(e,se,xr)};var Cr=Object.prototype.hasOwnProperty;const Sr=function(e,t,n,r,s,a){var l=1&n,h=Vn(e),A=h.length;if(A!=Vn(t).length&&!l)return!1;for(var R=A;R--;){var $=h[R];if(!(l?$ in t:Cr.call(t,$)))return!1}var P=a.get(e),H=a.get(t);if(P&&H)return P==t&&H==e;var Z=!0;a.set(e,t),a.set(t,e);for(var B=l;++R<A;){var tt=e[$=h[R]],rt=t[$];if(r)var ht=l?r(rt,tt,$,t,e,a):r(tt,rt,$,e,t,a);if(!(ht===void 0?tt===rt||s(tt,rt,n,r,a):ht)){Z=!1;break}B||(B=$=="constructor")}if(Z&&!B){var It=e.constructor,xe=t.constructor;It==xe||!("constructor"in e)||!("constructor"in t)||typeof It=="function"&&It instanceof It&&typeof xe=="function"&&xe instanceof xe||(Z=!1)}return a.delete(e),a.delete(t),Z},Dn=Nt(Mt,"DataView"),Un=Nt(Mt,"Promise"),$n=Nt(Mt,"Set"),zn=Nt(Mt,"WeakMap");var Zn="[object Map]",Kn="[object Promise]",Yn="[object Set]",Qn="[object WeakMap]",Xn="[object DataView]",Or=Zt(Dn),Ar=Zt(he),Er=Zt(Un),jr=Zt($n),kr=Zt(zn),we=z;(Dn&&we(new Dn(new ArrayBuffer(1)))!=Xn||he&&we(new he)!=Zn||Un&&we(Un.resolve())!=Kn||$n&&we(new $n)!=Yn||zn&&we(new zn)!=Qn)&&(we=function(e){var t=z(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Zt(n):"";if(r)switch(r){case Or:return Xn;case Ar:return Zn;case Er:return Kn;case jr:return Yn;case kr:return Qn}return t});const tr=we;var er="[object Arguments]",nr="[object Array]",gn="[object Object]",rr=Object.prototype.hasOwnProperty;const Tr=function(e,t,n,r,s,a){var l=Ot(e),h=Ot(t),A=l?nr:tr(e),R=h?nr:tr(t),$=(A=A==er?gn:A)==gn,P=(R=R==er?gn:R)==gn,H=A==R;if(H&&De(e)){if(!De(t))return!1;l=!0,$=!1}if(H&&!$)return a||(a=new be),l||Ue(e)?gt(e,t,n,r,s,a):Gn(e,t,A,n,r,s,a);if(!(1&n)){var Z=$&&rr.call(e,"__wrapped__"),B=P&&rr.call(t,"__wrapped__");if(Z||B){var tt=Z?e.value():e,rt=B?t.value():t;return a||(a=new be),s(tt,rt,n,r,a)}}return!!H&&(a||(a=new be),Sr(e,t,n,r,s,a))},or=function e(t,n,r,s,a){return t===n||(t==null||n==null||!ee(t)&&!ee(n)?t!=t&&n!=n:Tr(t,n,r,s,e,a))},Ir=function(e,t,n,r){var s=n.length,a=s,l=!r;if(e==null)return!a;for(e=Object(e);s--;){var h=n[s];if(l&&h[2]?h[1]!==e[h[0]]:!(h[0]in e))return!1}for(;++s<a;){var A=(h=n[s])[0],R=e[A],$=h[1];if(l&&h[2]){if(R===void 0&&!(A in e))return!1}else{var P=new be;if(r)var H=r(R,$,A,e,t,P);if(!(H===void 0?or($,R,3,r,P):H))return!1}}return!0},ir=function(e){return e==e&&!J(e)},Lr=function(e){for(var t=se(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,ir(s)]}return t},sr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},Mr=function(e){var t=Lr(e);return t.length==1&&t[0][2]?sr(t[0][0],t[0][1]):function(n){return n===e||Ir(n,e,t)}},Hn=function(e){return typeof e=="symbol"||ee(e)&&z(e)=="[object Symbol]"};var Fr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nr=/^\w*$/;const qn=function(e,t){if(Ot(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Hn(e))||Nr.test(e)||!Fr.test(e)||t!=null&&e in Object(t)};function Bn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var l=e.apply(this,r);return n.cache=a.set(s,l)||a,l};return n.cache=new(Bn.Cache||ve),n}Bn.Cache=ve;const Pr=Bn;var Rr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dr=/\\(\\)?/g;const Ur=function(e){var t=Pr(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Rr,function(n,r,s,a){t.push(s?a.replace(Dr,"$1"):r||n)}),t}),$r=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var ar=qt?qt.prototype:void 0,cr=ar?ar.toString:void 0;const zr=function e(t){if(typeof t=="string")return t;if(Ot(t))return $r(t,e)+"";if(Hn(t))return cr?cr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Hr=function(e){return e==null?"":zr(e)},lr=function(e,t){return Ot(e)?e:qn(e,t)?[e]:Ur(Hr(e))},yn=function(e){if(typeof e=="string"||Hn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},ur=function(e,t){for(var n=0,r=(t=lr(t,e)).length;e!=null&&n<r;)e=e[yn(t[n++])];return n&&n==r?e:void 0},qr=function(e,t,n){var r=e==null?void 0:ur(e,t);return r===void 0?n:r},Br=function(e,t){return e!=null&&t in Object(e)},Wr=function(e,t,n){for(var r=-1,s=(t=lr(t,e)).length,a=!1;++r<s;){var l=yn(t[r]);if(!(a=e!=null&&n(e,l)))break;e=e[l]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&ke(s)&&en(l,s)&&(Ot(e)||kt(e))},Gr=function(e,t){return e!=null&&Wr(e,t,Br)},Jr=function(e,t){return qn(e)&&ir(t)?sr(yn(e),t):function(n){var r=qr(n,e);return r===void 0&&r===t?Gr(n,e):or(t,r,3)}},Vr=function(e){return e},Zr=function(e){return function(t){return t?.[e]}},Kr=function(e){return function(t){return ur(t,e)}},Yr=function(e){return qn(e)?Zr(yn(e)):Kr(e)},Qr=function(e){return typeof e=="function"?e:e==null?Vr:typeof e=="object"?Ot(e)?Jr(e[0],e[1]):Mr(e):Yr(e)},Xr=function(e,t){var n={};return t=Qr(t),on(e,function(r,s,a){Ye(n,t(r,s,a),r)}),n};function fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class to{constructor(t,n){fr(this,"ctx",void 0),fr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Ot(r?.blocks)&&(r.blocks=r.blocks.map(s=>s&&Xr(s,(a,l)=>`block/${l}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{const a=(l=>`service:search:${l}:${n.name}`)(r);t.caller.on(a,async l=>{if(ut(n?.[s.f])){let h=null;try{h=await n[s.f].apply(n,(s.args||[]).map(A=>{if(l){if(A===!0)return l;if(l.hasOwnProperty(A)){const R=l[A];return delete l[A],R}}})),s.transformOutput&&(h=s.transformOutput(h))}catch(A){console.error("[SearchService] ",A),h=A}finally{s.reply&&t.caller.call(`${a}:reply`,h)}}})})}}function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const eo=Symbol.for("proxy-continue"),no=m()("LSPlugin:user"),pr=new D("",{console:!0});function Fe(e,t,n){var r;const{key:s,label:a,desc:l,palette:h,keybinding:A,extras:R}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const $=function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!$)return this.logger.error(`${a}: command key is required.`),!1;const P=`SimpleCommandHook${$}${++mr}`;this.Editor["on"+P](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:$,label:a,type:e,desc:l,keybinding:A,extras:R},["editor/hook",P]],h]})}function dr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(pr.error(`#${e} is not a valid UUID string.`),!1);var t}let vn=null,hr=new Map;const ro={async getInfo(e){return vn||(vn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?vn[e]:vn},registerCommand:Fe,registerSearchService(e){if(hr.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);hr.set(e.name,new to(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:s}=e;return Fe.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,s="$shortcut$",a=n.key||s+T(r?.toString());return Fe.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;Fe.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:editor:${T(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let mr=0;const oo={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;no("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[s,...a]=r;if(s==="editor/hook"){let l=a[0],h=()=>{var R;(R=this.caller)===null||R===void 0||R.callUserModel(l)};typeof l=="function"&&(h=l);const A=`SlashCommandHook${s}${++mr}`;r[1]=A,this.Editor["on"+A](h)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Fe.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Fe.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},io={onBlockChanged(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:db:${T(`block:${e}`)}`,s=({block:a,txData:l,txMeta:h})=>{a.uuid===e&&t(a,l,h)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},so={},ao={},co={makeSandboxStorage(){return new ot(this,{assets:!0})}};class Wn extends u(){constructor(t,n){super(),$t(this,"_baseInfo",void 0),$t(this,"_caller",void 0),$t(this,"_version","0.0.17"),$t(this,"_debugTag",""),$t(this,"_settingsSchema",void 0),$t(this,"_connected",!1),$t(this,"_ui",new Map),$t(this,"_mFileStorage",void 0),$t(this,"_mRequest",void 0),$t(this,"_mExperiments",void 0),$t(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{const{actor:s,...a}=r,l=this._beforeunloadCallback;try{l&&await l(a),s?.resolve(null)}catch(h){this.logger.error("[beforeunload] ",h),s?.reject(h)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let l=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=l,l=v()(r,s,{arrayMerge:(h,A)=>A}),this._baseInfo=l,(a=l)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${l.id} [${l.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(l.settings=function(h,A){const R=(A||[]).reduce(($,P)=>("default"in P&&($[P.key]=P.default),$),{});return Object.assign(R,h)}(l.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(h){console.warn(h)}n&&n.call(this,l)}catch(l){console.error(`${this._debugTag} [Ready Error]`,l)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return pr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),k(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,s=this.caller;return new Proxy(t,{get(a,l,h){const A=a[l];return function(...R){if(A){const P=A.apply(r,R.concat(n));if(P!==eo)return P}if(n){const P=l.toString().match(/^(once|off|on)/i);if(P!=null){const H=P[0].toLowerCase(),Z=P.input,B=H==="off",tt=r.baseInfo.id;let rt=Z.slice(H.length),ht=R[0],It=R[1];typeof ht=="string"&&typeof It=="function"&&(ht=ht.replace(/^logseq./,":"),rt=`${rt}${ht}`,ht=It,It=R[2]),rt=`hook:${n}:${T(rt)}`,s[H](rt,ht);const xe=()=>{s.off(rt,ht),s.listenerCount(rt)||r.App._uninstallPluginHook(tt,rt)};return B?void xe():(r.App._installPluginHook(tt,rt,It),xe)}}let $=l;return["git","ui","assets"].includes(n)&&($=n+"_"+$),s.callAsync("api:call",{tag:n,method:$,args:R})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(ro,"app")}get Editor(){return this._makeUserProxy(oo,"editor")}get DB(){return this._makeUserProxy(io,"db")}get Git(){return this._makeUserProxy(so,"git")}get UI(){return this._makeUserProxy(ao,"ui")}get Assets(){return this._makeUserProxy(co,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new ot(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new jt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new wt(this)),t}}function gr(e,t){return new Wn(e,t)}if(window.__LSP__HOST__==null){const e=new Xt(null);window.logseq=gr({},e)}})(),ct})())})(_n,_n.exports);_n.exports;const lo={id:"_zhaochunqi-logseq-livephotos-plugin",icon:"./logo.svg"},uo=lo.id;function fo(){console.info(`#${uo}: MAIN`),logseq.App.onMacroRendererSlotted(async({slot:zt,payload:Tt})=>{const[Ce,Ht,G]=Tt.arguments;if(Ce!==":live-photo"||!Ht||!G)return;const ct=parent.document.getElementById(zt);if(!ct)return;ct.innerHTML="",ct.style.width="100%",ct.style.height="auto",ct.style.display="block";const N=parent.document.createElement("div");N.style.position="relative",N.style.width="100%",N.style.cursor="pointer",N.style.overflow="hidden",N.style.borderRadius="8px";const p=parent.document.createElement("img");p.src=Ht,p.style.width="100%",p.style.height="auto",p.style.display="block",p.style.objectFit="cover";const v=parent.document.createElement("video");v.src=G,v.style.position="absolute",v.style.top="0",v.style.left="0",v.style.width="100%",v.style.height="100%",v.style.objectFit="cover",v.style.opacity="0",v.style.transition="opacity 0.2s ease-in-out",v.style.pointerEvents="none",v.muted=!0,v.playsInline=!0,v.loop=!0,N.appendChild(p),N.appendChild(v),ct.appendChild(N);const j=async()=>{try{await v.play(),v.style.opacity="1"}catch(M){console.error("Video play failed",M),v.style.opacity="0"}},O=()=>{v.style.opacity="0",setTimeout(()=>{getComputedStyle(v).opacity==="0"&&(v.pause(),v.currentTime=0)},250)};N.addEventListener("mouseenter",j),N.addEventListener("mouseleave",O),N.addEventListener("touchstart",M=>{j()}),N.addEventListener("touchend",O),N.addEventListener("touchcancel",O)})}logseq.ready(fo).catch(console.error);
