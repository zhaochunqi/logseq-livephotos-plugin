function di(Oe,Ne){for(var J=0;J<Ne.length;J++){const E=Ne[J];if(typeof E!="string"&&!Array.isArray(E)){for(const v in E)if(v!=="default"&&!(v in Oe)){const w=Object.getOwnPropertyDescriptor(E,v);w&&Object.defineProperty(Oe,v,w.get?w:{enumerable:!0,get:()=>E[v]})}}}return Object.freeze(Object.defineProperty(Oe,Symbol.toStringTag,{value:"Module"}))}(function(){const Ne=document.createElement("link").relList;if(Ne&&Ne.supports&&Ne.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))E(v);new MutationObserver(v=>{for(const w of v)if(w.type==="childList")for(const P of w.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&E(P)}).observe(document,{childList:!0,subtree:!0});function J(v){const w={};return v.integrity&&(w.integrity=v.integrity),v.referrerPolicy&&(w.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?w.credentials="include":v.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function E(v){if(v.ep)return;v.ep=!0;const w=J(v);fetch(v.href,w)}})();var Yt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hi(Oe){return Oe&&Oe.__esModule&&Object.prototype.hasOwnProperty.call(Oe,"default")?Oe.default:Oe}var Pr={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */Pr.exports;(function(Oe,Ne){(function(J,E){Oe.exports=E()})(self,()=>(()=>{var J={227:(P,m,p)=>{var d=p(155);m.formatArgs=function(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+P.exports.humanize(this.diff),!this.useColors)return;const F="color: "+this.color;l.splice(1,0,F,"color: inherit");let y=0,t=0;l[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(y++,n==="%c"&&(t=y))}),l.splice(t,0,F)},m.save=function(l){try{l?m.storage.setItem("debug",l):m.storage.removeItem("debug")}catch{}},m.load=function(){let l;try{l=m.storage.getItem("debug")}catch{}return!l&&d!==void 0&&"env"in d&&(l=d.env.DEBUG),l},m.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},m.storage=function(){try{return localStorage}catch{}}(),m.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],m.log=console.debug||console.log||(()=>{}),P.exports=p(447)(m);const{formatters:h}=P.exports;h.j=function(l){try{return JSON.stringify(l)}catch(F){return"[UnexpectedJSONParseError]: "+F.message}}},447:(P,m,p)=>{P.exports=function(d){function h(y){let t,n,i,o=null;function a(...c){if(!a.enabled)return;const u=a,g=Number(new Date),x=g-(t||g);u.diff=x,u.prev=t,u.curr=g,t=g,c[0]=h.coerce(c[0]),typeof c[0]!="string"&&c.unshift("%O");let f=0;c[0]=c[0].replace(/%([a-zA-Z%])/g,(O,L)=>{if(O==="%%")return"%";f++;const C=h.formatters[L];if(typeof C=="function"){const N=c[f];O=C.call(u,N),c.splice(f,1),f--}return O}),h.formatArgs.call(u,c),(u.log||h.log).apply(u,c)}return a.namespace=y,a.useColors=h.useColors(),a.color=h.selectColor(y),a.extend=l,a.destroy=h.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>o!==null?o:(n!==h.namespaces&&(n=h.namespaces,i=h.enabled(y)),i),set:c=>{o=c}}),typeof h.init=="function"&&h.init(a),a}function l(y,t){const n=h(this.namespace+(t===void 0?":":t)+y);return n.log=this.log,n}function F(y){return y.toString().substring(2,y.toString().length-2).replace(/\.\*\?$/,"*")}return h.debug=h,h.default=h,h.coerce=function(y){return y instanceof Error?y.stack||y.message:y},h.disable=function(){const y=[...h.names.map(F),...h.skips.map(F).map(t=>"-"+t)].join(",");return h.enable(""),y},h.enable=function(y){let t;h.save(y),h.namespaces=y,h.names=[],h.skips=[];const n=(typeof y=="string"?y:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&((y=n[t].replace(/\*/g,".*?"))[0]==="-"?h.skips.push(new RegExp("^"+y.slice(1)+"$")):h.names.push(new RegExp("^"+y+"$")))},h.enabled=function(y){if(y[y.length-1]==="*")return!0;let t,n;for(t=0,n=h.skips.length;t<n;t++)if(h.skips[t].test(y))return!1;for(t=0,n=h.names.length;t<n;t++)if(h.names[t].test(y))return!0;return!1},h.humanize=p(824),h.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(d).forEach(y=>{h[y]=d[y]}),h.names=[],h.skips=[],h.formatters={},h.selectColor=function(y){let t=0;for(let n=0;n<y.length;n++)t=(t<<5)-t+y.charCodeAt(n),t|=0;return h.colors[Math.abs(t)%h.colors.length]},h.enable(h.load()),h}},996:P=>{var m=function(i){return function(o){return!!o&&typeof o=="object"}(i)&&!function(o){var a=Object.prototype.toString.call(o);return a==="[object RegExp]"||a==="[object Date]"||function(c){return c.$$typeof===p}(o)}(i)},p=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function d(i,o){return o.clone!==!1&&o.isMergeableObject(i)?t((a=i,Array.isArray(a)?[]:{}),i,o):i;var a}function h(i,o,a){return i.concat(o).map(function(c){return d(c,a)})}function l(i){return Object.keys(i).concat(function(o){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(o).filter(function(a){return Object.propertyIsEnumerable.call(o,a)}):[]}(i))}function F(i,o){try{return o in i}catch{return!1}}function y(i,o,a){var c={};return a.isMergeableObject(i)&&l(i).forEach(function(u){c[u]=d(i[u],a)}),l(o).forEach(function(u){(function(g,x){return F(g,x)&&!(Object.hasOwnProperty.call(g,x)&&Object.propertyIsEnumerable.call(g,x))})(i,u)||(F(i,u)&&a.isMergeableObject(o[u])?c[u]=function(g,x){if(!x.customMerge)return t;var f=x.customMerge(g);return typeof f=="function"?f:t}(u,a)(i[u],o[u],a):c[u]=d(o[u],a))}),c}function t(i,o,a){(a=a||{}).arrayMerge=a.arrayMerge||h,a.isMergeableObject=a.isMergeableObject||m,a.cloneUnlessOtherwiseSpecified=d;var c=Array.isArray(o);return c===Array.isArray(i)?c?a.arrayMerge(i,o,a):y(i,o,a):d(o,a)}t.all=function(i,o){if(!Array.isArray(i))throw new Error("first argument should be an array");return i.reduce(function(a,c){return t(a,c,o)},{})};var n=t;P.exports=n},856:function(P){P.exports=function(){function m(q){return m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Z){return typeof Z}:function(Z){return Z&&typeof Symbol=="function"&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z},m(q)}function p(q,Z){return p=Object.setPrototypeOf||function(ie,de){return ie.__proto__=de,ie},p(q,Z)}function d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function h(q,Z,ie){return h=d()?Reflect.construct:function(de,Ce,We){var Qe=[null];Qe.push.apply(Qe,Ce);var lt=new(Function.bind.apply(de,Qe));return We&&p(lt,We.prototype),lt},h.apply(null,arguments)}function l(q){return F(q)||y(q)||t(q)||i()}function F(q){if(Array.isArray(q))return n(q)}function y(q){if(typeof Symbol<"u"&&q[Symbol.iterator]!=null||q["@@iterator"]!=null)return Array.from(q)}function t(q,Z){if(q){if(typeof q=="string")return n(q,Z);var ie=Object.prototype.toString.call(q).slice(8,-1);return ie==="Object"&&q.constructor&&(ie=q.constructor.name),ie==="Map"||ie==="Set"?Array.from(q):ie==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ie)?n(q,Z):void 0}}function n(q,Z){(Z==null||Z>q.length)&&(Z=q.length);for(var ie=0,de=new Array(Z);ie<Z;ie++)de[ie]=q[ie];return de}function i(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=Object.hasOwnProperty,a=Object.setPrototypeOf,c=Object.isFrozen,u=Object.getPrototypeOf,g=Object.getOwnPropertyDescriptor,x=Object.freeze,f=Object.seal,O=Object.create,L=typeof Reflect<"u"&&Reflect,C=L.apply,N=L.construct;C||(C=function(q,Z,ie){return q.apply(Z,ie)}),x||(x=function(q){return q}),f||(f=function(q){return q}),N||(N=function(q,Z){return h(q,l(Z))});var $=B(Array.prototype.forEach),Y=B(Array.prototype.pop),te=B(Array.prototype.push),M=B(String.prototype.toLowerCase),b=B(String.prototype.match),T=B(String.prototype.replace),I=B(String.prototype.indexOf),S=B(String.prototype.trim),D=B(RegExp.prototype.test),U=H(TypeError);function B(q){return function(Z){for(var ie=arguments.length,de=new Array(ie>1?ie-1:0),Ce=1;Ce<ie;Ce++)de[Ce-1]=arguments[Ce];return C(q,Z,de)}}function H(q){return function(){for(var Z=arguments.length,ie=new Array(Z),de=0;de<Z;de++)ie[de]=arguments[de];return N(q,ie)}}function V(q,Z){a&&a(q,null);for(var ie=Z.length;ie--;){var de=Z[ie];if(typeof de=="string"){var Ce=M(de);Ce!==de&&(c(Z)||(Z[ie]=Ce),de=Ce)}q[de]=!0}return q}function K(q){var Z,ie=O(null);for(Z in q)C(o,q,[Z])&&(ie[Z]=q[Z]);return ie}function re(q,Z){for(;q!==null;){var ie=g(q,Z);if(ie){if(ie.get)return B(ie.get);if(typeof ie.value=="function")return B(ie.value)}q=u(q)}function de(Ce){return console.warn("fallback value for",Ce),null}return de}var oe=x(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ce=x(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ue=x(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),xe=x(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),pe=x(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),me=x(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Se=x(["#text"]),we=x(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Re=x(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ve=x(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),he=x(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),se=f(/\{\{[\w\W]*|[\w\W]*\}\}/gm),_e=f(/<%[\w\W]*|[\w\W]*%>/gm),De=f(/^data-[\-\w.\u00B7-\uFFFF]/),Fe=f(/^aria-[\-\w]+$/),je=f(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ze=f(/^(?:\w+script|data):/i),Ze=f(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),st=f(/^html$/i),Ye=function(){return typeof window>"u"?null:window},xr=function(q,Z){if(m(q)!=="object"||typeof q.createPolicy!="function")return null;var ie=null,de="data-tt-policy-suffix";Z.currentScript&&Z.currentScript.hasAttribute(de)&&(ie=Z.currentScript.getAttribute(de));var Ce="dompurify"+(ie?"#"+ie:"");try{return q.createPolicy(Ce,{createHTML:function(We){return We}})}catch{return console.warn("TrustedTypes policy "+Ce+" could not be created."),null}};function Qt(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ye(),Z=function(k){return Qt(k)};if(Z.version="2.3.8",Z.removed=[],!q||!q.document||q.document.nodeType!==9)return Z.isSupported=!1,Z;var ie=q.document,de=q.document,Ce=q.DocumentFragment,We=q.HTMLTemplateElement,Qe=q.Node,lt=q.Element,Ut=q.NodeFilter,er=q.NamedNodeMap,nt=er===void 0?q.NamedNodeMap||q.MozNamedAttrMap:er,kr=q.HTMLFormElement,Sr=q.DOMParser,Tr=q.trustedTypes,Ft=lt.prototype,Or=re(Ft,"cloneNode"),Cr=re(Ft,"nextSibling"),Fr=re(Ft,"childNodes"),zt=re(Ft,"parentNode");if(typeof We=="function"){var qe=de.createElement("template");qe.content&&qe.content.ownerDocument&&(de=qe.content.ownerDocument)}var $e=xr(Tr,ie),tr=$e?$e.createHTML(""):"",Et=de,Vt=Et.implementation,ct=Et.createNodeIterator,rr=Et.createDocumentFragment,nr=Et.getElementsByTagName,Er=ie.importNode,ir={};try{ir=K(de).documentMode?de.documentMode:{}}catch{}var Be={};Z.isSupported=typeof zt=="function"&&Vt&&Vt.createHTMLDocument!==void 0&&ir!==9;var bt,et,At=se,Lt=_e,Bt=De,Ar=Fe,ar=ze,It=Ze,ye=je,Ee=null,or=V({},[].concat(l(oe),l(ce),l(ue),l(pe),l(Se))),Ae=null,ut=V({},[].concat(l(we),l(Re),l(ve),l(he))),ke=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),dt=null,Rt=null,Ht=!0,Wt=!0,sr=!1,ht=!1,it=!1,qt=!1,$t=!1,pt=!1,Mt=!1,ft=!1,lr=!0,Kt=!0,mt=!1,Ke={},vt=null,cr=V({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),ur=null,dr=V({},["audio","video","img","source","image","track"]),Gt=null,at=V({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),yt="http://www.w3.org/1998/Math/MathML",Xt="http://www.w3.org/2000/svg",tt="http://www.w3.org/1999/xhtml",Dt=tt,hr=!1,_t=["application/xhtml+xml","text/html"],wt="text/html",gt=null,Lr=de.createElement("form"),pr=function(k){return k instanceof RegExp||k instanceof Function},Jt=function(k){gt&&gt===k||(k&&m(k)==="object"||(k={}),k=K(k),Ee="ALLOWED_TAGS"in k?V({},k.ALLOWED_TAGS):or,Ae="ALLOWED_ATTR"in k?V({},k.ALLOWED_ATTR):ut,Gt="ADD_URI_SAFE_ATTR"in k?V(K(at),k.ADD_URI_SAFE_ATTR):at,ur="ADD_DATA_URI_TAGS"in k?V(K(dr),k.ADD_DATA_URI_TAGS):dr,vt="FORBID_CONTENTS"in k?V({},k.FORBID_CONTENTS):cr,dt="FORBID_TAGS"in k?V({},k.FORBID_TAGS):{},Rt="FORBID_ATTR"in k?V({},k.FORBID_ATTR):{},Ke="USE_PROFILES"in k&&k.USE_PROFILES,Ht=k.ALLOW_ARIA_ATTR!==!1,Wt=k.ALLOW_DATA_ATTR!==!1,sr=k.ALLOW_UNKNOWN_PROTOCOLS||!1,ht=k.SAFE_FOR_TEMPLATES||!1,it=k.WHOLE_DOCUMENT||!1,pt=k.RETURN_DOM||!1,Mt=k.RETURN_DOM_FRAGMENT||!1,ft=k.RETURN_TRUSTED_TYPE||!1,$t=k.FORCE_BODY||!1,lr=k.SANITIZE_DOM!==!1,Kt=k.KEEP_CONTENT!==!1,mt=k.IN_PLACE||!1,ye=k.ALLOWED_URI_REGEXP||ye,Dt=k.NAMESPACE||tt,k.CUSTOM_ELEMENT_HANDLING&&pr(k.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ke.tagNameCheck=k.CUSTOM_ELEMENT_HANDLING.tagNameCheck),k.CUSTOM_ELEMENT_HANDLING&&pr(k.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ke.attributeNameCheck=k.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),k.CUSTOM_ELEMENT_HANDLING&&typeof k.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ke.allowCustomizedBuiltInElements=k.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),bt=bt=_t.indexOf(k.PARSER_MEDIA_TYPE)===-1?wt:k.PARSER_MEDIA_TYPE,et=bt==="application/xhtml+xml"?function(X){return X}:M,ht&&(Wt=!1),Mt&&(pt=!0),Ke&&(Ee=V({},l(Se)),Ae=[],Ke.html===!0&&(V(Ee,oe),V(Ae,we)),Ke.svg===!0&&(V(Ee,ce),V(Ae,Re),V(Ae,he)),Ke.svgFilters===!0&&(V(Ee,ue),V(Ae,Re),V(Ae,he)),Ke.mathMl===!0&&(V(Ee,pe),V(Ae,ve),V(Ae,he))),k.ADD_TAGS&&(Ee===or&&(Ee=K(Ee)),V(Ee,k.ADD_TAGS)),k.ADD_ATTR&&(Ae===ut&&(Ae=K(Ae)),V(Ae,k.ADD_ATTR)),k.ADD_URI_SAFE_ATTR&&V(Gt,k.ADD_URI_SAFE_ATTR),k.FORBID_CONTENTS&&(vt===cr&&(vt=K(vt)),V(vt,k.FORBID_CONTENTS)),Kt&&(Ee["#text"]=!0),it&&V(Ee,["html","head","body"]),Ee.table&&(V(Ee,["tbody"]),delete dt.tbody),x&&x(k),gt=k)},fr=V({},["mi","mo","mn","ms","mtext"]),mr=V({},["foreignobject","desc","title","annotation-xml"]),Ir=V({},["title","style","font","a","script"]),Ge=V({},ce);V(Ge,ue),V(Ge,xe);var jt=V({},pe);V(jt,me);var Rr=function(k){var X=zt(k);X&&X.tagName||(X={namespaceURI:tt,tagName:"template"});var W=M(k.tagName),ge=M(X.tagName);return k.namespaceURI===Xt?X.namespaceURI===tt?W==="svg":X.namespaceURI===yt?W==="svg"&&(ge==="annotation-xml"||fr[ge]):!!Ge[W]:k.namespaceURI===yt?X.namespaceURI===tt?W==="math":X.namespaceURI===Xt?W==="math"&&mr[ge]:!!jt[W]:k.namespaceURI===tt&&!(X.namespaceURI===Xt&&!mr[ge])&&!(X.namespaceURI===yt&&!fr[ge])&&!jt[W]&&(Ir[W]||!Ge[W])},Xe=function(k){te(Z.removed,{element:k});try{k.parentNode.removeChild(k)}catch{try{k.outerHTML=tr}catch{k.remove()}}},Pt=function(k,X){try{te(Z.removed,{attribute:X.getAttributeNode(k),from:X})}catch{te(Z.removed,{attribute:null,from:X})}if(X.removeAttribute(k),k==="is"&&!Ae[k])if(pt||Mt)try{Xe(X)}catch{}else try{X.setAttribute(k,"")}catch{}},vr=function(k){var X,W;if($t)k="<remove></remove>"+k;else{var ge=b(k,/^[\r\n\t ]+/);W=ge&&ge[0]}bt==="application/xhtml+xml"&&(k='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+k+"</body></html>");var Te=$e?$e.createHTML(k):k;if(Dt===tt)try{X=new Sr().parseFromString(Te,bt)}catch{}if(!X||!X.documentElement){X=Vt.createDocument(Dt,"template",null);try{X.documentElement.innerHTML=hr?"":Te}catch{}}var Me=X.body||X.documentElement;return k&&W&&Me.insertBefore(de.createTextNode(W),Me.childNodes[0]||null),Dt===tt?nr.call(X,it?"html":"body")[0]:it?X.documentElement:Me},yr=function(k){return ct.call(k.ownerDocument||k,k,Ut.SHOW_ELEMENT|Ut.SHOW_COMMENT|Ut.SHOW_TEXT,null,!1)},Mr=function(k){return k instanceof kr&&(typeof k.nodeName!="string"||typeof k.textContent!="string"||typeof k.removeChild!="function"||!(k.attributes instanceof nt)||typeof k.removeAttribute!="function"||typeof k.setAttribute!="function"||typeof k.namespaceURI!="string"||typeof k.insertBefore!="function")},xt=function(k){return m(Qe)==="object"?k instanceof Qe:k&&m(k)==="object"&&typeof k.nodeType=="number"&&typeof k.nodeName=="string"},Ue=function(k,X,W){Be[k]&&$(Be[k],function(ge){ge.call(Z,X,W,gt)})},kt=function(k){var X;if(Ue("beforeSanitizeElements",k,null),Mr(k)||D(/[\u0080-\uFFFF]/,k.nodeName))return Xe(k),!0;var W=et(k.nodeName);if(Ue("uponSanitizeElement",k,{tagName:W,allowedTags:Ee}),k.hasChildNodes()&&!xt(k.firstElementChild)&&(!xt(k.content)||!xt(k.content.firstElementChild))&&D(/<[/\w]/g,k.innerHTML)&&D(/<[/\w]/g,k.textContent)||W==="select"&&D(/<template/i,k.innerHTML))return Xe(k),!0;if(!Ee[W]||dt[W]){if(!dt[W]&&ot(W)&&(ke.tagNameCheck instanceof RegExp&&D(ke.tagNameCheck,W)||ke.tagNameCheck instanceof Function&&ke.tagNameCheck(W)))return!1;if(Kt&&!vt[W]){var ge=zt(k)||k.parentNode,Te=Fr(k)||k.childNodes;if(Te&&ge)for(var Me=Te.length-1;Me>=0;--Me)ge.insertBefore(Or(Te[Me],!0),Cr(k))}return Xe(k),!0}return k instanceof lt&&!Rr(k)?(Xe(k),!0):W!=="noscript"&&W!=="noembed"||!D(/<\/no(script|embed)/i,k.innerHTML)?(ht&&k.nodeType===3&&(X=k.textContent,X=T(X,At," "),X=T(X,Lt," "),k.textContent!==X&&(te(Z.removed,{element:k.cloneNode()}),k.textContent=X)),Ue("afterSanitizeElements",k,null),!1):(Xe(k),!0)},gr=function(k,X,W){if(lr&&(X==="id"||X==="name")&&(W in de||W in Lr))return!1;if(!(Wt&&!Rt[X]&&D(Bt,X))){if(!(Ht&&D(Ar,X))){if(!Ae[X]||Rt[X]){if(!(ot(k)&&(ke.tagNameCheck instanceof RegExp&&D(ke.tagNameCheck,k)||ke.tagNameCheck instanceof Function&&ke.tagNameCheck(k))&&(ke.attributeNameCheck instanceof RegExp&&D(ke.attributeNameCheck,X)||ke.attributeNameCheck instanceof Function&&ke.attributeNameCheck(X))||X==="is"&&ke.allowCustomizedBuiltInElements&&(ke.tagNameCheck instanceof RegExp&&D(ke.tagNameCheck,W)||ke.tagNameCheck instanceof Function&&ke.tagNameCheck(W))))return!1}else if(!Gt[X]){if(!D(ye,T(W,It,""))){if((X!=="src"&&X!=="xlink:href"&&X!=="href"||k==="script"||I(W,"data:")!==0||!ur[k])&&!(sr&&!D(ar,T(W,It,"")))){if(W)return!1}}}}}return!0},ot=function(k){return k.indexOf("-")>0},St=function(k){var X,W,ge,Te;Ue("beforeSanitizeAttributes",k,null);var Me=k.attributes;if(Me){var Le={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ae};for(Te=Me.length;Te--;){var Tt=X=Me[Te],rt=Tt.name,Ve=Tt.namespaceURI;if(W=rt==="value"?X.value:S(X.value),ge=et(rt),Le.attrName=ge,Le.attrValue=W,Le.keepAttr=!0,Le.forceKeepAttr=void 0,Ue("uponSanitizeAttribute",k,Le),W=Le.attrValue,!Le.forceKeepAttr&&(Pt(rt,k),Le.keepAttr))if(D(/\/>/i,W))Pt(rt,k);else{ht&&(W=T(W,At," "),W=T(W,Lt," "));var Zt=et(k.nodeName);if(gr(Zt,ge,W))try{Ve?k.setAttributeNS(Ve,rt,W):k.setAttribute(rt,W),Y(Z.removed)}catch{}}}Ue("afterSanitizeAttributes",k,null)}},Dr=function k(X){var W,ge=yr(X);for(Ue("beforeSanitizeShadowDOM",X,null);W=ge.nextNode();)Ue("uponSanitizeShadowNode",W,null),kt(W)||(W.content instanceof Ce&&k(W.content),St(W));Ue("afterSanitizeShadowDOM",X,null)};return Z.sanitize=function(k,X){var W,ge,Te,Me,Le;if((hr=!k)&&(k="<!-->"),typeof k!="string"&&!xt(k)){if(typeof k.toString!="function")throw U("toString is not a function");if(typeof(k=k.toString())!="string")throw U("dirty is not a string, aborting")}if(!Z.isSupported){if(m(q.toStaticHTML)==="object"||typeof q.toStaticHTML=="function"){if(typeof k=="string")return q.toStaticHTML(k);if(xt(k))return q.toStaticHTML(k.outerHTML)}return k}if(qt||Jt(X),Z.removed=[],typeof k=="string"&&(mt=!1),mt){if(k.nodeName){var Tt=et(k.nodeName);if(!Ee[Tt]||dt[Tt])throw U("root node is forbidden and cannot be sanitized in-place")}}else if(k instanceof Qe)(ge=(W=vr("<!---->")).ownerDocument.importNode(k,!0)).nodeType===1&&ge.nodeName==="BODY"||ge.nodeName==="HTML"?W=ge:W.appendChild(ge);else{if(!pt&&!ht&&!it&&k.indexOf("<")===-1)return $e&&ft?$e.createHTML(k):k;if(!(W=vr(k)))return pt?null:ft?tr:""}W&&$t&&Xe(W.firstChild);for(var rt=yr(mt?k:W);Te=rt.nextNode();)Te.nodeType===3&&Te===Me||kt(Te)||(Te.content instanceof Ce&&Dr(Te.content),St(Te),Me=Te);if(Me=null,mt)return k;if(pt){if(Mt)for(Le=rr.call(W.ownerDocument);W.firstChild;)Le.appendChild(W.firstChild);else Le=W;return Ae.shadowroot&&(Le=Er.call(ie,Le,!0)),Le}var Ve=it?W.outerHTML:W.innerHTML;return it&&Ee["!doctype"]&&W.ownerDocument&&W.ownerDocument.doctype&&W.ownerDocument.doctype.name&&D(st,W.ownerDocument.doctype.name)&&(Ve="<!DOCTYPE "+W.ownerDocument.doctype.name+`>
`+Ve),ht&&(Ve=T(Ve,At," "),Ve=T(Ve,Lt," ")),$e&&ft?$e.createHTML(Ve):Ve},Z.setConfig=function(k){Jt(k),qt=!0},Z.clearConfig=function(){gt=null,qt=!1},Z.isValidAttribute=function(k,X,W){gt||Jt({});var ge=et(k),Te=et(X);return gr(ge,Te,W)},Z.addHook=function(k,X){typeof X=="function"&&(Be[k]=Be[k]||[],te(Be[k],X))},Z.removeHook=function(k){if(Be[k])return Y(Be[k])},Z.removeHooks=function(k){Be[k]&&(Be[k]=[])},Z.removeAllHooks=function(){Be={}},Z}return Qt()}()},729:P=>{var m=Object.prototype.hasOwnProperty,p="~";function d(){}function h(t,n,i){this.fn=t,this.context=n,this.once=i||!1}function l(t,n,i,o,a){if(typeof i!="function")throw new TypeError("The listener must be a function");var c=new h(i,o||t,a),u=p?p+n:n;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],c]:t._events[u].push(c):(t._events[u]=c,t._eventsCount++),t}function F(t,n){--t._eventsCount==0?t._events=new d:delete t._events[n]}function y(){this._events=new d,this._eventsCount=0}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(p=!1)),y.prototype.eventNames=function(){var t,n,i=[];if(this._eventsCount===0)return i;for(n in t=this._events)m.call(t,n)&&i.push(p?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},y.prototype.listeners=function(t){var n=p?p+t:t,i=this._events[n];if(!i)return[];if(i.fn)return[i.fn];for(var o=0,a=i.length,c=new Array(a);o<a;o++)c[o]=i[o].fn;return c},y.prototype.listenerCount=function(t){var n=p?p+t:t,i=this._events[n];return i?i.fn?1:i.length:0},y.prototype.emit=function(t,n,i,o,a,c){var u=p?p+t:t;if(!this._events[u])return!1;var g,x,f=this._events[u],O=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),O){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,n),!0;case 3:return f.fn.call(f.context,n,i),!0;case 4:return f.fn.call(f.context,n,i,o),!0;case 5:return f.fn.call(f.context,n,i,o,a),!0;case 6:return f.fn.call(f.context,n,i,o,a,c),!0}for(x=1,g=new Array(O-1);x<O;x++)g[x-1]=arguments[x];f.fn.apply(f.context,g)}else{var L,C=f.length;for(x=0;x<C;x++)switch(f[x].once&&this.removeListener(t,f[x].fn,void 0,!0),O){case 1:f[x].fn.call(f[x].context);break;case 2:f[x].fn.call(f[x].context,n);break;case 3:f[x].fn.call(f[x].context,n,i);break;case 4:f[x].fn.call(f[x].context,n,i,o);break;default:if(!g)for(L=1,g=new Array(O-1);L<O;L++)g[L-1]=arguments[L];f[x].fn.apply(f[x].context,g)}}return!0},y.prototype.on=function(t,n,i){return l(this,t,n,i,!1)},y.prototype.once=function(t,n,i){return l(this,t,n,i,!0)},y.prototype.removeListener=function(t,n,i,o){var a=p?p+t:t;if(!this._events[a])return this;if(!n)return F(this,a),this;var c=this._events[a];if(c.fn)c.fn!==n||o&&!c.once||i&&c.context!==i||F(this,a);else{for(var u=0,g=[],x=c.length;u<x;u++)(c[u].fn!==n||o&&!c[u].once||i&&c[u].context!==i)&&g.push(c[u]);g.length?this._events[a]=g.length===1?g[0]:g:F(this,a)}return this},y.prototype.removeAllListeners=function(t){var n;return t?(n=p?p+t:t,this._events[n]&&F(this,n)):(this._events=new d,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=p,y.EventEmitter=y,P.exports=y},717:P=>{typeof Object.create=="function"?P.exports=function(m,p){m.super_=p,m.prototype=Object.create(p.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}})}:P.exports=function(m,p){m.super_=p;var d=function(){};d.prototype=p.prototype,m.prototype=new d,m.prototype.constructor=m}},824:P=>{var m=1e3,p=60*m,d=60*p,h=24*d,l=7*h,F=365.25*h;function y(t,n,i,o){var a=n>=1.5*i;return Math.round(t/i)+" "+o+(a?"s":"")}P.exports=function(t,n){n=n||{};var i=typeof t;if(i==="string"&&t.length>0)return function(o){if(!((o=String(o)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(a){var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*F;case"weeks":case"week":case"w":return c*l;case"days":case"day":case"d":return c*h;case"hours":case"hour":case"hrs":case"hr":case"h":return c*d;case"minutes":case"minute":case"mins":case"min":case"m":return c*p;case"seconds":case"second":case"secs":case"sec":case"s":return c*m;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}(t);if(i==="number"&&isFinite(t))return n.long?function(o){var a=Math.abs(o);return a>=h?y(o,a,h,"day"):a>=d?y(o,a,d,"hour"):a>=p?y(o,a,p,"minute"):a>=m?y(o,a,m,"second"):o+" ms"}(t):function(o){var a=Math.abs(o);return a>=h?Math.round(o/h)+"d":a>=d?Math.round(o/d)+"h":a>=p?Math.round(o/p)+"m":a>=m?Math.round(o/m)+"s":o+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},520:(P,m,p)=>{var d=p(155),h=d.platform==="win32",l=p(539);function F(f,O){for(var L=[],C=0;C<f.length;C++){var N=f[C];N&&N!=="."&&(N===".."?L.length&&L[L.length-1]!==".."?L.pop():O&&L.push(".."):L.push(N))}return L}function y(f){for(var O=f.length-1,L=0;L<=O&&!f[L];L++);for(var C=O;C>=0&&!f[C];C--);return L===0&&C===O?f:L>C?[]:f.slice(L,C+1)}var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,n=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,i={};function o(f){var O=t.exec(f),L=(O[1]||"")+(O[2]||""),C=O[3]||"",N=n.exec(C);return[L,N[1],N[2],N[3]]}function a(f){var O=t.exec(f),L=O[1]||"",C=!!L&&L[1]!==":";return{device:L,isUnc:C,isAbsolute:C||!!O[2],tail:O[3]}}function c(f){return"\\\\"+f.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}i.resolve=function(){for(var f="",O="",L=!1,C=arguments.length-1;C>=-1;C--){var N;if(C>=0?N=arguments[C]:f?(N=d.env["="+f])&&N.substr(0,3).toLowerCase()===f.toLowerCase()+"\\"||(N=f+"\\"):N=d.cwd(),!l.isString(N))throw new TypeError("Arguments to path.resolve must be strings");if(N){var $=a(N),Y=$.device,te=$.isUnc,M=$.isAbsolute,b=$.tail;if((!Y||!f||Y.toLowerCase()===f.toLowerCase())&&(f||(f=Y),L||(O=b+"\\"+O,L=M),f&&L))break}}return te&&(f=c(f)),f+(L?"\\":"")+(O=F(O.split(/[\\\/]+/),!L).join("\\"))||"."},i.normalize=function(f){var O=a(f),L=O.device,C=O.isUnc,N=O.isAbsolute,$=O.tail,Y=/[\\\/]$/.test($);return($=F($.split(/[\\\/]+/),!N).join("\\"))||N||($="."),$&&Y&&($+="\\"),C&&(L=c(L)),L+(N?"\\":"")+$},i.isAbsolute=function(f){return a(f).isAbsolute},i.join=function(){for(var f=[],O=0;O<arguments.length;O++){var L=arguments[O];if(!l.isString(L))throw new TypeError("Arguments to path.join must be strings");L&&f.push(L)}var C=f.join("\\");return/^[\\\/]{2}[^\\\/]/.test(f[0])||(C=C.replace(/^[\\\/]{2,}/,"\\")),i.normalize(C)},i.relative=function(f,O){f=i.resolve(f),O=i.resolve(O);for(var L=f.toLowerCase(),C=O.toLowerCase(),N=y(O.split("\\")),$=y(L.split("\\")),Y=y(C.split("\\")),te=Math.min($.length,Y.length),M=te,b=0;b<te;b++)if($[b]!==Y[b]){M=b;break}if(M==0)return O;var T=[];for(b=M;b<$.length;b++)T.push("..");return(T=T.concat(N.slice(M))).join("\\")},i._makeLong=function(f){if(!l.isString(f))return f;if(!f)return"";var O=i.resolve(f);return/^[a-zA-Z]\:\\/.test(O)?"\\\\?\\"+O:/^\\\\[^?.]/.test(O)?"\\\\?\\UNC\\"+O.substring(2):f},i.dirname=function(f){var O=o(f),L=O[0],C=O[1];return L||C?(C&&(C=C.substr(0,C.length-1)),L+C):"."},i.basename=function(f,O){var L=o(f)[2];return O&&L.substr(-1*O.length)===O&&(L=L.substr(0,L.length-O.length)),L},i.extname=function(f){return o(f)[3]},i.format=function(f){if(!l.isObject(f))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof f);var O=f.root||"";if(!l.isString(O))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof f.root);var L=f.dir,C=f.base||"";return L?L[L.length-1]===i.sep?L+C:L+i.sep+C:C},i.parse=function(f){if(!l.isString(f))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof f);var O=o(f);if(!O||O.length!==4)throw new TypeError("Invalid path '"+f+"'");return{root:O[0],dir:O[0]+O[1].slice(0,-1),base:O[2],ext:O[3],name:O[2].slice(0,O[2].length-O[3].length)}},i.sep="\\",i.delimiter=";";var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,g={};function x(f){return u.exec(f).slice(1)}g.resolve=function(){for(var f="",O=!1,L=arguments.length-1;L>=-1&&!O;L--){var C=L>=0?arguments[L]:d.cwd();if(!l.isString(C))throw new TypeError("Arguments to path.resolve must be strings");C&&(f=C+"/"+f,O=C[0]==="/")}return(O?"/":"")+(f=F(f.split("/"),!O).join("/"))||"."},g.normalize=function(f){var O=g.isAbsolute(f),L=f&&f[f.length-1]==="/";return(f=F(f.split("/"),!O).join("/"))||O||(f="."),f&&L&&(f+="/"),(O?"/":"")+f},g.isAbsolute=function(f){return f.charAt(0)==="/"},g.join=function(){for(var f="",O=0;O<arguments.length;O++){var L=arguments[O];if(!l.isString(L))throw new TypeError("Arguments to path.join must be strings");L&&(f+=f?"/"+L:L)}return g.normalize(f)},g.relative=function(f,O){f=g.resolve(f).substr(1),O=g.resolve(O).substr(1);for(var L=y(f.split("/")),C=y(O.split("/")),N=Math.min(L.length,C.length),$=N,Y=0;Y<N;Y++)if(L[Y]!==C[Y]){$=Y;break}var te=[];for(Y=$;Y<L.length;Y++)te.push("..");return(te=te.concat(C.slice($))).join("/")},g._makeLong=function(f){return f},g.dirname=function(f){var O=x(f),L=O[0],C=O[1];return L||C?(C&&(C=C.substr(0,C.length-1)),L+C):"."},g.basename=function(f,O){var L=x(f)[2];return O&&L.substr(-1*O.length)===O&&(L=L.substr(0,L.length-O.length)),L},g.extname=function(f){return x(f)[3]},g.format=function(f){if(!l.isObject(f))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof f);var O=f.root||"";if(!l.isString(O))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof f.root);return(f.dir?f.dir+g.sep:"")+(f.base||"")},g.parse=function(f){if(!l.isString(f))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof f);var O=x(f);if(!O||O.length!==4)throw new TypeError("Invalid path '"+f+"'");return O[1]=O[1]||"",O[2]=O[2]||"",O[3]=O[3]||"",{root:O[0],dir:O[0]+O[1].slice(0,-1),base:O[2],ext:O[3],name:O[2].slice(0,O[2].length-O[3].length)}},g.sep="/",g.delimiter=":",P.exports=h?i:g,P.exports.posix=g,P.exports.win32=i},155:P=>{var m,p,d=P.exports={};function h(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function F(g){if(m===setTimeout)return setTimeout(g,0);if((m===h||!m)&&setTimeout)return m=setTimeout,setTimeout(g,0);try{return m(g,0)}catch{try{return m.call(null,g,0)}catch{return m.call(this,g,0)}}}(function(){try{m=typeof setTimeout=="function"?setTimeout:h}catch{m=h}try{p=typeof clearTimeout=="function"?clearTimeout:l}catch{p=l}})();var y,t=[],n=!1,i=-1;function o(){n&&y&&(n=!1,y.length?t=y.concat(t):i=-1,t.length&&a())}function a(){if(!n){var g=F(o);n=!0;for(var x=t.length;x;){for(y=t,t=[];++i<x;)y&&y[i].run();i=-1,x=t.length}y=null,n=!1,function(f){if(p===clearTimeout)return clearTimeout(f);if((p===l||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(f);try{p(f)}catch{try{return p.call(null,f)}catch{return p.call(this,f)}}}(g)}}function c(g,x){this.fun=g,this.array=x}function u(){}d.nextTick=function(g){var x=new Array(arguments.length-1);if(arguments.length>1)for(var f=1;f<arguments.length;f++)x[f-1]=arguments[f];t.push(new c(g,x)),t.length!==1||n||F(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(g){return[]},d.binding=function(g){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(g){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},384:P=>{P.exports=function(m){return m&&typeof m=="object"&&typeof m.copy=="function"&&typeof m.fill=="function"&&typeof m.readUInt8=="function"}},539:(P,m,p)=>{var d=p(155),h=/%[sdj%]/g;m.format=function(S){if(!f(S)){for(var D=[],U=0;U<arguments.length;U++)D.push(y(arguments[U]));return D.join(" ")}U=1;for(var B=arguments,H=B.length,V=String(S).replace(h,function(re){if(re==="%%")return"%";if(U>=H)return re;switch(re){case"%s":return String(B[U++]);case"%d":return Number(B[U++]);case"%j":try{return JSON.stringify(B[U++])}catch{return"[Circular]"}default:return re}}),K=B[U];U<H;K=B[++U])g(K)||!C(K)?V+=" "+K:V+=" "+y(K);return V},m.deprecate=function(S,D){if(O(p.g.process))return function(){return m.deprecate(S,D).apply(this,arguments)};if(d.noDeprecation===!0)return S;var U=!1;return function(){if(!U){if(d.throwDeprecation)throw new Error(D);d.traceDeprecation?console.trace(D):console.error(D),U=!0}return S.apply(this,arguments)}};var l,F={};function y(S,D){var U={seen:[],stylize:n};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),u(D)?U.showHidden=D:D&&m._extend(U,D),O(U.showHidden)&&(U.showHidden=!1),O(U.depth)&&(U.depth=2),O(U.colors)&&(U.colors=!1),O(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=t),i(U,S,U.depth)}function t(S,D){var U=y.styles[D];return U?"\x1B["+y.colors[U][0]+"m"+S+"\x1B["+y.colors[U][1]+"m":S}function n(S,D){return S}function i(S,D,U){if(S.customInspect&&D&&Y(D.inspect)&&D.inspect!==m.inspect&&(!D.constructor||D.constructor.prototype!==D)){var B=D.inspect(U,S);return f(B)||(B=i(S,B,U)),B}var H=function(pe,me){if(O(me))return pe.stylize("undefined","undefined");if(f(me)){var Se="'"+JSON.stringify(me).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return pe.stylize(Se,"string")}if(x(me))return pe.stylize(""+me,"number");if(u(me))return pe.stylize(""+me,"boolean");if(g(me))return pe.stylize("null","null")}(S,D);if(H)return H;var V=Object.keys(D),K=function(pe){var me={};return pe.forEach(function(Se,we){me[Se]=!0}),me}(V);if(S.showHidden&&(V=Object.getOwnPropertyNames(D)),$(D)&&(V.indexOf("message")>=0||V.indexOf("description")>=0))return o(D);if(V.length===0){if(Y(D)){var re=D.name?": "+D.name:"";return S.stylize("[Function"+re+"]","special")}if(L(D))return S.stylize(RegExp.prototype.toString.call(D),"regexp");if(N(D))return S.stylize(Date.prototype.toString.call(D),"date");if($(D))return o(D)}var oe,ce="",ue=!1,xe=["{","}"];return c(D)&&(ue=!0,xe=["[","]"]),Y(D)&&(ce=" [Function"+(D.name?": "+D.name:"")+"]"),L(D)&&(ce=" "+RegExp.prototype.toString.call(D)),N(D)&&(ce=" "+Date.prototype.toUTCString.call(D)),$(D)&&(ce=" "+o(D)),V.length!==0||ue&&D.length!=0?U<0?L(D)?S.stylize(RegExp.prototype.toString.call(D),"regexp"):S.stylize("[Object]","special"):(S.seen.push(D),oe=ue?function(pe,me,Se,we,Re){for(var ve=[],he=0,se=me.length;he<se;++he)I(me,String(he))?ve.push(a(pe,me,Se,we,String(he),!0)):ve.push("");return Re.forEach(function(_e){_e.match(/^\d+$/)||ve.push(a(pe,me,Se,we,_e,!0))}),ve}(S,D,U,K,V):V.map(function(pe){return a(S,D,U,K,pe,ue)}),S.seen.pop(),function(pe,me,Se){return pe.reduce(function(we,Re){return Re.indexOf(`
`)>=0,we+Re.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?Se[0]+(me===""?"":me+`
 `)+" "+pe.join(`,
  `)+" "+Se[1]:Se[0]+me+" "+pe.join(", ")+" "+Se[1]}(oe,ce,xe)):xe[0]+ce+xe[1]}function o(S){return"["+Error.prototype.toString.call(S)+"]"}function a(S,D,U,B,H,V){var K,re,oe;if((oe=Object.getOwnPropertyDescriptor(D,H)||{value:D[H]}).get?re=oe.set?S.stylize("[Getter/Setter]","special"):S.stylize("[Getter]","special"):oe.set&&(re=S.stylize("[Setter]","special")),I(B,H)||(K="["+H+"]"),re||(S.seen.indexOf(oe.value)<0?(re=g(U)?i(S,oe.value,null):i(S,oe.value,U-1)).indexOf(`
`)>-1&&(re=V?re.split(`
`).map(function(ce){return"  "+ce}).join(`
`).substr(2):`
`+re.split(`
`).map(function(ce){return"   "+ce}).join(`
`)):re=S.stylize("[Circular]","special")),O(K)){if(V&&H.match(/^\d+$/))return re;(K=JSON.stringify(""+H)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(K=K.substr(1,K.length-2),K=S.stylize(K,"name")):(K=K.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),K=S.stylize(K,"string"))}return K+": "+re}function c(S){return Array.isArray(S)}function u(S){return typeof S=="boolean"}function g(S){return S===null}function x(S){return typeof S=="number"}function f(S){return typeof S=="string"}function O(S){return S===void 0}function L(S){return C(S)&&te(S)==="[object RegExp]"}function C(S){return typeof S=="object"&&S!==null}function N(S){return C(S)&&te(S)==="[object Date]"}function $(S){return C(S)&&(te(S)==="[object Error]"||S instanceof Error)}function Y(S){return typeof S=="function"}function te(S){return Object.prototype.toString.call(S)}function M(S){return S<10?"0"+S.toString(10):S.toString(10)}m.debuglog=function(S){if(O(l)&&(l=d.env.NODE_DEBUG||""),S=S.toUpperCase(),!F[S])if(new RegExp("\\b"+S+"\\b","i").test(l)){var D=d.pid;F[S]=function(){var U=m.format.apply(m,arguments);console.error("%s %d: %s",S,D,U)}}else F[S]=function(){};return F[S]},m.inspect=y,y.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},y.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},m.isArray=c,m.isBoolean=u,m.isNull=g,m.isNullOrUndefined=function(S){return S==null},m.isNumber=x,m.isString=f,m.isSymbol=function(S){return typeof S=="symbol"},m.isUndefined=O,m.isRegExp=L,m.isObject=C,m.isDate=N,m.isError=$,m.isFunction=Y,m.isPrimitive=function(S){return S===null||typeof S=="boolean"||typeof S=="number"||typeof S=="string"||typeof S=="symbol"||S===void 0},m.isBuffer=p(384);var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var S=new Date,D=[M(S.getHours()),M(S.getMinutes()),M(S.getSeconds())].join(":");return[S.getDate(),b[S.getMonth()],D].join(" ")}function I(S,D){return Object.prototype.hasOwnProperty.call(S,D)}m.log=function(){console.log("%s - %s",T(),m.format.apply(m,arguments))},m.inherits=p(717),m._extend=function(S,D){if(!D||!C(D))return S;for(var U=Object.keys(D),B=U.length;B--;)S[U[B]]=D[U[B]];return S}}},E={};function v(P){var m=E[P];if(m!==void 0)return m.exports;var p=E[P]={exports:{}};return J[P].call(p.exports,p,p.exports,v),p.exports}v.n=P=>{var m=P&&P.__esModule?()=>P.default:()=>P;return v.d(m,{a:m}),m},v.d=(P,m)=>{for(var p in m)v.o(m,p)&&!v.o(P,p)&&Object.defineProperty(P,p,{enumerable:!0,get:m[p]})},v.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),v.o=(P,m)=>Object.prototype.hasOwnProperty.call(P,m),v.r=P=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})};var w={};return(()=>{v.r(w),v.d(w,{LSPluginUser:()=>Wr,setupPluginUserInstance:()=>vn});var P=v(520),m=(v(856),v(996)),p=v.n(m),d=function(){return d=Object.assign||function(r){for(var e,s=1,_=arguments.length;s<_;s++)for(var A in e=arguments[s])Object.prototype.hasOwnProperty.call(e,A)&&(r[A]=e[A]);return r},d.apply(this,arguments)};function h(r){return r.toLowerCase()}var l=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],F=/[^A-Z0-9]+/gi;function y(r,e,s){return e instanceof RegExp?r.replace(e,s):e.reduce(function(_,A){return _.replace(A,s)},r)}function t(r,e){return e===void 0&&(e={}),function(s,_){_===void 0&&(_={});for(var A=_.splitRegexp,R=A===void 0?l:A,j=_.stripRegexp,z=j===void 0?F:j,G=_.transform,ee=G===void 0?h:G,ne=_.delimiter,Q=ne===void 0?" ":ne,ae=y(y(s,R,"$1\0$2"),z,"\0"),fe=0,le=ae.length;ae.charAt(fe)==="\0";)fe++;for(;ae.charAt(le-1)==="\0";)le--;return ae.slice(fe,le).split("\0").map(ee).join(Q)}(r,d({delimiter:"."},e))}var n=v(729),i=v.n(n);function o(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const a=navigator.platform.toLowerCase()==="win32"?P.win32:P.posix,c=function(r,e){return e===void 0&&(e={}),t(r,d({delimiter:"_"},e))};class u extends i(){constructor(e,s){super(),o(this,"_tag",void 0),o(this,"_opts",void 0),o(this,"_logs",[]),this._tag=e,this._opts=s}write(e,s,_){var A;s!=null&&s.length&&s[s.length-1]===!0&&(_=!0,s.pop());const R=s.reduce((z,G)=>(G&&G instanceof Error?z+=`${G.message} ${G.stack}`:z+=G.toString(),z),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var j;this._logs.push([e,R]),(_||(A=this._opts)!==null&&A!==void 0&&A.console)&&((j=console)===null||j===void 0||j[e==="ERROR"?"error":"debug"](`${e}: ${R}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...e){this.write("INFO",e)}error(...e){this.write("ERROR",e)}warn(...e){this.write("WARN",e)}setTag(e){this._tag=e}toJSON(){return this._logs}}function g(r,...e){try{const s=new URL(r);if(!s.origin)throw new Error(null);const _=a.join(r.substr(s.origin.length),...e);return s.origin+_}catch{return a.join(r,...e)}}function x(r,e){let s,_,A=!1;const R=z=>G=>{r&&clearTimeout(r),z(G),A=!0},j=new Promise((z,G)=>{s=R(z),_=R(G),r&&(r=setTimeout(()=>_(new Error(`[deferred timeout] ${e}`)),r))});return{created:Date.now(),setTag:z=>e=z,resolve:s,reject:_,promise:j,get settled(){return A}}}const f=new Map;window.__injectedUIEffects=f;var O=v(227),L=v.n(O);function C(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const N="application/x-postmate-v1+json";let $=0;const Y={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},te=(r,e)=>(typeof e!="string"||r.origin===e)&&!!r.data&&(typeof r.data!="object"||"postmate"in r.data)&&r.data.type===N&&!!Y[r.data.postmate];class M{constructor(e){C(this,"parent",void 0),C(this,"frame",void 0),C(this,"child",void 0),C(this,"events",{}),C(this,"childOrigin",void 0),C(this,"listener",void 0),this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.listener=s=>{if(!te(s,this.childOrigin))return!1;const{data:_,name:A}=((s||{}).data||{}).value||{};s.data.postmate==="emit"&&A in this.events&&this.events[A].forEach(R=>{R.call(this,_)})},this.parent.addEventListener("message",this.listener,!1)}get(e,...s){return new Promise((_,A)=>{const R=++$,j=z=>{z.data.uid===R&&z.data.postmate==="reply"&&(this.parent.removeEventListener("message",j,!1),z.data.error?A(z.data.error):_(z.data.value))};this.parent.addEventListener("message",j,!1),this.child.postMessage({postmate:"request",type:N,property:e,args:s,uid:R},this.childOrigin)})}call(e,s){this.child.postMessage({postmate:"call",type:N,property:e,data:s},this.childOrigin)}on(e,s){this.events[e]||(this.events[e]=[]),this.events[e].push(s)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class b{constructor(e){C(this,"model",void 0),C(this,"parent",void 0),C(this,"parentOrigin",void 0),C(this,"child",void 0),this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",s=>{if(!te(s,this.parentOrigin))return;const{property:_,uid:A,data:R,args:j}=s.data;s.data.postmate!=="call"?((z,G,ee)=>{const ne=typeof z[G]=="function"?z[G].apply(null,ee):z[G];return Promise.resolve(ne)})(this.model,_,j).then(z=>{s.source.postMessage({property:_,postmate:"reply",type:N,uid:A,value:z},s.origin)}).catch(z=>{s.source.postMessage({property:_,postmate:"reply",type:N,uid:A,error:z},s.origin)}):_ in this.model&&typeof this.model[_]=="function"&&this.model[_](R)})}emit(e,s){this.parent.postMessage({postmate:"emit",type:N,value:{name:e,data:s}},this.parentOrigin)}}class T{constructor(e){C(this,"container",void 0),C(this,"parent",void 0),C(this,"frame",void 0),C(this,"child",void 0),C(this,"childOrigin",void 0),C(this,"url",void 0),C(this,"model",void 0),this.container=e.container,this.url=e.url,this.parent=window,this.frame=document.createElement("iframe"),e.id&&(this.frame.id=e.id),e.name&&(this.frame.name=e.name),this.frame.classList.add.apply(this.frame.classList,e.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=e.model||{}}sendHandshake(e){const s=(R=>{const j=document.createElement("a");j.href=R;const z=j.protocol.length>4?j.protocol:window.location.protocol,G=j.host.length?j.port==="80"||j.port==="443"?j.hostname:j.host:window.location.host;return j.origin||`${z}//${G}`})(e=e||this.url);let _,A=0;return new Promise((R,j)=>{const z=ee=>!!te(ee,s)&&(ee.data.postmate==="handshake-reply"?(clearInterval(_),this.parent.removeEventListener("message",z,!1),this.childOrigin=ee.origin,R(new M(this))):j("Failed handshake"));this.parent.addEventListener("message",z,!1);const G=()=>{A++,this.child.postMessage({postmate:"handshake",type:N,model:this.model},s),A===5&&clearInterval(_)};this.frame.addEventListener("load",()=>{G(),_=setInterval(G,500)}),this.frame.src=e})}destroy(){this.frame.parentNode.removeChild(this.frame)}}C(T,"debug",!1),C(T,"Model",void 0);class I{constructor(e){C(this,"child",void 0),C(this,"model",void 0),C(this,"parent",void 0),C(this,"parentOrigin",void 0),this.child=window,this.model=e,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((e,s)=>{const _=A=>{if(A.data.postmate){if(A.data.postmate==="handshake"){this.child.removeEventListener("message",_,!1),A.source.postMessage({postmate:"handshake-reply",type:N},A.origin),this.parentOrigin=A.origin;const R=A.data.model;return R&&Object.keys(R).forEach(j=>{this.model[j]=R[j]}),e(new b(this))}return s("Handshake Reply Failed")}};this.child.addEventListener("message",_,!1)})}}function S(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const{importHTML:D,createSandboxContainer:U}=window.QSandbox||{};function B(r,e){return r.startsWith("http")?fetch(r,e):(r=r.replace("file://",""),new Promise(async(s,_)=>{try{const A=await window.apis.doAction(["readFile",r]);s({text:()=>A})}catch(A){console.error(A),_(A)}}))}class H extends i(){constructor(e){super(),S(this,"_pluginLocal",void 0),S(this,"_frame",void 0),S(this,"_root",void 0),S(this,"_loaded",!1),S(this,"_unmountFns",[]),this._pluginLocal=e,e._dispose(()=>{this._unmount()})}async load(){const{name:e,entry:s}=this._pluginLocal.options;if(this.loaded||!s)return;const{template:_,execScripts:A}=await D(s,{fetch:B});this._mount(_,document.body);const R=U(e,{elementGetter:()=>{var z;return(z=this._root)===null||z===void 0?void 0:z.firstChild}}).instance.proxy;R.__shadow_mode__=!0,R.LSPluginLocal=this._pluginLocal,R.LSPluginShadow=this,R.LSPluginUser=R.logseq=new Wr(this._pluginLocal.toJSON(),this._pluginLocal.caller);const j=await A(R,!0);this._unmountFns.push(j.unmount),this._loaded=!0}_mount(e,s){const _=this._frame=document.createElement("div");_.classList.add("lsp-shadow-sandbox"),_.id=this._pluginLocal.id,this._root=_.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${e}</div>`,s.appendChild(_),this.emit("mounted")}_unmount(){for(const e of this._unmountFns)e&&e.call(null)}destroy(){var e,s;(e=this.frame)===null||e===void 0||(s=e.parentNode)===null||s===void 0||s.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var e;return(e=this._root)===null||e===void 0?void 0:e.firstChild}get frame(){return this._frame}}function V(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const K=L()("LSPlugin:caller"),re="#await#response#",oe="#lspmsg#",ce="#lspmsg#error#",ue=r=>`#lspmsg#${r}`;class xe extends i(){constructor(e){super(),V(this,"_pluginLocal",void 0),V(this,"_connected",!1),V(this,"_parent",void 0),V(this,"_child",void 0),V(this,"_shadow",void 0),V(this,"_status",void 0),V(this,"_userModel",{}),V(this,"_call",void 0),V(this,"_callUserModel",void 0),V(this,"_debugTag",""),this._pluginLocal=e,e&&(this._debugTag=e.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:e}=this._pluginLocal;e?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(e={}){if(this._connected)return;const s=this,_=this._pluginLocal!=null;let A=0;const R=new Map,j=x(6e4),z=this._extendUserModel({"#lspmsg#ready#":async ne=>{z[ue(ne?.pid)]=({type:Q,payload:ae})=>{K(`[host (_call) -> *user] ${this._debugTag}`,Q,ae),s.emit(Q,ae)},await j.resolve()},"#lspmsg#beforeunload#":async ne=>{const Q=x(1e4);s.emit("beforeunload",Object.assign({actor:Q},ne)),await Q.promise},"#lspmsg#settings#":async({type:ne,payload:Q})=>{s.emit("settings:changed",Q)},[oe]:async({ns:ne,type:Q,payload:ae})=>{K(`[host (async) -> *user] ${this._debugTag} ns=${ne} type=${Q}`,ae),ne&&ne.startsWith("hook")?s.emit(`${ne}:${Q}`,ae):s.emit(Q,ae)},"#lspmsg#reply#":({_sync:ne,result:Q})=>{if(K(`[sync host -> *user] #${ne}`,Q),R.has(ne)){const ae=R.get(ne);ae&&(Q!=null&&Q.hasOwnProperty(ce)?ae.reject(Q[ce]):ae.resolve(Q),R.delete(ne))}},...e});var G;if(_)return await j.promise,JSON.parse(JSON.stringify((G=this._pluginLocal)===null||G===void 0?void 0:G.toJSON()));const ee=new I(z).sendHandshakeReply();return this._status="pending",await ee.then(ne=>{this._child=ne,this._connected=!0,this._call=async(Q,ae={},fe)=>{if(fe){const le=++A;R.set(le,fe),ae._sync=le,fe.setTag(`async call #${le}`),K(`async call #${le}`)}return ne.emit(ue(z.baseInfo.id),{type:Q,payload:ae}),fe?.promise},this._callUserModel=async(Q,ae)=>{try{z[Q](ae)}catch{K(`[model method] #${Q} not existed`)}},setInterval(()=>{if(R.size>100)for(const[Q,ae]of R)ae.settled&&R.delete(Q)},18e5)}).finally(()=>{this._status=void 0}),await j.promise,z.baseInfo}async call(e,s={}){var _;return(_=this._call)===null||_===void 0?void 0:_.call(this,e,s)}async callAsync(e,s={}){var _;const A=x(1e4);return(_=this._call)===null||_===void 0?void 0:_.call(this,e,s,A)}async callUserModel(e,...s){var _;return(_=this._callUserModel)===null||_===void 0?void 0:_.apply(this,[e,...s])}async callUserModelAsync(e,...s){var _;return e=`${re}${e}`,(_=this._callUserModel)===null||_===void 0?void 0:_.apply(this,[e,...s])}async _setupIframeSandbox(){const e=this._pluginLocal,s=e.id,_=`${s}_lsp_main`,A=new URL(e.options.entry);A.searchParams.set("__v__",e.options.version);const R=document.querySelector(`#${_}`);R&&R.parentElement.removeChild(R);const j=document.createElement("div");j.classList.add("lsp-iframe-sandbox-container"),j.id=_,j.dataset.pid=s;try{var z;const Q=(z=await this._pluginLocal._loadLayoutsData())===null||z===void 0?void 0:z.$$0;if(Q){j.dataset.inited_layout="true";let{width:ae,height:fe,left:le,top:be,vw:Pe,vh:Ie}=Q;le=Math.max(le,0),le=typeof Pe=="number"?`${Math.min(100*le/Pe,99)}%`:`${le}px`,be=Math.max(be,45),be=typeof Ie=="number"?`${Math.min(100*be/Ie,99)}%`:`${be}px`,Object.assign(j.style,{width:ae+"px",height:fe+"px",left:le,top:be})}}catch(Q){console.error("[Restore Layout Error]",Q)}document.body.appendChild(j);const G=new T({id:s+"_iframe",container:j,url:A.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(e.toJSON()))}});let ee,ne=G.sendHandshake();return this._status="pending",new Promise((Q,ae)=>{ee=setTimeout(()=>{ae(new Error("handshake Timeout")),G.destroy()},4e3),ne.then(fe=>{this._parent=fe,this._connected=!0,this.emit("connected"),fe.on(ue(e.id),({type:le,payload:be})=>{var Pe,Ie;K("[user -> *host] ",le,be),(Pe=this._pluginLocal)===null||Pe===void 0||Pe.emit(le,be||{}),(Ie=this._pluginLocal)===null||Ie===void 0||Ie.caller.emit(le,be||{})}),this._call=async(...le)=>{await fe.call(ue(e.id),{type:le[0],payload:Object.assign(le[1]||{},{$$pid:e.id})})},this._callUserModel=async(le,...be)=>{if(le.startsWith(re))return await fe.get(le.replace(re,""),...be);fe.call(le,be?.[0])},Q(null)}).catch(fe=>{ae(fe)}).finally(()=>{clearTimeout(ee)})}).catch(Q=>{throw K("[iframe sandbox] error",Q),Q}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const e=this._pluginLocal,s=this._shadow=new H(e);try{this._status="pending",await s.load(),this._connected=!0,this.emit("connected"),this._call=async(_,A={},R)=>{var j;return R&&(A.actor=R),(j=this._pluginLocal)===null||j===void 0||j.emit(_,Object.assign(A,{$$pid:e.id})),R?.promise},this._callUserModel=async(..._)=>{var A;let R=_[0];(A=R)!==null&&A!==void 0&&A.startsWith(re)&&(R=R.replace(re,""));const j=_[1]||{},z=this._userModel[R];typeof z=="function"&&await z.call(null,j)}}catch(_){throw K("[shadow sandbox] error",_),_}finally{this._status=void 0}}_extendUserModel(e){return Object.assign(this._userModel,e)}_getSandboxIframeContainer(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxShadowContainer(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxIframeRoot(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame}_getSandboxShadowRoot(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame}set debugTag(e){this._debugTag=e}async destroy(){var e;let s=null;this._parent&&(s=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(s=this._getSandboxShadowContainer(),this._shadow.destroy()),(e=s)===null||e===void 0||e.parentNode.removeChild(s)}}function pe(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}class me{constructor(e,s){pe(this,"ctx",void 0),pe(this,"opts",void 0),this.ctx=e,this.opts=s}get ctxId(){return this.ctx.baseInfo.id}setItem(e,s){var _;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,e,s,(_=this.opts)===null||_===void 0?void 0:_.assets]})}getItem(e){var s;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,e,(s=this.opts)===null||s===void 0?void 0:s.assets]})}removeItem(e){var s;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,e,(s=this.opts)===null||s===void 0?void 0:s.assets]})}allKeys(){var e;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}clear(){var e;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}hasItem(e){var s;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,e,(s=this.opts)===null||s===void 0?void 0:s.assets]})}}class Se{constructor(e){var s,_,A;A=void 0,(_="ctx")in(s=this)?Object.defineProperty(s,_,{value:A,enumerable:!0,configurable:!0,writable:!0}):s[_]=A,this.ctx=e}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(e,...s){var _,A;const R=this.ensureHostScope();return e=(_=c(e))===null||_===void 0?void 0:_.toLowerCase(),(A=R.logseq.api["exper_"+e])===null||A===void 0?void 0:A.apply(R,s)}async loadScripts(...e){(e=e.map(s=>s!=null&&s.startsWith("http")?s:this.ctx.resolveResourceFullUrl(s))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...e)}registerFencedCodeRenderer(e,s){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,e,s)}registerExtensionsEnhancer(e,s){const _=this.ensureHostScope();return e==="katex"&&_.katex&&s(_.katex).catch(console.error),_.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,e,s)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function we(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const Re=r=>`task_callback_${r}`;class ve{constructor(e,s,_={}){we(this,"_client",void 0),we(this,"_requestId",void 0),we(this,"_requestOptions",void 0),we(this,"_promise",void 0),we(this,"_aborted",!1),this._client=e,this._requestId=s,this._requestOptions=_,this._promise=new Promise((z,G)=>{if(!this._requestId)return G(null);this._client.once(Re(this._requestId),ee=>{ee&&ee instanceof Error?G(ee):z(ee)})});const{success:A,fail:R,final:j}=this._requestOptions;this._promise.then(z=>{A?.(z)}).catch(z=>{R?.(z)}).finally(()=>{j?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class he extends n.EventEmitter{constructor(e){super(),we(this,"_ctx",void 0),this._ctx=e,this.ctx.caller.on("#lsp#request#callback",s=>{const _=s?.requestId;_&&this.emit(Re(_),s?.payload)})}static createRequestTask(e,s,_){return new ve(e,s,_)}async _request(e){const s=this.ctx.baseInfo.id,{success:_,fail:A,final:R,...j}=e,z=this.ctx.Experiments.invokeExperMethod("request",s,j),G=he.createRequestTask(this.ctx.Request,z,e);return j.abortable?G:G.promise}get ctx(){return this._ctx}}const se=Array.isArray,_e=typeof Yt=="object"&&Yt&&Yt.Object===Object&&Yt;var De=typeof self=="object"&&self&&self.Object===Object&&self;const Fe=_e||De||Function("return this")(),je=Fe.Symbol;var ze=Object.prototype,Ze=ze.hasOwnProperty,st=ze.toString,Ye=je?je.toStringTag:void 0;const xr=function(r){var e=Ze.call(r,Ye),s=r[Ye];try{r[Ye]=void 0;var _=!0}catch{}var A=st.call(r);return _&&(e?r[Ye]=s:delete r[Ye]),A};var Qt=Object.prototype.toString;const q=function(r){return Qt.call(r)};var Z=je?je.toStringTag:void 0;const ie=function(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Z&&Z in Object(r)?xr(r):q(r)},de=function(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")},Ce=function(r){if(!de(r))return!1;var e=ie(r);return e=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]"},We=Fe["__core-js_shared__"];var Qe,lt=(Qe=/[^.]+$/.exec(We&&We.keys&&We.keys.IE_PROTO||""))?"Symbol(src)_1."+Qe:"";const Ut=function(r){return!!lt&&lt in r};var er=Function.prototype.toString;const nt=function(r){if(r!=null){try{return er.call(r)}catch{}try{return r+""}catch{}}return""};var kr=/^\[object .+?Constructor\]$/,Sr=Function.prototype,Tr=Object.prototype,Ft=Sr.toString,Or=Tr.hasOwnProperty,Cr=RegExp("^"+Ft.call(Or).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Fr=function(r){return!(!de(r)||Ut(r))&&(Ce(r)?Cr:kr).test(nt(r))},zt=function(r,e){return r?.[e]},qe=function(r,e){var s=zt(r,e);return Fr(s)?s:void 0},$e=function(){try{var r=qe(Object,"defineProperty");return r({},"",{}),r}catch{}}(),tr=function(r,e,s){e=="__proto__"&&$e?$e(r,e,{configurable:!0,enumerable:!0,value:s,writable:!0}):r[e]=s},Et=function(r){return function(e,s,_){for(var A=-1,R=Object(e),j=_(e),z=j.length;z--;){var G=j[r?z:++A];if(s(R[G],G,R)===!1)break}return e}}(),Vt=function(r,e){for(var s=-1,_=Array(r);++s<r;)_[s]=e(s);return _},ct=function(r){return r!=null&&typeof r=="object"},rr=function(r){return ct(r)&&ie(r)=="[object Arguments]"};var nr=Object.prototype,Er=nr.hasOwnProperty,ir=nr.propertyIsEnumerable;const Be=rr(function(){return arguments}())?rr:function(r){return ct(r)&&Er.call(r,"callee")&&!ir.call(r,"callee")},bt=function(){return!1};var et=Ne&&!Ne.nodeType&&Ne,At=et&&!0&&Oe&&!Oe.nodeType&&Oe,Lt=At&&At.exports===et?Fe.Buffer:void 0;const Bt=(Lt?Lt.isBuffer:void 0)||bt;var Ar=/^(?:0|[1-9]\d*)$/;const ar=function(r,e){var s=typeof r;return!!(e=e??9007199254740991)&&(s=="number"||s!="symbol"&&Ar.test(r))&&r>-1&&r%1==0&&r<e},It=function(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=9007199254740991};var ye={};ye["[object Float32Array]"]=ye["[object Float64Array]"]=ye["[object Int8Array]"]=ye["[object Int16Array]"]=ye["[object Int32Array]"]=ye["[object Uint8Array]"]=ye["[object Uint8ClampedArray]"]=ye["[object Uint16Array]"]=ye["[object Uint32Array]"]=!0,ye["[object Arguments]"]=ye["[object Array]"]=ye["[object ArrayBuffer]"]=ye["[object Boolean]"]=ye["[object DataView]"]=ye["[object Date]"]=ye["[object Error]"]=ye["[object Function]"]=ye["[object Map]"]=ye["[object Number]"]=ye["[object Object]"]=ye["[object RegExp]"]=ye["[object Set]"]=ye["[object String]"]=ye["[object WeakMap]"]=!1;const Ee=function(r){return ct(r)&&It(r.length)&&!!ye[ie(r)]},or=function(r){return function(e){return r(e)}};var Ae=Ne&&!Ne.nodeType&&Ne,ut=Ae&&!0&&Oe&&!Oe.nodeType&&Oe,ke=ut&&ut.exports===Ae&&_e.process,dt=function(){try{var r=ut&&ut.require&&ut.require("util").types;return r||ke&&ke.binding&&ke.binding("util")}catch{}}(),Rt=dt&&dt.isTypedArray;const Ht=Rt?or(Rt):Ee;var Wt=Object.prototype.hasOwnProperty;const sr=function(r,e){var s=se(r),_=!s&&Be(r),A=!s&&!_&&Bt(r),R=!s&&!_&&!A&&Ht(r),j=s||_||A||R,z=j?Vt(r.length,String):[],G=z.length;for(var ee in r)!e&&!Wt.call(r,ee)||j&&(ee=="length"||A&&(ee=="offset"||ee=="parent")||R&&(ee=="buffer"||ee=="byteLength"||ee=="byteOffset")||ar(ee,G))||z.push(ee);return z};var ht=Object.prototype;const it=function(r){var e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||ht)},qt=function(r,e){return function(s){return r(e(s))}}(Object.keys,Object);var $t=Object.prototype.hasOwnProperty;const pt=function(r){if(!it(r))return qt(r);var e=[];for(var s in Object(r))$t.call(r,s)&&s!="constructor"&&e.push(s);return e},Mt=function(r){return r!=null&&It(r.length)&&!Ce(r)},ft=function(r){return Mt(r)?sr(r):pt(r)},lr=function(r,e){return r&&Et(r,e,ft)},Kt=function(){this.__data__=[],this.size=0},mt=function(r,e){return r===e||r!=r&&e!=e},Ke=function(r,e){for(var s=r.length;s--;)if(mt(r[s][0],e))return s;return-1};var vt=Array.prototype.splice;const cr=function(r){var e=this.__data__,s=Ke(e,r);return!(s<0)&&(s==e.length-1?e.pop():vt.call(e,s,1),--this.size,!0)},ur=function(r){var e=this.__data__,s=Ke(e,r);return s<0?void 0:e[s][1]},dr=function(r){return Ke(this.__data__,r)>-1},Gt=function(r,e){var s=this.__data__,_=Ke(s,r);return _<0?(++this.size,s.push([r,e])):s[_][1]=e,this};function at(r){var e=-1,s=r==null?0:r.length;for(this.clear();++e<s;){var _=r[e];this.set(_[0],_[1])}}at.prototype.clear=Kt,at.prototype.delete=cr,at.prototype.get=ur,at.prototype.has=dr,at.prototype.set=Gt;const yt=at,Xt=function(){this.__data__=new yt,this.size=0},tt=function(r){var e=this.__data__,s=e.delete(r);return this.size=e.size,s},Dt=function(r){return this.__data__.get(r)},hr=function(r){return this.__data__.has(r)},_t=qe(Fe,"Map"),wt=qe(Object,"create"),gt=function(){this.__data__=wt?wt(null):{},this.size=0},Lr=function(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e};var pr=Object.prototype.hasOwnProperty;const Jt=function(r){var e=this.__data__;if(wt){var s=e[r];return s==="__lodash_hash_undefined__"?void 0:s}return pr.call(e,r)?e[r]:void 0};var fr=Object.prototype.hasOwnProperty;const mr=function(r){var e=this.__data__;return wt?e[r]!==void 0:fr.call(e,r)},Ir=function(r,e){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=wt&&e===void 0?"__lodash_hash_undefined__":e,this};function Ge(r){var e=-1,s=r==null?0:r.length;for(this.clear();++e<s;){var _=r[e];this.set(_[0],_[1])}}Ge.prototype.clear=gt,Ge.prototype.delete=Lr,Ge.prototype.get=Jt,Ge.prototype.has=mr,Ge.prototype.set=Ir;const jt=Ge,Rr=function(){this.size=0,this.__data__={hash:new jt,map:new(_t||yt),string:new jt}},Xe=function(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null},Pt=function(r,e){var s=r.__data__;return Xe(e)?s[typeof e=="string"?"string":"hash"]:s.map},vr=function(r){var e=Pt(this,r).delete(r);return this.size-=e?1:0,e},yr=function(r){return Pt(this,r).get(r)},Mr=function(r){return Pt(this,r).has(r)},xt=function(r,e){var s=Pt(this,r),_=s.size;return s.set(r,e),this.size+=s.size==_?0:1,this};function Ue(r){var e=-1,s=r==null?0:r.length;for(this.clear();++e<s;){var _=r[e];this.set(_[0],_[1])}}Ue.prototype.clear=Rr,Ue.prototype.delete=vr,Ue.prototype.get=yr,Ue.prototype.has=Mr,Ue.prototype.set=xt;const kt=Ue,gr=function(r,e){var s=this.__data__;if(s instanceof yt){var _=s.__data__;if(!_t||_.length<199)return _.push([r,e]),this.size=++s.size,this;s=this.__data__=new kt(_)}return s.set(r,e),this.size=s.size,this};function ot(r){var e=this.__data__=new yt(r);this.size=e.size}ot.prototype.clear=Xt,ot.prototype.delete=tt,ot.prototype.get=Dt,ot.prototype.has=hr,ot.prototype.set=gr;const St=ot,Dr=function(r){return this.__data__.set(r,"__lodash_hash_undefined__"),this},k=function(r){return this.__data__.has(r)};function X(r){var e=-1,s=r==null?0:r.length;for(this.__data__=new kt;++e<s;)this.add(r[e])}X.prototype.add=X.prototype.push=Dr,X.prototype.has=k;const W=X,ge=function(r,e){for(var s=-1,_=r==null?0:r.length;++s<_;)if(e(r[s],s,r))return!0;return!1},Te=function(r,e){return r.has(e)},Me=function(r,e,s,_,A,R){var j=1&s,z=r.length,G=e.length;if(z!=G&&!(j&&G>z))return!1;var ee=R.get(r),ne=R.get(e);if(ee&&ne)return ee==e&&ne==r;var Q=-1,ae=!0,fe=2&s?new W:void 0;for(R.set(r,e),R.set(e,r);++Q<z;){var le=r[Q],be=e[Q];if(_)var Pe=j?_(be,le,Q,e,r,R):_(le,be,Q,r,e,R);if(Pe!==void 0){if(Pe)continue;ae=!1;break}if(fe){if(!ge(e,function(Ie,He){if(!Te(fe,He)&&(le===Ie||A(le,Ie,s,_,R)))return fe.push(He)})){ae=!1;break}}else if(le!==be&&!A(le,be,s,_,R)){ae=!1;break}}return R.delete(r),R.delete(e),ae},Le=Fe.Uint8Array,Tt=function(r){var e=-1,s=Array(r.size);return r.forEach(function(_,A){s[++e]=[A,_]}),s},rt=function(r){var e=-1,s=Array(r.size);return r.forEach(function(_){s[++e]=_}),s};var Ve=je?je.prototype:void 0,Zt=Ve?Ve.valueOf:void 0;const qr=function(r,e,s,_,A,R,j){switch(s){case"[object DataView]":if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(r.byteLength!=e.byteLength||!R(new Le(r),new Le(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return mt(+r,+e);case"[object Error]":return r.name==e.name&&r.message==e.message;case"[object RegExp]":case"[object String]":return r==e+"";case"[object Map]":var z=Tt;case"[object Set]":var G=1&_;if(z||(z=rt),r.size!=e.size&&!G)return!1;var ee=j.get(r);if(ee)return ee==e;_|=2,j.set(r,e);var ne=Me(z(r),z(e),_,A,R,j);return j.delete(r),ne;case"[object Symbol]":if(Zt)return Zt.call(r)==Zt.call(e)}return!1},bn=function(r,e){for(var s=-1,_=e.length,A=r.length;++s<_;)r[A+s]=e[s];return r},_n=function(r,e,s){var _=e(r);return se(r)?_:bn(_,s(r))},wn=function(r,e){for(var s=-1,_=r==null?0:r.length,A=0,R=[];++s<_;){var j=r[s];e(j,s,r)&&(R[A++]=j)}return R},Pn=function(){return[]};var xn=Object.prototype.propertyIsEnumerable,$r=Object.getOwnPropertySymbols;const kn=$r?function(r){return r==null?[]:(r=Object(r),wn($r(r),function(e){return xn.call(r,e)}))}:Pn,Kr=function(r){return _n(r,ft,kn)};var Sn=Object.prototype.hasOwnProperty;const Tn=function(r,e,s,_,A,R){var j=1&s,z=Kr(r),G=z.length;if(G!=Kr(e).length&&!j)return!1;for(var ee=G;ee--;){var ne=z[ee];if(!(j?ne in e:Sn.call(e,ne)))return!1}var Q=R.get(r),ae=R.get(e);if(Q&&ae)return Q==e&&ae==r;var fe=!0;R.set(r,e),R.set(e,r);for(var le=j;++ee<G;){var be=r[ne=z[ee]],Pe=e[ne];if(_)var Ie=j?_(Pe,be,ne,e,r,R):_(be,Pe,ne,r,e,R);if(!(Ie===void 0?be===Pe||A(be,Pe,s,_,R):Ie)){fe=!1;break}le||(le=ne=="constructor")}if(fe&&!le){var He=r.constructor,Ct=e.constructor;He==Ct||!("constructor"in r)||!("constructor"in e)||typeof He=="function"&&He instanceof He&&typeof Ct=="function"&&Ct instanceof Ct||(fe=!1)}return R.delete(r),R.delete(e),fe},jr=qe(Fe,"DataView"),Nr=qe(Fe,"Promise"),Ur=qe(Fe,"Set"),zr=qe(Fe,"WeakMap");var Gr="[object Map]",Xr="[object Promise]",Jr="[object Set]",Zr="[object WeakMap]",Yr="[object DataView]",On=nt(jr),Cn=nt(_t),Fn=nt(Nr),En=nt(Ur),An=nt(zr),Ot=ie;(jr&&Ot(new jr(new ArrayBuffer(1)))!=Yr||_t&&Ot(new _t)!=Gr||Nr&&Ot(Nr.resolve())!=Xr||Ur&&Ot(new Ur)!=Jr||zr&&Ot(new zr)!=Zr)&&(Ot=function(r){var e=ie(r),s=e=="[object Object]"?r.constructor:void 0,_=s?nt(s):"";if(_)switch(_){case On:return Yr;case Cn:return Gr;case Fn:return Xr;case En:return Jr;case An:return Zr}return e});const Qr=Ot;var en="[object Arguments]",tn="[object Array]",br="[object Object]",rn=Object.prototype.hasOwnProperty;const Ln=function(r,e,s,_,A,R){var j=se(r),z=se(e),G=j?tn:Qr(r),ee=z?tn:Qr(e),ne=(G=G==en?br:G)==br,Q=(ee=ee==en?br:ee)==br,ae=G==ee;if(ae&&Bt(r)){if(!Bt(e))return!1;j=!0,ne=!1}if(ae&&!ne)return R||(R=new St),j||Ht(r)?Me(r,e,s,_,A,R):qr(r,e,G,s,_,A,R);if(!(1&s)){var fe=ne&&rn.call(r,"__wrapped__"),le=Q&&rn.call(e,"__wrapped__");if(fe||le){var be=fe?r.value():r,Pe=le?e.value():e;return R||(R=new St),A(be,Pe,s,_,R)}}return!!ae&&(R||(R=new St),Tn(r,e,s,_,A,R))},nn=function r(e,s,_,A,R){return e===s||(e==null||s==null||!ct(e)&&!ct(s)?e!=e&&s!=s:Ln(e,s,_,A,r,R))},In=function(r,e,s,_){var A=s.length,R=A,j=!_;if(r==null)return!R;for(r=Object(r);A--;){var z=s[A];if(j&&z[2]?z[1]!==r[z[0]]:!(z[0]in r))return!1}for(;++A<R;){var G=(z=s[A])[0],ee=r[G],ne=z[1];if(j&&z[2]){if(ee===void 0&&!(G in r))return!1}else{var Q=new St;if(_)var ae=_(ee,ne,G,r,e,Q);if(!(ae===void 0?nn(ne,ee,3,_,Q):ae))return!1}}return!0},an=function(r){return r==r&&!de(r)},Rn=function(r){for(var e=ft(r),s=e.length;s--;){var _=e[s],A=r[_];e[s]=[_,A,an(A)]}return e},on=function(r,e){return function(s){return s!=null&&s[r]===e&&(e!==void 0||r in Object(s))}},Mn=function(r){var e=Rn(r);return e.length==1&&e[0][2]?on(e[0][0],e[0][1]):function(s){return s===r||In(s,r,e)}},Vr=function(r){return typeof r=="symbol"||ct(r)&&ie(r)=="[object Symbol]"};var Dn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jn=/^\w*$/;const Br=function(r,e){if(se(r))return!1;var s=typeof r;return!(s!="number"&&s!="symbol"&&s!="boolean"&&r!=null&&!Vr(r))||jn.test(r)||!Dn.test(r)||e!=null&&r in Object(e)};function Hr(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var s=function(){var _=arguments,A=e?e.apply(this,_):_[0],R=s.cache;if(R.has(A))return R.get(A);var j=r.apply(this,_);return s.cache=R.set(A,j)||R,j};return s.cache=new(Hr.Cache||kt),s}Hr.Cache=kt;const Nn=Hr;var Un=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zn=/\\(\\)?/g;const Vn=function(r){var e=Nn(r,function(_){return s.size===500&&s.clear(),_}),s=e.cache;return e}(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Un,function(s,_,A,R){e.push(A?R.replace(zn,"$1"):_||s)}),e}),Bn=function(r,e){for(var s=-1,_=r==null?0:r.length,A=Array(_);++s<_;)A[s]=e(r[s],s,r);return A};var sn=je?je.prototype:void 0,ln=sn?sn.toString:void 0;const Hn=function r(e){if(typeof e=="string")return e;if(se(e))return Bn(e,r)+"";if(Vr(e))return ln?ln.call(e):"";var s=e+"";return s=="0"&&1/e==-1/0?"-0":s},Wn=function(r){return r==null?"":Hn(r)},cn=function(r,e){return se(r)?r:Br(r,e)?[r]:Vn(Wn(r))},_r=function(r){if(typeof r=="string"||Vr(r))return r;var e=r+"";return e=="0"&&1/r==-1/0?"-0":e},un=function(r,e){for(var s=0,_=(e=cn(e,r)).length;r!=null&&s<_;)r=r[_r(e[s++])];return s&&s==_?r:void 0},qn=function(r,e,s){var _=r==null?void 0:un(r,e);return _===void 0?s:_},$n=function(r,e){return r!=null&&e in Object(r)},Kn=function(r,e,s){for(var _=-1,A=(e=cn(e,r)).length,R=!1;++_<A;){var j=_r(e[_]);if(!(R=r!=null&&s(r,j)))break;r=r[j]}return R||++_!=A?R:!!(A=r==null?0:r.length)&&It(A)&&ar(j,A)&&(se(r)||Be(r))},Gn=function(r,e){return r!=null&&Kn(r,e,$n)},Xn=function(r,e){return Br(r)&&an(e)?on(_r(r),e):function(s){var _=qn(s,r);return _===void 0&&_===e?Gn(s,r):nn(e,_,3)}},Jn=function(r){return r},Zn=function(r){return function(e){return e?.[r]}},Yn=function(r){return function(e){return un(e,r)}},Qn=function(r){return Br(r)?Zn(_r(r)):Yn(r)},ei=function(r){return typeof r=="function"?r:r==null?Jn:typeof r=="object"?se(r)?Xn(r[0],r[1]):Mn(r):Qn(r)},ti=function(r,e){var s={};return e=ei(e),lr(r,function(_,A,R){tr(s,e(_,A,R),_)}),s};function dn(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}class ri{constructor(e,s){dn(this,"ctx",void 0),dn(this,"serviceHooks",void 0),this.ctx=e,this.serviceHooks=s,e._execCallableAPI("register-search-service",e.baseInfo.id,s.name,s.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:_=>(se(_?.blocks)&&(_.blocks=_.blocks.map(A=>A&&ti(A,(R,j)=>`block/${j}`))),_)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([_,A])=>{const R=(j=>`service:search:${j}:${s.name}`)(_);e.caller.on(R,async j=>{if(Ce(s?.[A.f])){let z=null;try{z=await s[A.f].apply(s,(A.args||[]).map(G=>{if(j){if(G===!0)return j;if(j.hasOwnProperty(G)){const ee=j[G];return delete j[G],ee}}})),A.transformOutput&&(z=A.transformOutput(z))}catch(G){console.error("[SearchService] ",G),z=G}finally{A.reply&&e.caller.call(`${R}:reply`,z)}}})})}}function Je(r,e,s){return e in r?Object.defineProperty(r,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[e]=s,r}const ni=Symbol.for("proxy-continue"),ii=L()("LSPlugin:user"),hn=new u("",{console:!0});function Nt(r,e,s){var _;const{key:A,label:R,desc:j,palette:z,keybinding:G,extras:ee}=e;if(typeof s!="function")return this.logger.error(`${A||R}: command action should be function.`),!1;const ne=function(ae){if(typeof ae=="string")return ae.trim().replace(/\s/g,"_").toLowerCase()}(A);if(!ne)return this.logger.error(`${R}: command key is required.`),!1;const Q=`SimpleCommandHook${ne}${++mn}`;this.Editor["on"+Q](s),(_=this.caller)===null||_===void 0||_.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:ne,label:R,type:r,desc:j,keybinding:G,extras:ee},["editor/hook",Q]],z]})}function pn(r){return!(typeof(e=r)!="string"||e.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(e))||(hn.error(`#${r} is not a valid UUID string.`),!1);var e}let wr=null,fn=new Map;const ai={async getInfo(r){return wr||(wr=await this._execCallableAPIAsync("get-app-info")),typeof r=="string"?wr[r]:wr},registerCommand:Nt,registerSearchService(r){if(fn.has(r.name))throw new Error(`SearchService: #${r.name} has registered!`);fn.set(r.name,new ri(this,r))},registerCommandPalette(r,e){const{key:s,label:_,keybinding:A}=r;return Nt.call(this,"$palette$",{key:s,label:_,palette:!0,keybinding:A},e)},registerCommandShortcut(r,e,s={}){typeof r=="string"&&(r={mode:"global",binding:r});const{binding:_}=r,A="$shortcut$",R=s.key||A+c(_?.toString());return Nt.call(this,A,{...s,key:R,palette:!1,keybinding:r},e)},registerUIItem(r,e){var s;const _=this.baseInfo.id;(s=this.caller)===null||s===void 0||s.call("api:call",{method:"register-plugin-ui-item",args:[_,r,e]})},registerPageMenuItem(r,e){if(typeof e!="function")return!1;const s=r+"_"+this.baseInfo.id,_=r;Nt.call(this,"page-menu-item",{key:s,label:_},e)},onBlockRendererSlotted(r,e){if(!pn(r))return;const s=this.baseInfo.id,_=`hook:editor:${c(`slot:${r}`)}`;return this.caller.on(_,e),this.App._installPluginHook(s,_),()=>{this.caller.off(_,e),this.App._uninstallPluginHook(s,_)}},invokeExternalPlugin(r,...e){var s;if(!(r=(s=r)===null||s===void 0?void 0:s.trim()))return;let[_,A]=r.split(".");if(!["models","commands"].includes(A?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const R=r.replace(`${_}.${A}.`,"");if(!_||!A||!R)throw new Error(`Illegal type of #${r} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",_,A.toLowerCase(),R,e)},setFullScreen(r){const e=(...s)=>this._callWin("setFullScreen",...s);r==="toggle"?this._callWin("isFullScreen").then(s=>{s?e():e(!0)}):r?e(!0):e()}};let mn=0;const oi={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(r,e){var s;ii("Register slash command #",this.baseInfo.id,r,e),typeof e=="function"&&(e=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",e]]),e=e.map(_=>{const[A,...R]=_;if(A==="editor/hook"){let j=R[0],z=()=>{var ee;(ee=this.caller)===null||ee===void 0||ee.callUserModel(j)};typeof j=="function"&&(z=j);const G=`SlashCommandHook${A}${++mn}`;_[1]=G,this.Editor["on"+G](z)}return _}),(s=this.caller)===null||s===void 0||s.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[r,e]]})},registerBlockContextMenuItem(r,e){if(typeof e!="function")return!1;const s=r+"_"+this.baseInfo.id;Nt.call(this,"block-context-menu-item",{key:s,label:r},e)},registerHighlightContextMenuItem(r,e,s){if(typeof e!="function")return!1;const _=r+"_"+this.baseInfo.id;Nt.call(this,"highlight-context-menu-item",{key:_,label:r,extras:s},e)},scrollToBlockInPage(r,e,s){const _="block-content-"+e;s!=null&&s.replaceState?this.App.replaceState("page",{name:r},{anchor:_}):this.App.pushState("page",{name:r},{anchor:_})}},si={onBlockChanged(r,e){if(!pn(r))return;const s=this.baseInfo.id,_=`hook:db:${c(`block:${r}`)}`,A=({block:R,txData:j,txMeta:z})=>{R.uuid===r&&e(R,j,z)};return this.caller.on(_,A),this.App._installPluginHook(s,_),()=>{this.caller.off(_,A),this.App._uninstallPluginHook(s,_)}},datascriptQuery(r,...e){return e.pop(),e!=null&&e.some(s=>typeof s=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(r,...e):this._execCallableAPIAsync("datascript_query",r,...e)}},li={},ci={},ui={makeSandboxStorage(){return new me(this,{assets:!0})}};class Wr extends i(){constructor(e,s){super(),Je(this,"_baseInfo",void 0),Je(this,"_caller",void 0),Je(this,"_version","0.0.17"),Je(this,"_debugTag",""),Je(this,"_settingsSchema",void 0),Je(this,"_connected",!1),Je(this,"_ui",new Map),Je(this,"_mFileStorage",void 0),Je(this,"_mRequest",void 0),Je(this,"_mExperiments",void 0),Je(this,"_beforeunloadCallback",void 0),this._baseInfo=e,this._caller=s,s.on("sys:ui:visible",_=>{_!=null&&_.toggle&&this.toggleMainUI()}),s.on("settings:changed",_=>{const A=Object.assign({},this.settings),R=Object.assign(this._baseInfo.settings,_);this.emit("settings:changed",{...R},A)}),s.on("beforeunload",async _=>{const{actor:A,...R}=_,j=this._beforeunloadCallback;try{j&&await j(R),A?.resolve(null)}catch(z){this.logger.error("[beforeunload] ",z),A?.reject(z)}})}async ready(e,s){var _,A;if(!this._connected)try{var R;typeof e=="function"&&(s=e,e={});let j=await this._caller.connectToParent(e);this._connected=!0,_=this._baseInfo,A=j,j=p()(_,A,{arrayMerge:(z,G)=>G}),this._baseInfo=j,(R=j)!==null&&R!==void 0&&R.id&&(this._debugTag=this._caller.debugTag=`#${j.id} [${j.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(j.settings=function(z,G){const ee=(G||[]).reduce((ne,Q)=>("default"in Q&&(ne[Q.key]=Q.default),ne),{});return Object.assign(ee,z)}(j.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(z){console.warn(z)}s&&s.call(this,j)}catch(j){console.error(`${this._debugTag} [Ready Error]`,j)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(e){typeof e=="function"&&(this._beforeunloadCallback=e)}provideModel(e){return this.caller._extendUserModel(e),this}provideTheme(e){return this.caller.call("provider:theme",e),this}provideStyle(e){return this.caller.call("provider:style",e),this}provideUI(e){return this.caller.call("provider:ui",e),this}useSettingsSchema(e){return this.connected&&this.caller.call("settings:schema",{schema:e,isSync:!0}),this._settingsSchema=e,this}updateSettings(e){this.caller.call("settings:update",e)}onSettingsChanged(e){const s="settings:changed";return this.on(s,e),()=>this.off(s,e)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(e){this.caller.call("main-ui:attrs",e)}setMainUIInlineStyle(e){this.caller.call("main-ui:style",e)}hideMainUI(e){const s={key:0,visible:!1,cursor:e?.restoreEditingCursor};this.caller.call("main-ui:visible",s),this.emit("ui:visible:changed",s),this._ui.set(s.key,s)}showMainUI(e){const s={key:0,visible:!0,autoFocus:e?.autoFocus};this.caller.call("main-ui:visible",s),this.emit("ui:visible:changed",s),this._ui.set(s.key,s)}toggleMainUI(){const s=this._ui.get(0);s&&s.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const e=this._ui.get(0);return!!(e&&e.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(e=this)&&(((s=e.baseInfo)===null||s===void 0?void 0:s.effect)||!((_=e.baseInfo)!==null&&_!==void 0&&_.iir));var e,s,_}get logger(){return hn}get settings(){var e;return(e=this.baseInfo)===null||e===void 0?void 0:e.settings}get caller(){return this._caller}resolveResourceFullUrl(e){if(this.ensureConnected(),e)return e=e.replace(/^[.\\/]+/,""),g(this._baseInfo.lsr,e)}_makeUserProxy(e,s){const _=this,A=this.caller;return new Proxy(e,{get(R,j,z){const G=R[j];return function(...ee){if(G){const Q=G.apply(_,ee.concat(s));if(Q!==ni)return Q}if(s){const Q=j.toString().match(/^(once|off|on)/i);if(Q!=null){const ae=Q[0].toLowerCase(),fe=Q.input,le=ae==="off",be=_.baseInfo.id;let Pe=fe.slice(ae.length),Ie=ee[0],He=ee[1];typeof Ie=="string"&&typeof He=="function"&&(Ie=Ie.replace(/^logseq./,":"),Pe=`${Pe}${Ie}`,Ie=He,He=ee[2]),Pe=`hook:${s}:${c(Pe)}`,A[ae](Pe,Ie);const Ct=()=>{A.off(Pe,Ie),A.listenerCount(Pe)||_.App._uninstallPluginHook(be,Pe)};return le?void Ct():(_.App._installPluginHook(be,Pe,He),Ct)}}let ne=j;return["git","ui","assets"].includes(s)&&(ne=s+"_"+ne),A.callAsync("api:call",{tag:s,method:ne,args:ee})}}})}_execCallableAPIAsync(e,...s){return this._caller.callAsync("api:call",{method:e,args:s})}_execCallableAPI(e,...s){this._caller.call("api:call",{method:e,args:s})}_callWin(...e){return this._execCallableAPIAsync("_callMainWin",...e)}get App(){return this._makeUserProxy(ai,"app")}get Editor(){return this._makeUserProxy(oi,"editor")}get DB(){return this._makeUserProxy(si,"db")}get Git(){return this._makeUserProxy(li,"git")}get UI(){return this._makeUserProxy(ci,"ui")}get Assets(){return this._makeUserProxy(ui,"assets")}get FileStorage(){let e=this._mFileStorage;return e||(e=this._mFileStorage=new me(this)),e}get Request(){let e=this._mRequest;return e||(e=this._mRequest=new he(this)),e}get Experiments(){let e=this._mExperiments;return e||(e=this._mExperiments=new Se(this)),e}}function vn(r,e){return new Wr(r,e)}if(window.__LSP__HOST__==null){const r=new xe(null);window.logseq=vn({},r)}})(),w})())})(Pr,Pr.exports);Pr.exports;var yn={exports:{}};/*!
 * Copyright (c) 2017 Apple Inc. All rights reserved.
 * 
 * # LivePhotosKit JS License
 * 
 * **IMPORTANT:** This Apple LivePhotosKit software is supplied to you by Apple
 * Inc. ("Apple") in consideration of your agreement to the following terms, and
 * your use, reproduction, or installation of this Apple software constitutes
 * acceptance of these terms. If you do not agree with these terms, please do not
 * use, reproduce or install this Apple software.
 * 
 * This Apple LivePhotosKit software is supplied to you by Apple Inc. ("Apple") in
 * consideration of your agreement to the following terms, and your use,
 * reproduction, or installation of this Apple software constitutes acceptance of
 * these terms. If you do not agree with these terms, please do not use, reproduce
 * or install this Apple software.
 * 
 * This software is licensed to you only for use with LivePhotos that you are
 * authorized or legally permitted to embed or display on your website. 
 * 
 * The LivePhotosKit Software is only licensed and intended for the purposes set
 * forth above and may not be used for other purposes or in other contexts without
 * Apple's prior written permission. For the sake of clarity, you may not and
 * agree not to or enable others to, modify or create derivative works of the
 * LivePhotosKit Software.
 * 
 * Neither the name, trademarks, service marks or logos of Apple Inc. may be used
 * to endorse or promote products, services without specific prior written
 * permission from Apple. Except as expressly stated in this notice, no other
 * rights or licenses, express or implied, are granted by Apple herein.
 * 
 * The LivePhotosKit Software is provided by Apple on an "AS IS" basis. APPLE
 * MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE
 * IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A
 * PARTICULAR PURPOSE, REGARDING THE LIVEPHOTOSKIT SOFTWARE OR ITS USE AND
 * OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS, SYSTEMS, OR SERVICES.
 * APPLE DOES NOT WARRANT THAT THE LIVEPHOTOSKIT SOFTWARE WILL MEET YOUR
 * REQUIREMENTS, THAT THE OPERATION OF THE LIVEPHOTOSKIT SOFTWARE WILL BE
 * UNINTERRUPTED OR ERROR-FREE, THAT DEFECTS IN THE LIVEPHOTOSKIT SOFTWARE WILL BE
 * CORRECTED, OR THAT THE LIVEPHOTOSKIT SOFTWARE WILL BE COMPATIBLE WITH FUTURE
 * APPLE PRODUCTS, SOFTWARE OR SERVICES. NO ORAL OR WRITTEN INFORMATION OR ADVICE
 * GIVEN BY APPLE OR AN APPLE AUTHORIZED REPRESENTATIVE WILL CREATE A WARRANTY. 
 * 
 * IN NO EVENT SHALL APPLE BE LIABLE FOR ANY DIRECT, SPECIAL, INDIRECT, INCIDENTAL
 * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) RELATING TO OR ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION,
 * OR INSTALLATION, OF THE LIVEPHOTOSKIT SOFTWARE BY YOU OR OTHERS, HOWEVER CAUSED
 * AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE), STRICT
 * LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE. SOME JURISDICTIONS DO NOT ALLOW THE LIMITATION OF LIABILITY FOR
 * PERSONAL INJURY, OR OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THIS LIMITATION
 * MAY NOT APPLY TO YOU. In no event shall Apple's total liability to you for all
 * damages (other than as may be required by applicable law in cases involving
 * personal injury) exceed the amount of fifty dollars ($50.00). The foregoing
 * limitations will apply even if the above stated remedy fails of its essential
 * purpose. 
 * 
 * 
 * **ACKNOWLEDGEMENTS:**
 * https://cdn.apple-livephotoskit.com/lpk/1/acknowledgements.txt
 * 
 * v1.5.6
 */(function(Oe,Ne){(function(J,E){Oe.exports=E()})(Yt,function(){return function(J){function E(w){if(v[w])return v[w].exports;var P=v[w]={i:w,l:!1,exports:{}};return J[w].call(P.exports,P,P.exports,E),P.l=!0,P.exports}var v={};return E.m=J,E.c=v,E.i=function(w){return w},E.d=function(w,P,m){E.o(w,P)||Object.defineProperty(w,P,{configurable:!1,enumerable:!0,get:m})},E.n=function(w){var P=w&&w.__esModule?function(){return w.default}:function(){return w};return E.d(P,"a",P),P},E.o=function(w,P){return Object.prototype.hasOwnProperty.call(w,P)},E.p="",E(E.s=25)}([function(J,E,v){function w(b){if(b){var T=b.staticMembers;T&&P.call(this,T),P.call(this.prototype,b)}}function P(b){for(var T in b)if(b.hasOwnProperty(T)&&T!=="staticMembers"){var I=Object.getOwnPropertyDescriptor(b,T);I.get||I.set?Object.defineProperty(this,T,I):m.call(this,T,b[T])}}function m(b,T){var I=this[b];return I instanceof Function&&T instanceof Function?p.call(this,b,T,I):M.instanceOrKindOf(T,M.Metadata)?d.call(this,b,T):void(this[b]=T)}function p(b,T,I){this[b]=function(){var S=this._super;this._super=I;var D=T.apply(this,arguments);return this._super=S,D}}function d(b,T){this.hasOwnProperty("_metadatas")||(this._metadatas=Object.create(this._metadatas)),(T.isLPKClass?T.sharedInstance:T).registerOnDefinition(this,b)}function h(b){var T=this["_callbacksFor_"+b];if(T){var I=void 0;if(arguments.length>1){I=M.arrayPool.get();for(var S=1,D=arguments.length;S<D;S++)I[S-1]=arguments[S]}var U=void 0;if(U=this._triggerPauseStack){var B=U[U.length-1];if(B[B.length-1]!=="IS_FLUSHING")return void B.push(this,b,I)}for(var H=0,V=T.length;H<V;H++){var K=T[H];K&&K.apply(this,I)}I&&M.arrayPool.ret(I)}}function l(b,T){if(b.indexOf(".")!==-1)return y.call(this,b,T);var I="_callbackToIndexMapFor_"+b,S=this.hasOwnProperty(I)?this[I]:this[I]=this[I]?new $.a(this[I]):new $.a;if(S.get(T)===void 0){var D="_callbacksFor_"+b,U=this.hasOwnProperty(D)?this[D]:this[D]=this[D]?this[D].slice():[];S.set(T,U.length),U.push(T)}}function F(b,T){if(b.indexOf(".")!==-1)return t.call(this,b,T);var I="_callbackToIndexMapFor_"+b,S=this[I];if(S&&S.get(T)!==void 0){var D=this.hasOwnProperty(I)?this[I]:this[I]=this[I]?new $.a(this[I]):new $.a,U="_callbacksFor_"+b;(this.hasOwnProperty(U)?this[U]:this[U]=this[U]?this[U].slice():[])[D.get(T)]=null,D.delete(T)}}function y(b,T,I){var S="_"+b+"_"+M.guidFor(T)+"_"+M.guidFor(I),D="_chainListenerMaintenanceCallback_for"+S;if(!this[D]){var U=b.indexOf("."),B=U!==-1,H=b.substring(U+1),V=H.substring(0,(H.indexOf(".")+1||H.length+1)-1),K=b.substring(0,U===-1?b.length:U),re="_chainListenerPreviousStoredValue_for"+S,oe=function(ce){var ue=I||this;if(V&&B){var xe=this[K],pe=this[re];xe!==pe&&(this[re]=xe,pe&&pe.isLPKObservable&&t.call(pe,H,T,ue),xe&&xe.isLPKObservable&&y.call(xe,H,T,ue))}ce||T.call(ue)};l.call(this,K,oe),this.isInitialized&&oe.call(this,!0),this[D]=oe}}function t(b,T,I){var S="_"+b+"_"+M.guidFor(T)+"_"+M.guidFor(I),D="_chainListenerMaintenanceCallback_for"+S,U=this[D];if(U){var B=b.indexOf("."),H=b.substring(0,B===-1?b.length:B);F.call(this,H,U);var V="_chainListenerPreviousStoredValue_for"+S,K=this[V];if(K&&K.isLPKObservable){this[V]=void 0;var re=b.substring(B+1),oe=I||this;t.call(K,re,T,oe)}this[D]=void 0}}function n(b,T){l.apply(this,arguments),this.isInitialized&&T.call(this)}function i(b,T){F.apply(this,arguments)}function o(){var b=this._nextObserverId=(this._nextObserverId||0)+1,T="_runtimeObserver"+b,I=M.observer.apply(M.observer,arguments);return I.registerOnDefinition(this,T),I}function a(b){var T=this._metadatas[b];T&&T.invalidateForObject&&T.invalidateForObject(this)}function c(b){return M.resolvePropertyPathFromObject(this,b)}function u(b,T){var I=b.lastIndexOf(".");if(I===-1)return void(this[b]=T);var S=M.resolvePropertyPathFromObject(this,b.slice(0,I));S&&(S[b.slice(I+1)]=T)}function g(){for(var b=M.objectPool.get(),T=0,I=arguments.length;T<I;T++){var S=arguments[T];b[S]=this.getPath(S)}return b}function x(){var b=arguments.length,T=arguments[b-1],I=M.arrayPool.get();if(b>1)for(var S=0;S<b-1;S++)I[S]=arguments[S];else for(var D in T)Object.prototype.hasOwnProperty.call(T,D)&&I.push(D);M.Object.prototype.pauseNotifications();for(var U=0,B=I.length;U<B;U++){var H=I[U];this.setPath(H,T[H])}M.Object.prototype.resumeNotifications(),M.arrayPool.ret(I)}function f(){(this.hasOwnProperty("_triggerPauseStack")?this._triggerPauseStack:this._triggerPauseStack=M.arrayPool.get()).push(M.arrayPool.get())}function O(){var b=this.hasOwnProperty("_triggerPauseStack")&&this._triggerPauseStack;if(!b)throw"Unmatched `resumeNotifications` call. Cannot over-resume notifications.";var T=b[b.length-1];L(T),b.pop(),M.arrayPool.ret(T),b.length||(delete this._triggerPauseStack,M.arrayPool.ret(b))}function L(b){b.push("IS_FLUSHING");for(var T=M.objectPool.get(),I=0,S=b.length-1;I<S;I+=3){var D=b[I],U=b[I+1],B=b[I+2],H=M.guidFor(D)+":"+U,V=T[H];V!==void 0&&(b[V]=null),T[H]=B?void 0:I}M.objectPool.ret(T);for(var K=0,re=b.length-1;K<re;K+=3){var oe=b[K];if(oe){var ce=b[K+1],ue=b[K+2];ue?(ue.unshift(ce),oe.trigger.apply(oe,ue),M.arrayPool.ret(ue)):oe.trigger(ce)}}}var C=v(47),N=v(20),$=v(19),Y=v(44),te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},M={mixin:function(b){for(var T=arguments.length,I=Array(T>1?T-1:0),S=1;S<T;S++)I[S-1]=arguments[S];for(var D=1,U=arguments.length;D<U;D++){var B=arguments[D];if(B)for(var H in B)B.hasOwnProperty(H)&&(b[H]=B[H])}},instanceOf:function(b,T){return!!b&&(b.constructor===T||M.kindOf(b.constructor,T))},kindOf:function(b,T){if(!(b&&b.isLPKClass&&T&&T.isLPKClass))return!1;do if(b===T)return!0;while(b=b.superclass);return!1},instanceOrKindOf:function(b,T){return M.instanceOf(b,T)||M.kindOf(b,T)},isHash:function(b){var T=void 0;return!((b===void 0?"undefined":te(b))!=="object"||b===null||(T=b.constructor)&&T!==Object||b.isLPKObject||b.isLPKClass)},arrayPool:C.a,mapPool:C.b,objectPool:C.c,canvasPool:C.d,String:Y.a,Array:{mapIntoArray:function(b,T,I){var S=b.length;I.length!==S&&(I.length=S);for(var D=0;D<S;D++)I[D]=T(b[D],D);return I}},resolvePropertyPathFromObject:function(b,T){for(var I=T.indexOf("."),S=0,D=b;I!==-1;){if(!(D=D[T.substring(S,I)]))return;S=I+1,I=T.indexOf(".",S)}return D[T.substring(S)]},InequalityTests:{DEFAULT:function(b,T,I){return b!==T||Array.isArray(b)||M.isHash(b)},STRICT:function(b,T,I){return b!==T},NAN_AWARE:function(b,T,I){return!Object.is(b,T)}},guidFor:N.a,reusableObject:{},emptyArray:[],Object:null,Metadata:null,observer:null,MetadataExtension:null,metadataExtension:null,AccumulatorMetadata:null,accumulator:null,ObserverMetadata:null,Property:null,property:null,ObservableProperty:null,observableProperty:null,ProxyProperty:null,proxyProperty:null,boundFunction:null};M.Object={staticMembers:{isLPKClass:!0,isLPKObservable:!0,isInitialized:!0,create:function(){for(var b=arguments.length,T=Array(b),I=0;I<b;I++)T[I]=arguments[I];var S=Object.create(this.prototype);return S.constructor=this,S.init.apply(S,arguments),S},extend:function(){for(var b=arguments.length,T=Array(b),I=0;I<b;I++)T[I]=arguments[I];var S=Object.create(this);return S.prototype=Object.create(S.prototype),Array.prototype.forEach.call(arguments,w,S),S.superclass=this,S.init(),S},init:function(){},isClassFor:function(b){var T=b&&b.constructor;return!(!T||!this.isSuperclassOf(T))},isSuperclassOf:function(b){var T=this;if(!(b&&b.isLPKClass&&T&&T.isLPKClass))return!1;do if(b===T)return!0;while(b=b.superclass);return!1},_super:null,_metadatas:{},trigger:h,_listen:l,_observe:n,_unlisten:F,_unobserve:i,observe:o,propertyChanged:a,pauseNotifications:f,resumeNotifications:O,getPath:c,setPath:u,getMultiple:g,setMultiple:x},isLPKObject:!0,isLPKObservable:!0,isInitialized:!1,_metadatas:{},init:function(b){M.mixin(this,b),this._awakenPropertiesWithAccessors()},_awakenPropertiesWithAccessors:function(){var b=M.arrayPool.get(),T=this._metadatas;do b.push(T);while(T=Object.getPrototypeOf(T));for(var I,S=M.arrayPool.get(),D=M.arrayPool.get(),U=M.arrayPool.get(),B=M.mapPool.get(),H=b.length-1;I=b[H];H--){for(var V in I)if(I.hasOwnProperty(V)){var K=I[V];if(K.hasAccessors){var re=this[V];if(re!==void 0){var oe=B.get(K);oe!==void 0&&(S[oe]=D[oe]=void 0),B.set(K,S.length),S.push(K),D.push(re)}}}U.push(S.length)}this.isInitialized=!0,M.Object.prototype.pauseNotifications();for(var ce=0,ue=D.length;ce<ue;ce++){var xe=D[ce];xe!==void 0&&S[ce].awakenForObjectWithValue(this,xe)}M.Object.prototype.resumeNotifications(),M.arrayPool.ret(b),M.arrayPool.ret(S),M.arrayPool.ret(D),M.arrayPool.ret(U),M.mapPool.ret(B)},_super:null,trigger:h,_listen:l,_observe:n,_unlisten:F,_unobserve:i,observe:o,propertyChanged:a,pauseNotifications:f,resumeNotifications:O,getPath:c,setPath:u,getMultiple:g,setMultiple:x},M.Object.staticMembers.prototype=M.Object,M.Object=M.Object.staticMembers,delete M.Object.prototype.staticMembers,Object.defineProperty(M.Object,"sharedInstance",{get:function(){return this.hasOwnProperty("_internalValue_for_sharedInstance")||(this._internalValue_for_sharedInstance=this.create()),this._internalValue_for_sharedInstance},set:function(){throw"Cannot write to a read-only property."}}),M.Metadata=M.Object.extend({registerOnDefinition:function(b,T){b._metadatas[T]=this},unregisterFromDefinition:function(b,T){b._metadatas[T]=void 0}}),M.MetadataExtension=M.Metadata.extend({init:function(b){this._super(),this._extensionParams=b},registerOnDefinition:function(b,T){b._metadatas[T].constructor.extend(this._extensionParams).sharedInstance.registerOnDefinition(b,T)}}),M.metadataExtension=M.MetadataExtension.create.bind(M.MetadataExtension),M.AccumulatorMetadata=M.Metadata.extend({init:function(b){this._super(),this.value=b},registerOnDefinition:function(b,T){var I=b[T];b[T]=this.accumulateValues(b,I,this.value)},accumulateValues:function(b,T,I){if(Array.isArray(T)&&Array.isArray(I))return T.concat(I);if(T&&T.isLPKClass&&M.isHash(I))return T.extend(I);if(I instanceof Function)return I.call(b,T);throw"Cannot use accumulators this way yet."}}),M.accumulator=M.AccumulatorMetadata.create.bind(M.AccumulatorMetadata),M.ObserverMetadata=M.Metadata.extend({staticMembers:{_collector:[]},dependencies:[],observerCallback:function(){throw"Must specify `observerCallback` on observers."},decideRequiresUpdate:M.InequalityTests.DEFAULT,init:function(){if(M.isHash(arguments[0]))this._super.apply(this,arguments);else{var b=Array.prototype.slice.call(arguments),T=b.pop();this._super({dependencies:b,observerCallback:T})}},registerOnDefinition:function(b,T){this._super.apply(this,arguments),this.keyOnObject=T;var I=this;this._invokeObserverCallbackIfNeeded=this._invokeObserverCallbackIfNeeded||(this._invokeObserverCallbackIfNeeded=function(){var U=I.dependencies,B=I.observerCallback,H=I.constructor._collector;H.length=U.length;var V=!1;I._shouldForceNextInvocationOfObserverCallback&&(I._shouldForceNextInvocationOfObserverCallback=!1,V=!0);for(var K=0;K<U.length;K++){var re=U[K],oe=this.getPath(re),ce="_lastValueSeenByObserver_"+T+"_forDependency_"+re,ue=this[ce];this[ce]=oe,!V&&I.decideRequiresUpdate(oe,ue,re)&&(V=!0),H[K]=oe}V&&B.apply(this,H),H.length=0}),b[this.keyOnObject]=b[this.keyOnObject]||(b[this.keyOnObject]=function(){I._shouldForceNextInvocationOfObserverCallback=!0,I._invokeObserverCallbackIfNeeded.call(this)});for(var S=this.dependencies,D=0;D<S.length;D++)b.isInitialized?b._observe(S[D],this._invokeObserverCallbackIfNeeded):b._listen(S[D],this._invokeObserverCallbackIfNeeded)},unregisterFromDefinition:function(b,T){this._super.apply(this,arguments);for(var I=this.dependencies,S=0;S<I.length;S++)b._unlisten(I[S],this._invokeObserverCallbackIfNeeded)}}),M.observer=M.ObserverMetadata.create.bind(M.ObserverMetadata),M.Property=M.Metadata.extend({staticMembers:{extend:function(b){return arguments.length!==1||M.isHash(b)?this._super.apply(this,arguments):this._super({defaultValue:b})}},hasAccessors:!0,readOnly:!1,defaultValue:void 0,get:null,set:null,keyOnObject:null,storageKeyOnObject:null,_defaultGetter:function(b){return b},_defaultSetter:function(b){return b},_internalGetterForObject:function(b){return this.get.call(b,b[this.storageKeyOnObject])},_internalSetterForObject:function(b,T){b[this.storageKeyOnObject]=this.set.call(b,T)},init:function(b){var T=this;if(arguments.length!==1||M.isHash(b)?this._super.apply(this,arguments):this._super({defaultValue:b}),this.get||(this.get=this._defaultGetter),this.readOnly){if(this.set)throw"Cannot include both `readOnly` and `set`.";this.set=function(I){if(T._isAwakeningInReadOnlyMode)return T._isAwakeningInReadOnlyMode=!1,I;throw"Cannot write to a read-only property"}}else this.set||(this.set=this._defaultSetter)},registerOnDefinition:function(b,T){this._super.apply(this,arguments),this.keyOnObject=T;var I=this.storageKeyOnObject="_internalValue_for_"+T;this._internalGetterForObject=this._internalGetterForObject.bind(this),this._internalSetterForObject=this._internalSetterForObject.bind(this);var S=this;Object.defineProperty(b,T,{get:function(){return this.isInitialized?S._internalGetterForObject(this):this[I]},set:function(D){if(!this.isInitialized)return void(this[I]=D);S._internalSetterForObject(this,D)}}),b[T]=this.defaultValue},unregisterFromDefinition:function(b,T){M.reusableObject[T]=void 0;var I=Object.getOwnPropertyDescriptor(M.reusableObject,T);delete M.reusableObject[T],Object.defineProperty(b,T,I),delete b["_internalValue_for_"+T],this._super.apply(this,arguments)},awakenForObjectWithValue:function(b,T){this.readOnly&&(this._isAwakeningInReadOnlyMode=!0),T instanceof Function&&(T=T.call(b)),b[this.keyOnObject]=T}}),M.property=M.Property.extend.bind(M.Property),M.ObservableProperty=M.Property.extend({isCacheable:!1,dependencies:[],writeDependencies:[],decideRequiresUpdate:M.InequalityTests.DEFAULT,_internalSetterForObject:function(b){this._super.apply(this,arguments),this.invalidateForObject(b)},_internalGetterForObject:function(b){if(!this.isCacheable)return this._super.apply(this,arguments);var T=this.cacheExistenceKeyOnObject;if(b[T])return b[this.cacheStorageKeyOnObject];var I=this._super.apply(this,arguments);return b[T]=!0,b[this.cacheStorageKeyOnObject]=I,I},invalidateForObject:function(b){b[this.cacheExistenceKeyOnObject]=!1,b[this.cacheStorageKeyOnObject]=void 0,b.trigger(this.keyOnObject)},registerOnDefinition:function(b,T){this._super.apply(this,arguments);var I=this;this.cacheStorageKeyOnObject="_cacheStorageForProperty_"+T,this.cacheExistenceKeyOnObject="_cacheExistenceForProperty_"+T,M.observer({dependencies:this.dependencies,observerCallback:function(){I.invalidateForObject(this)},decideRequiresUpdate:this.decideRequiresUpdate}).registerOnDefinition(b,"_dependencyObserverForProperty_"+T),this.didChange&&M.observer({dependencies:[T],observerCallback:this.didChange,decideRequiresUpdate:this.decideRequiresUpdate}).registerOnDefinition(b,"_didChangeObserverForProperty_"+T)}}),M.observableProperty=M.ObservableProperty.extend.bind(M.ObservableProperty),M.ProxyProperty=M.ObservableProperty.extend({proxyPath:null,decode:function(b){return b},encode:function(b){return b},init:function(b){var T=typeof b=="string"?b:b.proxyPath;if(!T)throw"A proxyPath must be configured on a ProxyProperty.";this.dependencies=[T];var I=this;this.get=function(){return I.decode(this.getPath(I.proxyPath))},b&&b.readOnly||(this.set=function(S){this.setPath(I.proxyPath,I.encode(S))}),typeof b=="string"?this._super({proxyPath:b}):this._super.apply(this,arguments)}}),M.proxyProperty=M.ProxyProperty.create.bind(M.ProxyProperty),M.boundFunction=function(b){return M.property(function(){return b.bind(this)})},E.a=M},function(J,E,v){v.d(E,"a",function(){return w});var w={default:"full",FULL:"full",HINT:"hint",LOOP:"loop"}},function(J,E,v){function w(h,l){if(!(h instanceof l))throw new TypeError("Cannot call a class as a function")}var P=function(){function h(l,F){for(var y=0;y<F.length;y++){var t=F[y];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,t.key,t)}}return function(l,F,y){return F&&h(l.prototype,F),y&&h(l,y),l}}(),m=navigator.userAgent.toLowerCase(),p=/\sedge\//.test(m),d=function(){function h(){w(this,h)}return P(h,null,[{key:"isEdge",get:function(){return p}},{key:"isChrome",get:function(){return h._isChrome}},{key:"isSafari",get:function(){return h._isSafari}},{key:"isFirefox",get:function(){return h._isFirefox}},{key:"isIE",get:function(){return h._isIE}},{key:"isIOS",get:function(){if(h._isIOS)return!0;var l=window.top,F=l.document;return!(!h._macLike||!("ontouchstart"in l||"createTouch"in F))}}]),h}();E.a=d,d._isChrome=!d.isEdge&&/chrome/.test(m),d._isSafari=!d.isEdge&&!d.isChrome&&/safari/.test(m),d._isFirefox=!d.isEdge&&!d.isChrome&&!d.isSafari&&/firefox/.test(m),d._isIE=!d.isEdge&&!d.isChrome&&!d.isSafari&&!d.isFirefox&&/trident|msie/.test(m),d._isIOS=!!navigator.userAgent.match(/\b(iPad|iPhone|iPod)\b.*\bOS \d+_\d+/i),d._macLike=/mac/i.test(navigator.userAgent)&&!/like mac/i.test(navigator.userAgent)},function(J,E,v){var w=v(10),P=v(1);v.d(E,"a",function(){return m});var m={_mappingToLocalizedStrings:{live:"Live",get bounce(){return w.a.getString("VideoEffects.Badge.Title.Bounce")},get exposure(){return w.a.getString("VideoEffects.Badge.Title.LongExposure")},get loop(){return w.a.getString("VideoEffects.Badge.Title.Loop")}},_mappingToPlaybackStyle:{bounce:P.a.LOOP,exposure:P.a.FULL,live:P.a.FULL,loop:P.a.LOOP},default:"live",BOUNCE:"bounce",EXPOSURE:"exposure",LIVE:"live",LOOP:"loop",toBadgeText:function(p){return this.toLocalizedString(p).toLocaleUpperCase()},toLocalizedString:function(p){return this._mappingToLocalizedStrings[p||m.default]},toPlaybackStyle:function(p){return this._mappingToPlaybackStyle[p||P.a.default]}}},function(J,E,v){function w(a,c,u){return c in a?Object.defineProperty(a,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[c]=u,a}var P=v(0),m=v(7),p=v(39),d=v(38),h=v(40),l=v(9),F=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var u=arguments[c];for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&(a[g]=u[g])}return a},y=P.a.Object.extend({layerName:null,renderLayerClass_dom:null,renderLayerMixin:{},init:function(a){this._super(),this.renderLayerMixin=a},getRenderLayer:function(a,c){return this["renderLayerClass_"+a.approach].extend(this.renderLayerMixin,{layerName:this.layerName}).create(a,c)}}),t=y.extend({renderLayerClass_dom:p.a}),n=y.extend({renderLayerClass_dom:d.a}),i=y.extend({renderLayerClass_dom:h.a}),o=P.a.Object.extend({staticMembers:{PhotoIngredient:t,InterpolatedVideoIngredient:n,VideoIngredient:i,computedStyle:m.a.computedStyle,getRecipeFromPlaybackStyle:function(a){return this._recipesByPlaybackStyle[a]},registerRecipeWithPlaybackStyle:function(a,c){this._recipesByPlaybackStyle=F({},this._recipesByPlaybackStyle,w({},c,a))}},correspondingPlaybackStyle:null,get name(){return"recipe_for_playbackStyle_"+this.correspondingPlaybackStyle},minimumShortenedDuration:0,spontaneousFinishDuration:0,ingredients:null,requiresInterpolation:!1,init:function(a){this.ingredients=[],this._super();for(var c in a)if(a.hasOwnProperty(c)){var u=a[c];this[c]=u,y.isClassFor(u)&&(u.layerName=c,this.ingredients.push(u))}this.correspondingPlaybackStyle&&o.registerRecipeWithPlaybackStyle(this,this.correspondingPlaybackStyle)},getRenderLayers:function(a){for(var c,u=[],g=0;c=this.ingredients[g];g++)c.isDisabled||u.push(c.getRenderLayer(a,this));return u},beginFinishingPlaybackEarly:function(a){if(!a.isPlaying)return void(a.wantsToPlay=!1);a.duration=Math.min(a.duration,Math.max(this.minimumShortenedDuration,a.currentTime+this.spontaneousFinishDuration))},calculateAnimationDuration:function(a,c,u){return c||0},continuePlayback:function(a){a.currentTime<a.duration?a._rafID=requestAnimationFrame(a._nextFrame.bind(a)):(a.stop(),a.dispatchEvent(v.i(l.f)()))},register:function(){},requestMoreCompatibleRecipe:function(){return this}});E.a=o},function(J,E,v){var w=v(12),P={debug:function(m){for(var p=arguments.length,d=Array(p>1?p-1:0),h=1;h<p;h++)d[h-1]=arguments[h];w.a&&console.debug.apply(console,arguments)},log:function(m){for(var p=arguments.length,d=Array(p>1?p-1:0),h=1;h<p;h++)d[h-1]=arguments[h];w.a&&console.log.apply(console,arguments)},info:function(m){for(var p=arguments.length,d=Array(p>1?p-1:0),h=1;h<p;h++)d[h-1]=arguments[h];w.a&&console.info.apply(console,arguments)},warn:function(m){for(var p=arguments.length,d=Array(p>1?p-1:0),h=1;h<p;h++)d[h-1]=arguments[h];console.warn.apply(console,arguments)},error:function(m){for(var p=arguments.length,d=Array(p>1?p-1:0),h=1;h<p;h++)d[h-1]=arguments[h];console.error.apply(console,arguments)}};E.a=P},function(J,E,v){v.d(E,"a",function(){return w});var w;(function(P){P[P.FAILED_TO_DOWNLOAD_RESOURCE=0]="FAILED_TO_DOWNLOAD_RESOURCE",P[P.PHOTO_FAILED_TO_LOAD=1]="PHOTO_FAILED_TO_LOAD",P[P.VIDEO_FAILED_TO_LOAD=2]="VIDEO_FAILED_TO_LOAD"})(w||(w={}))},function(J,E,v){var w=v(8),P=v(0),m=w.a.extend({_hasBeenDisposed:!1,staticMembers:{computedStyle:function(p){return p._lpk_isComputedStyle=!0,p}},recipe:P.a.observableProperty(),renderer:P.a.observableProperty(),duration:P.a.proxyProperty("renderer.duration"),canRender:P.a.observableProperty(!1),computedStyles:P.a.property(function(){return[]}),displayWidth:0,displayHeight:0,shouldLoop:!1,init:function(p,d){this.renderer=p,this.recipe=d,this._super();for(var h in this){var l=this[h];l&&l._lpk_isComputedStyle&&this.computedStyles.push({styleKey:h,getter:l})}},updateSize:function(p,d){if(!arguments.length)return this.updateSize(this.displayWidth,this.displayHeight);this.displayWidth=p,this.displayHeight=d},setUpForRender:function(){},tearDownFromRender:function(){this.reduceMemoryFootprint()},reduceMemoryFootprint:function(){},_canRenderDidChange:P.a.observer("canRender","renderer._lastRecipe",function(p,d){var h=this.recipe,l=this.renderer;this._hasBeenDisposed||(!p||!d||d!==h&&l._hasInitialized?this.tearDownFromRender():(l._hasInitialized=!0,this.setUpForRender(),this.updateSize()))}),prepareToRenderAtTime:function(){return!0},canRenderAtTime:function(){return!0},renderAtTime:function(p){if(!arguments.length)return this.renderAtTime(this._lastRenderedTime);this._lastRenderedTime=p;for(var d,h=0;d=this.computedStyles[h];h++)d.value=d.getter.call(this,p);this.renderStyles(this.computedStyles)},renderStyles:function(p){},dispose:function(){this.detach(),this._hasBeenDisposed=!0}});E.a=m},function(J,E,v){var w=v(0),P=w.a.Object.extend({element:null,_lpk_isView:!0,tagName:"div",eventDispatchingElement:null,init:function(m){m?this.element=m:this.tagName&&(this.element=document.createElement(this.tagName)),this._super()},attachInto:function(m,p,d){if(!this.element)return void(this.parentView=m);p||(p=m.element),d&&d._lpk_isView&&(d=d.element),d?p.insertBefore(this.element,d):p.appendChild(this.element),this.parentView=m},detach:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.parentView=null},dispatchEvent:function(m){var p=this.eventDispatchingElement||this.element;if(!p)throw"Cannot dispatch an event from a view with no DOM element.";p.dispatchEvent.call(p,m)},parentView:w.a.observableProperty(null)});E.a=P},function(J,E,v){function w(y){return function(t){return new CustomEvent(y,{detail:t})}}var P=v(14);v.d(E,"a",function(){return m}),v.d(E,"b",function(){return p}),v.d(E,"f",function(){return d}),v.d(E,"e",function(){return h}),v.d(E,"c",function(){return l}),v.d(E,"d",function(){return F}),function(){function y(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),i}if(typeof window.CustomEvent=="function")return!1;y.prototype=window.Event.prototype,window.CustomEvent=y}();var m=w(P.a.LIVEPHOTOSKIT_LOADED),p=w("canplay"),d=w("ended"),h=w("error"),l=w("photoload"),F=w("videoload")},function(J,E,v){var w=v(0),P=["ar-sa","ca-cs","cs-cz","da-dk","nl-nl","pt-br","pt-pt","no-no","el-gr","en-us","fi-fi","fr-fr","de-de","he-il","hr-hr","hu-hu","id-id","it-it","ja-jp","ko-kr","ms-my","pl-pl","ro-ro","ru-ru","zh-cn","zh-tw","sk-sk","es-es","sv-se","th-th","tr-tr","uk-ua","vi-vi"],m={"es-419":"es-es",pt:"pt-pt",no:"no-no",nb:"no-no",nn:"no-no",zh:"zh-cn","zh-Hans":"zh-cn","zh-Hant":"zh-tw","zh-HK":"zh-tw","zh-MO":"zh-tw","zh-SG":"zh-cn"},p={};for(var d in m){var h=m[d],l=p[h]||[];p[h]=[].concat(function(g){if(Array.isArray(g)){for(var x=0,f=Array(g.length);x<g.length;x++)f[x]=g[x];return f}return Array.from(g)}(l),[d])}for(var F={},y=0;y<P.length;y++){var t=P[y];try{var n=v(21)("./"+t+".lproj/strings.json"),i=t.split("-")[0],o=p[t];if(F[t]=n,F[i]||(F[i]=n),o)for(var a in o)F[a]=n}catch{}}var c=function(g){var x=u.locale,f=u.strings;return(f[x]||f["en-us"])[g]||""},u=w.a.Object.extend({locale:w.a.observableProperty({get:function(g){return g||window.navigator.language},set:function(g){return g}}),getString:c,strings:F}).create();E.a=u},function(J,E,v){function w(C,N){if(!(C instanceof N))throw new TypeError("Cannot call a class as a function")}function P(C){var N=parseFloat(C);if(+N===N)return N;var $=C==="true"||C!=="false"&&void 0;return!!$===$?$:C}var m=v(27),p=v(0),d=v(5),h=v(1),l=v(3),F=v(12);v.d(E,"a",function(){return x}),v.d(E,"b",function(){return f}),v.d(E,"c",function(){return O});var y=Object.assign||function(C){for(var N=1;N<arguments.length;N++){var $=arguments[N];for(var Y in $)Object.prototype.hasOwnProperty.call($,Y)&&(C[Y]=$[Y])}return C},t="property",n={play:"method",pause:"method",stop:"method",toggle:"method",beginFinishingPlaybackEarly:"method",isPlaying:"read_only_property",wantsToPlay:"read_only_property",currentTime:"read_only_property",renderedTime:"read_only_property",duration:"read_only_property",autoplay:t,caption:t,playbackStyle:t,preloadedEffectType:t,updateSize:"method",photoWidth:"read_only_property",photoHeight:"read_only_property",videoWidth:"read_only_property",videoHeight:"read_only_property",effectType:t,proactivelyLoadsVideo:t,photoSrc:t,photoMimeType:t,videoSrc:t,videoMimeType:t,metadataVideoSrc:t,photo:t,video:t,photoTime:t,frameTimes:t,videoRotation:t,canPlay:"read_only_property",loadProgress:"read_only_property",errors:"read_only_property",showsNativeControls:t,observe:"method"};delete n.observe;var i=function(){var C=[];for(var N in n)n.hasOwnProperty(N)&&C.push(N);return C}(),o={},a=i.map(function(C){var N="data-"+p.a.String.hyphenate(C);return o[N]=C,N}),c=i.map(function(C){return n[C]}),u={enumerable:!1,configurable:!1,writable:!1},g={enumerable:!1,configurable:!1},x=function(C,N){if(!C)return d.a.warn("LivePhotosKit.augmentElementAsPlayer requires a target element to augment."),null;if(C.tagName==="IMG"){var $=document.createElement("div"),Y=C.parentNode,te=C.getAttribute("src"),M=C.getAttribute("photo-src")||te;C.removeAttribute("src"),C.setAttribute("data-photo-src",M);for(var b=C.attributes,T=0;T<b.length;T++){var I=b[T],S=I.nodeName,D=I.value;$.setAttribute(S,D)}Y.insertBefore($,C),Y.removeChild(C),C=$}var U=void 0,B=void 0,H=C;if(H.__isLPKPlayer__)return H;u.value=!0,Object.defineProperty(H,"__isLPKPlayer__",u);var V=function(){var ve=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};F.a&&!ve.videoSrc&&ve.photoSrc?d.a.warn("Changing a `photoSrc` independent of its `videoSrc` can result in unexpected behavior"):F.a&&ve.videoSrc&&!ve.photoSrc&&d.a.warn("Changing a `videoSrc` independent of its `photoSrc` can result in unexpected behavior");var he=B?{photoSrc:B.photo,videoSrc:B.videoSrc,effectType:B.effectType,autoplay:B.autoplay,proactivelyLoadsVideo:B.proactivelyLoadsVideo}:{},se=y({},he,ve),_e=(se.photoSrc,se.videoSrc,se.effectType),De=se.autoplay,Fe=se.proactivelyLoadsVideo;U=p.a.objectPool.get(),se.preloadedEffectType=_e,se.autoplay=De!==!1;var je=_e||l.a.default;l.a.toPlaybackStyle(je)===h.a.LOOP&&se.autoplay&&(F.a&&!Fe&&d.a.warn("When using a looping asset you should set `proactivelyLoadsVideo` to `true` unless `autoplay` is also set to `false`"),se.proactivelyLoadsVideo=!0);for(var ze in se)Object.prototype.hasOwnProperty.call(se,ze)&&(n[ze]===t?U[ze]=se[ze]:d.a.warn("LivePhotosKit.Player: Initial configuration for `"+ze+"` was ignored, because the property is not a writable property."));if(B)for(var Ze in U){var st=U[Ze];B[Ze]=st}else B=m.a.create(H,U);p.a.objectPool.ret(U),U=null};H.setProperties=V,H.setProperties(N);for(var K,re,oe=0;(K=i[oe])&&(re=c[oe]);oe++)(function(ve,he,se){se==="method"?(u.value=B[he].bind(B),Object.defineProperty(H,he,u)):(g.set=se===t?function(_e){B[he]=_e}:function(){},g.get=function(){return B[he]},Object.defineProperty(H,he,g))})(0,K,re);u.value=function(){var ve=arguments.length,he=arguments[ve-1];if(ve<1||!(he instanceof Function))throw new Error("Invalid arguments passed to `observe`. Form: key, [key, ], callback.");for(var se=p.a.arrayPool.get(),_e=0,De=ve;_e<De;_e++)se[_e]=arguments[_e];for(var Fe=0,je=ve-1;Fe<je;Fe++){var ze=n[se[Fe]];if(ze!==t&&ze!=="read_only_property")throw new Error("Can't observe non-observable property '"+se[Fe]+"'.")}se[ve-1]=he.bind(this);var Ze=B.observe.apply(B,se);return p.a.arrayPool.ret(se),new L(Ze,B)},Object.defineProperty(H,"observe",u);for(var K,re,ce,oe=0;(K=i[oe])&&(re=c[oe])&&(ce=a[oe]);oe++)if(re===t){var ue=H.getAttribute(ce);ue&&(K==="effectType"?B.preloadedEffectType=P(ue):B[K]=P(ue))}var xe=H.setAttribute;u.value=function(ve,he){var se=o[ve];if(!se)return void xe.apply(this,arguments);this[se]=P(he)},Object.defineProperty(H,"setAttribute",u);var pe=H.removeAttribute;u.value=function(ve){var he=o[ve];if(!he)return pe.apply(this,arguments);this[he]=null},Object.defineProperty(H,"removeAttribute",u);for(var me,Se,we,Re=0;(me=i[Re])&&(Se=c[Re])&&(we=a[Re]);Re++)(function(ve,he,se,_e){if(se!==t&&se!=="read_only_property")return"continue";H.observe(he,function(De){De==null||typeof De!="string"&&+De!==De&&typeof De!="boolean"?pe.call(this,_e):xe.call(this,_e,String(De))})})(0,me,Se,we);return H.getAttribute("data-live-photo")!==""&&H.setAttribute("data-live-photo",""),u.value=B,Object.defineProperty(H,"__internalLPKPlayer__",u),u.value=void 0,g.set=g.get=void 0,H},f=function(C){var N=document.createElement("div");return x(N,C)},O=function(C,N){if(arguments.length>=3||typeof arguments[0]=="string"&&typeof arguments[1]=="string")throw new Error("LivePhotosKit.Player: Creating a new Player using arguments of the form 'photoSrc, videoSrc, [targetElement, [options]]' is no longer supported. Instead, use the new signature, '[targetElement, [options]]");return d.a.warn("The `LivePhotosKit.Player` method will be deprecated in an upcoming release. Please use the `LivePhotosKit.augementElementAsPlayer` or `LivePhotosKit.createPlayer` methods, instead."),C?x(C,N):f(N)},L=function C(N,$){w(this,C),this.fire=function(){$[N.keyOnObject]()},this.disconnect=function(){N.unregisterFromDefinition($)},this.connect=function(){N.registerOnDefinition($)}}},function(J,E,v){var w=/_lpk_debug=true/i;E.a=w.test(window.location.search)||w.test(window.location.hash)},function(J,E,v){var w={setUpForRender:function(){this.attachInto(this.renderer)},tearDownFromRender:function(){this.detach(),this._super()},renderStyles:function(P){for(var m,p=this.element,d=p.style,h=0;m=P[h];h++){var l=m,F=l.styleKey,y=l.value;d[F]!==y&&(d[F]=y)}}};E.a=w},function(J,E,v){var w=v(55),P=v(56),m=v(57);E.a={APP_NAME:"LivePhotosKit",BUILD_NUMBER:w.a,MASTERING_NUMBER:P.a,FEEDBACK_URL_PREFIX:"https://feedbackws.icloud.com",LIVEPHOTOSKIT_LOADED:"livephotoskitloaded",URL_PREFIX:"https://cdn.apple-livephotoskit.com",VERSION:m.a}},function(J,E,v){function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var P=v(3),m=v(50),p=v(18),d=v(10),h=v(1);v.d(E,"a",function(){return y});var l=function(){function t(n,i){for(var o=0;o<i.length;o++){var a=i[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,i,o){return i&&t(n.prototype,i),o&&t(n,o),n}}(),F={element:null,label:"",labelPadding:6,leftPadding:5,height:25,backgroundColor:"rgba(255, 255, 255, 0.7)",itemColor:"rgb(0, 0, 0)",fontSize:9,borderRadius:5,dottedRadius:8.5,innerRadius:5.25,zIndex:4,shouldAnimateProgressRing:!0,progressRingAnimationSpeed:300,shouldAddEventListeners:!0,effectType:null,playbackStyle:null,configurePlayAction:v.i(m.a)(),configureStopAction:v.i(m.a)()},y=function(){function t(){var n=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};w(this,t),this._setInstanceProps(i),this._createCanvas(),this.redraw(),this._addEventListeners(),d.a.observe("locale",function(){return n.updateBadgeText()})}return l(t,[{key:"attachPlayerInstance",value:function(n){n.attachBadgeView(this),this.updateBadgeText(n.effectType)}},{key:"redraw",value:function(){var n=this.progress;n>0&&this.shouldAnimateProgressRing?this._animateProgressRing():this._redraw(n)}},{key:"reset",value:function(){var n=this._requestedFrame;n&&cancelAnimationFrame(n),this._progress=0,this._previousProgress=0,this.redraw()}},{key:"appendTo",value:function(n){n.appendChild(this.element)}},{key:"updateAriaLabel",value:function(){var n=P.a.toLocalizedString(this.effectType),i=d.a.getString("VideoEffects.Badge");this.element.setAttribute("aria-label",i+": "+n)}},{key:"updateBadgeText",value:function(n){n?this.effectType=n:n=this.effectType,this.label=n?P.a.toBadgeText(n):"",this.playbackStyle=P.a.toPlaybackStyle(n),this.updateAriaLabel(),this._redraw()}},{key:"_createCanvas",value:function(){var n=this.element;if(n){if(n.tagName.toLowerCase()!=="canvas")throw new Error("Backing element for LivePhotoBadge needs to be an HTMLCanvasElement.")}else n=this.element=document.createElement("canvas");n.setAttribute("role","button"),this.updateAriaLabel(),n.classList.add("lpk-badge"),this._context=n.getContext("2d")}},{key:"_setCanvasSize",value:function(){var n=this.element,i=p.a(),o=this.height,a=this.width;n.height=o*i,n.width=a*i,n.style.height=o+"px",n.style.width=a+"px"}},{key:"_setInstanceProps",value:function(n){var i={};for(var o in F)i.hasOwnProperty.call(F,o)&&(this[o]=n.hasOwnProperty(o)?n[o]:F[o]);this.defaultProps=F}},{key:"_redraw",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=(this.element,this.label),o=i.toLowerCase()||P.a.default;this._setCanvasSize(),this._context.clearRect(0,0,this.width,this.height),this._drawBackground(),this._drawLabel(),this.shouldShowError||(this._drawInnerCircle(),P.a.toPlaybackStyle(o)!==h.a.LOOP?this._drawPlayArrow():this._drawLoopCircle()),this.shouldShowError?(this._drawProgressRing(1),this._drawErrorSlash()):this.progress>0?this._drawProgressRing(n):this._drawDottedCircle()}},{key:"_drawBackground",value:function(){var n=p.a(),i=this._context,o=this.borderRadius*n,a=this.width*n,c=this.height*n;i.beginPath(),i.moveTo(o,0),i.lineTo(a-o,0),i.quadraticCurveTo(a,0,a,o),i.lineTo(a,c-o),i.quadraticCurveTo(a,c,a-o,c),i.lineTo(o,c),i.quadraticCurveTo(0,c,0,c-o),i.lineTo(0,o),i.quadraticCurveTo(0,0,o,0),i.closePath(),i.fillStyle=this.backgroundColor,i.fill()}},{key:"_drawDottedCircle",value:function(){for(var n=t.numberOfDots,i=this.dottedRadius*p.a(),o=0;o<n;o++){var a=this.x0+i*Math.cos(2*Math.PI*o/n),c=this.y0+i*Math.sin(2*Math.PI*o/n);this._drawDot(a,c)}}},{key:"_drawDot",value:function(n,i){var o=this._context,a=p.a()===1?1:1.25;o.beginPath(),o.arc(n,i,a,0,2*Math.PI),o.fillStyle=this.itemColor,o.fill()}},{key:"_drawInnerCircle",value:function(){var n=p.a(),i=this._context,o=this.innerRadius*n;i.beginPath(),i.arc(this.x0,this.y0,o,0,2*Math.PI),i.lineWidth=n===1?1.25:1.5,i.strokeStyle=this.itemColor,i.stroke()}},{key:"_drawPlayArrow",value:function(){var n=p.a(),i=this._context,o=5*n,a=4*n,c=this.x0+.5*n,u=this.y0;i.beginPath(),i.moveTo(c-a/2,u-o/2),i.lineTo(c+a/2,u),i.lineTo(c-a/2,u+o/2),i.fillStyle=this.itemColor,i.fill()}},{key:"_drawLoopCircle",value:function(){var n=p.a(),i=this._context,o=2*n;i.beginPath(),i.arc(this.x0,this.y0,o,0,2*Math.PI),i.fillStyle=this.itemColor,i.fill()}},{key:"_drawLabel",value:function(){var n=p.a(),i=this._context,o=(this.leftPadding+2*this.dottedRadius+this.labelPadding)*n,a=(this.height/2+4.5)*n;i.fillStyle=this.itemColor,i.font=this.fontStyle,i.fillText(this.label,o,a)}},{key:"_drawProgressRing",value:function(n){var i=p.a(),o=this._context,a=this.dottedRadius*i,c=2*Math.PI*.75,u=(.75+n)*(2*Math.PI);o.beginPath(),o.arc(this.x0,this.y0,a,c,u,!1),o.lineWidth=1.5*i,o.strokeStyle=this.itemColor,o.stroke()}},{key:"_drawErrorSlash",value:function(){var n=p.a(),i=this._context,o=this.dottedRadius*n,a=o*Math.sqrt(2)/2;i.beginPath(),i.moveTo(this.x0+a,this.y0+a),i.lineTo(this.x0-a,this.y0-a),i.lineWidth=1.5*n,i.strokeStyle=this.itemColor,i.stroke()}},{key:"_animateProgressRing",value:function(){var n=this,i=this.progress,o=this._previousProgress||0,a=Math.abs(i-o),c=i<o;c&&(i=o,o=this.progress);for(var u=a*this.progressRingAnimationSpeed,g=u/(1e3/60),x=a/g,f=[],O=0,L=g;O<L;O++)f.push(o+O*x);f[f.length-1]=i,c&&f.reverse(),function C(){var N=f.shift();n._redraw(N),f.length&&(n._requestedFrame=window.requestAnimationFrame(C)),N===1&&window.setTimeout(function(){n.progress=0},.25*n.progressRingAnimationSpeed)}()}},{key:"_addEventListeners",value:function(){var n=this,i=this.element,o=void 0;i.addEventListener("mouseup",function(){o=window.setTimeout(function(){n.configurePlayAction()},0)}),i.addEventListener("mouseenter",function(){o=window.setTimeout(function(){n.configurePlayAction()},0)}),i.addEventListener("mouseleave",function(){o&&window.clearTimeout(o),n.configureStopAction()})}},{key:"width",get:function(){var n=this._context;if(!n)return 0;var i=this.dottedRadius,o=this.fontStyle,a=this.label,c=this.labelPadding,u=this.leftPadding;n.font=o;var g=n.measureText(a);this._textMetrics=g;var x=a.length>0?g.width:0;return this._width=(x>2?u:-2)+2*i+2*c+Math.ceil(x/p.a())}},{key:"fontStyle",get:function(){return this.fontSize*p.a()+'pt/1 system, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica'}},{key:"x0",get:function(){return(this.dottedRadius+this.leftPadding)*p.a()}},{key:"y0",get:function(){return this.height/2*p.a()}},{key:"progress",set:function(n){typeof n=="number"&&(this._previousProgress=this._progress,this._progress=n,this.redraw())},get:function(){return this._progress}},{key:"shouldShowError",set:function(n){this._shouldShowError=!!n,this._redraw(this.progress)},get:function(){return this._shouldShowError}}],[{key:"numberOfDots",get:function(){return p.a()===1?17:26}}]),t}()},function(J,E,v){var w=v(30),P=v(0),m=v(6),p=w.a.extend({mimeType:P.a.observableProperty({dependencies:["_mimeTypeFromXHR"],get:function(d){return this._mimeTypeFromXHR||d||null}}),_mimeTypeFromXHR:P.a.observableProperty(),requiresMimeTypeForRawArrayBufferSrc:!0,exposedMimeTypeKeyForErrorStrings:"mimeType",exposedSrcKeyForErrorStrings:"src",abortCurrentLoad:function(){this.__xhr&&(this._detachXHR(),this._xhr.abort()),this._mimeTypeFromXHR=null,this.abortCurrentSecondaryLoad()},loadSrc:function(d){if(typeof d=="string"){this._mimeTypeFromXHR=null,this._attachXHR();var h=this._xhr;h.open("GET",d),h.responseType="arraybuffer",h.send(null)}else if(d instanceof ArrayBuffer){if(!this.mimeType&&this.requiresMimeTypeForRawArrayBufferSrc)throw new Error("MIME Type must be assigned to `"+this.exposedMimeTypeKeyForErrorStrings+"` prior to assigning a raw ArrayBuffer to `"+this.exposedSrcKeyForErrorStrings+"`.");this.beginSecondaryLoad(d,this.mimeType)}},get _xhr(){var d=this.__xhr;return d||(d=this.__xhr=new XMLHttpRequest),d},_detachXHR:function(){var d=this._xhr;d.removeEventListener("progress",this._xhrProgress),d.removeEventListener("readystatechange",this._xhrReadyStateChanged)},_attachXHR:function(){var d=this._xhr;d.addEventListener("progress",this._xhrProgress),d.addEventListener("readystatechange",this._xhrReadyStateChanged)},_xhrReadyStateChanged:function(){if(this.state==="loading"){if(this._xhr.readyState>=2&&this._xhr.status!==200){var d=new Error("Failed to download resource from URL assigned to '"+this.exposedSrcKeyForErrorStrings+"'.");return d.errCode=m.a.FAILED_TO_DOWNLOAD_RESOURCE,this.loadDidFail(d)}return this._xhr.readyState===4&&this._xhr.status===200?this._xhrLoadDidFinish():void 0}},_xhrProgress:function(d){if(d&&d.total){var h=(+d.loaded||0)/d.total;+h===h&&(this.progress=Math.max(0,Math.min(1,h)))}},_xhrLoadDidFinish:function(){this._mimeTypeFromXHR=this._xhr.getResponseHeader("Content-Type"),this.beginSecondaryLoad(this._xhr.response,this.mimeType)},beginSecondaryLoad:function(d,h){this._defaultSecondaryLoadTimeout=setTimeout(this.loadDidSucceed.bind(this,d),0)},abortCurrentSecondaryLoad:function(){this._defaultSecondaryLoadTimeout&&(clearTimeout(this._defaultSecondaryLoadTimeout),this._defaultSecondaryLoadTimeout=null)},init:function(){this._xhrReadyStateChanged=this._xhrReadyStateChanged.bind(this),this._xhrProgress=this._xhrProgress.bind(this),this._super()}});E.a=p},function(J,E,v){var w=v(2);E.a=w.a.isEdge||w.a.isIE},function(J,E,v){function w(){h.forEach(function(l){return l()})}function P(l){h.push(l)}function m(){return window.devicePixelRatio}function p(){return Math.ceil(m())}E.b=P,E.a=p;var d=void 0,h=[];(function(){window.matchMedia&&(d=window.matchMedia("only screen and (-webkit-min-device-pixel-ratio:1.3),only screen and (-o-min-device-pixel-ratio:13/10),only screen and (min-resolution:120dpi)"),d.addListener(w))})()},function(J,E,v){function w(p,d){if(!(p instanceof d))throw new TypeError("Cannot call a class as a function")}var P=function(){function p(d,h){for(var l=0;l<h.length;l++){var F=h[l];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(d,F.key,F)}}return function(d,h,l){return h&&p(d.prototype,h),l&&p(d,l),d}}(),m=function(){function p(d){var h=this;w(this,p),this._k=[],this._v=[],d&&d._k.forEach(function(l){h.set(l,d.get(l))})}return P(p,[{key:"_indexOfKey",value:function(d){return this._k.indexOf(d)}},{key:"get",value:function(d){var h=this._indexOfKey(d);return h===-1?void 0:this._v[h]}},{key:"set",value:function(d,h){var l=this._indexOfKey(d);return l===-1&&(l=this._k.push(d)-1),this._v[l]=h,this}},{key:"delete",value:function(d){var h=this._indexOfKey(d);return h!==-1&&(this._k.splice(h,1),this._v.splice(h,1),!0)}},{key:"clear",value:function(){this._k.length>0&&(this._k.length=0,this._v.length=0)}}]),p}();E.a=m},function(J,E,v){function w(d){if(d===null)return"_null";if(d===void 0)return"_undefined";if(d.hasOwnProperty("_LPKGUID"))return d._LPKGUID;var h=d===void 0?"undefined":P(d);switch(h){case"number":Object.is(d,-0)&&(d="-0");case"string":case"boolean":return h+d;case"object":case"function":p++;var l=h+p;return m.value=l,Object.defineProperty(d,"_LPKGUID",m),l;default:throw"unrecognized object type"}}E.a=w;var P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},m={value:"",enumerable:!1,writable:!1,configurable:!1},p=0},function(J,E,v){function w(p){return v(P(p))}function P(p){var d=m[p];if(!(d+1))throw new Error("Cannot find module '"+p+"'.");return d}var m={"./en-us.lproj/strings.json":22};w.keys=function(){return Object.keys(m)},w.resolve=P,J.exports=w,w.id=21},function(J,E){J.exports={"VideoEffects.Badge":"Badge","VideoEffects.Badge.Title.Loop":"Loop","VideoEffects.Badge.Title.Bounce":"Bounce","VideoEffects.Badge.Title.LongExposure":"Long Exposure"}},function(J,E,v){var w=v(28),P=v(32),m=v(34),p=v(37),d=v(35),h=v(4),l=v(0),F=v(8),y=v(5),t=v(1);m.a.register(),p.a.register(),d.a.register();var n=F.a.extend({approach:"",autoplay:!0,caption:"",_hasInitialized:!1,_lastRecipe:null,recipe:l.a.observableProperty({get:function(){var i=h.a.getRecipeFromPlaybackStyle(this.playbackStyle);return this._setRecipe(i),i},set:function(i){this._setRecipe(i)}}),_setRecipe:function(i){i&&i!==this._lastRecipe&&(this._lastRecipe=i,this.setUpRenderLayers())},requestMoreCompatibleRecipe:function(){this.recipe=this.recipe.requestMoreCompatibleRecipe()},duration:l.a.observableProperty({dependencies:["recipe","provider.videoDuration","provider.photoTime"],get:function(i){var o=this.recipe,a=this.provider,c=a.photoTime,u=a.videoDuration;return o?o.calculateAnimationDuration(i,u,c):0}}),displayWidth:0,displayHeight:0,get backingWidth(){return Math.round(this.displayWidth*devicePixelRatio)},get backingHeight(){return Math.round(this.displayHeight*devicePixelRatio)},get renderLayerWidth(){return this.displayWidth},get renderLayerHeight(){return this.displayHeight},get videoWidth(){return this.videoDecoder.videoWidth},get videoHeight(){return this.videoDecoder.videoHeight},photoWidth:l.a.proxyProperty("photo.width"),photoHeight:l.a.proxyProperty("photo.height"),photo:l.a.proxyProperty("provider.photo"),video:l.a.proxyProperty("provider.video"),photoTime:l.a.proxyProperty("provider.photoTime"),frameTimes:l.a.proxyProperty("provider.frameTimes"),effectType:l.a.proxyProperty("provider.effectType"),preloadedEffectType:l.a.proxyProperty("provider.preloadedEffectType"),playbackStyle:l.a.proxyProperty("provider.playbackStyle"),currentTime:l.a.observableProperty({defaultValue:0,dependencies:["duration"],get:function(i){return Math.min(this.duration||0,Math.max(0,i||0))},didChange:function(i){this.prepareToRenderAtTime(i)}}),canRenderCurrentTime:l.a.observableProperty({readOnly:!0,dependencies:["currentTime"],get:function(){return this.canRenderAtTime(this.currentTime)}}),_currentTimeRenderObserver:l.a.observer("currentTime","canRenderCurrentTime",function(i,o){o&&(this.renderedTime=i)}),renderedTime:l.a.observableProperty({defaultValue:0,didChange:function(i){this.renderAtTime(i),this.currentTime=i}}),areAllRenderLayersPrepared:l.a.observableProperty({defaultValue:!1}),isFullyPreparedForPlayback:l.a.observableProperty({readOnly:!0,dependencies:["video","areAllRenderLayersPrepared","photoTime","frameTimes","playbackStyle"],get:function(){return!!(this.video&&this.areAllRenderLayersPrepared&&(this.photoTime||this.playbackStyle!==t.a.HINT)&&Array.isArray(this.frameTimes))}}),cannotRenderDueToMissingPhotoTimeOrFrameTimes:l.a.observableProperty({readOnly:!0,dependencies:["video","areAllRenderLayersPrepared","photoTime","frameTimes","playbackStyle"],get:function(){return!!(this.video&&this.areAllRenderLayersPrepared&&(!this.photoTime&&this.playbackStyle===t.a.HINT||!Array.isArray(this.frameTimes)))}}),renderLayers:l.a.property(function(){return[]}),videoDecoder:l.a.observableProperty(function(){return this._videoDecoderClass.create({owner:this})}),_videoDecoderClass:w.a.extend({owner:l.a.observableProperty(),provider:l.a.proxyProperty("owner.provider")}),provider:l.a.observableProperty(function(){return P.a.create()}),init:function(){this._super(),this.element.className=((this.element.className||"")+" lpk-live-photo-renderer").trim(),this.element.style.position="absolute",this.element.style.overflow="hidden",this.element.style.textAlign="left"},updateSize:function(i,o){if(!arguments.length)return void(this.displayWidth&&this.displayHeight&&this.updateSize(this.displayWidth,this.displayHeight));this.displayWidth=i=Math.round(i),this.displayHeight=o=Math.round(o),this.element.style.width=i+"px",this.element.style.height=o+"px";for(var a,c=0;a=this.renderLayers[c];c++)a.updateSize(this.renderLayerWidth,this.renderLayerHeight)},_imageOrVideoDidEnterOrLeave:l.a.observer("videoDecoder.canProvideFrames","photo",function(){this.prepareToRenderAtTime(this.currentTime)}),prepareToRenderAtTime:l.a.boundFunction(function(i){this.propertyChanged("canRenderCurrentTime");for(var o,a=!0,c=0;o=this.renderLayers[c];c++)a=o.prepareToRenderAtTime(i)&&a;this.areAllRenderLayersPrepared=a}),canRenderAtTime:function(i){if(i===0)return!0;if(!this.duration&&i)return!1;for(var o,a=!0,c="",u=0;o=this.renderLayers[u];u++)o.canRenderAtTime(i)||(a=!1,c+=(c?", ":"Cannot render; waiting for ")+o.layerName);return c&&y.a.log(c+"."),a},renderAtTime:function(i){if(this.duration)for(var o,a=0;o=this.renderLayers[a];a++)o.renderAtTime(i)},getNewRenderLayers:function(){return this.recipe.getRenderLayers(this)},setUpRenderLayers:function(){var i=this.renderLayers;i&&this._cleanUpRenderLayers(i),this.renderLayers=this.getNewRenderLayers(),this.updateSize(),this.currentTime=0,this.prepareToRenderAtTime(0)},_cleanUpRenderLayers:function(i){for(var o,a=0;o=i[a];a++)o.dispose(),o.tearDownFromRender()},reduceMemoryFootprint:function(){for(var i,o=0;i=this.renderLayers[o];o++)i.reduceMemoryFootprint()},_clearRetainedFramesWhenNecessary:l.a.observer("provider.videoRotation","provider.frameTimes",function(){this.reduceMemoryFootprint(),this.prepareToRenderAtTime(this.currentTime)})});E.a=n},function(J,E,v){var w=v(23),P=w.a.extend({approach:"dom"});E.a=P},function(J,E,v){Object.defineProperty(E,"__esModule",{value:!0});var w=v(14),P=v(9),m=v(10),p=v(11);v.d(E,"augmentElementAsPlayer",function(){return p.a}),v.d(E,"createPlayer",function(){return p.b}),v.d(E,"Player",function(){return p.c});var d=v(6);v.d(E,"Errors",function(){return d.a});var h=v(15);v.d(E,"LivePhotoBadge",function(){return h.a});var l=v(1);v.d(E,"PlaybackStyle",function(){return l.a}),v.d(E,"Localization",function(){return F}),v.d(E,"BUILD_NUMBER",function(){return y}),v.d(E,"MASTERING_NUMBER",function(){return t}),v.d(E,"VERSION",function(){return n}),v.d(E,"LIVEPHOTOSKIT_LOADED",function(){return i});var F={get locale(){return m.a.locale},set locale(b){m.a.locale=b}},y=w.a.BUILD_NUMBER,t=w.a.MASTERING_NUMBER,n=w.a.VERSION,i=w.a.LIVEPHOTOSKIT_LOADED,o=typeof window<"u"&&typeof document<"u";if(o){var a=window.document;if(setTimeout(function(){return a.dispatchEvent(v.i(P.a)())}),a.styleSheets&&document.head){for(var c=null,u=null,g=0;g<a.styleSheets.length;++g)try{var x=a.styleSheets[g];if(x.cssRules)for(var f=0;f<x.cssRules.length;++f){var O=x.cssRules[f];if(O.cssText.indexOf(".lpk-live-photo-player")!==-1){c=O;break}}if(c){u=x;break}}catch(b){if(b.name!=="SecurityError"&&b.message.substring(0,17)!=="Access is denied."&&b.message.substring(0,17)!=="Member not found.")throw b}if(!u){var L=document.createElement("style");L.type="text/css",document.head.appendChild(L),u=L.sheet}var C="user-select: none;-khtml-user-select: none; -moz-user-select: none;-ms-user-select: none;-webkit-touch-callout: none; -webkit-user-select: none;";u.addRule?u.addRule(".lpk-live-photo-player",C):u.insertRule&&u.insertRule(".lpk-live-photo-player {"+C+"}",0)}}if(o&&document.querySelectorAll instanceof Function){var N=function(){M=!0,Array.prototype.forEach.call(document.querySelectorAll("[data-live-photo]"),function(b){return v.i(p.a)(b)})},$=function(){!M&&Y&&te&&N()},Y=/interactive|complete|loaded/.test(document.readyState),te=!!window.LivePhotosKit,M=!1;Y||document.addEventListener("DOMContentLoaded",function(){Y=!0,$()}),te||document.addEventListener("livephotoskitloaded",function(){te=!0,$()}),$()}},function(J,E,v){var w=v(8),P=v(18),m=v(15);v.d(E,"a",function(){return p});var p=w.a.extend({badgeView:null,init:function(){var d=this;this._super(),this._createBadgeView(),P.b(function(){return d.badgeView.redraw()})},_createBadgeView:function(){this.badgeView=new m.a,this.element.appendChild(this.badgeView.element);var d=this.badgeView.element.style;d.top="10px",d.left="10px",d.position="absolute",d.zIndex=4},updateToRendererLayout:function(d,h,l,F){var y=this.badgeView,t=y.element.style;t.left=d+10+"px",t.top=h+10+"px",t.right=""},redraw:function(){this.badgeView.redraw()}})},function(J,E,v){function w(o){if(Array.isArray(o)){for(var a=0,c=Array(o.length);a<o.length;a++)c[a]=o[a];return c}return Array.from(o)}function P(o){if(!o)return!1;try{o.appendChild(i),o.removeChild(i)}catch{return!1}return!0}var m=v(8),p=v(24),d=v(26),h=v(54),l=v(0),F=v(9),y=v(53),t=v(1),n=m.a.extend({staticMembers:{activeInstance:l.a.observableProperty(null)},renderer:l.a.observableProperty(function(){return p.a.create()}),showsNativeControls:l.a.observableProperty(!0),isPlaying:l.a.observableProperty(!1),wantsToPlay:l.a.observableProperty({defaultValue:!1,didChange:function(o){o&&(this.constructor.activeInstance=this)}}),canPlay:l.a.observableProperty({readOnly:!0,dependencies:["isPlaying","renderer.isFullyPreparedForPlayback"],get:function(){return this.isPlaying||this.renderer.isFullyPreparedForPlayback},didChange:function(o){o&&(this._hasHadCanPlay=!0,this.dispatchEvent(v.i(F.b)()),this.wantsToPlay&&this.play())}}),_generateErrorIfPlayedWithoutNecessaryMetadata:l.a.observer("renderer.cannotRenderDueToMissingPhotoTimeOrFrameTimes","wantsToPlay",function(o){o&&this.wantsToPlay&&(this._cannotRenderDueToMissingPhotoTimeOrFrameTimesError=new Error("The `photoTime` and/or `frameTimes` values are missing. Provide them directly (or via `metadataVideoSrc`) if they cannot be parsed from the video.")),o||(this._cannotRenderDueToMissingPhotoTimeOrFrameTimesError=null)}),_cannotRenderDueToMissingPhotoTimeOrFrameTimesError:l.a.observableProperty(),_playerErrors:l.a.observableProperty({readOnly:!0,dependencies:["_cannotRenderDueToMissingPhotoTimeOrFrameTimesError"],get:function(){var o=this._cannotRenderDueToMissingPhotoTimeOrFrameTimesError;return o?[o]:null}}),_captionChanged:l.a.observer("caption",function(o){var a="";o&&(a=": "+o),this.element.setAttribute("aria-label","Live Photo"+a)}),_effectTypeChanged:l.a.observer("effectType",function(o){this.badgeView&&o&&this.updateBadgeText()}),errors:l.a.observableProperty({readOnly:!0,dependencies:["provider.errors","_playerErrors"],get:function(){var o=this.provider.errors,a=this._playerErrors,c=[];return o&&o.length&&c.push.apply(c,w(o)),a&&a.length&&c.push.apply(c,w(a)),c}}),lastError:l.a.observableProperty({dependencies:["provider.lastError"],get:function(o){return o||this.provider.lastError||null},didChange:function(o){o&&(this.throwError(o),this.stop())}}),playbackRate:l.a.proxyProperty("renderer.videoDecoder.playbackRate"),currentTime:l.a.proxyProperty("renderer.currentTime"),renderedTime:l.a.proxyProperty("renderer.renderedTime"),duration:l.a.proxyProperty("renderer.duration"),videoWidth:l.a.proxyProperty("renderer.videoWidth"),videoHeight:l.a.proxyProperty("renderer.videoHeight"),photoWidth:l.a.proxyProperty("renderer.photoWidth"),photoHeight:l.a.proxyProperty("renderer.photoHeight"),recipe:l.a.proxyProperty("renderer.recipe"),requiresInterpolation:l.a.proxyProperty("renderer.recipe.requiresInterpolation"),effectType:l.a.proxyProperty("provider.effectType"),preloadedEffectType:l.a.proxyProperty("renderer.preloadedEffectType"),playbackStyle:l.a.proxyProperty("renderer.playbackStyle"),provider:l.a.proxyProperty("renderer.provider"),proactivelyLoadsVideo:l.a.proxyProperty("provider.proactivelyLoadsVideo"),metadataVideoSrc:l.a.proxyProperty("provider.metadataVideoSrc"),photoMimeType:l.a.proxyProperty("provider.photoMimeType"),photoSrc:l.a.proxyProperty("provider.photoSrc"),photo:l.a.proxyProperty("provider.photo"),videoMimeType:l.a.proxyProperty("provider.videoMimeType"),videoSrc:l.a.proxyProperty("provider.videoSrc"),video:l.a.proxyProperty("provider.video"),photoTime:l.a.proxyProperty("provider.photoTime"),frameTimes:l.a.proxyProperty("provider.frameTimes"),videoRotation:l.a.proxyProperty("provider.videoRotation"),loadProgress:l.a.proxyProperty("provider.progress"),autoplay:l.a.proxyProperty("renderer.autoplay"),caption:l.a.proxyProperty("renderer.caption"),_isZeroSizeWarningLogged:l.a.observableProperty(!1),_renderWhenPossible:l.a.observer("renderer.video","renderer.photo",function(){if(this._cannotRenderDueToMissingPhotoTimeOrFrameTimesError=null,this.updateSize(!0),!this._isZeroSizeWarningLogged){var o=this.element.getBoundingClientRect();o.width!==0&&o.height!==0||(console.warn("The LivePhotosKit Player located at position ("+o.left+", "+o.top+") in the viewport has either a zero width or zero height (or both) and will not render. To fix this, ensure that the Player has a style that will yield a non-zero width and height."),this._isZeroSizeWarningLogged=!0)}}),attachBadgeView:function(o){var a=this;this.badgeView=o,this.updateBadgeText(),o.configurePlayAction(function(){return a.play()}),o.configureStopAction(function(){return a.beginFinishingPlaybackEarly()})},updateBadgeText:function(){this.badgeView.updateBadgeText(this.effectType)},nativeControls:l.a.observableProperty({readOnly:!0,dependencies:["showsNativeControls"],get:function(){var o=this;return this.showsNativeControls?this._nativeControls_cachedValue||(this._nativeControls_cachedValue=d.a.extend({owner:l.a.observableProperty(this),_slurpProgress:l.a.observer("owner.provider.progress",function(a){this.badgeView&&(this.badgeView.progress=a)}),_slurpError:l.a.observer("owner.errors",function(a){this.badgeView&&(this.badgeView.shouldShowError=!!a&&a.length>0)}),init:function(){this._super.apply(this,arguments),o.attachBadgeView(this.badgeView)}}).create()):null},didChange:function(o){this._nativeControls_previousValue&&this._nativeControls_previousValue.detach(),this._nativeControls_previousValue=o,o&&o.attachInto(this)}}),init:function(o,a){var c=this;if(o&&!P(o))throw"Any pre-existing element provided for use as a LivePhotosKit.Player must be able to append child DOM nodes.";o&&o.childNodes.length&&(o.innerHTML="");for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(this[u]=a[u]);switch(this._super(o),this.element.className.indexOf("lpk-live-photo-player")<0&&(this.element.className=this.element.className+" lpk-live-photo-player"),this.element.setAttribute("role","image"),v.i(y.a)(this.element,"position")||this.element.style.position){case"absolute":case"fixed":case"relative":break;default:this.element.style.position="relative"}switch(v.i(y.a)(this.element,"display")||this.element.style.display){case"block":case"inline-block":case"table":case"table-caption":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row-group":case"table-cell":case"table-column":case"table-row":break;default:this.element.style.display="inline-block"}this.renderer.attachInto(this),this.renderer.eventDispatchingElement=this.element,window.addEventListener("resize",this.updateSize),"ontouchstart"in document.documentElement&&(this.addEventListener("touchstart",function(){return c.play()},!1),this.addEventListener("touchend",function(){return c.beginFinishingPlaybackEarly()},!1))},play:function(){if(!this.isPlaying){var o=this.provider;o.video||(o.needsLoadedVideoForPlayback=!0),this.wantsToPlay=!0,this.canPlay&&(this.isPlaying=!0,this._lastFrameNow=Date.now(),this._nextFrame())}return this.isPlaying},pause:function(){this.isPlaying=!1,this.wantsToPlay=!1,this._cancelNextFrame()},stop:function(){this.pause(),this.currentTime=0,this.renderer.duration=NaN},toggle:function(){this.wantsToPlay?this.pause():this.play()},beginFinishingPlaybackEarly:function(){this.recipe.beginFinishingPlaybackEarly(this)},_stopWhenAnotherPlayerStarts:l.a.observer("_constructor.activeInstance",function(o){o&&o!==this&&(this.stop(),this.renderer.reduceMemoryFootprint())}),_constructor:l.a.observableProperty(function(){return n}),_stopPlaybackWhenItemsLoadOrUnload:l.a.observer("video","photo",function(){!this.isPlaying||this.playbackStyle===t.a.LOOP&&this.autoplay||this.stop()}),addEventListener:function(o,a,c){var u=this.element;u.addEventListener.call(u,o,a,c)},removeEventListener:function(o,a,c){var u=this.element;u.removeEventListener.call(u,o,a,c)},_nextFrame:function(){var o=Date.now(),a=(o-this._lastFrameNow)*this.playbackRate;this._lastFrameNow=o,this.currentTime===this.renderedTime&&(this.currentTime+=a/1e3),this.recipe&&this.recipe.continuePlayback(this)},_cancelNextFrame:function(){cancelAnimationFrame(this._rafID)},updateSize:l.a.boundFunction(function(o,a){if(this.photoWidth&&this.photoHeight){var c=o===!0?void 0:o,u=o===!0?o:void 0;if(isNaN(c)||isNaN(a)?(c=this.element.offsetWidth,a=this.element.offsetHeight):(c=Math.round(c),a=Math.round(a),this.element.style.width=c+"px",this.element.style.height=a+"px"),c&&a){if(this._lastUpdateChangeToken===(this._lastUpdateChangeToken=c+":"+a)&&!u)return!1;var g=v.i(h.a)(this.photoWidth,this.photoHeight,c,a),x=Math.ceil(g.height),f=Math.ceil(g.width),O=Math.floor(c/2-f/2),L=Math.round(a/2-x/2),C=this.renderer;C.element.style.top=L+"px",C.element.style.left=O+"px",C.updateSize(f,x),this.displayWidth=c,this.displayHeight=a,this.nativeControls&&this.nativeControls.updateToRendererLayout(O,L,f,x)}}}),_dispatchPhotoLoadEventOnNewPhoto:l.a.observer("photo",function(o){o&&this.dispatchEvent(v.i(F.c)())}),_dispatchVideoLoadEventOnNewVideo:l.a.observer("video",function(o){o&&this.dispatchEvent(v.i(F.d)())}),throwError:function(o){this.dispatchEvent(v.i(F.e)({error:o,errorCode:o.errCode}))}}),i=document.createElement("div");E.a=n},function(J,E,v){function w(){i=!1}function P(){}function m(a,c){return-(a.importance-c.importance)||a.number-c.number}function p(a,c){for(var u=0,g=a.length,x=0;x<g-u;x++)if(a[x]===c&&(u++,x--),u){var f=x+1;a[f]=a[f+u]}return a.length-=u,a}var d=v(52),h=v(29),l=v(0),F=v(17),y=v(2),t=location.href.indexOf("_lpk_play_to_decode=true")!==-1||location.href.indexOf("_lpk_play_to_decode=false")===-1&&!y.a.isSafari&&!y.a.isIOS,n=location.href.indexOf("_lpk_persistent_frames=true")!==-1||(location.href.indexOf("_lpk_persistent_frames=false"),!1),i=!0,o=l.a.Object.extend({id:l.a.property(function(){return v.i(d.a)()}),provider:l.a.observableProperty(),video:l.a.proxyProperty("provider.video"),duration:l.a.proxyProperty("provider.videoDuration"),videoRotation:l.a.proxyProperty("provider.videoRotation"),frameTimes:l.a.proxyProperty("provider.frameTimes"),requiresInterpolation:l.a.proxyProperty("renderer.recipe.requiresInterpolation"),get frameCount(){var a=this.frameTimes;return a?a.length:0},shouldPrepareToSeek:!1,canProvideFrames:l.a.observableProperty({readOnly:!0,dependencies:["video"],get:function(){return!!this.video}}),videoWidth:l.a.observableProperty({readOnly:!0,dependencies:["video","videoRotation"],get:function(){var a=this.video;if(a)return this.videoRotation%180==0?a.videoWidth:a.videoHeight}}),videoHeight:l.a.observableProperty({readOnly:!0,dependencies:["video","videoRotation"],get:function(){var a=this.video;if(a)return this.videoRotation%180==0?a.videoHeight:a.videoWidth}}),playbackRate:l.a.observableProperty(1),_sendPlaybackRateToVideo:l.a.observer("playbackRate","video",function(a,c){c&&(c.playbackRate=a)}),_pendingFrames:l.a.property(function(){return[]}),init:function(){this._largeCanvas=document.createElement("canvas"),this._largeContext=this._largeCanvas.getContext("2d"),this._super.apply(this,arguments)},_handleVideoChange:l.a.observer("video",function(){var a=this.video,c=this._lastVideo;if(this._lastVideo=a,a!==c&&(c&&this.cleanUpOldVideo(c),a&&this.setUpNewVideo(a),a&&n))for(var u=F.a?1:0;this.frameTimes&&u<this.frameTimes.length;u++)this.getFrame(u).retain()}),setUpNewVideo:function(a){a.addEventListener("seeked",this._seeked),a.muted=!0},cleanUpOldVideo:function(a){a.removeEventListener("seeked",this._seeked),a.playbackRate=1,a.muted=!1,a.pause(),this._stopSeekingEntirely()},fractionalIndexForTime:function(a){if(a=Math.min(this.duration,Math.max(0,a)),isNaN(a))return a;var c=this.frameTimes,u=c.length,g=void 0;for(g=0;g<u&&c[g]<a;g++);g&&g--;var x=c[g],f=c[g+1];return f?g+Math.min(1,(a-x)/(f-x)):g},timeForFractionalIndex:function(a){if(a<=0)return 0;if(a>=this.frameTimes.length)return this.duration;var c=0|a,u=Math.ceil(a);if(c===u)return this.frameTimes[c];var g=this.frameTimes[c],x=u<this.frameTimes.length?this.frameTimes[u]:this.duration;return x?g+(a-c)*(x-g):g},getFrame:function(a,c){if(!this.frameTimes)throw"Attempted to get frame before ready.";if(isNaN(this.frameTimes[a]))throw"Frame number "+a+" is is not a frame in the video.";var u=h.a.getCached(this,a);return isNaN(c)||(u.importance=Math.max(u.importance,c)),u.readyState||(this._pendingFrames.push(u),this._pendingFrames.sort(m),u.didPend(),this._isSeeking||this._scheduleArtificialSeek()),u},peekFrame:function(a){var c=h.a.peekCached(this,a);return c&&c.readyState===2&&!c.lacksOwnPixelData?c:null},getNearestDecodedFrame:function(a){for(var c=Math.max(a,this.frameTimes.length-1-a),u=-1;++u<=c;){var g=this.peekFrame(a+u)||this.peekFrame(a-u);if(g)return g}return null},_scheduleArtificialSeek:function(){this._artificialSeekTimeout||(this._artificialSeekTimeout=setTimeout(this._seeked),this._artificialSeekRAFId=requestAnimationFrame(this._seeked))},_unscheduleArtificialSeek:function(){this._artificialSeekTimeout&&(clearTimeout(this._artificialSeekTimeout),this._artificialSeekTimeout=null,cancelAnimationFrame(this._artificialSeekRAFId),this._artificialSeekRAFId=null)},_stopSeekingEntirely:function(){this._unscheduleArtificialSeek(),this._isPlaying=!1,this._isSeeking=!1,this._expectedNextSeenFrameNumber=NaN,this.video&&this.video.pause()},_seeked:l.a.boundFunction(function(a){var c=this._pendingFrames;if((c.length!==0||this.requiresInterpolation)&&!(a instanceof Event&&a.target!==this.video)&&(a instanceof Event||this.video)){this._unscheduleArtificialSeek(),this._isSeeking=!1;var u=this.fractionalIndexForTime(this.video.currentTime);u|=0;for(var g,x=NaN,f=0;g=c[f];f++)if(g.number===u){x=u,g.didDecode(),this._removePendingFrame(g);break}var O=this._expectedNextSeenFrameNumber;if(this._expectedNextSeenFrameNumber=NaN,O<x)for(var L,C=0;L=c[C];C++)L.number>=O&&L.number<x&&(L.didGetSkipped(),this._removePendingFrame(L),C--);var N=c[0];if(!N)return this._isPlaying&&this.requiresInterpolation&&(this._isPlaying=!1,this.video.pause()),void(this._expectedNextSeenFrameNumber=NaN);var $=N.number>u&&N.number<=u+2&&i;if(t||($=!1),$){if(!this._isPlaying){this._isPlaying=!0;try{var Y=this.video.play();Y&&Y.then instanceof Function&&Y.then(P,w)}catch{i=!1}}this._expectedNextSeenFrameNumber=N.number,this._scheduleArtificialSeek()}else this._isPlaying&&(this._isPlaying=!1,this.video.pause()),this._expectedNextSeenFrameNumber=NaN,this.video.currentTime=N.time+1e-4,this._isSeeking=!0}}),_frameWillDispose:function(a){this._removePendingFrame(a)},_removePendingFrame:function(a){p(this._pendingFrames,a),this._pendingFrames.length||this._unscheduleArtificialSeek()}});E.a=o},function(J,E,v){function w(n){n.container=document.createElement("div"),n.container.frame=n,n.container.innerHTML='<div style="position:absolute; left:0; right:0; top:0; bottom:0; text-align:center; line-height:30px; color:white; text-shadow: black 0px 0px 4px,black 0px 0px 4px,black 0px 0px 4px,black 0px 0px 4px; font-family:HelveticaNeue-Light;"></div>',n.textBox=n.container.lastChild,n.container.insertBefore(n.image,n.textBox),n.image.style.position="absolute",n.container.style.cssText="position:relative; display:inline-block; border: 1px solid black;";var i=n._debug_aspect||(n._debug_aspect=n.videoDecoder&&(n.videoDecoder.videoWidth>n.videoDecoder.videoHeight?"landscape":"portrait"));n.container.style.width=n.image.style.width=i==="landscape"?"40px":"30px",n.container.style.height=n.image.style.height=i==="landscape"?"30px":"40px",document.body.appendChild(n.container)}var P=v(12),m=v(48),p=v(5),d=v(0),h=v(46),l=v(2);v.d(E,"a",function(){return F});var F=d.a.Object.extend(h.a,m.a,{staticMembers:{getPoolingCacheKey:function(n,i){return"f"+i+"_in_"+n.id}},container:null,image:null,_context:null,number:-1,time:-1,importance:0,videoDecoder:null,readyState:0,_poolingCacheKey:null,_debugShowInDOM:P.a,lacksOwnPixelData:!1,_postDispose:function(){this.image.width=this.image.height=0},get backingFrame(){return this.lacksOwnPixelData?this.videoDecoder.getNearestDecodedFrame(this.number)||this:this},init:function(){this._postDispose=this._postDispose.bind(this);var n=this.image=document.createElement("canvas");this._context=this.image.getContext("2d"),this._super(),this._debugShowInDOM?w(this):t&&(t.appendChild(n),n.style.cssText="position: absolute; top: 0px; width:1px; height: 1px; display: inline-block;",n.style.left=y+++"px")},initFromPool:function(n,i){clearTimeout(this._postDisposalTimeout),this.videoDecoder=n,this.number=i,this.time=n.frameTimes[i],this._debugShowInDOM&&(this.textBox.innerHTML=this.number)},dispose:function(){this.resetReadiness(),this.videoDecoder._frameWillDispose(this),this.number=this.time=-1,this.importance=0,this.videoDecoder=null,this.readyState=0,this.lacksOwnPixelData=!1,this._postDisposalTimeout=setTimeout(this._postDispose,3e3),this.constructor._disposeInstance(this),this._debugShowInDOM&&(this.textBox.innerHTML="x",this.textBox.style.color="#FF0000",this._context.clearRect(0,0,this.image.width,this.image.height))},didPend:function(){this.readyState=1,this._debugShowInDOM&&(this.textBox.style.color="#FF8800")},didDecode:function(){this.obtainPixelData(),this.readyState=2,this.resolveReadiness(this),this._debugShowInDOM&&(this.textBox.style.color="#00FF00")},obtainPixelData:function(){var n=this.image,i=this._context,o=this.videoDecoder,a=o.videoRotation,c=o.videoWidth,u=o.videoHeight,g=a%180==0?c:u,x=a%180==0?u:c;n.width===c&&n.height===u||(n.width=c,n.height=u),l.a.isFirefox&&i.getImageData(0,0,1,1);for(var f=0;f<a;f+=90)i.translate(f%180?u:c,0),i.rotate(Math.PI/2);i.drawImage(o.video,0,0,g,x),i.setTransform(1,0,0,1,0,0)},didGetSkipped:function(){p.a.log("    Skipped decoding frame "+this.number+". Using nearest frame instead."),this.lacksOwnPixelData=!0,this.readyState=2,this.resolveReadiness(this),this._debugShowInDOM&&(this._context.fillStyle="red",this._context.fillRect(0,0,this.image.width,this.image.height),this.textBox.style.color="#00FF00")}}),y=0,t=function(){if(!l.a.isIE&&!l.a.isEdge)return null;var n=document.createElement("div");return n.style.cssText="top: 0px; left: 0px; width: 50px; height: 1px; overflow: hidden; position: absolute; z-index: 100000; opacity: 0.001; pointer-events: none;",document.body?document.body.appendChild(n):setTimeout(function(){return document.body.appendChild(n)},0),n}()},function(J,E,v){var w=v(0),P=w.a.Object.extend({state:w.a.observableProperty("unloaded"),validateResult:function(m){return!!m},loadSrc:function(m){},abortCurrentLoad:function(){},isSrcLoadAllowed:w.a.observableProperty(!0),_loadSrcOnceAllowed:w.a.observer("isSrcLoadAllowed",function(m){if(m&&this.state==="unloaded"){var p=this.src;p&&(this.state="loading",this.loadSrc(p))}}),src:w.a.observableProperty({didChange:function(m){this._isWritingSrcDueToWritingOfResult||(this._isWritingResultDueToWritingOfSrc=!0,this.result=null,this._isWritingResultDueToWritingOfSrc=!1,this.abortCurrentLoad(),m&&this.isSrcLoadAllowed?(this.state="loading",this.loadSrc(m)):this.state="unloaded")}}),result:w.a.observableProperty({decideRequiresUpdate:function(){return!0},didChange:function(m){if(!this._isWritingResultDueToWritingOfSrc){var p=this.validateResult(m)?"loaded":m||this._isWritingResultDueToError?"errored":"unloaded";this._isWritingResultDueToLoadOfSrc||this._isWritingResultDueToError||(this._isWritingSrcDueToWritingOfResult=!0,this.src=null,this._isWritingSrcDueToWritingOfResult=!1,this.abortCurrentLoad(),this.state="unloaded"),this.state=p}}}),error:w.a.observableProperty(null),_clearErrorOnceNoLongerErrored:w.a.observer("state",function(m){m!=="errored"&&(this.error=null)}),progress:w.a.observableProperty({defaultValue:0,dependencies:["state"],get:function(m){return this.state==="loading"?Math.min(1,Math.max(0,+m||0)):this.state==="loaded"?1:0}}),_clearProgressOnceUnloaded:w.a.observer("state",function(m){m==="unloaded"&&(this.progress=0)}),loadDidFail:function(m){this.state==="loading"&&(this._isWritingResultDueToError=!0,this.result=null,this._isWritingResultDueToError=!1,this.error=m)},loadDidSucceed:function(m){this.state==="loading"&&(this._isWritingResultDueToLoadOfSrc=!0,this.result=m,this._isWritingResultDueToLoadOfSrc=!1,this.error=null)}});E.a=P},function(J,E,v){function w(y,t,n){var i=y.getContext("2d"),o=n===7||n===8?270:n===3||n===4?180:n===5||n===6?90:0,a=t.naturalWidth,c=t.naturalHeight,u=o%180==0?a:c,g=o%180==0?c:a,x=n===2||n===4?-1:1,f=n===5||n===7?-1:1;y.width===u&&y.height===g||(y.width=u,y.height=g);for(var O=0;O<o;O+=90)i.translate(O%180?g:u,0),i.rotate(Math.PI/2);i.scale(x,f),i.translate((x-1)/2*a,(f-1)/2*c),i.drawImage(t,0,0),i.setTransform(1,0,0,1,0,0)}var P=v(16),m=v(51),p=v(6),d=v(3),h=[],l={},F=P.a.extend({mimeType:"image/jpeg",beginSecondaryLoad:function(y,t){var n=v.i(m.a)(y);this._exifOrientationInLastLoadedBuffer=n.orientation||NaN,n.photosRenderEffect===3&&(this.effectType=d.a.EXPOSURE),h[0]=y,l.type=t,this._internalImage.src=this._internalImageSrc=URL.createObjectURL(new Blob(h,l)),(window.photoBuffers||(window.photoBuffers=[])).push(y)},abortCurrentSecondaryLoad:function(){this.__internalImage&&this._internalImage.removeAttribute("src"),this._internalImageSrc&&(URL.revokeObjectURL(this._internalImageSrc),this._internalImageSrc=null),this._exifOrientationInLastLoadedBuffer=null,this.effectType=null},get _internalImage(){var y=this.__internalImage;return y||(y=this.__internalImage=new Image,y.addEventListener("load",this._internalImageLoadDidSucceed.bind(this)),y.addEventListener("error",function(t){this.loadDidFail(t)}.bind(this))),y},get _internalCanvas(){return this.__internalCanvas||(this.__internalCanvas=document.createElement("canvas"))},loadDidFail:function(y){if(y)return y.errCode=p.a.PHOTO_FAILED_TO_LOAD,this._super(y)},_internalImageLoadDidSucceed:function(){var y=this._internalImage;this._exifOrientationInLastLoadedBuffer!==1&&(w(this._internalCanvas,this._internalImage,this._exifOrientationInLastLoadedBuffer),y=this._internalCanvas),this.loadDidSucceed(y)}});E.a=F},function(J,E,v){var w=v(0),P=v(33),m=v(31),p=v(3),d=v(1),h=w.a.Object.extend({videoSrc:w.a.proxyProperty("_videoProvider.src"),videoMimeType:w.a.proxyProperty("_videoProvider.mimeType"),video:w.a.proxyProperty("_videoProvider.result"),effectType:w.a.observableProperty({dependencies:["_photoProvider.effectType","_videoProvider.effectType","preloadedEffectType"],get:function(){return this._photoProvider.effectType||this._videoProvider.effectType||this.preloadedEffectType||p.a.default},didChange:function(l){this.setPlaybackStyle(l)}}),preloadedEffectType:w.a.observableProperty({get:function(l){return l},set:function(l){return this._photoProvider.effectType=null,this._videoProvider.effectType=null,l}}),setPlaybackStyle:function(l){this.effectType=l,this.playbackStyle=p.a.toPlaybackStyle(l)},photoSrc:w.a.proxyProperty("_photoProvider.src"),photoMimeType:w.a.proxyProperty("_photoProvider.mimeType"),photo:w.a.proxyProperty("_photoProvider.result"),playbackStyle:w.a.observableProperty(d.a.default),metadataVideoSrc:w.a.proxyProperty("_metadataVideoProvider.src"),progress:w.a.observableProperty({readOnly:!0,dependencies:["_photoProvider.progress","_videoProvider.state","_videoProvider.progress","_metadataVideoProvider.state","_metadataVideoProvider.progress"],get:function(){var l=this._videoProvider,F=this._metadataVideoProvider,y=l.state,t=F.state,n=y!=="unloaded"||t!=="unloaded"?.75:0,i=n?t==="unloaded"?l.progress:(l.progress+F.progress)/2:0;return this._photoProvider.progress*(1-n)+i*n}}),photoTime:w.a.observableProperty({dependencies:["_metadataVideoProvider.photoTime","_videoProvider.photoTime"],get:function(l){return+l===l?l:this._metadataVideoProvider.photoTime||this._videoProvider.photoTime||null}}),videoRotation:w.a.observableProperty({dependencies:["_videoProvider.videoRotation"],get:function(l){if(+l===l)return l;var F=this._videoProvider.videoRotation;return+F===F?F:null},set:function(l){return 90*Math.round(l/90)%360|0}}),frameTimes:w.a.observableProperty({dependencies:["_metadataVideoProvider.frameTimes","_videoProvider.frameTimes"],get:function(l){return l||this._metadataVideoProvider.frameTimes||this._videoProvider.frameTimes},set:function(l){if(!l)return null;if(typeof l=="string"){var F=w.a.arrayPool.get();w.a.String.splitIntoArray(l,",",F),w.a.Array.mapIntoArray(F,function(a){return Number(a.trim())},F),l=F}for(var y=Array.isArray(l),t=y&&l.length>=2,n=0,i=l.length;n<i&&t;n++){var o=l[n];+o!==o&&(t=!1)}if(!t)throw new Error("If frameTimes is provided, it must be provided as an Array or comma-delimited string containing numbers.");return l}}),videoDuration:w.a.observableProperty({readOnly:!0,dependencies:["frameTimes"],get:function(){return this.frameTimes?this.frameTimes[this.frameTimes.length-1]:void 0}}),proactivelyLoadsVideo:w.a.observableProperty(!1),needsLoadedVideoForPlayback:w.a.observableProperty(!1),_reset_needsLoadedVideoForPlayback_whenAppropriate:w.a.observer("video",function(){this.needsLoadedVideoForPlayback=!1}),isVideoLoadAllowed:w.a.observableProperty({readOnly:!0,dependencies:["proactivelyLoadsVideo","needsLoadedVideoForPlayback"],get:function(){return this.proactivelyLoadsVideo||this.needsLoadedVideoForPlayback}}),errors:w.a.observableProperty({readOnly:!0,dependencies:["_videoProvider.error","_photoProvider.error"],get:function(){return[this._photoProvider.error,this._videoProvider.error].filter(function(l){return!!l})}}),lastError:w.a.observableProperty(),_lastPhotoError:w.a.observableProperty({readOnly:!0,dependencies:["_photoProvider.error"],get:function(){return this._photoProvider.error},didChange:function(l){this.lastError=l}}),_lastVideoError:w.a.observableProperty({readOnly:!0,dependencies:["_videoProvider.error"],get:function(){return this._videoProvider.error},didChange:function(l){this.lastError=l}}),_metadataVideoProvider:w.a.observableProperty(function(){return P.a.extend({requiresMimeTypeForRawArrayBufferSrc:!1,actuallyProvidesResultingVideoFromSecondaryLoad:!1}).create()}),_videoProvider:w.a.observableProperty(function(){return P.a.extend({owner:w.a.observableProperty(this),isSrcLoadAllowed:w.a.proxyProperty("owner.isVideoLoadAllowed"),exposedSrcKeyForErrorStrings:"videoSrc",exposedMimeTypeKeyForErrorStrings:"videoMimeType"}).create()}),_photoProvider:w.a.observableProperty(function(){return m.a.extend({exposedSrcKeyForErrorStrings:"photoSrc",exposedMimeTypeKeyForErrorStrings:"photoMimeType"}).create()})});E.a=h},function(J,E,v){function w(u){var g=[0,0,0,0,0,0,0,0,1];g[0]=P(u.slice(0,4),16,16),g[1]=P(u.slice(4,8),16,16),g[3]=P(u.slice(12,16),16,16),g[4]=P(u.slice(16,20),16,16);for(var x=0;x<c.length;x++)if(m(c[x],g))return 90*x;return 0}function P(u,g,x){var f=u[0]<<24|u[1]<<16|u[2]<<8|u[3];return Math.abs(f>>x)*(f&1<<g+x-1?-1:1)}function m(u,g){if(u===g)return!0;if(!u||!g)return!1;var x=u.length;if(x!==g.length)return!1;for(var f=0;f<x;f++)if(u[f]!==g[f])return!1;return!0}var p=v(16),d=v(45),h=v(0),l=v(5),F=v(6),y=v(2),t=v(3),n=[],i={},o=p.a.extend({__internalVideo:null,_internalVideoSRC:null,photoTime:h.a.observableProperty(),playbackStyle:h.a.observableProperty(null),effectType:h.a.observableProperty(null),frameTimes:h.a.observableProperty(),videoRotation:h.a.observableProperty(),actuallyProvidesResultingVideoFromSecondaryLoad:!0,_clearMetadataPropertiesOnUnload:h.a.observer("state",function(u){u!=="loaded"&&(this.photoTime=this.frameTimes=this.videoRotation=void 0)}),beginSecondaryLoad:function(u,g){this.preprocessAndAttemptToReadMetadataFromBuffer(u),this.actuallyProvidesResultingVideoFromSecondaryLoad&&(n[0]=u,i.type=g==="video/quicktime"?"video/mp4":g,g==="application/octet-stream"&&(l.a.warn('Encountered a Content-Type of "application/octet-stream" for the file obtained for `videoSrc`.Some browsers may be unable to use the video with this MIME type. If the video portion of the Player is not functioning, make sure the proper MIME type is being provided with the response,or provide the proper MIME type manually by assigning it to the `videoMimeType` property on the Player instance. For now, an attempt will be made to treat the videos bytes as "video/mp4", but playback is not guaranteed unless either of these corrective steps are taken.'),g="video/mp4"),this._internalVideo.src=this._internalVideoSRC=URL.createObjectURL(new Blob(n,i)),y.a.isIOS&&this._internalVideo.load())},abortCurrentSecondaryLoad:function(){this.__internalVideo&&(this.__internalVideo.pause(),this.__internalVideo.removeAttribute("src"),this.__internalVideo.load(),y.a.isIOS&&(this.__internalVideo=null),this._internalVideoSRC&&(URL.revokeObjectURL(this._internalVideoSRC),this._internalVideoSRC=null),this.effectType=null)},get _internalVideo(){var u=this.__internalVideo;return u||(u=this.__internalVideo=document.createElement("video"),u.addEventListener("canplay",this.loadDidSucceed.bind(this)),u.addEventListener("error",this.loadDidFail.bind(this)),u.volume=0),u},loadDidFail:function(u){if(u)return u.errCode=F.a.VIDEO_FAILED_TO_LOAD,this._super(u);var g=this.__internalVideo;return g.error.errCode=F.a.VIDEO_FAILED_TO_LOAD,g&&this._super(g.error)},loadDidSucceed:function(){var u=this.__internalVideo;return u&&this._super(u)},preprocessAndAttemptToReadMetadataFromBuffer:function(u){var g=void 0,x=void 0;try{g=new d.a(new d.b(u)),g.read()}catch{g=null}if(!g)return this.photoTime=null,this.frameTimes=null,void(this.videoRotation=0);var f=(x=g.tracks)&&(x=x.vide)&&(x=x[0])&&x.getAllSampleSeconds&&x.getAllSampleSeconds();f&&(this.frameTimes=f);var O=void 0;try{O=g.tracks.meta[0].timeToSeconds(g.tracks.meta[0].trak.edts.elst.editList[0].trackDuration)}catch{}O&&(this.photoTime=O);var L=new Uint8Array(u),C=(x=g.tracks)&&(x=x.soun)&&(x=x[0])&&(x=x.trak)&&x.offset;if(C){var N="free";L[C+4]=N.charCodeAt(0),L[C+5]=N.charCodeAt(1),L[C+6]=N.charCodeAt(2),L[C+7]=N.charCodeAt(3)}var $=(x=g.tracks)&&(x=x.vide)&&(x=x[0])&&(x=x.trak)&&(x=x.tkhd)&&(x=x.offset)&&x+48,Y=0;if($){for(var te=[],M=0;M<a.length;M++)te[M]=L[$+M];if(Y=w(te))for(var b=0;b<a.length;b++)L[$+b]=a[b]}this.videoRotation=Y;var T=g.metaData.keys&&g.metaData.keys.keyList.get("com.apple.photos.variation-identifier"),I=void 0;if(T>0)switch(g.metaData.values.items[T]){case 1:I=t.a.LOOP;break;case 2:I=t.a.BOUNCE;break;case 3:I=t.a.EXPOSURE}this.effectType=I}}),a=[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0],c=[[1,0,0,0,1,0,0,0,1],[0,1,0,-1,0,0,0,0,1],[-1,0,0,0,-1,0,0,0,1],[0,-1,0,1,0,0,0,0,1]];E.a=o},function(J,E,v){var w=v(4),P=v(1),m=v(2),p=m.a.isSafari,d=w.a.create({correspondingPlaybackStyle:P.a.FULL,get minimumShortenedDuration(){return this.enterDuration+this.exitDuration+.01},get spontaneousFinishDuration(){return this.exitDuration},enterDuration:1/3,exitDuration:.5,videoBeginTime:.15,zoomScaleFactor:1.075,blurRadius:5,blurRadiusStep:.2,requiresInterpolation:!0,quantizeRadius:function(h){return this.blurRadiusStep?Math.round(h/this.blurRadiusStep)*this.blurRadiusStep:h},easeInOut:function(h){return h<0?0:h>1?1:.5-.5*Math.cos(h*Math.PI)},calculateAnimationDuration:function(h,l,F){var y=l?l+this.videoBeginTime+this.exitDuration:0;return Math.max(0,Math.min(h||1/0,y))},getEntranceExitParameter:function(h,l){return Math.min(Math.max(0,Math.min(1,1-this.easeInOut((h-(l-this.exitDuration))/this.exitDuration))),1-Math.max(0,Math.min(1,1-this.easeInOut(h/this.enterDuration))))||0},getTransform:function(h,l,F,y){var t=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1,o=1+(this.zoomScaleFactor-1)*this.getEntranceExitParameter(h,l),a=-(o-1)/2*F,c=-(o-1)/2*y,u=Math.round(a*devicePixelRatio)/devicePixelRatio,g=Math.round(c*devicePixelRatio)/devicePixelRatio;return Math.abs(o-t)<1e-5?"translate3d("+u+"px, "+g+"px, 0) scale3d("+n+", "+i+", 1)":a||c||o?"translate3d("+a+"px, "+c+"px, 0) scale3d("+o+", "+o+", 1)":"translate3d(0, 0, 0)"},photo:w.a.PhotoIngredient.create({opacity:w.a.computedStyle(function(h){if(h<this.recipe.enterDuration)return(1-this.recipe.easeInOut(h/this.recipe.enterDuration)).toString();if(h<this.renderer.duration-this.recipe.exitDuration)return"0";var l=this.recipe.easeInOut((h-(this.renderer.duration-this.recipe.exitDuration))/this.recipe.exitDuration);return l!==1?l:"1"}),display:w.a.computedStyle(function(h){return h>this.recipe.enterDuration&&h<this.renderer.duration-this.recipe.exitDuration?"none":""}),filter:w.a.computedStyle(function(h){if(!p)return"";var l=this.recipe,F=l.blurRadius*l.getEntranceExitParameter(h,this.renderer.duration);return F?"blur("+l.quantizeRadius(F)+"px)":""}),transform:w.a.computedStyle(function(h){return this.recipe.getTransform(h,this.renderer.duration,this.displayWidth,this.displayHeight)}),zIndex:w.a.computedStyle(function(){return 3})}),video:w.a.InterpolatedVideoIngredient.create({get backingScaleFactor(){return this.recipe.zoomScaleFactor},lookaheadTime:.01+7/15,videoTimeAtTime:function(h){var l=Math.max(0,Math.min(this.videoDuration,h-this.recipe.videoBeginTime));return Math.min(l,this.renderer.duration-this.recipe.exitDuration-this.recipe.videoBeginTime)},prepareVideoFramesFromTime:function(h){this.retainFramesForTime(h,h+this.lookaheadTime)},display:w.a.computedStyle(function(h){return h===0||h===this.renderer.duration?"none":""}),transform:w.a.computedStyle(function(h){return this.recipe.getTransform(h,this.renderer.duration,this.displayWidth,this.displayHeight,this.backingScaleFactor,this.backingScaleX,this.backingScaleY)}),zIndex:w.a.computedStyle(function(){return 1})})});E.a=d},function(J,E,v){var w=v(4),P=v(1),m=w.a.create({correspondingPlaybackStyle:P.a.HINT,minimumShortenedDuration:.9,get spontaneousFinishDuration(){return this.exitBlurDuration},exitBlurDuration:.75,bottomVideoRevealBeginTime:.1,zoomScaleFactor:1.075,blurRadius:7.5,blurRadiusStep:1,requiresInterpolation:!0,quantizeRadius:function(p){return Math.round(p/this.blurRadiusStep)*this.blurRadiusStep},tween:function(p){return p<0?0:p>1?1:.5-.5*Math.cos(p*Math.PI)},calculateAnimationDuration:function(p,d,h){var l=d?d-h+this.exitBlurDuration:0;return Math.max(0,Math.min(p||1/0,l))},photo:w.a.PhotoIngredient.create({hideDuration:.06,get returnDuration(){return this.recipe.exitBlurDuration},opacity:w.a.computedStyle(function(p){if(p<this.hideDuration)return(1-this.recipe.tween(p/this.hideDuration)).toString();if(p<this.renderer.duration-this.returnDuration)return"0";var d=this.recipe.tween((p-(this.renderer.duration-this.returnDuration))/this.returnDuration);return d!==1?d.toString():""}),display:w.a.computedStyle(function(p){return p>this.hideDuration&&p<this.renderer.duration-this.returnDuration?"none":""}),webkitFilter:w.a.computedStyle(function(p){if(p<this.renderer.duration-this.returnDuration)return"";var d=this.recipe.blurRadius*(1-this.recipe.tween((p-(this.renderer.duration-this.returnDuration))/this.returnDuration));return d?"blur("+this.recipe.quantizeRadius(d)+"px)":""}),transform:w.a.computedStyle(function(p){if(p<this.renderer.duration-this.returnDuration)return"translateZ(0)";var d=1+(this.recipe.zoomScaleFactor-1)*(1-this.recipe.tween((p-(this.renderer.duration-this.returnDuration))/this.returnDuration));return"translate3d("+-(d-1)/2*this.displayWidth+"px, "+-(d-1)/2*this.displayHeight+"px, 0) scale3d("+d+", "+d+", 1)"}),zIndex:w.a.computedStyle(function(){return 3})}),video:w.a.InterpolatedVideoIngredient.create({get backingScaleFactor(){return this.recipe.zoomScaleFactor},scaleInDuration:.15,get blurOutDuration(){return this.recipe.exitBlurDuration},lookaheadTime:.01+7/15,videoTimeAtTime:function(p){return Math.min(this.videoDuration,p+this.renderer.photoTime)},prepareVideoFramesFromTime:function(p){this.retainFramesForTime(p,p+this.lookaheadTime)},display:w.a.computedStyle(function(p){return p&&p!==this.renderer.duration?"":"none"}),transform:w.a.computedStyle(function(p){var d=1+(this.recipe.zoomScaleFactor-1)*Math.max(0,Math.min(1,1-this.recipe.tween((p-(this.renderer.duration-this.blurOutDuration))/this.blurOutDuration)-(1-this.recipe.tween(p/this.scaleInDuration)))),h=-(d-1)/2*this.displayWidth,l=-(d-1)/2*this.displayHeight,F=Math.round(h*devicePixelRatio)/devicePixelRatio,y=Math.round(l*devicePixelRatio)/devicePixelRatio;return Math.abs(d-this.backingScaleFactor)<1e-5?"translate3d("+F+"px, "+y+"px, 0) scale3d("+this.backingScaleX+", "+this.backingScaleY+", 1)":"translate3d("+h+"px, "+l+"px, 0) scale3d("+d+", "+d+", 1)"}),webkitFilter:w.a.computedStyle(function(p){var d=this.recipe.blurRadius*this.recipe.tween((p-(this.renderer.duration-this.blurOutDuration))/this.blurOutDuration);return d?"blur("+this.recipe.quantizeRadius(d)+"px)":""}),zIndex:w.a.computedStyle(function(){return 1})})});E.a=m},function(J,E,v){var w=v(4),P=v(2),m=(P.a.isSafari,w.a.create({requiresInterpolation:!0,photo:w.a.PhotoIngredient.create({display:w.a.computedStyle(function(p){return this.isPlaying||p>0?"none":""})}),video:w.a.InterpolatedVideoIngredient.create({lookaheadTime:.01+7/15,videoTimeAtTime:function(p){return p%this.renderer.duration},prepareVideoFramesFromTime:function(p){this.retainFramesForTime(p,p+this.lookaheadTime)},display:w.a.computedStyle(function(p){return""})}),beginFinishingPlaybackEarly:function(p){p.autoplay||(p.isPlaying?p.pause():p.wantsToPlay=!1)},continuePlayback:function(p){var d=p.currentTime,h=p.duration;d>=h&&(p.currentTime=d%h),p._rafID=requestAnimationFrame(p._nextFrame.bind(p))}}));E.a=m},function(J,E,v){var w=v(4),P=v(36),m=v(1);P.a.register();var p=w.a.create({correspondingPlaybackStyle:m.a.LOOP,photo:w.a.PhotoIngredient.create({display:w.a.computedStyle(function(d){return this.isPlaying||d>0?"none":""})}),video:w.a.VideoIngredient.create({display:w.a.computedStyle(function(d){return""})}),beginFinishingPlaybackEarly:function(d){d.autoplay||(d.isPlaying?d.pause():d.wantsToPlay=!1)},continuePlayback:function(d){var h=d.currentTime,l=d.duration;h>=l&&(d.currentTime=h%l),d._rafID=requestAnimationFrame(d._nextFrame.bind(d))},requestMoreCompatibleRecipe:function(d){return w.a.registerRecipeWithPlaybackStyle(P.a,this.correspondingPlaybackStyle),P.a}});E.a=p},function(J,E,v){var w=v(0),P=v(41),m=v(1),p=v(13),d=P.a.extend(p.a,{_loCanvas:null,_hiCanvas:null,backingScaleFactor:1,setUpForRender:function(){var h=this.element,l=(this.isPlaying,this.renderer),F=l.autoplay,y=l.parentView,t=l.playbackStyle,n=l.video;if(!this._loCanvas||!this._hiCanvas){h.innerHTML&&(h.innerHTML="");var i=this._loCanvas=w.a.canvasPool.get(),o=this._hiCanvas=w.a.canvasPool.get();i._context=i.getContext("2d"),o._context=o.getContext("2d"),i.style.cssText=o.style.cssText="position: absolute; left: 0; top: 0; width: 100%; height: 100%; transform: translateZ(0);",h.appendChild(i),h.appendChild(o),this._swapCanvases()}h.className="lpk-render-layer lpk-video",h.style.position="absolute",h.style.transformOrigin="0 0",h.style.zIndex=1,this._super(),t===m.a.LOOP&&(this.shouldLoop=!0),this.shouldLoop&&requestAnimationFrame(function(){n.currentTime=-1,F&&y.play()}),window.test=this},updateSize:function(h,l){if(!arguments.length)return this._super();this._super(h,l);var F=Math.ceil(h*this.backingScaleFactor),y=Math.ceil(l*this.backingScaleFactor);this.backingScaleX=F/h,this.backingScaleY=y/l,this.element.style.width=F+"px",this.element.style.height=y+"px",this._loCanvas&&this._hiCanvas&&(this._loCanvas.width=this._hiCanvas.width=F*devicePixelRatio,this._loCanvas.height=this._hiCanvas.height=y*devicePixelRatio,this._loCanvas._drawnFrameNumber=this._hiCanvas._drawnFrameNumber=-1,this.renderAtTime())},renderAtTime:function(h){if(!arguments.length)return this._super();this._super(h);var l=this.backingScaleX,F=this.backingScaleY;l===1&&F===1||(this.element.style.transform+=" scale3d("+1/l+", "+1/F+", 1)")},renderFramePair:function(h,l,F){(h&&this._hiCanvas._drawnFrameNumber===h.number||l&&this._loCanvas._drawnFrameNumber===l.number)&&this._swapCanvases(),this._putFrameInCanvasIfNeeded(h,this._loCanvas),this._putFrameInCanvasIfNeeded(l,this._hiCanvas),l&&(this._hiCanvas.style.opacity=F)},_swapCanvases:function(){var h=this._hiCanvas;this._hiCanvas=this._loCanvas,this._loCanvas=h,this._loCanvas.style.opacity="",this._loCanvas.style.zIndex=1,this._hiCanvas.style.zIndex=2},_putFrameInCanvasIfNeeded:function(h,l){l._drawnFrameNumber!==(l._drawnFrameNumber=h?h.number:-1)&&(l.setAttribute("data-frame-number",l._drawnFrameNumber.toString()),h?l._context.drawImage(h.image,0,0,l.width,l.height):l._context.clearRect(0,0,l.width,l.height))},dispose:function(){this._super(),this._loCanvas&&w.a.canvasPool.ret(this._loCanvas),this._hiCanvas&&w.a.canvasPool.ret(this._hiCanvas)},tearDownFromRender:function(){var h=this.renderer,l=h.parentView;this.shouldLoop=!1,l&&l.stop(),this._clearAllRetainedFrames(),this._super()}});E.a=d},function(J,E,v){var w=v(42),P=v(13),m=v(49),p=w.a.extend(P.a,{tagName:"canvas",get _canvas(){return this.element},get _context(){return this.__context||(this.__context=this._canvas.getContext("2d"))},init:function(){this._super.apply(this,arguments),this.element.className="lpk-render-layer lpk-photo",this.element.style.position="absolute",this.element.style.width=this.element.style.height="100%",this.element.style.transformOrigin="0 0",this.element.style.zIndex=2},tearDownFromRender:function(){this._super(),this._canvas.width=this._canvas.height=0},updateSize:function(d,h){if(!arguments.length)return this._super();this._super(d,h);var l=Math.ceil(d*devicePixelRatio),F=Math.ceil(h*devicePixelRatio),y=this.photo,t=this._canvas;this._lastPhoto===(this._lastPhoto=y)&&t.width===l&&t.height===F||(t.width=l,t.height=F,y&&v.i(m.a)(this._context,y,0,0,l,F))}});E.a=p},function(J,E,v){var w=v(0),P=v(2),m=v(13),p=v(43),d=p.a.extend(m.a,{_isPlayingChanged:w.a.observer("isPlaying",function(h){this._video&&(h?(this.duration=1/0,this.play()):this.pause())}),_isVisible:!1,applyStyles:function(){var h=this.element,l=this.video,F=this.videoRotation,y=l.videoHeight,t=l.videoWidth,n=1;[90,270].indexOf(F)>=0&&(n=t/y);var i=`
                height: 100%;
                position: absolute;
                width: 100%;
                -moz-transform: scale(`+n+") rotate("+F+`deg);
                -webkit-transform: scale(`+n+") rotate("+F+`deg);
                -o-transform: scale(`+n+") rotate("+F+`deg);
                -ms-transform: scale(`+n+") rotate("+F+`deg);
                transform: scale(`+n+") rotate("+F+`deg);
                z-index: 1;
            `;h.setAttribute("style",i),h.className="lpk-render-layer lpk-video",l.style.height="100%",l.style.width="100%"},cleanupElement:function(){var h=this.element,l=this.renderer,F=this._video,y=l.parentView;h.innerHtml&&(h.innerHtml=""),F&&(F.loop=!1,F.muted=!1,F.removeEventListener("pause",this.playIfPlaying)),y&&y.stop(),delete this._video},pause:function(){var h=this._isVisible,l=this._video;h&&l.pause()},play:function(){if(this._isVisible){var h=this._video,l=h.play();l?l.catch(this._handlePlayFailure):P.a.isIE||P.a.isEdge||(h.pause(),setTimeout(this._handlePlayFailure))}},_handlePlayFailure:w.a.boundFunction(function(){this.renderer.requestMoreCompatibleRecipe()}),playIfPlaying:w.a.boundFunction(function(){var h=this.isPlaying,l=this._video;if(h&&l.paused){var F=l.play();F&&F.catch(function(){})}}),setUpForRender:function(){var h=this.element,l=(this.isPlaying,this.renderer),F=l.autoplay,y=l.parentView,t=l.video;this.cleanupElement(),h.appendChild(t),this.applyStyles(),t.loop=!0,t.muted=!0,this._video=t,this._isVisible=!0,this._super(),F&&(t.addEventListener("pause",this.playIfPlaying),y.play())},tearDownFromRender:function(){this.cleanupElement(),this._isVisible=!1,this._super()}});E.a=d},function(J,E,v){function w(y){y.retain()}function P(y){y.release()}var m=v(0),p=v(7),d=v(17),h=p.a.extend({videoDecoder:m.a.proxyProperty("renderer.videoDecoder"),videoDuration:m.a.proxyProperty("videoDecoder.duration"),canRender:m.a.proxyProperty({readOnly:!0,proxyPath:"videoDecoder.canProvideFrames"}),init:function(){this._super.apply(this,arguments);var y=this.layerName,t=this.recipe;this._framePrepIDKey=t.name+"_"+y+"_framePrepID"},videoTimeAtTime:function(y){return y},_videoTimeAtTime:function(y){return isNaN(y)?y:this.videoTimeAtTime(y)},prepareToRenderAtTime:function(y){var t=this._currentPrepID=++l;if(!this.canRender)return!1;this.prepareVideoFramesFromTime(y);for(var n,i=this._retainedFrames,o=0,a=0;n=i[a];a++)n.readyState!==2&&(n[this._framePrepIDKey]=t,n.onReadyOrFail(this._frameDidPrepare),o++);return this._preppingFrameCount=o,!o},reduceMemoryFootprint:function(){this._super(),this._clearAllRetainedFrames()},_clearAllRetainedFrames:function(){this._clearExtraRetainedFrames(),this._clearRetainedInstantaneousFrames()},_clearExtraRetainedFrames:function(){var y=this._retainedFrames;y&&(y.forEach(P),y.length=0)},_clearRetainedInstantaneousFrames:function(){this._retainedLoFrame&&this._retainedLoFrame.release(),this._retainedHiFrame&&this._retainedHiFrame.release(),this._retainedLoFrame=this._retainedHiFrame=null},_frameDidPrepare:m.a.boundFunction(function(y){y[this._framePrepIDKey]===this._currentPrepID&&(y[this._framePrepIDKey]=void 0,--this._preppingFrameCount||this.renderer.prepareToRenderAtTime(this.renderer.currentTime))}),prepareVideoFramesFromTime:function(y){this.retainFramesForTime(y)},canRenderAtTime:function(y){if(this.display(y)==="none")return!0;if(!this.canRender)return!1;for(var t,n=!0,i=this.requiredFramesForTime(y),o=0;t=i[o];o++)n=n&&t.readyState===2,t.retain().release();return n},renderAtTime:function(y){if(!arguments.length)return this._super();if(this.display(y)==="none")return this._clearRetainedInstantaneousFrames(),this._super(y);var t=this._videoTimeAtTime(y),n=this.requiredFramesForVideoTime(t),i=n[0]||null,o=n[1]||null;if(i&&i.retain(),o&&o.retain(),this._clearRetainedInstantaneousFrames(),this._retainedLoFrame=i,this._retainedHiFrame=o,i&&(i=i.backingFrame),o&&(o=o.backingFrame),i&&o&&i.number>o.number){var a=i;o=i,i=a}i===o&&(o=null);var c=!i||o?this.videoDecoder.fractionalIndexForTime(t):i.frameNumber,u=c-(0|c);this.renderFramePair(i,o,u),this._super(y)},renderFramePair:function(){},requiredFramesForVideoTime:function(y,t,n){isNaN(t)&&(t=y);var i=this.videoDecoder,o=this.videoDuration,a=i.frameCount,c=F;if(c.length=0,t<0||y>o||isNaN(y)||isNaN(t))return c;var u=Math.max(0,Math.floor(i.fractionalIndexForTime(y))),g=Math.min(i.frameCount,Math.ceil(i.fractionalIndexForTime(t))),x=g<u,f=x?a-1:g;if(u===f-1){var O=i.frameTimes;O[f]-O[u]<1/30+.001&&(f=u)}for(var L=u;L<=f;L++)d.a&&L===0||(c.push(i.getFrame(L,n)),L+1===a&&x&&(L=-1,f=g));return c},requiredFramesForTime:function(y,t,n){return this.requiredFramesForVideoTime(this._videoTimeAtTime(y),this._videoTimeAtTime(t),n)},retainFramesForVideoTime:function(y,t,n){t===void 0&&(t=y);var i=this.lookaheadTime,o=this.shouldLoop,a=this.requiredFramesForVideoTime(y,t,n),c=this._retainedFrames||(this._retainedFrames=[]);a.forEach(w);for(var u=c.length-1;u>=0;u--){var g=c[u],x=g.time;(!o||x>i/2)&&(P(g),c.splice(u,1))}c.push.apply(c,a)},retainFramesForTime:function(y,t,n){return this.retainFramesForVideoTime(this._videoTimeAtTime(y),this._videoTimeAtTime(t),n)},dispose:function(){this.retainFramesForVideoTime(NaN),this._super()}}),l=1,F=[];E.a=h},function(J,E,v){var w=v(7),P=v(0),m=w.a.extend({isPlaying:P.a.proxyProperty({readOnly:!0,proxyPath:"renderer.parentView.isPlaying"}),photo:P.a.proxyProperty({readOnly:!0,proxyPath:"renderer.photo"}),canRender:P.a.proxyProperty("photo"),canRenderAtTime:function(p){var d=this.photo;return!(this.display(p)!=="none"&&(!d||d instanceof Image&&!d.complete))}});E.a=m},function(J,E,v){var w=v(7),P=v(0),m=w.a.extend({canRender:P.a.proxyProperty({readOnly:!0,proxyPath:"video"}),isPlaying:P.a.proxyProperty({readOnly:!0,proxyPath:"renderer.parentView.isPlaying"}),video:P.a.proxyProperty({readOnly:!0,proxyPath:"renderer.video"}),videoRotation:P.a.proxyProperty({readOnly:!0,proxyPath:"renderer.provider.videoRotation"})});E.a=m},function(J,E,v){function w(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")}function P(c){var u=v.i(p.a)(c),g=l.get(u);if(g)return g;var x=c.map(function(f){if(f[0]==="i"&&t(f[1]))return"I"+f.substring(1)});return c=c.concat(x.filter(function(f){return!!f})),g=new RegExp(c.join("|"),"g"),l.set(u,g),g}function m(c,u){var g=c.charCodeAt(0),x=u.charCodeAt(0),f=new Map;return function(O){var L=f.get(O);if(L!==void 0)return L;var C=O.charCodeAt(0);return L=C>=g&&C<=x,f.set(O,L),L}}var p=v(20),d=function(){function c(u,g){for(var x=0;x<g.length;x++){var f=g[x];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,g,x){return g&&c(u.prototype,g),x&&c(u,x),u}}(),h=["iOS","iPhone","iPad","iPod","WebKit"],l=new Map,F=m("0","9"),y=m("a","z"),t=m("A","Z"),n=function(c){return y(c)||t(c)},i=function(c){return n(c)||F(c)},o=new Map,a=function(){function c(){w(this,c)}return d(c,null,[{key:"splitIntoArray",value:function(u,g,x){for(var f=u.indexOf(g),O=0,L=g.length;f!==-1;)x.push(u.substring(O,f)),O=f+L,f=u.indexOf(g,O);x.push(u.substring(O))}},{key:"hyphenate",value:function(u,g,x){if(!u)return"";g||g===null||g===!1||(g=h);var f=g||x?v.i(p.a)(g)+"#"+u+"#"+!!x:u,O=o.get(f);if(O)return O;if(Array.isArray(g)){var L=c.hyphenateCarefully(u,g,x);return o.set(f,L),L}var C=u.length,N="",$=void 0,Y=void 0,te=void 0,M=void 0,b=void 0;for($=0;$<C;$++)Y=u[$-1],te=u[$],M=te.toLowerCase(),b=u[$+1],Y&&i(te)&&i(Y)&&(!t(Y)&&t(te)||F(Y)&&n(te)||b&&t(Y)&&t(te)&&y(b))?N+="-"+M:N+=M;return o.set(f,N),N}},{key:"hyphenateCarefully",value:function(u,g,x){var f=P(g),O=u.match(f);if(!O||!O.length)return c.hyphenate(u,null,x);for(var L=u.split(f),C=c.hyphenate(L[0]),N=0,$=O.length;N<$;N++){var Y=O[N];x||(Y=Y.toLowerCase());var te=L[N+1];te&&(te=c.hyphenate(te,null,x)),C+=(C&&"-")+Y,te&&(C+=(n(te[0])?"-":"")+te)}return C}}]),c}();E.a=a},function(J,E,v){function w(y,t){if(!(y instanceof t))throw new TypeError("Cannot call a class as a function")}function P(y,t){y||m(t)}function m(y){throw y}var p=v(5);v.d(E,"b",function(){return h}),v.d(E,"a",function(){return l});var d=function(){function y(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&y(t.prototype,n),i&&y(t,i),t}}(),h=(function(){function y(t,n){w(this,y),this.w=t,this.h=n}d(y,[{key:"toString",value:function(){return"("+this.w+", "+this.h+")"}},{key:"getHalfSize",value:function(){return new y(this.w>>>1,this.h>>>1)}},{key:"length",value:function(){return this.w*this.h}}])}(),function(){function y(t,n,i){w(this,y),this.bytes=new Uint8Array(t),this.start=n||0,this.pos=this.start,this.end=n+i||this.bytes.length}return d(y,[{key:"readU8Array",value:function(t){if(this.pos>this.end-t)return null;var n=this.bytes.subarray(this.pos,this.pos+t);return this.pos+=t,n}},{key:"readU32Array",value:function(t,n,i){if(n=n||1,this.pos>this.end-t*n*4)return null;if(n===1){for(var o=new Uint32Array(t),a=0;a<t;a++)o[a]=this.readU32();return o}for(var c=new Array(t),u=0;u<t;u++){var g=null;if(i){g={};for(var x=0;x<n;x++)g[i[x]]=this.readU32()}else{g=new Uint32Array(n);for(var f=0;f<n;f++)g[f]=this.readU32()}c[u]=g}return c}},{key:"read8",value:function(){return this.readU8()<<24>>24}},{key:"readU8",value:function(){return this.pos>=this.end?null:this.bytes[this.pos++]}},{key:"read16",value:function(){return this.readU16()<<16>>16}},{key:"readU16",value:function(){if(this.pos>=this.end-1)return null;var t=this.bytes[this.pos+0]<<8|this.bytes[this.pos+1];return this.pos+=2,t}},{key:"read24",value:function(){return this.readU24()<<8>>8}},{key:"readU24",value:function(){var t=this.pos,n=this.bytes;if(t>this.end-3)return null;var i=n[t+0]<<16|n[t+1]<<8|n[t+2];return this.pos+=3,i}},{key:"peek32",value:function(t){var n=this.pos,i=this.bytes;if(n>this.end-4)return null;var o=i[n+0]<<24|i[n+1]<<16|i[n+2]<<8|i[n+3];return t&&(this.pos+=4),o}},{key:"read32",value:function(){return this.peek32(!0)}},{key:"readU32",value:function(){return this.peek32(!0)>>>0}},{key:"read4CC",value:function(){var t=this.pos;if(t>this.end-4)return null;for(var n="",i=0;i<4;i++)n+=String.fromCharCode(this.bytes[t+i]);return this.pos+=4,n}},{key:"readFP16",value:function(){return this.read32()/65536}},{key:"readFP8",value:function(){return this.read16()/256}},{key:"readISO639",value:function(){for(var t=this.readU16(),n="",i=0;i<3;i++){var o=t>>>5*(2-i)&31;n+=String.fromCharCode(o+96)}return n}},{key:"readUTF8",value:function(t){for(var n="",i=0;i<t;i++)n+=String.fromCharCode(this.readU8());return n}},{key:"readPString",value:function(t){var n=this.readU8();P(n<=t);var i=this.readUTF8(n);return this.reserved(t-n-1,0),i}},{key:"skip",value:function(t){this.seek(this.pos+t)}},{key:"reserved",value:function(t,n){for(var i=0;i<t;i++)P(this.readU8()===n)}},{key:"seek",value:function(t){(t<0||t>this.end)&&m("Index out of bounds (bounds: [0, "+this.end+"], index: "+t+")."),this.pos=t}},{key:"subStream",value:function(t,n){return new y(this.bytes.buffer,t,n)}},{key:"uint",value:function(t){for(var n=this.position,i=n+t,o=0,a=n;a<i;a++)o<<=8,o|=255&this.readU8();return o}},{key:"length",get:function(){return this.end-this.start}},{key:"position",get:function(){return this.pos}},{key:"remaining",get:function(){return this.end-this.pos}}]),y}()),l=function(){function y(t){w(this,y),this.stream=t,this.tracks={},this.metaData={}}return d(y,[{key:"getPath",value:function(t){for(var n=t.split("."),i=this,o=0,a=n.length;o<a;o++)i=i?i[n[o]]:void 0;return i}},{key:"readBoxes",value:function(t,n){for(;t.peek32();){var i=this.readBox(t);if(i.type in n){var o=n[i.type];Array.isArray(o)||(n[i.type]=[o]),n[i.type].push(i)}else n[i.type]=i}}},{key:"readBox",value:function(t){function n(){c.version=t.readU8(),c.flags=t.readU24()}function i(){return c.size-(t.position-c.offset)}function o(){t.skip(i())}function a(){var Ye=t.subStream(t.position,i());u.readBoxes(Ye,c),t.skip(Ye.length)}var c={offset:t.position},u=this;(function(){c.size=t.readU32(),c.type=t.read4CC()})();var g=void 0,x=void 0,f=void 0;switch(c.type){case"ftyp":var O=c;O.name="File Type Box",O.majorBrand=t.read4CC(),O.minorVersion=t.readU32(),O.compatibleBrands=new Array((O.size-16)/4);for(var L=0;L<O.compatibleBrands.length;L++)O.compatibleBrands[L]=t.read4CC();break;case"moov":c.name="Movie Box",a();break;case"mvhd":var C=c;C.name="Movie Header Box",n(),P(C.version==0),C.creationTime=t.readU32(),C.modificationTime=t.readU32(),C.timeScale=t.readU32(),C.duration=t.readU32(),C.rate=t.readFP16(),C.volume=t.readFP8(),t.skip(10),C.matrix=t.readU32Array(9),t.skip(24),C.nextTrackId=t.readU32();break;case"trak":var N=c;N.name="Track Box",a();var $=new F(this,N),Y=N.mdia&&N.mdia.hdlr&&N.mdia.hdlr.handlerType||"unknownHandlerType",te=this.tracks;(te[Y]||(te[Y]=[])).push($),te[N.tkhd.trackId]=$;break;case"tkhd":var M=c;M.name="Track Header Box",n(),P(M.version==0),M.creationTime=t.readU32(),M.modificationTime=t.readU32(),M.trackId=t.readU32(),t.skip(4),M.duration=t.readU32(),t.skip(8),M.layer=t.readU16(),M.alternateGroup=t.readU16(),M.volume=t.readFP8(),t.skip(2),M.matrix=t.readU32Array(9),M.width=t.readFP16(),M.height=t.readFP16();break;case"edts":c.name="Edit Atom",a();break;case"elst":var b=c;b.name="Edit List Atom",n(),b.editList=[],f=t.readU32();for(var T=0;T<f;T++)b.editList.push({trackDuration:t.read32(),mediaTime:t.read32(),mediaRate:t.readU32()});P(!i()),o();break;case"mdia":c.name="Media Box",a();break;case"mdhd":var I=c;I.name="Media Header Box",n(),P(I.version==0),I.creationTime=t.readU32(),I.modificationTime=t.readU32(),I.timeScale=t.readU32(),I.duration=t.readU32(),I.language=t.readISO639(),t.skip(2);break;case"hdlr":var S=c;S.name="Handler Reference Box",n(),t.skip(4),S.handlerType=t.read4CC(),t.skip(12),x=S.size-32,x>0&&(S.name=t.readUTF8(x));break;case"minf":c.name="Media Information Box",a();break;case"stbl":c.name="Sample Table Box",a();break;case"stsd":var D=c;D.name="Sample Description Box",n(),D.sd=[],t.readU32(),a();break;case"avc1":var U=c;t.reserved(6,0),U.dataReferenceIndex=t.readU16(),P(t.readU16()==0),P(t.readU16()==0),t.readU32(),t.readU32(),t.readU32(),U.width=t.readU16(),U.height=t.readU16(),U.horizontalResolution=t.readFP16(),U.verticalResolution=t.readFP16(),P(t.readU32()==0),U.frameCount=t.readU16(),U.compressorName=t.readPString(32),U.depth=t.readU16(),P(t.readU16()==65535),a();break;case"mp4a":var B=c;if(t.reserved(6,0),B.dataReferenceIndex=t.readU16(),B.version=t.readU16(),B.version!==0){o();break}t.skip(2),t.skip(4),B.channelCount=t.readU16(),B.sampleSize=t.readU16(),B.compressionId=t.readU16(),B.packetSize=t.readU16(),B.sampleRate=t.readU32()>>>16,a();break;case"esds":c.name="Elementary Stream Descriptor",n(),o();break;case"avcC":var H=c;H.name="AVC Configuration Box",H.configurationVersion=t.readU8(),H.avcProfileIndicaation=t.readU8(),H.profileCompatibility=t.readU8(),H.avcLevelIndication=t.readU8(),H.lengthSizeMinusOne=3&t.readU8(),P(H.lengthSizeMinusOne==3,"TODO"),g=31&t.readU8(),H.sps=[];for(var V=0;V<g;V++)H.sps.push(t.readU8Array(t.readU16()));g=31&t.readU8(),H.pps=[];for(var K=0;K<g;K++)H.pps.push(t.readU8Array(t.readU16()));o();break;case"btrt":var re=c;re.name="Bit Rate Box",re.bufferSizeDb=t.readU32(),re.maxBitrate=t.readU32(),re.avgBitrate=t.readU32();break;case"stts":var oe=c;oe.name="Decoding Time to Sample Box",n(),oe.table=t.readU32Array(t.readU32(),2,["count","delta"]);break;case"stss":var ce=c;ce.name="Sync Sample Box",n(),ce.samples=t.readU32Array(t.readU32());break;case"stsc":var ue=c;ue.name="Sample to Chunk Box",n(),ue.table=t.readU32Array(t.readU32(),3,["firstChunk","samplesPerChunk","sampleDescriptionId"]);break;case"stsz":var xe=c;xe.name="Sample Size Box",n(),xe.sampleSize=t.readU32(),g=t.readU32(),xe.sampleSize==0&&(xe.table=t.readU32Array(g));break;case"stco":var pe=c;pe.name="Chunk Offset Box",n(),pe.table=t.readU32Array(t.readU32());break;case"smhd":var me=c;me.name="Sound Media Header Box",n(),me.balance=t.readFP8(),t.reserved(2,0);break;case"mdat":var Se=c;Se.name="Media Data Box",P(Se.size>=8,"Cannot parse large media data yet."),Se.data=t.readU8Array(i());break;case"mebx":c.name="Mebx",a();break;case"meta":c.name="Metadata",a();break;case"keys":var we=c;we.name="Metadata Item Keys",n();var Re=we.keyCount=t.read32(),ve=we.offset-we.size;we.keyList=new Map;for(var he=1;he<=Re;he++){var se=t.read32()-8;se<1||se>ve||(t.skip(4),we.keyList.set(t.readUTF8(se),he))}this.metaData.keys=we;break;case"ilst":var _e=c;_e.name="Metadata Item List",_e.items=[];for(var De=_e.offset+_e.size;t.position<De;){var Fe=(t.position,t.readU32(),t.readU32()),je=t.readU32()-16,ze=(t.read4CC(),t.readU8()),Ze=t.readU24(),st=(t.readU16(),t.readU16(),void 0);st=ze===0&&Ze!==1?t.uint(je):t.readUTF8(je),_e.items[Fe]=st}this.metaData.values=_e;break;default:o()}return c}},{key:"read",value:function(){var t=new Date().getTime();this.file={},this.readBoxes(this.stream,this.file),p.a.info("Parsed stream in "+(new Date().getTime()-t)+" ms")}},{key:"traceSamples",value:function(){var t=this.tracks[1],n=this.tracks[2];p.a.info("Video Samples: "+t.getSampleCount()),p.a.info("Audio Samples: "+n.getSampleCount());for(var i=0,o=0,a=0;a<100;a++){var c=t.sampleToOffset(i),u=n.sampleToOffset(o),g=t.sampleToSize(i,1),x=n.sampleToSize(o,1);c<u?(p.a.info("V Sample "+i+" Offset : "+c+", Size : "+g),i++):(p.a.info("A Sample "+o+" Offset : "+u+", Size : "+x),o++)}}}]),y}(),F=function(){function y(t,n){w(this,y),this.file=t,this.trak=n}return d(y,[{key:"getSampleSizeTable",value:function(){return this.trak.mdia.minf.stbl.stsz.table}},{key:"getSampleCount",value:function(){return this.getSampleSizeTable().length}},{key:"sampleToSize",value:function(t,n){for(var i=this.getSampleSizeTable(),o=0,a=t;a<t+n;a++)o+=i[a];return o}},{key:"sampleToChunk",value:function(t){var n=this.trak.mdia.minf.stbl.stsc.table;if(n.length===1){var i=n[0];return P(i.firstChunk===1),{index:t/i.samplesPerChunk,offset:t%i.samplesPerChunk}}for(var o=0,a=0;a<n.length;a++){var c=n[a];if(a>0){var u=n[a-1],g=c.firstChunk-u.firstChunk,x=u.samplesPerChunk*g;if(!(t>=x))return{index:o+Math.floor(t/u.samplesPerChunk),offset:t%u.samplesPerChunk};if(t-=x,a===n.length-1)return{index:o+g+Math.floor(t/c.samplesPerChunk),offset:t%c.samplesPerChunk};o+=g}}P(!1)}},{key:"chunkToOffset",value:function(t){return this.trak.mdia.minf.stbl.stco.table[t]}},{key:"sampleToOffset",value:function(t){var n=this.sampleToChunk(t);return this.chunkToOffset(n.index)+this.sampleToSize(t-n.offset,n.offset)}},{key:"timeToSample",value:function(t){for(var n=this.trak.mdia.minf.stbl.stts.table,i=0,o=0;o<n.length;o++){var a=n[o].count*n[o].delta;if(!(t>=a))return i+Math.floor(t/n[o].delta);t-=a,i+=n[o].count}}},{key:"sampleToTime",value:function(t){for(var n=this.trak.mdia.minf.stbl.stts.table,i=0,o=0,a=0;a<n.length&&i<t;a++){var c=n[a],u=Math.min(t-i,c.count);i+=u,o+=u*c.delta}return o}},{key:"getTotalTime",value:function(){for(var t=this.trak.mdia.minf.stbl.stts.table,n=0,i=0;i<t.length;i++)n+=t[i].count*t[i].delta;return P(this.trak.mdia.mdhd.duration===n),this.trak.mdia.mdhd.duration}},{key:"getTotalTimeInSeconds",value:function(){return this.timeToSeconds(this.getTotalTime())}},{key:"getTimeScale",value:function(){return this.trak.mdia.mdhd.timeScale}},{key:"timeToSeconds",value:function(t){return t/this.getTimeScale()}},{key:"secondsToTime",value:function(t){return t*this.getTimeScale()}},{key:"secondsToSample",value:function(t){return this.timeToSample(this.secondsToTime(t))}},{key:"sampleToSeconds",value:function(t){return this.timeToSeconds(this.sampleToTime(t))}},{key:"getAllSampleTimes",value:function(){for(var t=[],n=this.getSampleCount(),i=0;i<n;i++)t.push(this.sampleToTime(i));return t}},{key:"getAllSampleSeconds",value:function(){for(var t=[],n=this.getSampleCount(),i=0;i<n;i++)t.push(this.sampleToSeconds(i));return t}},{key:"getSampleNALUnits",value:function(t){for(var n=this.file.stream.bytes,i=this.sampleToOffset(t),o=i+this.sampleToSize(t,1),a=[];o-i>0;){var c=new h(n.buffer,i).readU32();a.push(n.subarray(i+4,i+c+4)),i=i+c+4}return a}}]),y}()},function(J,E,v){var w={staticMembers:{_pool:null,_cache:null,init:function(){this._pool=[],this._cache={},this._super()},getPoolingCacheKey:function(){throw"Must implement `getPoolingCacheKey` to use PoolCaching."},getCached:function(){var P=this.getPoolingCacheKey.apply(this,arguments),m=this._cache[P];return m||(m=this._cache[P]=this._pool.pop()||this.create(),m._poolingCacheKey=P,m.initFromPool.apply(m,arguments)),m},peekCached:function(){var P=this.getPoolingCacheKey.apply(this,arguments);return this._cache[P]||null},_disposeInstance:function(P){delete this._cache[P._poolingCacheKey],P._poolingCacheKey=void 0,P._poolingLifecycleCount=1+(0|P._poolingLifecycleCount),this._pool.push(P)}},dispose:function(){},_poolingCacheKey:null,initFromPool:function(){},_retainCount:0,retain:function(){return this._retainCount++,this},release:function(){return this._retainCount--,this._retainCount||this.dispose(),this}};E.a=w},function(J,E,v){function w(c,u){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!u||typeof u!="object"&&typeof u!="function"?c:u}function P(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(c,u):c.__proto__=u)}function m(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")}var p=v(19);v.d(E,"a",function(){return F}),v.d(E,"b",function(){return t}),v.d(E,"c",function(){return i}),v.d(E,"d",function(){return a});var d=function(){function c(u,g){for(var x=0;x<g.length;x++){var f=g[x];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(u,f.key,f)}}return function(u,g,x){return g&&c(u.prototype,g),x&&c(u,x),u}}(),h=function(){function c(){m(this,c),this._a=[]}return d(c,[{key:"get",value:function(){return this._a.pop()||this.create()}},{key:"ret",value:function(u){this.prepare(u),this._a.push(u)}}]),c}(),l=function(c){function u(){return m(this,u),w(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return P(u,c),d(u,[{key:"create",value:function(){return[]}},{key:"prepare",value:function(g){g.length=0}}]),u}(h),F=new l,y=function(c){function u(){return m(this,u),w(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return P(u,c),d(u,[{key:"create",value:function(){return new p.a}},{key:"prepare",value:function(g){g.clear()}}]),u}(h),t=new y,n=function(c){function u(){return m(this,u),w(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return P(u,c),d(u,[{key:"create",value:function(){return Object.create(null)}},{key:"prepare",value:function(g){var x=g;for(var f in x)delete x[f]}}]),u}(h),i=new n,o=function(c){function u(){return m(this,u),w(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return P(u,c),d(u,[{key:"create",value:function(){return document.createElement("canvas")}},{key:"prepare",value:function(g){var x=g.parentNode;x&&x.removeChild(g),g.width=g.height=0}}]),u}(h),a=new o},function(J,E,v){function w(m,p){return m.apply(void 0,p)}var P={_readiness:"pending",_resolutionArgs:null,_fulfillmentCallbacks:null,_rejectionCallbacks:null,onReadyOrFail:function(m,p){this._resolveIfAlreadyResolved(m,p,!1)||this._pendCallbacks(m,p)},onReadyOrFailSync:function(m,p){this._resolveIfAlreadyResolved(m,p,!0)||this._pendCallbacks(m,p)},_resolveIfAlreadyResolved:function(m,p,d){var h=this._resolutionArgs;return this._readiness==="success"&&m?(d?w(m,h):setTimeout(w,0,m,h),!0):!(this._readiness!=="failure"||!p)&&(d?w(p,h):setTimeout(w,0,p,h),!0)},_pendCallbacks:function(m,p){m&&(this._fulfillmentCallbacks||(this._fulfillmentCallbacks=[])).push(m),p&&(this._rejectionCallbacks||(this._rejectionCallbacks=[])).push(p)},clearReadinessCallbacks:function(){this._fulfillmentCallbacks&&(this._fulfillmentCallbacks.length=0),this._rejectionCallbacks&&(this._rejectionCallbacks.length=0)},resetReadiness:function(){this._readiness="pending",this._resolutionArgs&&(this._resolutionArgs.length=0),this.clearReadinessCallbacks()},resolveReadiness:function(){this._readiness==="pending"&&(this._readiness="success",(this._resolutionArgs=this._resolutionArgs||[]).push.apply(this._resolutionArgs,arguments),this._invokeCallbacks(this._fulfillmentCallbacks),this.clearReadinessCallbacks())},rejectReadiness:function(){this._readiness==="pending"&&(this._readiness="failure",(this._resolutionArgs=this._resolutionArgs||[]).push.apply(this._resolutionArgs,arguments),this._invokeCallbacks(this._rejectionCallbacks),this.clearReadinessCallbacks())},_invokeCallbacks:function(m){if(m){for(var p,d=0;p=m[d];d++)p.apply(void 0,this._resolutionArgs);m.length=0}}};E.a=P},function(J,E,v){function w(){for(var n=1;n<arguments.length;n++)this[n-1]=arguments[n];return this}function P(n){return n&&n.tagName==="IMG"&&/^data:image\/svg|\.svg\?|\.svg$/.test(n.src)}var m=document.createElement("canvas"),p=m.getContext("2d"),d=document.createElement("canvas"),h=d.getContext("2d");m.width=d.width=m.height=d.height=0;var l=!1,F=!1,y=function(n,i){for(var o=arguments.length,a=Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];if(P(i))return n.drawImage.apply(n,w.apply(t,arguments)),!0;var u=l,g=F;l=F=!1;var x=i instanceof HTMLImageElement?i.naturalWidth:i.width,f=i instanceof HTMLImageElement?i.naturalHeight:i.height;if(!x||!f)throw"Source image provided to drawImageSmooth was not loaded, or otherwise had no dimensions.";var O=void 0,L=void 0,C=void 0,N=void 0,$=void 0,Y=void 0,te=void 0,M=void 0;switch(arguments.length-1){case 3:O=0,L=0,C=x,N=f,$=arguments[2],Y=arguments[3],te=x,M=f;break;case 5:O=0,L=0,C=x,N=f,$=arguments[2],Y=arguments[3],te=arguments[4],M=arguments[5];break;case 9:O=arguments[2],L=arguments[3],C=arguments[4],N=arguments[5],$=arguments[6],Y=arguments[7],te=arguments[8],M=arguments[9]}var b=te/C,T=M/N;if(b&&T){var I=Math.max(b,T),S=Math.pow(2,Math.ceil(Math.log(1.1*I)/Math.log(2)));if(S>=1)return n.drawImage.apply(n,w.apply(t,arguments)),!0;var D=void 0;if(u){D="_cachedSmoothDownsample_from"+O+","+L+","+C+","+N+"@"+S+"x";var U=i[D];if(U)return n.drawImage(U,0,0,U.width,U.height,$,Y,te,M),!0}if(g)return n.drawImage.apply(n,w.apply(t,arguments)),!1;var B=1,H=C,V=N,K=Math.max(Math.pow(2,Math.ceil(Math.log(H)/Math.log(2))),m.width),re=Math.max(Math.pow(2,Math.ceil(Math.log(V)/Math.log(2))),m.height);for(m.width===K&&m.height===re||(m.width=d.width=K,m.height=d.height=re),p.drawImage(i,O,L,C,N,0,0,C,N);B>S;){h.drawImage(m,0,0,H,V,0,0,H=Math.ceil(H/2),V=Math.ceil(V/2)),p.clearRect(0,0,H,V);var oe=m;m=d,d=oe;var ce=p;p=h,h=ce,B/=2}if(u){var ue=document.createElement("canvas");ue.width=H,ue.height=V,ue.getContext("2d").drawImage(m,0,0),i[D]=ue}return n.drawImage(m,0,0,H,V,$,Y,te,M),p.clearRect(0,0,C,N),h.clearRect(0,0,C,N),!0}};y.usingCache=function(){return l=!0,this},y.avoidingWorkIf=function(n){return F=n,this};var t=[];E.a=y},function(J,E,v){function w(){var m="_callbacksForEventHandler"+ ++P;return function(p){var d=this[m]||(this[m]=[]);if(typeof p=="function")return d.push(p);if(d)for(var h=0,l=d.length;h<l;++h)d[h](p)}}E.a=w;var P=1},function(J,E,v){function w(t){var n=t&&new DataView(t),i={};return n&&P(n)&&m(n,i),i}function P(t){return t.getUint16(0)===65496}function m(t,n){for(var i=t.byteLength,o=2;o<i;){var a=t.getUint16(o);a===65505&&p(t,o+4,n),a!==65472&&a!==65474||d(t,o+5,n),o+=2+t.getUint16(o+2)}return n}function p(t,n,i){if(t.getUint32(n)!==1165519206)return i;var o=n+6,a=void 0,c=t.getUint16(o);if(c===18761)a=!0;else{if(c!==19789)return i;a=!1}for(var u=o+t.getUint32(o+4,a),g=t.getUint16(u,a),x=0;x<g;x++){var f=u+12*x+2,O=t.getUint16(f,a);O===274&&(i.orientation=t.getUint16(f+8,a)),O===34665&&h(t,o,y(t,f,a),a,i)}return i}function d(t,n,i){return i.height=t.getUint16(n),i.width=t.getUint16(n+2),i}function h(t,n,i,o,a){var c=F(t,n+i,o),u=void 0;return 37500 in c&&(u=c[37500],l(t,n+t.getUint32(u+8),a)),a}function l(t,n,i){for(var o="",a=0;a<9;a++)o+=String.fromCharCode(t.getUint8(n+a));if(o!=="Apple iOS")return i;var c=t.getUint16(n+9+3)===18761,u=F(t,n+9+3+2,c);return 27 in u&&(i.photosRenderEffect=y(t,u[27],c)),i}function F(t,n,i){for(var o=t.getUint16(n,i),a=n+2,c={},u=0;u<o;u++){var g=a+12*u;c[t.getUint16(g,i)]=g}return c}function y(t,n,i){var o=t.getUint16(n+2,i),a=t.getUint32(n+4,i),c=t.getUint32(n+8,i),u=[];switch(o){case 3:if(a===1)return t.getUint16(n+8,i);if(a===2)return[t.getUint16(n+8,i),t.getUint16(n+10,i)];for(var g=0;g<a;g++)u[g]=t.getUint16(c+4*g,i);return u;case 4:if(a===1)return c;for(var x=0;x<a;x++)u[x]=t.getUint32(c+4*x,i);return u;case 9:if(a===1)return t.getInt32(n+8,i);for(var f=0;f<a;f++)u[f]=t.getInt32(c+4*f,i);return u;default:return null}}E.a=w},function(J,E,v){function w(){for(var m=P()+P();m.length<16;)m+=P();return m.slice(0,16)}function P(){return Math.random().toString(16).substring(2)}E.a=w},function(J,E,v){function w(p,d){var h=p,l=h._computedStyle;l||(l=h._computedStyle=document.defaultView.getComputedStyle(p,null));var F=l.getPropertyValue(d);return!F&&P.get(d)&&(F=P.get(d)(l)||F),F}E.a=w;var P=function(){var p=new Map;return p.set("font",function(d){for(var h="",l=0,F=m.length;l<F;l++){var y=m[l],t=d.getPropertyValue("font-"+y);if(t&&(h&&(h+=" "),h+=t,y==="size")){var n=d.getPropertyValue("line-height");n&&(h+="/"+n)}}return h}),p}(),m=["style","variant","weight","size","family"]},function(J,E,v){function w(m,p,d,h,l,F,y){var t=void 0;if(typeof m=="string"){var n=m;n==="fit"&&(t=!1),n==="cover"&&(t=!0)}else t=!!m;var i=arguments.length;i!==6&&(y=i-1);var o=void 0,a=void 0,c=void 0,u=void 0,g=void 0;if(y===2||y===3){var x=p,f=d;a=x.height,o=x.width,u=f.height,c=f.width,g=h}else o=p,a=d,c=h,u=l,g=F;var O=o/a,L=c/u,C=t?O<L:O>L;return g=g||{},g.width=C?c:u*O,g.height=C?c/O:u,g}function P(m,p,d,h,l){return w(!1,m,p,d,h,l,arguments.length)}E.a=P},function(J,E,v){E.a="current"},function(J,E,v){E.a="Mcurrent"},function(J,E,v){E.a="1.5.6"}])})})(yn);var gn=yn.exports;const pi=hi(gn),fi=di({__proto__:null,default:pi},[gn]),mi={id:"_zhaochunqi-logseq-livephotos-plugin",icon:"./logo.svg"},vi=mi.id,yi=()=>{parent.window.LivePhotosKit||(parent.window.LivePhotosKit=fi)};function gi(){console.info(`#${vi}: MAIN`),logseq.App.onMacroRendererSlotted(async({slot:Oe,payload:Ne})=>{const[J,E,v]=Ne.arguments;if(J!==":live-photo"||!E||!v)return;yi();const w=parent.document.getElementById(Oe);if(!w)return;w.innerHTML="",w.style.width="100%",w.style.height="auto",w.style.minHeight="300px",w.style.display="block";const P=parent.document.createElement("div");P.style.width="100%",P.style.height="500px",P.style.position="relative",w.appendChild(P);const m=parent.window.LivePhotosKit;if(m&&m.Player)try{const p=m.Player(P);p.photoSrc=E,p.videoSrc=v,p.showsNativeControls=!0}catch(p){console.error("LivePhotosKit Player init error:",p),w.innerHTML=`<div style="color:red">Error initializing Live Photo: ${p}</div>`}else console.error("LivePhotosKit not found on parent window"),w.innerHTML='<div style="color:red">LivePhotosKit library not loaded.</div>'})}logseq.ready(gi).catch(console.error);
