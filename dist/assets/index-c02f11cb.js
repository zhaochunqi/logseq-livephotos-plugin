(function(){const Tt=document.createElement("link").relList;if(Tt&&Tt.supports&&Tt.supports("modulepreload"))return;for(const J of document.querySelectorAll('link[rel="modulepreload"]'))Ht(J);new MutationObserver(J=>{for(const ct of J)if(ct.type==="childList")for(const F of ct.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&Ht(F)}).observe(document,{childList:!0,subtree:!0});function Ce(J){const ct={};return J.integrity&&(ct.integrity=J.integrity),J.referrerPolicy&&(ct.referrerPolicy=J.referrerPolicy),J.crossOrigin==="use-credentials"?ct.credentials="include":J.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function Ht(J){if(J.ep)return;J.ep=!0;const ct=Ce(J);fetch(J.href,ct)}})();var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */_n.exports;(function(zt,Tt){(function(Ce,Ht){zt.exports=Ht()})(self,()=>(()=>{var Ce={227:(F,d,b)=>{var w=b(155);d.formatArgs=function(k){if(k[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+k[0]+(this.useColors?"%c ":" ")+"+"+F.exports.humanize(this.diff),!this.useColors)return;const W="color: "+this.color;k.splice(1,0,W,"color: inherit");let y=0,f=0;k[0].replace(/%[a-zA-Z%]/g,x=>{x!=="%%"&&(y++,x==="%c"&&(f=y))}),k.splice(f,0,W)},d.save=function(k){try{k?d.storage.setItem("debug",k):d.storage.removeItem("debug")}catch{}},d.load=function(){let k;try{k=d.storage.getItem("debug")}catch{}return!k&&w!==void 0&&"env"in w&&(k=w.env.DEBUG),k},d.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},d.storage=function(){try{return localStorage}catch{}}(),d.destroy=(()=>{let k=!1;return()=>{k||(k=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],d.log=console.debug||console.log||(()=>{}),F.exports=b(447)(d);const{formatters:A}=F.exports;A.j=function(k){try{return JSON.stringify(k)}catch(W){return"[UnexpectedJSONParseError]: "+W.message}}},447:(F,d,b)=>{F.exports=function(w){function A(y){let f,x,u,C=null;function v(...I){if(!v.enabled)return;const D=v,T=Number(new Date),L=T-(f||T);D.diff=L,D.prev=f,D.curr=T,f=T,I[0]=A.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let i=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(c,m)=>{if(c==="%%")return"%";i++;const g=A.formatters[m];if(typeof g=="function"){const q=I[i];c=g.call(D,q),I.splice(i,1),i--}return c}),A.formatArgs.call(D,I),(D.log||A.log).apply(D,I)}return v.namespace=y,v.useColors=A.useColors(),v.color=A.selectColor(y),v.extend=k,v.destroy=A.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>C!==null?C:(x!==A.namespaces&&(x=A.namespaces,u=A.enabled(y)),u),set:I=>{C=I}}),typeof A.init=="function"&&A.init(v),v}function k(y,f){const x=A(this.namespace+(f===void 0?":":f)+y);return x.log=this.log,x}function W(y){return y.toString().substring(2,y.toString().length-2).replace(/\.\*\?$/,"*")}return A.debug=A,A.default=A,A.coerce=function(y){return y instanceof Error?y.stack||y.message:y},A.disable=function(){const y=[...A.names.map(W),...A.skips.map(W).map(f=>"-"+f)].join(",");return A.enable(""),y},A.enable=function(y){let f;A.save(y),A.namespaces=y,A.names=[],A.skips=[];const x=(typeof y=="string"?y:"").split(/[\s,]+/),u=x.length;for(f=0;f<u;f++)x[f]&&((y=x[f].replace(/\*/g,".*?"))[0]==="-"?A.skips.push(new RegExp("^"+y.slice(1)+"$")):A.names.push(new RegExp("^"+y+"$")))},A.enabled=function(y){if(y[y.length-1]==="*")return!0;let f,x;for(f=0,x=A.skips.length;f<x;f++)if(A.skips[f].test(y))return!1;for(f=0,x=A.names.length;f<x;f++)if(A.names[f].test(y))return!0;return!1},A.humanize=b(824),A.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(w).forEach(y=>{A[y]=w[y]}),A.names=[],A.skips=[],A.formatters={},A.selectColor=function(y){let f=0;for(let x=0;x<y.length;x++)f=(f<<5)-f+y.charCodeAt(x),f|=0;return A.colors[Math.abs(f)%A.colors.length]},A.enable(A.load()),A}},996:F=>{var d=function(u){return function(C){return!!C&&typeof C=="object"}(u)&&!function(C){var v=Object.prototype.toString.call(C);return v==="[object RegExp]"||v==="[object Date]"||function(I){return I.$$typeof===b}(C)}(u)},b=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function w(u,C){return C.clone!==!1&&C.isMergeableObject(u)?f((v=u,Array.isArray(v)?[]:{}),u,C):u;var v}function A(u,C,v){return u.concat(C).map(function(I){return w(I,v)})}function k(u){return Object.keys(u).concat(function(C){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(C).filter(function(v){return Object.propertyIsEnumerable.call(C,v)}):[]}(u))}function W(u,C){try{return C in u}catch{return!1}}function y(u,C,v){var I={};return v.isMergeableObject(u)&&k(u).forEach(function(D){I[D]=w(u[D],v)}),k(C).forEach(function(D){(function(T,L){return W(T,L)&&!(Object.hasOwnProperty.call(T,L)&&Object.propertyIsEnumerable.call(T,L))})(u,D)||(W(u,D)&&v.isMergeableObject(C[D])?I[D]=function(T,L){if(!L.customMerge)return f;var i=L.customMerge(T);return typeof i=="function"?i:f}(D,v)(u[D],C[D],v):I[D]=w(C[D],v))}),I}function f(u,C,v){(v=v||{}).arrayMerge=v.arrayMerge||A,v.isMergeableObject=v.isMergeableObject||d,v.cloneUnlessOtherwiseSpecified=w;var I=Array.isArray(C);return I===Array.isArray(u)?I?v.arrayMerge(u,C,v):y(u,C,v):w(C,v)}f.all=function(u,C){if(!Array.isArray(u))throw new Error("first argument should be an array");return u.reduce(function(v,I){return f(v,I,C)},{})};var x=f;F.exports=x},856:function(F){F.exports=function(){function d(O){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},d(O)}function b(O,M){return b=Object.setPrototypeOf||function(z,V){return z.__proto__=V,z},b(O,M)}function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(O,M,z){return A=w()?Reflect.construct:function(V,ut,Ft){var Bt=[null];Bt.push.apply(Bt,ut);var te=new(Function.bind.apply(V,Bt));return Ft&&b(te,Ft.prototype),te},A.apply(null,arguments)}function k(O){return W(O)||y(O)||f(O)||u()}function W(O){if(Array.isArray(O))return x(O)}function y(O){if(typeof Symbol<"u"&&O[Symbol.iterator]!=null||O["@@iterator"]!=null)return Array.from(O)}function f(O,M){if(O){if(typeof O=="string")return x(O,M);var z=Object.prototype.toString.call(O).slice(8,-1);return z==="Object"&&O.constructor&&(z=O.constructor.name),z==="Map"||z==="Set"?Array.from(O):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?x(O,M):void 0}}function x(O,M){(M==null||M>O.length)&&(M=O.length);for(var z=0,V=new Array(M);z<M;z++)V[z]=O[z];return V}function u(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C=Object.hasOwnProperty,v=Object.setPrototypeOf,I=Object.isFrozen,D=Object.getPrototypeOf,T=Object.getOwnPropertyDescriptor,L=Object.freeze,i=Object.seal,c=Object.create,m=typeof Reflect<"u"&&Reflect,g=m.apply,q=m.construct;g||(g=function(O,M,z){return O.apply(M,z)}),L||(L=function(O){return O}),i||(i=function(O){return O}),q||(q=function(O,M){return A(O,k(M))});var Y=K(Array.prototype.forEach),nt=K(Array.prototype.pop),lt=K(Array.prototype.push),yt=K(String.prototype.toLowerCase),bt=K(String.prototype.match),mt=K(String.prototype.replace),Se=K(String.prototype.indexOf),p=K(String.prototype.trim),_=K(RegExp.prototype.test),U=_t(TypeError);function K(O){return function(M){for(var z=arguments.length,V=new Array(z>1?z-1:0),ut=1;ut<z;ut++)V[ut-1]=arguments[ut];return g(O,M,V)}}function _t(O){return function(){for(var M=arguments.length,z=new Array(M),V=0;V<M;V++)z[V]=arguments[V];return q(O,z)}}function N(O,M){v&&v(O,null);for(var z=M.length;z--;){var V=M[z];if(typeof V=="string"){var ut=yt(V);ut!==V&&(I(M)||(M[z]=ut),V=ut)}O[V]=!0}return O}function G(O){var M,z=c(null);for(M in O)g(C,O,[M])&&(z[M]=O[M]);return z}function et(O,M){for(;O!==null;){var z=T(O,M);if(z){if(z.get)return K(z.get);if(typeof z.value=="function")return K(z.value)}O=D(O)}function V(ut){return console.warn("fallback value for",ut),null}return V}var Ct=L(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),vt=L(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),At=L(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Xt=L(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),st=L(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ot=L(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),wt=L(["#text"]),St=L(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Lt=L(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vt=L(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),jt=L(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ot=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),fe=i(/<%[\w\W]*|[\w\W]*%>/gm),wn=i(/^data-[\-\w.\u00B7-\uFFFF]/),Mt=i(/^aria-[\-\w]+$/),qt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ve=i(/^(?:\w+script|data):/i),xn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Cn=i(/^html$/i),pe=function(){return typeof window>"u"?null:window},Sn=function(O,M){if(d(O)!=="object"||typeof O.createPolicy!="function")return null;var z=null,V="data-tt-policy-suffix";M.currentScript&&M.currentScript.hasAttribute(V)&&(z=M.currentScript.getAttribute(V));var ut="dompurify"+(z?"#"+z:"");try{return O.createPolicy(ut,{createHTML:function(Ft){return Ft}})}catch{return console.warn("TrustedTypes policy "+ut+" could not be created."),null}};function Ze(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe(),M=function(o){return Ze(o)};if(M.version="2.3.8",M.removed=[],!O||!O.document||O.document.nodeType!==9)return M.isSupported=!1,M;var z=O.document,V=O.document,ut=O.DocumentFragment,Ft=O.HTMLTemplateElement,Bt=O.Node,te=O.Element,Ne=O.NodeFilter,Ke=O.NamedNodeMap,Zt=Ke===void 0?O.NamedNodeMap||O.MozNamedAttrMap:Ke,On=O.HTMLFormElement,En=O.DOMParser,An=O.trustedTypes,Oe=te.prototype,jn=et(Oe,"cloneNode"),kn=et(Oe,"nextSibling"),Tn=et(Oe,"childNodes"),Pe=et(Oe,"parentNode");if(typeof Ft=="function"){var Nt=V.createElement("template");Nt.content&&Nt.content.ownerDocument&&(V=Nt.content.ownerDocument)}var Pt=Sn(An,z),Ye=Pt?Pt.createHTML(""):"",Ee=V,Re=Ee.implementation,ee=Ee.createNodeIterator,Qe=Ee.createDocumentFragment,Xe=Ee.getElementsByTagName,In=z.importNode,tn={};try{tn=G(V).documentMode?V.documentMode:{}}catch{}var kt={};M.isSupported=typeof Pe=="function"&&Re&&Re.createHTMLDocument!==void 0&&tn!==9;var de,Wt,Ae=Ot,je=fe,De=wn,Ln=Mt,en=Ve,ke=xn,Q=qt,ft=null,nn=N({},[].concat(k(Ct),k(vt),k(At),k(st),k(wt))),pt=null,ne=N({},[].concat(k(St),k(Lt),k(Vt),k(jt))),it=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),re=null,Te=null,Ue=!0,$e=!0,rn=!1,oe=!1,Kt=!1,ze=!1,He=!1,ie=!1,Ie=!1,se=!1,on=!0,qe=!0,ae=!1,Rt={},ce=null,sn=N({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),an=null,cn=N({},["audio","video","img","source","image","track"]),Be=null,Yt=N({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),le="http://www.w3.org/1998/Math/MathML",We="http://www.w3.org/2000/svg",Gt="http://www.w3.org/1999/xhtml",Le=Gt,ln=!1,he=["application/xhtml+xml","text/html"],me="text/html",ue=null,Mn=V.createElement("form"),un=function(o){return o instanceof RegExp||o instanceof Function},Ge=function(o){ue&&ue===o||(o&&d(o)==="object"||(o={}),o=G(o),ft="ALLOWED_TAGS"in o?N({},o.ALLOWED_TAGS):nn,pt="ALLOWED_ATTR"in o?N({},o.ALLOWED_ATTR):ne,Be="ADD_URI_SAFE_ATTR"in o?N(G(Yt),o.ADD_URI_SAFE_ATTR):Yt,an="ADD_DATA_URI_TAGS"in o?N(G(cn),o.ADD_DATA_URI_TAGS):cn,ce="FORBID_CONTENTS"in o?N({},o.FORBID_CONTENTS):sn,re="FORBID_TAGS"in o?N({},o.FORBID_TAGS):{},Te="FORBID_ATTR"in o?N({},o.FORBID_ATTR):{},Rt="USE_PROFILES"in o&&o.USE_PROFILES,Ue=o.ALLOW_ARIA_ATTR!==!1,$e=o.ALLOW_DATA_ATTR!==!1,rn=o.ALLOW_UNKNOWN_PROTOCOLS||!1,oe=o.SAFE_FOR_TEMPLATES||!1,Kt=o.WHOLE_DOCUMENT||!1,ie=o.RETURN_DOM||!1,Ie=o.RETURN_DOM_FRAGMENT||!1,se=o.RETURN_TRUSTED_TYPE||!1,He=o.FORCE_BODY||!1,on=o.SANITIZE_DOM!==!1,qe=o.KEEP_CONTENT!==!1,ae=o.IN_PLACE||!1,Q=o.ALLOWED_URI_REGEXP||Q,Le=o.NAMESPACE||Gt,o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(it.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&un(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(it.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(it.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),de=de=he.indexOf(o.PARSER_MEDIA_TYPE)===-1?me:o.PARSER_MEDIA_TYPE,Wt=de==="application/xhtml+xml"?function(j){return j}:yt,oe&&($e=!1),Ie&&(ie=!0),Rt&&(ft=N({},k(wt)),pt=[],Rt.html===!0&&(N(ft,Ct),N(pt,St)),Rt.svg===!0&&(N(ft,vt),N(pt,Lt),N(pt,jt)),Rt.svgFilters===!0&&(N(ft,At),N(pt,Lt),N(pt,jt)),Rt.mathMl===!0&&(N(ft,st),N(pt,Vt),N(pt,jt))),o.ADD_TAGS&&(ft===nn&&(ft=G(ft)),N(ft,o.ADD_TAGS)),o.ADD_ATTR&&(pt===ne&&(pt=G(pt)),N(pt,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&N(Be,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ce===sn&&(ce=G(ce)),N(ce,o.FORBID_CONTENTS)),qe&&(ft["#text"]=!0),Kt&&N(ft,["html","head","body"]),ft.table&&(N(ft,["tbody"]),delete re.tbody),L&&L(o),ue=o)},fn=N({},["mi","mo","mn","ms","mtext"]),pn=N({},["foreignobject","desc","title","annotation-xml"]),Fn=N({},["title","style","font","a","script"]),Dt=N({},vt);N(Dt,At),N(Dt,Xt);var Me=N({},st);N(Me,ot);var Nn=function(o){var j=Pe(o);j&&j.tagName||(j={namespaceURI:Gt,tagName:"template"});var S=yt(o.tagName),X=yt(j.tagName);return o.namespaceURI===We?j.namespaceURI===Gt?S==="svg":j.namespaceURI===le?S==="svg"&&(X==="annotation-xml"||fn[X]):!!Dt[S]:o.namespaceURI===le?j.namespaceURI===Gt?S==="math":j.namespaceURI===We?S==="math"&&pn[X]:!!Me[S]:o.namespaceURI===Gt&&!(j.namespaceURI===We&&!pn[X])&&!(j.namespaceURI===le&&!fn[X])&&!Me[S]&&(Fn[S]||!Dt[S])},Ut=function(o){lt(M.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=Ye}catch{o.remove()}}},ge=function(o,j){try{lt(M.removed,{attribute:j.getAttributeNode(o),from:j})}catch{lt(M.removed,{attribute:null,from:j})}if(j.removeAttribute(o),o==="is"&&!pt[o])if(ie||Ie)try{Ut(j)}catch{}else try{j.setAttribute(o,"")}catch{}},dn=function(o){var j,S;if(He)o="<remove></remove>"+o;else{var X=bt(o,/^[\r\n\t ]+/);S=X&&X[0]}de==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var at=Pt?Pt.createHTML(o):o;if(Le===Gt)try{j=new En().parseFromString(at,de)}catch{}if(!j||!j.documentElement){j=Re.createDocument(Le,"template",null);try{j.documentElement.innerHTML=ln?"":at}catch{}}var gt=j.body||j.documentElement;return o&&S&&gt.insertBefore(V.createTextNode(S),gt.childNodes[0]||null),Le===Gt?Xe.call(j,Kt?"html":"body")[0]:Kt?j.documentElement:gt},hn=function(o){return ee.call(o.ownerDocument||o,o,Ne.SHOW_ELEMENT|Ne.SHOW_COMMENT|Ne.SHOW_TEXT,null,!1)},Pn=function(o){return o instanceof On&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Zt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},ye=function(o){return d(Bt)==="object"?o instanceof Bt:o&&d(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},xt=function(o,j,S){kt[o]&&Y(kt[o],function(X){X.call(M,j,S,ue)})},ve=function(o){var j;if(xt("beforeSanitizeElements",o,null),Pn(o)||_(/[\u0080-\uFFFF]/,o.nodeName))return Ut(o),!0;var S=Wt(o.nodeName);if(xt("uponSanitizeElement",o,{tagName:S,allowedTags:ft}),o.hasChildNodes()&&!ye(o.firstElementChild)&&(!ye(o.content)||!ye(o.content.firstElementChild))&&_(/<[/\w]/g,o.innerHTML)&&_(/<[/\w]/g,o.textContent)||S==="select"&&_(/<template/i,o.innerHTML))return Ut(o),!0;if(!ft[S]||re[S]){if(!re[S]&&Qt(S)&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,S)||it.tagNameCheck instanceof Function&&it.tagNameCheck(S)))return!1;if(qe&&!ce[S]){var X=Pe(o)||o.parentNode,at=Tn(o)||o.childNodes;if(at&&X)for(var gt=at.length-1;gt>=0;--gt)X.insertBefore(jn(at[gt],!0),kn(o))}return Ut(o),!0}return o instanceof te&&!Nn(o)?(Ut(o),!0):S!=="noscript"&&S!=="noembed"||!_(/<\/no(script|embed)/i,o.innerHTML)?(oe&&o.nodeType===3&&(j=o.textContent,j=mt(j,Ae," "),j=mt(j,je," "),o.textContent!==j&&(lt(M.removed,{element:o.cloneNode()}),o.textContent=j)),xt("afterSanitizeElements",o,null),!1):(Ut(o),!0)},mn=function(o,j,S){if(on&&(j==="id"||j==="name")&&(S in V||S in Mn))return!1;if(!($e&&!Te[j]&&_(De,j))){if(!(Ue&&_(Ln,j))){if(!pt[j]||Te[j]){if(!(Qt(o)&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,o)||it.tagNameCheck instanceof Function&&it.tagNameCheck(o))&&(it.attributeNameCheck instanceof RegExp&&_(it.attributeNameCheck,j)||it.attributeNameCheck instanceof Function&&it.attributeNameCheck(j))||j==="is"&&it.allowCustomizedBuiltInElements&&(it.tagNameCheck instanceof RegExp&&_(it.tagNameCheck,S)||it.tagNameCheck instanceof Function&&it.tagNameCheck(S))))return!1}else if(!Be[j]){if(!_(Q,mt(S,ke,""))){if((j!=="src"&&j!=="xlink:href"&&j!=="href"||o==="script"||Se(S,"data:")!==0||!an[o])&&!(rn&&!_(en,mt(S,ke,"")))){if(S)return!1}}}}}return!0},Qt=function(o){return o.indexOf("-")>0},be=function(o){var j,S,X,at;xt("beforeSanitizeAttributes",o,null);var gt=o.attributes;if(gt){var dt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:pt};for(at=gt.length;at--;){var _e=j=gt[at],Jt=_e.name,Et=_e.namespaceURI;if(S=Jt==="value"?j.value:p(j.value),X=Wt(Jt),dt.attrName=X,dt.attrValue=S,dt.keepAttr=!0,dt.forceKeepAttr=void 0,xt("uponSanitizeAttribute",o,dt),S=dt.attrValue,!dt.forceKeepAttr&&(ge(Jt,o),dt.keepAttr))if(_(/\/>/i,S))ge(Jt,o);else{oe&&(S=mt(S,Ae," "),S=mt(S,je," "));var Je=Wt(o.nodeName);if(mn(Je,X,S))try{Et?o.setAttributeNS(Et,Jt,S):o.setAttribute(Jt,S),nt(M.removed)}catch{}}}xt("afterSanitizeAttributes",o,null)}},Rn=function o(j){var S,X=hn(j);for(xt("beforeSanitizeShadowDOM",j,null);S=X.nextNode();)xt("uponSanitizeShadowNode",S,null),ve(S)||(S.content instanceof ut&&o(S.content),be(S));xt("afterSanitizeShadowDOM",j,null)};return M.sanitize=function(o,j){var S,X,at,gt,dt;if((ln=!o)&&(o="<!-->"),typeof o!="string"&&!ye(o)){if(typeof o.toString!="function")throw U("toString is not a function");if(typeof(o=o.toString())!="string")throw U("dirty is not a string, aborting")}if(!M.isSupported){if(d(O.toStaticHTML)==="object"||typeof O.toStaticHTML=="function"){if(typeof o=="string")return O.toStaticHTML(o);if(ye(o))return O.toStaticHTML(o.outerHTML)}return o}if(ze||Ge(j),M.removed=[],typeof o=="string"&&(ae=!1),ae){if(o.nodeName){var _e=Wt(o.nodeName);if(!ft[_e]||re[_e])throw U("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Bt)(X=(S=dn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&X.nodeName==="BODY"||X.nodeName==="HTML"?S=X:S.appendChild(X);else{if(!ie&&!oe&&!Kt&&o.indexOf("<")===-1)return Pt&&se?Pt.createHTML(o):o;if(!(S=dn(o)))return ie?null:se?Ye:""}S&&He&&Ut(S.firstChild);for(var Jt=hn(ae?o:S);at=Jt.nextNode();)at.nodeType===3&&at===gt||ve(at)||(at.content instanceof ut&&Rn(at.content),be(at),gt=at);if(gt=null,ae)return o;if(ie){if(Ie)for(dt=Qe.call(S.ownerDocument);S.firstChild;)dt.appendChild(S.firstChild);else dt=S;return pt.shadowroot&&(dt=In.call(z,dt,!0)),dt}var Et=Kt?S.outerHTML:S.innerHTML;return Kt&&ft["!doctype"]&&S.ownerDocument&&S.ownerDocument.doctype&&S.ownerDocument.doctype.name&&_(Cn,S.ownerDocument.doctype.name)&&(Et="<!DOCTYPE "+S.ownerDocument.doctype.name+`>
`+Et),oe&&(Et=mt(Et,Ae," "),Et=mt(Et,je," ")),Pt&&se?Pt.createHTML(Et):Et},M.setConfig=function(o){Ge(o),ze=!0},M.clearConfig=function(){ue=null,ze=!1},M.isValidAttribute=function(o,j,S){ue||Ge({});var X=Wt(o),at=Wt(j);return mn(X,at,S)},M.addHook=function(o,j){typeof j=="function"&&(kt[o]=kt[o]||[],lt(kt[o],j))},M.removeHook=function(o){if(kt[o])return nt(kt[o])},M.removeHooks=function(o){kt[o]&&(kt[o]=[])},M.removeAllHooks=function(){kt={}},M}return Ze()}()},729:F=>{var d=Object.prototype.hasOwnProperty,b="~";function w(){}function A(f,x,u){this.fn=f,this.context=x,this.once=u||!1}function k(f,x,u,C,v){if(typeof u!="function")throw new TypeError("The listener must be a function");var I=new A(u,C||f,v),D=b?b+x:x;return f._events[D]?f._events[D].fn?f._events[D]=[f._events[D],I]:f._events[D].push(I):(f._events[D]=I,f._eventsCount++),f}function W(f,x){--f._eventsCount==0?f._events=new w:delete f._events[x]}function y(){this._events=new w,this._eventsCount=0}Object.create&&(w.prototype=Object.create(null),new w().__proto__||(b=!1)),y.prototype.eventNames=function(){var f,x,u=[];if(this._eventsCount===0)return u;for(x in f=this._events)d.call(f,x)&&u.push(b?x.slice(1):x);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},y.prototype.listeners=function(f){var x=b?b+f:f,u=this._events[x];if(!u)return[];if(u.fn)return[u.fn];for(var C=0,v=u.length,I=new Array(v);C<v;C++)I[C]=u[C].fn;return I},y.prototype.listenerCount=function(f){var x=b?b+f:f,u=this._events[x];return u?u.fn?1:u.length:0},y.prototype.emit=function(f,x,u,C,v,I){var D=b?b+f:f;if(!this._events[D])return!1;var T,L,i=this._events[D],c=arguments.length;if(i.fn){switch(i.once&&this.removeListener(f,i.fn,void 0,!0),c){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,x),!0;case 3:return i.fn.call(i.context,x,u),!0;case 4:return i.fn.call(i.context,x,u,C),!0;case 5:return i.fn.call(i.context,x,u,C,v),!0;case 6:return i.fn.call(i.context,x,u,C,v,I),!0}for(L=1,T=new Array(c-1);L<c;L++)T[L-1]=arguments[L];i.fn.apply(i.context,T)}else{var m,g=i.length;for(L=0;L<g;L++)switch(i[L].once&&this.removeListener(f,i[L].fn,void 0,!0),c){case 1:i[L].fn.call(i[L].context);break;case 2:i[L].fn.call(i[L].context,x);break;case 3:i[L].fn.call(i[L].context,x,u);break;case 4:i[L].fn.call(i[L].context,x,u,C);break;default:if(!T)for(m=1,T=new Array(c-1);m<c;m++)T[m-1]=arguments[m];i[L].fn.apply(i[L].context,T)}}return!0},y.prototype.on=function(f,x,u){return k(this,f,x,u,!1)},y.prototype.once=function(f,x,u){return k(this,f,x,u,!0)},y.prototype.removeListener=function(f,x,u,C){var v=b?b+f:f;if(!this._events[v])return this;if(!x)return W(this,v),this;var I=this._events[v];if(I.fn)I.fn!==x||C&&!I.once||u&&I.context!==u||W(this,v);else{for(var D=0,T=[],L=I.length;D<L;D++)(I[D].fn!==x||C&&!I[D].once||u&&I[D].context!==u)&&T.push(I[D]);T.length?this._events[v]=T.length===1?T[0]:T:W(this,v)}return this},y.prototype.removeAllListeners=function(f){var x;return f?(x=b?b+f:f,this._events[x]&&W(this,x)):(this._events=new w,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=b,y.EventEmitter=y,F.exports=y},717:F=>{typeof Object.create=="function"?F.exports=function(d,b){d.super_=b,d.prototype=Object.create(b.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}})}:F.exports=function(d,b){d.super_=b;var w=function(){};w.prototype=b.prototype,d.prototype=new w,d.prototype.constructor=d}},824:F=>{var d=1e3,b=60*d,w=60*b,A=24*w,k=7*A,W=365.25*A;function y(f,x,u,C){var v=x>=1.5*u;return Math.round(f/u)+" "+C+(v?"s":"")}F.exports=function(f,x){x=x||{};var u=typeof f;if(u==="string"&&f.length>0)return function(C){if(!((C=String(C)).length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(C);if(v){var I=parseFloat(v[1]);switch((v[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return I*W;case"weeks":case"week":case"w":return I*k;case"days":case"day":case"d":return I*A;case"hours":case"hour":case"hrs":case"hr":case"h":return I*w;case"minutes":case"minute":case"mins":case"min":case"m":return I*b;case"seconds":case"second":case"secs":case"sec":case"s":return I*d;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return I;default:return}}}}(f);if(u==="number"&&isFinite(f))return x.long?function(C){var v=Math.abs(C);return v>=A?y(C,v,A,"day"):v>=w?y(C,v,w,"hour"):v>=b?y(C,v,b,"minute"):v>=d?y(C,v,d,"second"):C+" ms"}(f):function(C){var v=Math.abs(C);return v>=A?Math.round(C/A)+"d":v>=w?Math.round(C/w)+"h":v>=b?Math.round(C/b)+"m":v>=d?Math.round(C/d)+"s":C+"ms"}(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},520:(F,d,b)=>{var w=b(155),A=w.platform==="win32",k=b(539);function W(i,c){for(var m=[],g=0;g<i.length;g++){var q=i[g];q&&q!=="."&&(q===".."?m.length&&m[m.length-1]!==".."?m.pop():c&&m.push(".."):m.push(q))}return m}function y(i){for(var c=i.length-1,m=0;m<=c&&!i[m];m++);for(var g=c;g>=0&&!i[g];g--);return m===0&&g===c?i:m>g?[]:i.slice(m,g+1)}var f=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,x=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,u={};function C(i){var c=f.exec(i),m=(c[1]||"")+(c[2]||""),g=c[3]||"",q=x.exec(g);return[m,q[1],q[2],q[3]]}function v(i){var c=f.exec(i),m=c[1]||"",g=!!m&&m[1]!==":";return{device:m,isUnc:g,isAbsolute:g||!!c[2],tail:c[3]}}function I(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}u.resolve=function(){for(var i="",c="",m=!1,g=arguments.length-1;g>=-1;g--){var q;if(g>=0?q=arguments[g]:i?(q=w.env["="+i])&&q.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(q=i+"\\"):q=w.cwd(),!k.isString(q))throw new TypeError("Arguments to path.resolve must be strings");if(q){var Y=v(q),nt=Y.device,lt=Y.isUnc,yt=Y.isAbsolute,bt=Y.tail;if((!nt||!i||nt.toLowerCase()===i.toLowerCase())&&(i||(i=nt),m||(c=bt+"\\"+c,m=yt),i&&m))break}}return lt&&(i=I(i)),i+(m?"\\":"")+(c=W(c.split(/[\\\/]+/),!m).join("\\"))||"."},u.normalize=function(i){var c=v(i),m=c.device,g=c.isUnc,q=c.isAbsolute,Y=c.tail,nt=/[\\\/]$/.test(Y);return(Y=W(Y.split(/[\\\/]+/),!q).join("\\"))||q||(Y="."),Y&&nt&&(Y+="\\"),g&&(m=I(m)),m+(q?"\\":"")+Y},u.isAbsolute=function(i){return v(i).isAbsolute},u.join=function(){for(var i=[],c=0;c<arguments.length;c++){var m=arguments[c];if(!k.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&i.push(m)}var g=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(g=g.replace(/^[\\\/]{2,}/,"\\")),u.normalize(g)},u.relative=function(i,c){i=u.resolve(i),c=u.resolve(c);for(var m=i.toLowerCase(),g=c.toLowerCase(),q=y(c.split("\\")),Y=y(m.split("\\")),nt=y(g.split("\\")),lt=Math.min(Y.length,nt.length),yt=lt,bt=0;bt<lt;bt++)if(Y[bt]!==nt[bt]){yt=bt;break}if(yt==0)return c;var mt=[];for(bt=yt;bt<Y.length;bt++)mt.push("..");return(mt=mt.concat(q.slice(yt))).join("\\")},u._makeLong=function(i){if(!k.isString(i))return i;if(!i)return"";var c=u.resolve(i);return/^[a-zA-Z]\:\\/.test(c)?"\\\\?\\"+c:/^\\\\[^?.]/.test(c)?"\\\\?\\UNC\\"+c.substring(2):i},u.dirname=function(i){var c=C(i),m=c[0],g=c[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},u.basename=function(i,c){var m=C(i)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},u.extname=function(i){return C(i)[3]},u.format=function(i){if(!k.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var c=i.root||"";if(!k.isString(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var m=i.dir,g=i.base||"";return m?m[m.length-1]===u.sep?m+g:m+u.sep+g:g},u.parse=function(i){if(!k.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var c=C(i);if(!c||c.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:c[0],dir:c[0]+c[1].slice(0,-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},u.sep="\\",u.delimiter=";";var D=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,T={};function L(i){return D.exec(i).slice(1)}T.resolve=function(){for(var i="",c=!1,m=arguments.length-1;m>=-1&&!c;m--){var g=m>=0?arguments[m]:w.cwd();if(!k.isString(g))throw new TypeError("Arguments to path.resolve must be strings");g&&(i=g+"/"+i,c=g[0]==="/")}return(c?"/":"")+(i=W(i.split("/"),!c).join("/"))||"."},T.normalize=function(i){var c=T.isAbsolute(i),m=i&&i[i.length-1]==="/";return(i=W(i.split("/"),!c).join("/"))||c||(i="."),i&&m&&(i+="/"),(c?"/":"")+i},T.isAbsolute=function(i){return i.charAt(0)==="/"},T.join=function(){for(var i="",c=0;c<arguments.length;c++){var m=arguments[c];if(!k.isString(m))throw new TypeError("Arguments to path.join must be strings");m&&(i+=i?"/"+m:m)}return T.normalize(i)},T.relative=function(i,c){i=T.resolve(i).substr(1),c=T.resolve(c).substr(1);for(var m=y(i.split("/")),g=y(c.split("/")),q=Math.min(m.length,g.length),Y=q,nt=0;nt<q;nt++)if(m[nt]!==g[nt]){Y=nt;break}var lt=[];for(nt=Y;nt<m.length;nt++)lt.push("..");return(lt=lt.concat(g.slice(Y))).join("/")},T._makeLong=function(i){return i},T.dirname=function(i){var c=L(i),m=c[0],g=c[1];return m||g?(g&&(g=g.substr(0,g.length-1)),m+g):"."},T.basename=function(i,c){var m=L(i)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},T.extname=function(i){return L(i)[3]},T.format=function(i){if(!k.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var c=i.root||"";if(!k.isString(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+T.sep:"")+(i.base||"")},T.parse=function(i){if(!k.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var c=L(i);if(!c||c.length!==4)throw new TypeError("Invalid path '"+i+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},T.sep="/",T.delimiter=":",F.exports=A?u:T,F.exports.posix=T,F.exports.win32=u},155:F=>{var d,b,w=F.exports={};function A(){throw new Error("setTimeout has not been defined")}function k(){throw new Error("clearTimeout has not been defined")}function W(T){if(d===setTimeout)return setTimeout(T,0);if((d===A||!d)&&setTimeout)return d=setTimeout,setTimeout(T,0);try{return d(T,0)}catch{try{return d.call(null,T,0)}catch{return d.call(this,T,0)}}}(function(){try{d=typeof setTimeout=="function"?setTimeout:A}catch{d=A}try{b=typeof clearTimeout=="function"?clearTimeout:k}catch{b=k}})();var y,f=[],x=!1,u=-1;function C(){x&&y&&(x=!1,y.length?f=y.concat(f):u=-1,f.length&&v())}function v(){if(!x){var T=W(C);x=!0;for(var L=f.length;L;){for(y=f,f=[];++u<L;)y&&y[u].run();u=-1,L=f.length}y=null,x=!1,function(i){if(b===clearTimeout)return clearTimeout(i);if((b===k||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(i);try{b(i)}catch{try{return b.call(null,i)}catch{return b.call(this,i)}}}(T)}}function I(T,L){this.fun=T,this.array=L}function D(){}w.nextTick=function(T){var L=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)L[i-1]=arguments[i];f.push(new I(T,L)),f.length!==1||x||W(v)},I.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=D,w.addListener=D,w.once=D,w.off=D,w.removeListener=D,w.removeAllListeners=D,w.emit=D,w.prependListener=D,w.prependOnceListener=D,w.listeners=function(T){return[]},w.binding=function(T){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(T){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},384:F=>{F.exports=function(d){return d&&typeof d=="object"&&typeof d.copy=="function"&&typeof d.fill=="function"&&typeof d.readUInt8=="function"}},539:(F,d,b)=>{var w=b(155),A=/%[sdj%]/g;d.format=function(p){if(!i(p)){for(var _=[],U=0;U<arguments.length;U++)_.push(y(arguments[U]));return _.join(" ")}U=1;for(var K=arguments,_t=K.length,N=String(p).replace(A,function(et){if(et==="%%")return"%";if(U>=_t)return et;switch(et){case"%s":return String(K[U++]);case"%d":return Number(K[U++]);case"%j":try{return JSON.stringify(K[U++])}catch{return"[Circular]"}default:return et}}),G=K[U];U<_t;G=K[++U])T(G)||!g(G)?N+=" "+G:N+=" "+y(G);return N},d.deprecate=function(p,_){if(c(b.g.process))return function(){return d.deprecate(p,_).apply(this,arguments)};if(w.noDeprecation===!0)return p;var U=!1;return function(){if(!U){if(w.throwDeprecation)throw new Error(_);w.traceDeprecation?console.trace(_):console.error(_),U=!0}return p.apply(this,arguments)}};var k,W={};function y(p,_){var U={seen:[],stylize:x};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),D(_)?U.showHidden=_:_&&d._extend(U,_),c(U.showHidden)&&(U.showHidden=!1),c(U.depth)&&(U.depth=2),c(U.colors)&&(U.colors=!1),c(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=f),u(U,p,U.depth)}function f(p,_){var U=y.styles[_];return U?"\x1B["+y.colors[U][0]+"m"+p+"\x1B["+y.colors[U][1]+"m":p}function x(p,_){return p}function u(p,_,U){if(p.customInspect&&_&&nt(_.inspect)&&_.inspect!==d.inspect&&(!_.constructor||_.constructor.prototype!==_)){var K=_.inspect(U,p);return i(K)||(K=u(p,K,U)),K}var _t=function(st,ot){if(c(ot))return st.stylize("undefined","undefined");if(i(ot)){var wt="'"+JSON.stringify(ot).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return st.stylize(wt,"string")}if(L(ot))return st.stylize(""+ot,"number");if(D(ot))return st.stylize(""+ot,"boolean");if(T(ot))return st.stylize("null","null")}(p,_);if(_t)return _t;var N=Object.keys(_),G=function(st){var ot={};return st.forEach(function(wt,St){ot[wt]=!0}),ot}(N);if(p.showHidden&&(N=Object.getOwnPropertyNames(_)),Y(_)&&(N.indexOf("message")>=0||N.indexOf("description")>=0))return C(_);if(N.length===0){if(nt(_)){var et=_.name?": "+_.name:"";return p.stylize("[Function"+et+"]","special")}if(m(_))return p.stylize(RegExp.prototype.toString.call(_),"regexp");if(q(_))return p.stylize(Date.prototype.toString.call(_),"date");if(Y(_))return C(_)}var Ct,vt="",At=!1,Xt=["{","}"];return I(_)&&(At=!0,Xt=["[","]"]),nt(_)&&(vt=" [Function"+(_.name?": "+_.name:"")+"]"),m(_)&&(vt=" "+RegExp.prototype.toString.call(_)),q(_)&&(vt=" "+Date.prototype.toUTCString.call(_)),Y(_)&&(vt=" "+C(_)),N.length!==0||At&&_.length!=0?U<0?m(_)?p.stylize(RegExp.prototype.toString.call(_),"regexp"):p.stylize("[Object]","special"):(p.seen.push(_),Ct=At?function(st,ot,wt,St,Lt){for(var Vt=[],jt=0,Ot=ot.length;jt<Ot;++jt)Se(ot,String(jt))?Vt.push(v(st,ot,wt,St,String(jt),!0)):Vt.push("");return Lt.forEach(function(fe){fe.match(/^\d+$/)||Vt.push(v(st,ot,wt,St,fe,!0))}),Vt}(p,_,U,G,N):N.map(function(st){return v(p,_,U,G,st,At)}),p.seen.pop(),function(st,ot,wt){return st.reduce(function(St,Lt){return Lt.indexOf(`
`)>=0,St+Lt.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?wt[0]+(ot===""?"":ot+`
 `)+" "+st.join(`,
  `)+" "+wt[1]:wt[0]+ot+" "+st.join(", ")+" "+wt[1]}(Ct,vt,Xt)):Xt[0]+vt+Xt[1]}function C(p){return"["+Error.prototype.toString.call(p)+"]"}function v(p,_,U,K,_t,N){var G,et,Ct;if((Ct=Object.getOwnPropertyDescriptor(_,_t)||{value:_[_t]}).get?et=Ct.set?p.stylize("[Getter/Setter]","special"):p.stylize("[Getter]","special"):Ct.set&&(et=p.stylize("[Setter]","special")),Se(K,_t)||(G="["+_t+"]"),et||(p.seen.indexOf(Ct.value)<0?(et=T(U)?u(p,Ct.value,null):u(p,Ct.value,U-1)).indexOf(`
`)>-1&&(et=N?et.split(`
`).map(function(vt){return"  "+vt}).join(`
`).substr(2):`
`+et.split(`
`).map(function(vt){return"   "+vt}).join(`
`)):et=p.stylize("[Circular]","special")),c(G)){if(N&&_t.match(/^\d+$/))return et;(G=JSON.stringify(""+_t)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(G=G.substr(1,G.length-2),G=p.stylize(G,"name")):(G=G.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),G=p.stylize(G,"string"))}return G+": "+et}function I(p){return Array.isArray(p)}function D(p){return typeof p=="boolean"}function T(p){return p===null}function L(p){return typeof p=="number"}function i(p){return typeof p=="string"}function c(p){return p===void 0}function m(p){return g(p)&&lt(p)==="[object RegExp]"}function g(p){return typeof p=="object"&&p!==null}function q(p){return g(p)&&lt(p)==="[object Date]"}function Y(p){return g(p)&&(lt(p)==="[object Error]"||p instanceof Error)}function nt(p){return typeof p=="function"}function lt(p){return Object.prototype.toString.call(p)}function yt(p){return p<10?"0"+p.toString(10):p.toString(10)}d.debuglog=function(p){if(c(k)&&(k=w.env.NODE_DEBUG||""),p=p.toUpperCase(),!W[p])if(new RegExp("\\b"+p+"\\b","i").test(k)){var _=w.pid;W[p]=function(){var U=d.format.apply(d,arguments);console.error("%s %d: %s",p,_,U)}}else W[p]=function(){};return W[p]},d.inspect=y,y.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},y.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},d.isArray=I,d.isBoolean=D,d.isNull=T,d.isNullOrUndefined=function(p){return p==null},d.isNumber=L,d.isString=i,d.isSymbol=function(p){return typeof p=="symbol"},d.isUndefined=c,d.isRegExp=m,d.isObject=g,d.isDate=q,d.isError=Y,d.isFunction=nt,d.isPrimitive=function(p){return p===null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||typeof p=="symbol"||p===void 0},d.isBuffer=b(384);var bt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function mt(){var p=new Date,_=[yt(p.getHours()),yt(p.getMinutes()),yt(p.getSeconds())].join(":");return[p.getDate(),bt[p.getMonth()],_].join(" ")}function Se(p,_){return Object.prototype.hasOwnProperty.call(p,_)}d.log=function(){console.log("%s - %s",mt(),d.format.apply(d,arguments))},d.inherits=b(717),d._extend=function(p,_){if(!_||!g(_))return p;for(var U=Object.keys(_),K=U.length;K--;)p[U[K]]=_[U[K]];return p}}},Ht={};function J(F){var d=Ht[F];if(d!==void 0)return d.exports;var b=Ht[F]={exports:{}};return Ce[F].call(b.exports,b,b.exports,J),b.exports}J.n=F=>{var d=F&&F.__esModule?()=>F.default:()=>F;return J.d(d,{a:d}),d},J.d=(F,d)=>{for(var b in d)J.o(d,b)&&!J.o(F,b)&&Object.defineProperty(F,b,{enumerable:!0,get:d[b]})},J.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),J.o=(F,d)=>Object.prototype.hasOwnProperty.call(F,d),J.r=F=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})};var ct={};return(()=>{J.r(ct),J.d(ct,{LSPluginUser:()=>Wn,setupPluginUserInstance:()=>gr});var F=J(520),d=(J(856),J(996)),b=J.n(d),w=function(){return w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},w.apply(this,arguments)};function A(e){return e.toLowerCase()}var k=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],W=/[^A-Z0-9]+/gi;function y(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,s){return r.replace(s,n)},e)}function f(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var s=r.splitRegexp,a=s===void 0?k:s,l=r.stripRegexp,h=l===void 0?W:l,E=r.transform,R=E===void 0?A:E,$=r.delimiter,P=$===void 0?" ":$,H=y(y(n,a,"$1\0$2"),h,"\0"),Z=0,B=H.length;H.charAt(Z)==="\0";)Z++;for(;H.charAt(B-1)==="\0";)B--;return H.slice(Z,B).split("\0").map(R).join(P)}(e,w({delimiter:"."},t))}var x=J(729),u=J.n(x);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const v=navigator.platform.toLowerCase()==="win32"?F.win32:F.posix,I=function(e,t){return t===void 0&&(t={}),f(e,w({delimiter:"_"},t))};class D extends u(){constructor(t,n){super(),C(this,"_tag",void 0),C(this,"_opts",void 0),C(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var s;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const a=n.reduce((h,E)=>(E&&E instanceof Error?h+=`${E.message} ${E.stack}`:h+=E.toString(),h),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var l;this._logs.push([t,a]),(r||(s=this._opts)!==null&&s!==void 0&&s.console)&&((l=console)===null||l===void 0||l[t==="ERROR"?"error":"debug"](`${t}: ${a}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function T(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=v.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return v.join(e,...t)}}function L(e,t){let n,r,s=!1;const a=h=>E=>{e&&clearTimeout(e),h(E),s=!0},l=new Promise((h,E)=>{n=a(h),r=a(E),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:h=>t=h,resolve:n,reject:r,promise:l,get settled(){return s}}}const i=new Map;window.__injectedUIEffects=i;var c=J(227),m=J.n(c);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const q="application/x-postmate-v1+json";let Y=0;const nt={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},lt=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===q&&!!nt[e.data.postmate];class yt{constructor(t){g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"events",{}),g(this,"childOrigin",void 0),g(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!lt(n,this.childOrigin))return!1;const{data:r,name:s}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&s in this.events&&this.events[s].forEach(a=>{a.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,s)=>{const a=++Y,l=h=>{h.data.uid===a&&h.data.postmate==="reply"&&(this.parent.removeEventListener("message",l,!1),h.data.error?s(h.data.error):r(h.data.value))};this.parent.addEventListener("message",l,!1),this.child.postMessage({postmate:"request",type:q,property:t,args:n,uid:a},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:q,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class bt{constructor(t){g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),g(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!lt(n,this.parentOrigin))return;const{property:r,uid:s,data:a,args:l}=n.data;n.data.postmate!=="call"?((h,E,R)=>{const $=typeof h[E]=="function"?h[E].apply(null,R):h[E];return Promise.resolve($)})(this.model,r,l).then(h=>{n.source.postMessage({property:r,postmate:"reply",type:q,uid:s,value:h},n.origin)}).catch(h=>{n.source.postMessage({property:r,postmate:"reply",type:q,uid:s,error:h},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](a)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:q,value:{name:t,data:n}},this.parentOrigin)}}class mt{constructor(t){g(this,"container",void 0),g(this,"parent",void 0),g(this,"frame",void 0),g(this,"child",void 0),g(this,"childOrigin",void 0),g(this,"url",void 0),g(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(a=>{const l=document.createElement("a");l.href=a;const h=l.protocol.length>4?l.protocol:window.location.protocol,E=l.host.length?l.port==="80"||l.port==="443"?l.hostname:l.host:window.location.host;return l.origin||`${h}//${E}`})(t=t||this.url);let r,s=0;return new Promise((a,l)=>{const h=R=>!!lt(R,n)&&(R.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",h,!1),this.childOrigin=R.origin,a(new yt(this))):l("Failed handshake"));this.parent.addEventListener("message",h,!1);const E=()=>{s++,this.child.postMessage({postmate:"handshake",type:q,model:this.model},n),s===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{E(),r=setInterval(E,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}g(mt,"debug",!1),g(mt,"Model",void 0);class Se{constructor(t){g(this,"child",void 0),g(this,"model",void 0),g(this,"parent",void 0),g(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=s=>{if(s.data.postmate){if(s.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:q},s.origin),this.parentOrigin=s.origin;const a=s.data.model;return a&&Object.keys(a).forEach(l=>{this.model[l]=a[l]}),t(new bt(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:_,createSandboxContainer:U}=window.QSandbox||{};function K(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const s=await window.apis.doAction(["readFile",e]);n({text:()=>s})}catch(s){console.error(s),r(s)}}))}class _t extends u(){constructor(t){super(),p(this,"_pluginLocal",void 0),p(this,"_frame",void 0),p(this,"_root",void 0),p(this,"_loaded",!1),p(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:s}=await _(n,{fetch:K});this._mount(r,document.body);const a=U(t,{elementGetter:()=>{var h;return(h=this._root)===null||h===void 0?void 0:h.firstChild}}).instance.proxy;a.__shadow_mode__=!0,a.LSPluginLocal=this._pluginLocal,a.LSPluginShadow=this,a.LSPluginUser=a.logseq=new Wn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const l=await s(a,!0);this._unmountFns.push(l.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const G=m()("LSPlugin:caller"),et="#await#response#",Ct="#lspmsg#",vt="#lspmsg#error#",At=e=>`#lspmsg#${e}`;class Xt extends u(){constructor(t){super(),N(this,"_pluginLocal",void 0),N(this,"_connected",!1),N(this,"_parent",void 0),N(this,"_child",void 0),N(this,"_shadow",void 0),N(this,"_status",void 0),N(this,"_userModel",{}),N(this,"_call",void 0),N(this,"_callUserModel",void 0),N(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let s=0;const a=new Map,l=L(6e4),h=this._extendUserModel({"#lspmsg#ready#":async $=>{h[At($?.pid)]=({type:P,payload:H})=>{G(`[host (_call) -> *user] ${this._debugTag}`,P,H),n.emit(P,H)},await l.resolve()},"#lspmsg#beforeunload#":async $=>{const P=L(1e4);n.emit("beforeunload",Object.assign({actor:P},$)),await P.promise},"#lspmsg#settings#":async({type:$,payload:P})=>{n.emit("settings:changed",P)},[Ct]:async({ns:$,type:P,payload:H})=>{G(`[host (async) -> *user] ${this._debugTag} ns=${$} type=${P}`,H),$&&$.startsWith("hook")?n.emit(`${$}:${P}`,H):n.emit(P,H)},"#lspmsg#reply#":({_sync:$,result:P})=>{if(G(`[sync host -> *user] #${$}`,P),a.has($)){const H=a.get($);H&&(P!=null&&P.hasOwnProperty(vt)?H.reject(P[vt]):H.resolve(P),a.delete($))}},...t});var E;if(r)return await l.promise,JSON.parse(JSON.stringify((E=this._pluginLocal)===null||E===void 0?void 0:E.toJSON()));const R=new Se(h).sendHandshakeReply();return this._status="pending",await R.then($=>{this._child=$,this._connected=!0,this._call=async(P,H={},Z)=>{if(Z){const B=++s;a.set(B,Z),H._sync=B,Z.setTag(`async call #${B}`),G(`async call #${B}`)}return $.emit(At(h.baseInfo.id),{type:P,payload:H}),Z?.promise},this._callUserModel=async(P,H)=>{try{h[P](H)}catch{G(`[model method] #${P} not existed`)}},setInterval(()=>{if(a.size>100)for(const[P,H]of a)H.settled&&a.delete(P)},18e5)}).finally(()=>{this._status=void 0}),await l.promise,h.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const s=L(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,s)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${et}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,s=new URL(t.options.entry);s.searchParams.set("__v__",t.options.version);const a=document.querySelector(`#${r}`);a&&a.parentElement.removeChild(a);const l=document.createElement("div");l.classList.add("lsp-iframe-sandbox-container"),l.id=r,l.dataset.pid=n;try{var h;const P=(h=await this._pluginLocal._loadLayoutsData())===null||h===void 0?void 0:h.$$0;if(P){l.dataset.inited_layout="true";let{width:H,height:Z,left:B,top:tt,vw:rt,vh:ht}=P;B=Math.max(B,0),B=typeof rt=="number"?`${Math.min(100*B/rt,99)}%`:`${B}px`,tt=Math.max(tt,45),tt=typeof ht=="number"?`${Math.min(100*tt/ht,99)}%`:`${tt}px`,Object.assign(l.style,{width:H+"px",height:Z+"px",left:B,top:tt})}}catch(P){console.error("[Restore Layout Error]",P)}document.body.appendChild(l);const E=new mt({id:n+"_iframe",container:l,url:s.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}});let R,$=E.sendHandshake();return this._status="pending",new Promise((P,H)=>{R=setTimeout(()=>{H(new Error("handshake Timeout")),E.destroy()},4e3),$.then(Z=>{this._parent=Z,this._connected=!0,this.emit("connected"),Z.on(At(t.id),({type:B,payload:tt})=>{var rt,ht;G("[user -> *host] ",B,tt),(rt=this._pluginLocal)===null||rt===void 0||rt.emit(B,tt||{}),(ht=this._pluginLocal)===null||ht===void 0||ht.caller.emit(B,tt||{})}),this._call=async(...B)=>{await Z.call(At(t.id),{type:B[0],payload:Object.assign(B[1]||{},{$$pid:t.id})})},this._callUserModel=async(B,...tt)=>{if(B.startsWith(et))return await Z.get(B.replace(et,""),...tt);Z.call(B,tt?.[0])},P(null)}).catch(Z=>{H(Z)}).finally(()=>{clearTimeout(R)})}).catch(P=>{throw G("[iframe sandbox] error",P),P}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new _t(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,s={},a)=>{var l;return a&&(s.actor=a),(l=this._pluginLocal)===null||l===void 0||l.emit(r,Object.assign(s,{$$pid:t.id})),a?.promise},this._callUserModel=async(...r)=>{var s;let a=r[0];(s=a)!==null&&s!==void 0&&s.startsWith(et)&&(a=a.replace(et,""));const l=r[1]||{},h=this._userModel[a];typeof h=="function"&&await h.call(null,l)}}catch(r){throw G("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ot{constructor(t,n){st(this,"ctx",void 0),st(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class wt{constructor(t){var n,r,s;s=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,s;const a=this.ensureHostScope();return t=(r=I(t))===null||r===void 0?void 0:r.toLowerCase(),(s=a.logseq.api["exper_"+t])===null||s===void 0?void 0:s.apply(a,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Lt=e=>`task_callback_${e}`;class Vt{constructor(t,n,r={}){St(this,"_client",void 0),St(this,"_requestId",void 0),St(this,"_requestOptions",void 0),St(this,"_promise",void 0),St(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((h,E)=>{if(!this._requestId)return E(null);this._client.once(Lt(this._requestId),R=>{R&&R instanceof Error?E(R):h(R)})});const{success:s,fail:a,final:l}=this._requestOptions;this._promise.then(h=>{s?.(h)}).catch(h=>{a?.(h)}).finally(()=>{l?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class jt extends x.EventEmitter{constructor(t){super(),St(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(Lt(r),n?.payload)})}static createRequestTask(t,n,r){return new Vt(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:s,final:a,...l}=t,h=this.ctx.Experiments.invokeExperMethod("request",n,l),E=jt.createRequestTask(this.ctx.Request,h,t);return l.abortable?E:E.promise}get ctx(){return this._ctx}}const Ot=Array.isArray,fe=typeof bn=="object"&&bn&&bn.Object===Object&&bn;var wn=typeof self=="object"&&self&&self.Object===Object&&self;const Mt=fe||wn||Function("return this")(),qt=Mt.Symbol;var Ve=Object.prototype,xn=Ve.hasOwnProperty,Cn=Ve.toString,pe=qt?qt.toStringTag:void 0;const Sn=function(e){var t=xn.call(e,pe),n=e[pe];try{e[pe]=void 0;var r=!0}catch{}var s=Cn.call(e);return r&&(t?e[pe]=n:delete e[pe]),s};var Ze=Object.prototype.toString;const O=function(e){return Ze.call(e)};var M=qt?qt.toStringTag:void 0;const z=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":M&&M in Object(e)?Sn(e):O(e)},V=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},ut=function(e){if(!V(e))return!1;var t=z(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Ft=Mt["__core-js_shared__"];var Bt,te=(Bt=/[^.]+$/.exec(Ft&&Ft.keys&&Ft.keys.IE_PROTO||""))?"Symbol(src)_1."+Bt:"";const Ne=function(e){return!!te&&te in e};var Ke=Function.prototype.toString;const Zt=function(e){if(e!=null){try{return Ke.call(e)}catch{}try{return e+""}catch{}}return""};var On=/^\[object .+?Constructor\]$/,En=Function.prototype,An=Object.prototype,Oe=En.toString,jn=An.hasOwnProperty,kn=RegExp("^"+Oe.call(jn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Tn=function(e){return!(!V(e)||Ne(e))&&(ut(e)?kn:On).test(Zt(e))},Pe=function(e,t){return e?.[t]},Nt=function(e,t){var n=Pe(e,t);return Tn(n)?n:void 0},Pt=function(){try{var e=Nt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ye=function(e,t,n){t=="__proto__"&&Pt?Pt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ee=function(e){return function(t,n,r){for(var s=-1,a=Object(t),l=r(t),h=l.length;h--;){var E=l[e?h:++s];if(n(a[E],E,a)===!1)break}return t}}(),Re=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ee=function(e){return e!=null&&typeof e=="object"},Qe=function(e){return ee(e)&&z(e)=="[object Arguments]"};var Xe=Object.prototype,In=Xe.hasOwnProperty,tn=Xe.propertyIsEnumerable;const kt=Qe(function(){return arguments}())?Qe:function(e){return ee(e)&&In.call(e,"callee")&&!tn.call(e,"callee")},de=function(){return!1};var Wt=Tt&&!Tt.nodeType&&Tt,Ae=Wt&&!0&&zt&&!zt.nodeType&&zt,je=Ae&&Ae.exports===Wt?Mt.Buffer:void 0;const De=(je?je.isBuffer:void 0)||de;var Ln=/^(?:0|[1-9]\d*)$/;const en=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Ln.test(e))&&e>-1&&e%1==0&&e<t},ke=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var Q={};Q["[object Float32Array]"]=Q["[object Float64Array]"]=Q["[object Int8Array]"]=Q["[object Int16Array]"]=Q["[object Int32Array]"]=Q["[object Uint8Array]"]=Q["[object Uint8ClampedArray]"]=Q["[object Uint16Array]"]=Q["[object Uint32Array]"]=!0,Q["[object Arguments]"]=Q["[object Array]"]=Q["[object ArrayBuffer]"]=Q["[object Boolean]"]=Q["[object DataView]"]=Q["[object Date]"]=Q["[object Error]"]=Q["[object Function]"]=Q["[object Map]"]=Q["[object Number]"]=Q["[object Object]"]=Q["[object RegExp]"]=Q["[object Set]"]=Q["[object String]"]=Q["[object WeakMap]"]=!1;const ft=function(e){return ee(e)&&ke(e.length)&&!!Q[z(e)]},nn=function(e){return function(t){return e(t)}};var pt=Tt&&!Tt.nodeType&&Tt,ne=pt&&!0&&zt&&!zt.nodeType&&zt,it=ne&&ne.exports===pt&&fe.process,re=function(){try{var e=ne&&ne.require&&ne.require("util").types;return e||it&&it.binding&&it.binding("util")}catch{}}(),Te=re&&re.isTypedArray;const Ue=Te?nn(Te):ft;var $e=Object.prototype.hasOwnProperty;const rn=function(e,t){var n=Ot(e),r=!n&&kt(e),s=!n&&!r&&De(e),a=!n&&!r&&!s&&Ue(e),l=n||r||s||a,h=l?Re(e.length,String):[],E=h.length;for(var R in e)!t&&!$e.call(e,R)||l&&(R=="length"||s&&(R=="offset"||R=="parent")||a&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||en(R,E))||h.push(R);return h};var oe=Object.prototype;const Kt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||oe)},ze=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var He=Object.prototype.hasOwnProperty;const ie=function(e){if(!Kt(e))return ze(e);var t=[];for(var n in Object(e))He.call(e,n)&&n!="constructor"&&t.push(n);return t},Ie=function(e){return e!=null&&ke(e.length)&&!ut(e)},se=function(e){return Ie(e)?rn(e):ie(e)},on=function(e,t){return e&&Ee(e,t,se)},qe=function(){this.__data__=[],this.size=0},ae=function(e,t){return e===t||e!=e&&t!=t},Rt=function(e,t){for(var n=e.length;n--;)if(ae(e[n][0],t))return n;return-1};var ce=Array.prototype.splice;const sn=function(e){var t=this.__data__,n=Rt(t,e);return!(n<0)&&(n==t.length-1?t.pop():ce.call(t,n,1),--this.size,!0)},an=function(e){var t=this.__data__,n=Rt(t,e);return n<0?void 0:t[n][1]},cn=function(e){return Rt(this.__data__,e)>-1},Be=function(e,t){var n=this.__data__,r=Rt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Yt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Yt.prototype.clear=qe,Yt.prototype.delete=sn,Yt.prototype.get=an,Yt.prototype.has=cn,Yt.prototype.set=Be;const le=Yt,We=function(){this.__data__=new le,this.size=0},Gt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Le=function(e){return this.__data__.get(e)},ln=function(e){return this.__data__.has(e)},he=Nt(Mt,"Map"),me=Nt(Object,"create"),ue=function(){this.__data__=me?me(null):{},this.size=0},Mn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var un=Object.prototype.hasOwnProperty;const Ge=function(e){var t=this.__data__;if(me){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return un.call(t,e)?t[e]:void 0};var fn=Object.prototype.hasOwnProperty;const pn=function(e){var t=this.__data__;return me?t[e]!==void 0:fn.call(t,e)},Fn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=me&&t===void 0?"__lodash_hash_undefined__":t,this};function Dt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Dt.prototype.clear=ue,Dt.prototype.delete=Mn,Dt.prototype.get=Ge,Dt.prototype.has=pn,Dt.prototype.set=Fn;const Me=Dt,Nn=function(){this.size=0,this.__data__={hash:new Me,map:new(he||le),string:new Me}},Ut=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ge=function(e,t){var n=e.__data__;return Ut(t)?n[typeof t=="string"?"string":"hash"]:n.map},dn=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},hn=function(e){return ge(this,e).get(e)},Pn=function(e){return ge(this,e).has(e)},ye=function(e,t){var n=ge(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}xt.prototype.clear=Nn,xt.prototype.delete=dn,xt.prototype.get=hn,xt.prototype.has=Pn,xt.prototype.set=ye;const ve=xt,mn=function(e,t){var n=this.__data__;if(n instanceof le){var r=n.__data__;if(!he||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ve(r)}return n.set(e,t),this.size=n.size,this};function Qt(e){var t=this.__data__=new le(e);this.size=t.size}Qt.prototype.clear=We,Qt.prototype.delete=Gt,Qt.prototype.get=Le,Qt.prototype.has=ln,Qt.prototype.set=mn;const be=Qt,Rn=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function j(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ve;++t<n;)this.add(e[t])}j.prototype.add=j.prototype.push=Rn,j.prototype.has=o;const S=j,X=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},at=function(e,t){return e.has(t)},gt=function(e,t,n,r,s,a){var l=1&n,h=e.length,E=t.length;if(h!=E&&!(l&&E>h))return!1;var R=a.get(e),$=a.get(t);if(R&&$)return R==t&&$==e;var P=-1,H=!0,Z=2&n?new S:void 0;for(a.set(e,t),a.set(t,e);++P<h;){var B=e[P],tt=t[P];if(r)var rt=l?r(tt,B,P,t,e,a):r(B,tt,P,e,t,a);if(rt!==void 0){if(rt)continue;H=!1;break}if(Z){if(!X(t,function(ht,It){if(!at(Z,It)&&(B===ht||s(B,ht,n,r,a)))return Z.push(It)})){H=!1;break}}else if(B!==tt&&!s(B,tt,n,r,a)){H=!1;break}}return a.delete(e),a.delete(t),H},dt=Mt.Uint8Array,_e=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n},Jt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var Et=qt?qt.prototype:void 0,Je=Et?Et.valueOf:void 0;const Gn=function(e,t,n,r,s,a,l){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new dt(e),new dt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ae(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var h=_e;case"[object Set]":var E=1&r;if(h||(h=Jt),e.size!=t.size&&!E)return!1;var R=l.get(e);if(R)return R==t;r|=2,l.set(e,t);var $=gt(h(e),h(t),r,s,a,l);return l.delete(e),$;case"[object Symbol]":if(Je)return Je.call(e)==Je.call(t)}return!1},yr=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e},vr=function(e,t,n){var r=t(e);return Ot(e)?r:yr(r,n(e))},br=function(e,t){for(var n=-1,r=e==null?0:e.length,s=0,a=[];++n<r;){var l=e[n];t(l,n,e)&&(a[s++]=l)}return a},_r=function(){return[]};var wr=Object.prototype.propertyIsEnumerable,Jn=Object.getOwnPropertySymbols;const xr=Jn?function(e){return e==null?[]:(e=Object(e),br(Jn(e),function(t){return wr.call(e,t)}))}:_r,Vn=function(e){return vr(e,se,xr)};var Cr=Object.prototype.hasOwnProperty;const Sr=function(e,t,n,r,s,a){var l=1&n,h=Vn(e),E=h.length;if(E!=Vn(t).length&&!l)return!1;for(var R=E;R--;){var $=h[R];if(!(l?$ in t:Cr.call(t,$)))return!1}var P=a.get(e),H=a.get(t);if(P&&H)return P==t&&H==e;var Z=!0;a.set(e,t),a.set(t,e);for(var B=l;++R<E;){var tt=e[$=h[R]],rt=t[$];if(r)var ht=l?r(rt,tt,$,t,e,a):r(tt,rt,$,e,t,a);if(!(ht===void 0?tt===rt||s(tt,rt,n,r,a):ht)){Z=!1;break}B||(B=$=="constructor")}if(Z&&!B){var It=e.constructor,xe=t.constructor;It==xe||!("constructor"in e)||!("constructor"in t)||typeof It=="function"&&It instanceof It&&typeof xe=="function"&&xe instanceof xe||(Z=!1)}return a.delete(e),a.delete(t),Z},Dn=Nt(Mt,"DataView"),Un=Nt(Mt,"Promise"),$n=Nt(Mt,"Set"),zn=Nt(Mt,"WeakMap");var Zn="[object Map]",Kn="[object Promise]",Yn="[object Set]",Qn="[object WeakMap]",Xn="[object DataView]",Or=Zt(Dn),Er=Zt(he),Ar=Zt(Un),jr=Zt($n),kr=Zt(zn),we=z;(Dn&&we(new Dn(new ArrayBuffer(1)))!=Xn||he&&we(new he)!=Zn||Un&&we(Un.resolve())!=Kn||$n&&we(new $n)!=Yn||zn&&we(new zn)!=Qn)&&(we=function(e){var t=z(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Zt(n):"";if(r)switch(r){case Or:return Xn;case Er:return Zn;case Ar:return Kn;case jr:return Yn;case kr:return Qn}return t});const tr=we;var er="[object Arguments]",nr="[object Array]",gn="[object Object]",rr=Object.prototype.hasOwnProperty;const Tr=function(e,t,n,r,s,a){var l=Ot(e),h=Ot(t),E=l?nr:tr(e),R=h?nr:tr(t),$=(E=E==er?gn:E)==gn,P=(R=R==er?gn:R)==gn,H=E==R;if(H&&De(e)){if(!De(t))return!1;l=!0,$=!1}if(H&&!$)return a||(a=new be),l||Ue(e)?gt(e,t,n,r,s,a):Gn(e,t,E,n,r,s,a);if(!(1&n)){var Z=$&&rr.call(e,"__wrapped__"),B=P&&rr.call(t,"__wrapped__");if(Z||B){var tt=Z?e.value():e,rt=B?t.value():t;return a||(a=new be),s(tt,rt,n,r,a)}}return!!H&&(a||(a=new be),Sr(e,t,n,r,s,a))},or=function e(t,n,r,s,a){return t===n||(t==null||n==null||!ee(t)&&!ee(n)?t!=t&&n!=n:Tr(t,n,r,s,e,a))},Ir=function(e,t,n,r){var s=n.length,a=s,l=!r;if(e==null)return!a;for(e=Object(e);s--;){var h=n[s];if(l&&h[2]?h[1]!==e[h[0]]:!(h[0]in e))return!1}for(;++s<a;){var E=(h=n[s])[0],R=e[E],$=h[1];if(l&&h[2]){if(R===void 0&&!(E in e))return!1}else{var P=new be;if(r)var H=r(R,$,E,e,t,P);if(!(H===void 0?or($,R,3,r,P):H))return!1}}return!0},ir=function(e){return e==e&&!V(e)},Lr=function(e){for(var t=se(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,ir(s)]}return t},sr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},Mr=function(e){var t=Lr(e);return t.length==1&&t[0][2]?sr(t[0][0],t[0][1]):function(n){return n===e||Ir(n,e,t)}},Hn=function(e){return typeof e=="symbol"||ee(e)&&z(e)=="[object Symbol]"};var Fr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nr=/^\w*$/;const qn=function(e,t){if(Ot(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Hn(e))||Nr.test(e)||!Fr.test(e)||t!=null&&e in Object(t)};function Bn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],a=n.cache;if(a.has(s))return a.get(s);var l=e.apply(this,r);return n.cache=a.set(s,l)||a,l};return n.cache=new(Bn.Cache||ve),n}Bn.Cache=ve;const Pr=Bn;var Rr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dr=/\\(\\)?/g;const Ur=function(e){var t=Pr(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Rr,function(n,r,s,a){t.push(s?a.replace(Dr,"$1"):r||n)}),t}),$r=function(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var ar=qt?qt.prototype:void 0,cr=ar?ar.toString:void 0;const zr=function e(t){if(typeof t=="string")return t;if(Ot(t))return $r(t,e)+"";if(Hn(t))return cr?cr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Hr=function(e){return e==null?"":zr(e)},lr=function(e,t){return Ot(e)?e:qn(e,t)?[e]:Ur(Hr(e))},yn=function(e){if(typeof e=="string"||Hn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},ur=function(e,t){for(var n=0,r=(t=lr(t,e)).length;e!=null&&n<r;)e=e[yn(t[n++])];return n&&n==r?e:void 0},qr=function(e,t,n){var r=e==null?void 0:ur(e,t);return r===void 0?n:r},Br=function(e,t){return e!=null&&t in Object(e)},Wr=function(e,t,n){for(var r=-1,s=(t=lr(t,e)).length,a=!1;++r<s;){var l=yn(t[r]);if(!(a=e!=null&&n(e,l)))break;e=e[l]}return a||++r!=s?a:!!(s=e==null?0:e.length)&&ke(s)&&en(l,s)&&(Ot(e)||kt(e))},Gr=function(e,t){return e!=null&&Wr(e,t,Br)},Jr=function(e,t){return qn(e)&&ir(t)?sr(yn(e),t):function(n){var r=qr(n,e);return r===void 0&&r===t?Gr(n,e):or(t,r,3)}},Vr=function(e){return e},Zr=function(e){return function(t){return t?.[e]}},Kr=function(e){return function(t){return ur(t,e)}},Yr=function(e){return qn(e)?Zr(yn(e)):Kr(e)},Qr=function(e){return typeof e=="function"?e:e==null?Vr:typeof e=="object"?Ot(e)?Jr(e[0],e[1]):Mr(e):Yr(e)},Xr=function(e,t){var n={};return t=Qr(t),on(e,function(r,s,a){Ye(n,t(r,s,a),r)}),n};function fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class to{constructor(t,n){fr(this,"ctx",void 0),fr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Ot(r?.blocks)&&(r.blocks=r.blocks.map(s=>s&&Xr(s,(a,l)=>`block/${l}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,s])=>{const a=(l=>`service:search:${l}:${n.name}`)(r);t.caller.on(a,async l=>{if(ut(n?.[s.f])){let h=null;try{h=await n[s.f].apply(n,(s.args||[]).map(E=>{if(l){if(E===!0)return l;if(l.hasOwnProperty(E)){const R=l[E];return delete l[E],R}}})),s.transformOutput&&(h=s.transformOutput(h))}catch(E){console.error("[SearchService] ",E),h=E}finally{s.reply&&t.caller.call(`${a}:reply`,h)}}})})}}function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const eo=Symbol.for("proxy-continue"),no=m()("LSPlugin:user"),pr=new D("",{console:!0});function Fe(e,t,n){var r;const{key:s,label:a,desc:l,palette:h,keybinding:E,extras:R}=t;if(typeof n!="function")return this.logger.error(`${s||a}: command action should be function.`),!1;const $=function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()}(s);if(!$)return this.logger.error(`${a}: command key is required.`),!1;const P=`SimpleCommandHook${$}${++mr}`;this.Editor["on"+P](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:$,label:a,type:e,desc:l,keybinding:E,extras:R},["editor/hook",P]],h]})}function dr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(pr.error(`#${e} is not a valid UUID string.`),!1);var t}let vn=null,hr=new Map;const ro={async getInfo(e){return vn||(vn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?vn[e]:vn},registerCommand:Fe,registerSearchService(e){if(hr.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);hr.set(e.name,new to(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:s}=e;return Fe.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:s},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,s="$shortcut$",a=n.key||s+I(r?.toString());return Fe.call(this,s,{...n,key:a,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;Fe.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:editor:${I(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,s]=e.split(".");if(!["models","commands"].includes(s?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const a=e.replace(`${r}.${s}.`,"");if(!r||!s||!a)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,s.toLowerCase(),a,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let mr=0;const oo={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;no("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[s,...a]=r;if(s==="editor/hook"){let l=a[0],h=()=>{var R;(R=this.caller)===null||R===void 0||R.callUserModel(l)};typeof l=="function"&&(h=l);const E=`SlashCommandHook${s}${++mr}`;r[1]=E,this.Editor["on"+E](h)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;Fe.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;Fe.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},io={onBlockChanged(e,t){if(!dr(e))return;const n=this.baseInfo.id,r=`hook:db:${I(`block:${e}`)}`,s=({block:a,txData:l,txMeta:h})=>{a.uuid===e&&t(a,l,h)};return this.caller.on(r,s),this.App._installPluginHook(n,r),()=>{this.caller.off(r,s),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},so={},ao={},co={makeSandboxStorage(){return new ot(this,{assets:!0})}};class Wn extends u(){constructor(t,n){super(),$t(this,"_baseInfo",void 0),$t(this,"_caller",void 0),$t(this,"_version","0.0.17"),$t(this,"_debugTag",""),$t(this,"_settingsSchema",void 0),$t(this,"_connected",!1),$t(this,"_ui",new Map),$t(this,"_mFileStorage",void 0),$t(this,"_mRequest",void 0),$t(this,"_mExperiments",void 0),$t(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const s=Object.assign({},this.settings),a=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...a},s)}),n.on("beforeunload",async r=>{const{actor:s,...a}=r,l=this._beforeunloadCallback;try{l&&await l(a),s?.resolve(null)}catch(h){this.logger.error("[beforeunload] ",h),s?.reject(h)}})}async ready(t,n){var r,s;if(!this._connected)try{var a;typeof t=="function"&&(n=t,t={});let l=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,s=l,l=b()(r,s,{arrayMerge:(h,E)=>E}),this._baseInfo=l,(a=l)!==null&&a!==void 0&&a.id&&(this._debugTag=this._caller.debugTag=`#${l.id} [${l.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(l.settings=function(h,E){const R=(E||[]).reduce(($,P)=>("default"in P&&($[P.key]=P.default),$),{});return Object.assign(R,h)}(l.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(h){console.warn(h)}n&&n.call(this,l)}catch(l){console.error(`${this._debugTag} [Ready Error]`,l)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return pr}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),T(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,s=this.caller;return new Proxy(t,{get(a,l,h){const E=a[l];return function(...R){if(E){const P=E.apply(r,R.concat(n));if(P!==eo)return P}if(n){const P=l.toString().match(/^(once|off|on)/i);if(P!=null){const H=P[0].toLowerCase(),Z=P.input,B=H==="off",tt=r.baseInfo.id;let rt=Z.slice(H.length),ht=R[0],It=R[1];typeof ht=="string"&&typeof It=="function"&&(ht=ht.replace(/^logseq./,":"),rt=`${rt}${ht}`,ht=It,It=R[2]),rt=`hook:${n}:${I(rt)}`,s[H](rt,ht);const xe=()=>{s.off(rt,ht),s.listenerCount(rt)||r.App._uninstallPluginHook(tt,rt)};return B?void xe():(r.App._installPluginHook(tt,rt,It),xe)}}let $=l;return["git","ui","assets"].includes(n)&&($=n+"_"+$),s.callAsync("api:call",{tag:n,method:$,args:R})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(ro,"app")}get Editor(){return this._makeUserProxy(oo,"editor")}get DB(){return this._makeUserProxy(io,"db")}get Git(){return this._makeUserProxy(so,"git")}get UI(){return this._makeUserProxy(ao,"ui")}get Assets(){return this._makeUserProxy(co,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new ot(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new jt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new wt(this)),t}}function gr(e,t){return new Wn(e,t)}if(window.__LSP__HOST__==null){const e=new Xt(null);window.logseq=gr({},e)}})(),ct})())})(_n,_n.exports);_n.exports;const lo={id:"_zhaochunqi-logseq-livephotos-plugin",icon:"./logo.svg"},uo=lo.id;function fo(){console.info(`#${uo}: MAIN`),logseq.App.onMacroRendererSlotted(async({slot:zt,payload:Tt})=>{const[Ce,Ht,J]=Tt.arguments;if(Ce!==":live-photo"||!Ht||!J)return;const ct=parent.document.getElementById(zt);if(!ct)return;ct.innerHTML="",ct.style.width="100%",ct.style.height="auto",ct.style.display="block";const F=parent.document.createElement("div");F.style.position="relative",F.style.width="100%",F.style.cursor="pointer",F.style.overflow="hidden",F.style.borderRadius="8px";const d=parent.document.createElement("img");d.src=Ht,d.style.width="100%",d.style.height="auto",d.style.display="block",d.style.objectFit="cover";const b=parent.document.createElement("video");b.src=J,b.style.position="absolute",b.style.top="0",b.style.left="0",b.style.width="100%",b.style.height="100%",b.style.objectFit="cover",b.style.opacity="0",b.style.transition="opacity 0.2s ease-in-out",b.style.pointerEvents="none",b.muted=!0,b.playsInline=!0,b.loop=!0;const w=parent.document.createElement("div");w.style.position="absolute",w.style.top="8px",w.style.left="8px",w.style.display="flex",w.style.alignItems="center",w.style.gap="4px",w.style.padding="4px 6px",w.style.borderRadius="4px",w.style.backgroundColor="rgba(255, 255, 255, 0.8)",w.style.backdropFilter="blur(4px)",w.style.zIndex="10",w.style.pointerEvents="none";const A=`
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="black" stroke-width="2"/>
        <circle cx="12" cy="12" r="5" fill="black"/>
        <circle cx="12" cy="12" r="2" fill="white" style="opacity: 0.5"/> 
      </svg>
    `;w.innerHTML=A;const k=parent.document.createElement("span");k.innerText="LIVE",k.style.fontSize="10px",k.style.fontWeight="bold",k.style.color="black",k.style.lineHeight="1",k.style.letterSpacing="0.5px",w.appendChild(k),F.appendChild(d),F.appendChild(b),F.appendChild(w),ct.appendChild(F);const W=async()=>{try{await b.play(),b.style.opacity="1"}catch(f){console.error("Video play failed",f),b.style.opacity="0"}},y=()=>{b.style.opacity="0",setTimeout(()=>{getComputedStyle(b).opacity==="0"&&(b.pause(),b.currentTime=0)},250)};F.addEventListener("mouseenter",W),F.addEventListener("mouseleave",y),F.addEventListener("touchstart",f=>{W()}),F.addEventListener("touchend",y),F.addEventListener("touchcancel",y)})}logseq.ready(fo).catch(console.error);
